{"version":3,"sources":["model/canvas.ts","model/icon.tsx","model/name-preset.ts","model/coordinate-data.tsx","model/dictionary.ts","model/foil-finish.tsx","model/font-data-effect.tsx","model/font-data-name.ts","model/font-data-other.ts","model/format.tsx","model/frame.tsx","model/link.tsx","model/regex.tsx","model/index.tsx","util/categorize.tsx","util/condenser.ts","util/font.tsx","util/gradient.ts","util/navigation.ts","3rd/index.ts","util/codec.ts","util/index.tsx","component/loading/index.tsx","component/icon-button/index.tsx","component/image-cropper/index.tsx","component/link-marker/index.tsx","component/explanation/index.tsx","component/formatting-guide/index.tsx","component/frame-info-block/index.tsx","service/format-change.tsx","service/use-card.ts","service/use-setting.ts","draw/canvas-util.ts","draw/image.ts","draw/letter.ts","draw/text-util.ts","draw/text-analyze.ts","draw/line.ts","draw/text-overhead.ts","draw/text.ts","draw/text-normalize.tsx","draw/predefined-section/effect.ts","draw/predefined-section/with-image.ts","draw/predefined-section/layout.ts","draw/predefined-section/name.ts","draw/predefined-section/type-ability.ts","draw/predefined-section/with-text.ts","service/master-seri.tsx","draw/predefined-section/creator.ts","component/setting/index.tsx","component/app-header/index.tsx","component/index.tsx","page/input-panel/const.tsx","page/input-panel/char-picker/index.tsx","page/input-panel/text-style-picker/gradient-picker.tsx","page/input-panel/text-style-picker/style-picker.styled.tsx","page/input-panel/text-style-picker/grid-slider-input.tsx","page/input-panel/text-style-picker/predefined-option-grid.tsx","page/input-panel/text-style-picker/index.tsx","util/hook.ts","page/input-panel/input-train/input-train.styled.tsx","page/input-panel/input-train/radio-train.tsx","page/input-panel/input-train/frame-train.tsx","page/input-panel/input-train/checkbox-train.tsx","page/input-panel/layout-picker/background-input-group.tsx","page/input-panel/layout-picker/index.tsx","page/input-panel/input-group/card-icon-input-group.tsx","page/input-panel/input-text/util.ts","page/input-panel/input-text/card-text-area.tsx","page/input-panel/input-text/card-text-input.tsx","page/input-panel/input-group/effect-input-group.tsx","page/input-panel/input-checkbox-group.tsx","page/input-panel/input-panel.styled.tsx","page/input-panel/input-group/footer-input-group.tsx","page/input-panel/input-group/image-input-group.tsx","page/input-panel/input-group/name-set-input-group.tsx","page/input-panel/input-group/pendulum-input-group.tsx","page/input-panel/input-group/post-pendulum-input-group.tsx","page/input-panel/index.tsx","page/canvas-panel/download-button.tsx","service/use-card-export.ts","app.styled.tsx","app.tsx","service/use-ocg-font.ts","reportWebVitals.js","index.js"],"names":["BackgroundTypeList","value","label","CanvasConst","DEFAULT_BASE_FILL_COLOR","getDefaultCardOpacity","body","pendulum","text","name","baseFill","artBorder","nameBorder","boundless","CardArtCanvasCoordinateMap","normal","artFinishX","artFinishY","artWidth","artX","artY","ratio","type","extendedCard","extendedPendulum","truePendulum","fullCard","fullPendulum","getArtCanvasCoordinate","isPendulum","opacity","backgroundType","NO_ATTRIBUTE","AttributeList","color","NO_ICON","IconList","CloseCircleOutlined","createPresetNameStyle","map","entry","presetValue","hasGradient","hasOutline","hasShadow","pattern","PresetNameStyleMap","commonB","key","image","preset","fillStyle","commonW","skillDefault","lineWidth","lineColor","skillArial","font","lineOffsetX","rare","secretGradient","gradientAngle","gradientColor","secret","platinum2","ultra","ultra2","platinum","shadowColor","shadowOffsetY","shadowOffsetX","shadowBlur","gold","animeRed","lineOffsetY","animeSilver","animeGold","promo","PresetNameStyleList","Object","values","PatternMap","none","patternImage","blendMode","type1","type2","type3","type4","type5","overrideFill","type6","type7","type8","type9","PatternList","EffectCoordinateData","trueWidth","trueBaseline","trueEdge","PendulumEffectCoordinate","TypeAbilityCoordinateMap","tcg","small","medium","large","edgeAlignment","ocg","CreatorCoordinateMap","ocgKeywordDataList","shortForm","rubyForm","regexForm","rubyFormName","ocgKeywordDataMap","reduce","acc","cur","type3CommonInstruction","type8CommonInstruction","FinishMap","partInstructionMap","ArtFinishMap","art","DefaultFontSizeData","DefaultFontData","DefaultEffectFontData","alphabetFont","furiganaFont","headTextFontRatio","headTextHeightRatio","ordinalFont","symbolFont","symbolFontRatio","DefaultTCGEffectFontData","fontStyle","fontList","DefaultTCGNormalFontData","DefaultOCGEffectFontData","metricMethod","EffectFontData","bulletSymbolWidth","fontSize","lineHeight","lineCount","TCGVanillaTypeStatFontList","PendulumEffectFontData","CondenseTolerantMap","veryStrict","strict","loose","veryLoose","relaxed","NameFontDataMap","Default","fontData","letterSpacing","offsetY","Arial","weight","OCG","headTextOverflow","numberFont","numberFontRatio","headTextSpacing","CreatorFontData","largeSymbolRatio","wordLetterSpacing","tcgTypeAbilityFontData","iconSymbolWidth","capitalLetterRatio","squareBracketRatio","ocgTypeAbilityFontData","tcgToOCGLetterMap","ocgToTCGLetterMap","ocgNumberCircleMap","ocgToTCGTermMap","tcgToOCGTermMap","entries","ocgTerm","FrameInfoMap","labelColor","edition","labelBackgroundColor","labelBackgroundColorList","labelBackgroundImage","join","frameList","arrowPositionList","top","left","width","height","CapitalLetterRegex","RegExp","SquareBracketLetterRegex","WHOLE_WORD_SOURCE","WholeWordRegex","FragmentSplitRegex","NB_WORD_OPEN","NB_WORD_CLOSE","NB_LINE_OPEN","NB_LINE_CLOSE","NB_UNCOMPRESSED_START","NB_UNCOMPRESSED_END","NormalizeTextRegex","NON_BREAKABLE_SYMBOL_SOURCE","nonBreakableSymbolRegex","FLAVOR_CONDITION_SOURCE","TCG_LETTER_JOINLIST","TCGSpecialLetterRegex","OCG_KEYWORD_JOIN_REGEX","OCG_KEYWORD_SOURCE","CHIISAI_KANA_JOINLIST","ChiisaiRegex","NOT_START_OF_LINE_SOURCE","OCGAlphabetRegex","OCGNumberRegex","NumberRegex","HiraganaRegex","KatakanaRegex","OCGDotRegex","ChoonpuRegex","NoSpaceRegex","OCGIncreasedLevel2WidthRegex","OCGIncreasedWidthRegex","OCGNoOverheadGapRegex","OCGOffsetMap","OCGLastOfLineOffsetMap","OCGBoxSpacingRatioMap","TCGOffsetMap","TCGLastOfLineOffsetMap","TCGBoxSpacingRatioMap","getBulletSpacing","format","RUBY_REGEX","BREAKABLE_LETTER","GAP_PER_WIDTH_RATIO","GAP_PADDING_RATIO","getDefaultCard","version","frame","foil","finish","artFinish","nameStyleType","nameStyle","headTextFillStyle","attribute","subFamily","cardIcon","star","artCrop","x","y","unit","aspect","hasBackground","background","backgroundCrop","linkMap","pendulumFrame","pendulumEffect","pendulumScaleRed","pendulumScaleBlue","typeAbility","effectStyle","condenseTolerant","effect","setId","atk","def","password","sticker","isFirstEdition","isSpeedCard","isDuelTerminalCard","creator","furiganaHelper","getEmptyCard","OpacityList","subType","tooltip","checkXyz","card","checkLink","checkMonster","checkSpeedSkill","getCardIconFromFrame","checkLightFrame","includes","resolveNameStyle","isSpeedSkill","lightHeader","checkLightHeader","contextualFont","contextualColor","resultNameStyle","contextualOutline","strokeStyle","foilStyle","frameStyle","MAX_CONDENSER_THRESHOLD","createCondenser","minThreshold","maxThreshold","min","max","median","lastEffective","iterateCount","magnitude","magnitudeReductionRatio","reverseSearch","Math","searchDown","reset","getMedian","setMedian","newMedian","setLastEffective","forceMedian","getLastEffective","applyLastEffective","getIterateCount","condense","worker","effectiveMedian","condenser","finalMedian","satisfy","forcedMedian","createFontGetter","props","defaultWeight","defaultStyle","defaultSize","defaultFamily","style","size","sizeAsNumber","parseFloat","replaceAll","family","getFont","filter","part","getFontInfo","setWeight","nextWeight","this","setStyle","nextStyle","setSize","nextSize","calculatedSize","setFamily","nextFamily","stringifyPalette","palette","offset","parsePalette","stringifiedPalette","split","index","id","getNavigationProps","debug","optionLength","stopPropagation","setFocus","onTrigger","onCancel","onKeyPress","tabIndex","onFocus","console","info","onBlur","onKeyDown","e","preventDefault","JSONUncrush","n","substring","length","r","pop","JSONCrushSwap","o","replace","cardFieldShortenMap","_newKey","artFrame","passcode","picture","pictureCrop","decodeCardWithCompatibility","cardData","decodedCard","rebuildCardData","error","legacyRebuildCardData","notification","message","description","compressCardData","shortenMap","serialize","condensedCard","keys","forEach","fieldKey","fieldValue","Array","isArray","newFieldKey","newKey","JSON","stringify","decompressCardData","fullKey","shortenKey","shortendKey","legacyReverseCardDataShortener","normalizedCondensedCard","parse","decodeURIComponent","normalizedCard","migrateCardData","isCondensed","migratedCard","clone","kanjiHelper","undefined","randomCharacter","charSet","result","charactersLength","i","charAt","floor","random","insertUrlParam","window","history","pushState","searchParams","URLSearchParams","location","search","set","newurl","protocol","host","pathname","toString","path","normalizedCardName","isMobileDevice","a","check","navigator","userAgent","vendor","opera","test","substr","mergeClass","args","Boolean","StyledLoadingFullViewContainer","styled","div","Loading","FullView","className","StyledIconButtonContainer","span","IconButton","Icon","onClick","iconProps","tooltipProps","containerProps","customOnClick","restContainerProps","normalizeCrop","crop","cropWidth","cropHeight","imageWidth","imageHeight","scaleRatio","nextX","nextY","newWidth","naturalHeight","naturalWidth","acceptableError","isRatioAcceptable","abs","ImageCropper","React","forwardRef","forwardedRef","title","backgroundColor","defaultExternalSource","receivingCanvas","children","beforeCropper","defaultCropInfo","onSourceLoaded","onSourceChange","onCropChange","onTainted","useState","crossorigin","redrawSignal","setRedrawSignal","sourceType","setSourceType","inputMode","setInputMode","internalSource","setInternalSource","isLoading","setLoading","setError","externalSource","setExternalSource","imgRef","useRef","current","completed","setCrop","isMigrated","setMigrated","currentCrop","completedCrop","pendingCrop","source","onLoad","useCallback","img","src","internalId","pendingId","setTimeout","normalizedCrop","useEffect","transform","ctx","getContext","zoomX","zoomY","cropUnit","pixelRatio","devicePixelRatio","setTransform","expectedDrawWidth","drawWidth","expectedDrawHeight","drawHeight","drawCoordinateX","drawCoordinateY","imageSmoothingQuality","fitCropData","drawImage","newValue","useImperativeHandle","setRatio","forceExternalSource","cropInfo","isDownloadable","DownloadOutlined","overlay","canvas","toBlob","blob","previewUrl","URL","createObjectURL","anchor","document","createElement","download","href","click","revokeObjectURL","generateDownload","Group","onChange","target","Button","checked","ExclamationCircleOutlined","placeholder","maxLength","allowClear","accept","files","reader","FileReader","addEventListener","readAsDataURL","alert","imageStyle","backgroundImage","process","onImageLoaded","onImageError","clearRect","_","percentCropData","onComplete","percentData","ruleOfThirds","LinkMarkChooser","defaultValue","choosenArrow","setChoosenArrow","rotateMap","literalChoosenArrow","normalizedIndex","newMap","push","Explanation","overlayClassName","rest","restIconProps","StyledCode","StyledPanel","StyledImageWithCaptionContainer","ImageWithCaption","caption","alt","FormattingHelpDrawer","modalOpen","setDrawerOpen","footer","visible","onClose","SettingFilled","BulbFilled","StyledFrameContainer","$withPillar","StyledFramePillar","FrameInfoBlock","changeCardFormat","targetFormat","termMap","newSetId","retrieveSavedCard","localCardVersion","localStorage","getItem","localCardData","cardURLData","get","VariantConfigMap","debounce","wait","throttle","useCard","create","setCard","cardTransform","getUpdater","valueTransform","variant","returnFunction","variantConfig","useSetting","cachedStore","allowHotkey","reduceMotionColor","showCreativeOption","showExtraDecorativeOption","setting","updateSetting","transformerOrPayload","currentStore","newSetting","setItem","CanvasHeight","CanvasWidth","drawMarker","edge","baseline","xRatio","currentFillStyle","beginPath","rect","fillTextLeftWithSpacing","str","letterSpacingRatio","option","stroke","textAlign","charList","curLeft","char","fillText","strokeText","measureText","fillTextRightWithSpacing","curRight","c","clearCanvas","getFinishIterator","finishMap","caller","Promise","resolve","finishType","finishInformation","instructionList","globalCompositeOperation","globalAlpha","imageCacheMap","drawFrom","sx","sy","ready","normalizedX","normalizedY","Image","onload","onerror","drawAsset","drawFromWithSize","dw","dh","normalizedW","normalizedH","drawAssetWithSize","getLetterWidth","letter","isLastOfLine","boundWidth","boxSpacingRatioMap","offsetMap","lastOfLineOffsetMap","metric","actualBoundWidth","actualBoundingBoxLeft","actualBoundingBoxRight","kerningScaleRatio","spacingRatio","offsetRatio","letterBoxSpacing","standardMetricRatio","actualLetterWidth","drawLetter","letterMetric","textDrawer","letterWidth","scaledBoundingWidth","scaledBaseline","scaledEdge","tokenizeText","keepControlCharacter","regex","token","getTextWorker","fontSizeData","fontController","numberFontMemory","symbolFontMemory","ordinalFontMemory","furiganaFontMemory","largerTextFontMemory","applyNumberFont","stopApplyNumberFont","applyLargerText","fontRatio","stopApplyLargerText","applySymbolFont","stopApplySymbolFont","applyOrdinalFont","stopApplyOrdinalFont","applyFuriganaFont","bold","stopApplyFuriganaFont","applyAsymmetricScale","yRatio","scale","applyScale","xScale","yScale","resetScale","reverseScale","scaleValue","drawBullet","spaceAfter","bulletRadius","arc","PI","fill","analyzeHeadText","footText","footTextWidth","headText","headTextLetterWidth","headTextGap","gapPadding","fitFootText","sentenceXRatio","noHeadText","condenseHeadText","alignCenterLetterSpacing","internalXRatio","alignCenterHeadTextWidth","alignEvenlyLetterSpacing","alignEvenlyHeadTextWidth","alignment","trueHeadTextWidth","headTextWidth","baseHalfGap","halfGap","headTextXRatio","getLostLeftWidth","prevGap","curGap","analyzeToken","rawToken","nextToken","previousTokenGap","textData","totalWidth","leftMostLetter","spaceCount","spaceAtEnd","rightGap","leftGap","currentFont","fontLevel","defaultGap","currentRightGap","offsetable","leftMostGap","fragmentList","cnt","isLeftmostFragment","fragment","fragmentWidth","rubyType","lostLeftWidth","normalizedWordSpacingRatio","remainFragment","currentLetter","nextRemainFragment","slice","createLineList","paragraphList","additionalLineCount","currentLineList","currentLineCount","accumulatedLineCount","curr","baseXRatio","scaledWidth","tokenList","addedLineCount","wordList","currentLineWidth","currentGap","unCompressedFlag","tokenWidth","line","trim","isLast","actualLineWidth","fillHeadText","textWorker","externalHeadTextXRatio","overflow","baseLoneTokenRatio","finalizedRatio","currentEdge","boundingOffset","drawLine","spaceWidth","iconPositionList","previousTokenRebalanceOffset","tokenEdge","tokenCnt","gapRatio","next2ndToken","analyzeTokenParameter","drawLetterParameter","tokenRightGap","totalTokenWidth","indent","fragmentEdge","fragmentCnt","nextFragment","next2ndFragment","vacantLeftWidth","isNextTokenOffsetable","nextLeftGap","lostRightWidth","totalVacantSpace","rebalancedSpace","nextTokenRebalanceOffset","footTextFragmentEdge","currentStrokeStyle","currentShadowColor","currentShadowOffsetX","currentShadowOffsetY","currentShadowBlur","fragmentNaiveWidth","currentPosition","drawLetterofWordParameter","letterOffset","round","normalizeCardText","multiline","dictionaryType","nonNullableText","normalizedText","letterSwapMap","textAfterJoinRow","textAfterDetectBlockWord","m","correspondingCircleSymbol","textAfterProcessing","keywordSubtitue","textAfterNormalizeBlockWord","currentDepth","getEffectSizeAndCoordinate","isNormal","statInEffect","typeInEffect","coordinateKey","fontDataKey","sizeList","drawEffect","content","effectSizeLevel","normalizedContent","tolerancePerSentence","materialReplacement","material","effectText","fullLineList","wholeLineRegex","exec","effectFlavorCondition","flavorConditionRegex","potentialFlavorConditionText","splitEffect","trueWidthStart","trueBaselineStart","lineListWithRatio","fullLineListWithRatio","totalContentWidth","lineSpaceCount","expectedSpaceWidth","analyzeLine","drawStarIcon","onStarDraw","starWidth","starCount","reverseAlign","leftEdge","all","coordinate","drawSticker","toLowerCase","drawPredefinedMark","isLink","bordered","drawLinkRatingText","topToPendulumStructure","pendulumStructureHeight","leftToPendulumStructure","getLayoutDrawFunction","artworkCanvas","backgroundCanvas","bottomFrame","pendulumSize","isXyz","loopFinish","loopArtFinish","keepArtBorder","opacityBody","opacityName","opacityPendulum","opacityText","effectBoxY","hasFoil","frameBorderType","nameBorderType","applyArtFinish","resultAPI","calculateCardArtRedrawCoordination","imageCanvas","customOpacity","extraHeightRatio","customBackgroundType","normalizedOpacity","bodyOpacity","imageScaledRatio","sourceOffsetX","destinationOffsetX","sourceOffsetY","destinationOffsetY","offsetHeight","destinationX","destinationY","destinationWidth","destinationHeight","drawFrame","drawCardArt","drawBackground","boundary","backgroundWidth","backgroundHeight","redrawCoordination","backgroundSourceOffsetX","backgroundSourceOffsetY","backgroundOffsetHeight","backgroundDestinationX","backgroundDestinationY","backgroundDestinationWidth","backgroundDestinationHeight","drawAttribute","drawStar","normalizedCardIcon","drawPendulumScaleIcon","drawLinkArrowMap","isActive","baseLink","activeLink","drawNameBackground","drawEffectBackground","withPendulum","effectBoxX","drawFrameBorder","drawNameBorder","drawArtBorder","artFrameSource","drawPendulumBorder","foilType","drawEffectBorder","drawCardBorder","drawArtBorderFoil","drawEffectBorderFoil","drawLinkMapFoil","withBorder","drawNameFinish","drawAttributeFinish","drawArtFinish","drawArtOverlayFinish","drawArtBorderFinish","drawPendulumArtBorderFinish","drawBorderPendulumFinish","drawFrameFinish","drawFrameBackgroundFinish","drawOverlayFinish","overlayType","drawCardBorderFinish","getNameGradient","angleAsDegree","colorStopList","contentWidth","maxAscent","maxDescent","baseKAF","quarterSlot","KAF","originHeight","cx","cy","AD","sqrt","FDA","asin","AF","sin","AL","FL","cos","offsetX","topX","topY","botX","botY","gradient","createLinearGradient","addColorStop","drawName","cloneNode","cloneCtx","hasDefaultOutline","patternBlendMode","fontGetter","quoteConvertedValue","crudeTokenList","fontGetterForWidthCalculating","normalStyle","symbolStyle","textMetric","actualBoundingBoxAscent","actualBoundingBoxDescent","internalEffectiveMedian","lineJoin","defaultTextStyle","sizeMap","drawTypeAbilityText","drawTypeAbility","isMonster","willDrawTypeAbility","typeAbilityWithIcon","willDrawIcon","normalizedTypeAbilityText","drawScale","digitList","digit","accLeft","drawStatText","cursorEndOfATK","drawStat","statWidth","tokenizedText","prev","nextWidth","condenseRatio","arr","curText","nextEdge","useMasterSeriDrawer","active","canvasMap","drawCanvasRef","artworkCanvasRef","backgroundCanvasRef","frameCanvasRef","creatorCanvasRef","effectCanvasRef","nameCanvasRef","passwordCanvasRef","pendulumEffectCanvasRef","pendulumScaleCanvasRef","setIdCanvasRef","statCanvasRef","stickerCanvasRef","cardIconCanvasRef","typeCanvasRef","finishCanvasRef","lightboxCanvasRef","checkNormal","requireShadow","lightFooter","normalizedSubFamily","toUpperCase","normalizedTypeAbility","isInitializing","imageChangeCount","readyToDraw","useMemo","drawingPipeline","order","rerun","instructor","hasArtBorder","fillBaseColor","w","h","fillRect","artHeight","withShadow","spacing","xOffset","drawSetId","endOfPassword","drawPassword","baselineOffset","draw1stEdition","internalTextData","internalTrueWidth","drawCreatorText","typeCtx","effectIndexSize","drawHistory","onExport","exportProps","canvasRef","exportCtx","generateLayer","canvasLayer","delayQueue","url","layer","sort","l","rotate","keyframes","StyledSettingPanel","StyledSettingButtonContainer","$softMode","css","SettingButton","trigger","placement","Affiliation","rel","GithubFilled","StyledAppSettingContainer","AppHeader","TaintedCanvasWarning","display","StandaloneLabel","StyledDropdownOption","StyledDropdown","Container","Option","FormatButtonList","fontWeight","FoilButtonList","FinishButtonList","NameFontOptionList","ArtFinishButtonList","getFrameButtonList","STIconButtonList","StarButtonList","IconTypeMap","fullLabel","IconTypeList","StickerButtonList","CondenseThresholdButtonList","StyledCharPickerContainer","CharPicker","targetId","onPick","internalOnPick","inputTarget","getElementById","myValue","selection","focus","createRange","position","selectionStart","startPos","endPos","selectionEnd","insertAtCursor","WrappedColorPicker","ref","onSelect","onOffsetChange","onRemove","internalColor","setInternalColor","internalOffset","setInternalOffset","setInternalId","debouncedOnChange","setColor","setCurrentOffset","parseInt","styles","default","picker","boxShadow","padding","disableAlpha","hex","onChangeComplete","getPaletteInfo","newColorList","colorList","raw","TextGradientPicker","externalPalette","angle","externalAngle","memoizedOnChange","pickerRef","setAngle","intialPalette","currentControlId","setPalette","changePalette","nextColorList","newPalette","setPickerOnMount","relevant","targetColor","find","disabled","Number","paletteHeight","maxStops","minStops","stopRemovalDrop","onPaletteChange","onColorStopSelect","stopColor","nextId","StyledPickerButton","$active","StyledPatternContainer","StyledPatternOption","StyledPredefinedContainer","StyledPredefinedOption","GridSliderInput","fieldMap","labelMap","xField","yField","colorField","widthField","xValue","yValue","colorValue","widthValue","setValue","widthLabel","nextValue","keyList","axis","track","gridRow","thumb","zIndex","xmax","xmin","ymax","ymin","PredefinedOptionGrid","containerRef","TextStylePicker","frameInfo","defaultType","undebouncedOnChange","optionGridRef","predefinedDropdownVisible","setPredefinedDropdownVisible","setType","setCnt","useRefresh","customStyleSignal","sendCustomStyleSignal","memoizedOnGradientChange","reduceColorMotion","state","shadowPickeRef","outlinePickeRef","currentValue","patternStyle","isStyleCustom","isStylePredefined","optionInputContainerId","applyAutoStyle","applyPredefinedStyle","applyCustomStyle","onVisibleChange","CaretDownOutlined","fontValue","InputTrainStyle","TrainGridStyle","StyledRadioTrainContainer","RadioTrain","activeValue","optionList","internalRef","isChecked","StyledFrameTrain","FrameTrain","onSTFrameChange","useShallow","changeFrame","frameValue","currentCard","nextFrame","isST","newTypeAbility","StyledCheckboxTrainContainer","CheckboxTrain","StyledImageCropper","BackgroundInputGroup","imageCropperRef","changeBackground","changeBackgroundCrop","StyledLayoutPickerContainer","StyledBaseFillPickerContainer","LayoutPicker","backgroundInputVisible","setBackgroundInputVisible","backgroundInputHidden","setBackgroundInputHidden","setOpacity","backgroundInputRef","changeBackgroundType","changeHasBackground","noBackground","activable","destroyTooltipOnHide","BorderOuterOutlined","step","CardIconInputGroup","isDarkSynchro","changeCardIcon","changeSubFamily","changeStar","iconTypeData","IconDropdownLabel","IconDropdown","DropdownChildren","availableCommand","Set","resolveHotkey","allowNewLine","onResult","selectedText","keepInline","wrappedText","cursorOffset","placeCursorInInput","querySelector","TextArea","Input","CardTextArea","onTakePicker","immediateValue","cursorData","setCursorData","internalOnChange","eventOrValue","normalizedValue","externalSetValue","getPickerRef","autoComplete","spellCheck","ev","ctrlKey","metaKey","currentTarget","has","joinedText","CardTextInput","EffectInputGroup","effectInputRef","changeEffect","getState","rows","StyledCheckboxGroup","CardCheckboxGroup","onFirstEditionChange","onDuelTerminalCardChange","onSpeedCardChange","StyledPendulumFrameContainer","StyledInputLabelWithButton","StyledNameSetIdInputContainer","StyledFormatRadioTrain","StyledFooterInputContainer","FooterInputGroup","passwordInputRef","creatorInputRef","atkInputRef","defInputRef","changeATK","changeDEF","changePassword","onStickerChange","changeCreator","addonBefore","SyncOutlined","StyledImageRadioTrain","ImageInputGroup","changeLinkMap","changePicture","changeArtFinish","changeImageCrop","StyledNameInputContainer","NameSetInputGroup","nameInputRef","setIdInputRef","changeSetId","changeName","cursor","clipboard","writeText","randomSetID","BottomFrameOptionGrid","recentCustomPendulumFrame","inputRef","StyledPendulumFrameInputContainer","StyledPendulumInputContainer","PendulumInputGroup","bottomFrameOptionGridRef","pendulumEffectInputRef","isMirrorScale","setMirrorScale","frameDropdownVisible","setFrameDropdownVisibleVisible","onRedScaleChange","onBlueScaleChange","changePendulumEffect","currentPendulumFrame","willBecomePendulum","StyledPostPendulumInputContainer","PostPendulumInputGroup","typeAbilitySeparator","typeAbilityInputRef","changeTypeAbility","toggleFuriganaHelper","isOCG","onCondenseTolerantChange","CardInputPanel","stylePickerRef","stylePickerResetCount","setStylePickerResetCount","imageInputGroupRef","layoutPickerRef","nameSetIdInputGroupRef","pendulumInputGroupRef","effectInputGroupRef","postPendulumInputGroupRef","footerInputGroupRef","pickerTarget","setPickerTarget","changeFoil","onFinishChange","changeOpacity","changeAttribute","changeNameStyle","attributeList","getAttributeList","forceCardData","formatValue","nextFormat","formatSwappedCard","DownloadButton","isTainted","onDownloadError","exportRef","currentPipeline","pipelineRunning","isDownloading","setDownloading","onDownloadComplete","onSave","pendingSave","normalizedName","link","toDataURL","classList","remove","confirmReload","setAttribute","isRelevant","add","removeEventListener","useCardExport","loading","StyledDataButtonPanelContainer","StyledCardCanvasGroupContainer","StyledAppLoading","StyledByMe","ErrorAlert","OverlayButton","LightboxButton","ResetButton","configure","ignoreTags","AppGlobalHotkeyMap","EXPORT","IMPORT","VIEW","DOWNLOAD","App","softMode","setInitializing","canvasKey","setCanvasKey","lightboxVisible","setLightboxVisible","cardInputRef","downloadButtonRef","setImageChangeCount","WebFont","load","custom","families","urls","fontinactive","familyName","fvd","inactive","ocgStyleFile","onActive","onBeforeLoad","onFontInactive","onInactive","styleContent","setStyleContent","ocgReady","loadAttempt","useOCGFont","setTainted","documentClassList","importData","event","prompt","exportData","exportableCard","downloadFromHotkey","hotkeyHandlerMap","alertDownloadError","rerenderAllImage","rerenderCardImage","markTaintedImage","keyMap","handlers","onDrop","confirm","defaultCard","contextualDefaultCardData","ClearOutlined","ZoomInOutlined","onContextMenu","wrapClassName","forceRender","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode"],"mappings":"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U,wBAEd,CACID,UAAW,qBACXC,SAAU,wBAEd,CACID,UAAW,qBACXC,SAAU,wBAEd,CACID,UAAW,KACXE,UAAW,oBACXD,SAAU,uCAEd,CACID,UAAW,iCACXC,SAAU,oCAEd,CACID,UAAW,eACXC,SAAU,kCAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,qBACXC,SAAU,wBAEd,CACID,UAAW,iCACXC,SAAU,oCAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,6CACXC,SAAU,gDAEd,CACID,UAAW,qBACXC,SAAU,8CAEd,CACID,UAAW,2BACXC,SAAU,8BAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,qBACXC,SAAU,wBAEd,CACID,UAAW,2BACXC,SAAU,8BAEd,CACID,UAAW,2BACXC,SAAU,8BAEd,CACID,UAAW,2BACXC,SAAU,8BAEd,CACID,UAAW,eACXC,SAAU,oDAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,eACXC,SAAU,oDAEd,CACID,UAAW,qBACXC,SAAU,wBAEd,CACID,UAAW,2BACXC,SAAU,8BAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,eACXC,SAAU,oDAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,iCACXC,SAAU,oCAEd,CACID,UAAW,2BACXC,SAAU,8BAEd,CACID,UAAW,qBACXC,SAAU,wBAEd,CACID,UAAW,iCACXC,SAAU,oCAEd,CACID,UAAW,qBACXC,SAAU,wBAEd,CACID,UAAW,qBACXC,SAAU,wBAEd,CACID,UAAW,2BACXC,SAAU,8BAEd,CACID,UAAW,2BACXC,SAAU,8BAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,oDAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,SACXC,SAAU,qCAEd,CACID,UAAW,iCACXC,SAAU,kCAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,iCACXC,SAAU,oCAEd,CACID,UAAW,qBACXC,SAAU,wBAEd,CACID,UAAW,qBACXC,SAAU,wBAEd,CACID,UAAW,2BACXC,SAAU,8BAEd,CACID,UAAW,qBACXC,SAAU,yEAEd,CACID,UAAW,qBACXC,SAAU,mEAEd,CACID,UAAW,eACXC,SAAU,oDAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,iCACXC,SAAU,oCAEd,CACID,UAAW,2BACXC,SAAU,8BAEd,CACID,UAAW,iCACXC,SAAU,oCAEd,CACID,UAAW,2BACXC,SAAU,8BAEd,CACID,UAAW,2BACXC,SAAU,8BAEd,CACID,UAAW,2BACXC,SAAU,8BAEd,CACID,UAAW,iCACXC,SAAU,oCAEd,CACID,UAAW,2BACXC,SAAU,8BAEd,CACID,UAAW,SACXC,SAAU,+BAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SAAU,mBAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SAAU,+BAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,qBACXC,SAAU,mEAEd,CACID,UAAW,qBACXC,SAAU,mEAEd,CACID,UAAW,iCACXC,SAAU,oCAEd,CACID,UAAW,eACXC,SAAU,0DAEd,CACID,UAAW,qBACXC,SAAU,yEAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,SACXC,SAAU,+BAEd,CACID,UAAW,uCACXC,SAAU,0CAEd,CACID,UAAW,qBACXC,SAAU,6DAEd,CACID,UAAW,eACXC,SAAU,oDAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,eACXC,SAAU,oDAEd,CACID,UAAW,qBACXC,SAAU,mEAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,oDAEd,CACID,UAAW,2BACXC,SAAU,mEAEd,CACID,UAAW,SACXC,SAAU,qCAEd,CACID,UAAW,eACXC,SAAU,0DAEd,CACID,UAAW,eACXC,SAAU,oDAEd,CACID,UAAW,iCACXC,SAAU,oCAEd,CACID,UAAW,iCACXC,SAAU,oCAEd,CACID,UAAW,2BACXC,SAAU,kFAEd,CACID,UAAW,uCACXC,SAAU,0CAEd,CACID,UAAW,2BACXC,SAAU,sEAEd,CACID,UAAW,qBACXC,SAAU,uDAEd,CACID,UAAW,qBACXC,SAAU,wBAEd,CACID,UAAW,iCACXC,SAAU,oCAEd,CACID,UAAW,qBACXC,SAAU,+BAEd,CACID,UAAW,qBACXC,SAAU,qCAEd,CACID,UAAW,iCACXC,SAAU,iDAEd,CACID,UAAW,qBACXC,SAAU,qCAEd,CACID,UAAW,qBACXC,SAAU,qCAEd,CACID,UAAW,2BACXC,SAAU,8CAEd,CACID,UAAW,2BACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,+BAEd,CACID,UAAW,eACXC,SAAU,qCAEd,CACID,UAAW,eACXC,SAAU,+BAEd,CACID,UAAW,eACXC,SAAU,+BAEd,CACID,UAAW,eACXC,SAAU,yBAEd,CACID,UAAW,qBACXC,SAAU,wBAEd,CACID,UAAW,iCACXC,SAAU,oCAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,eACXC,SAAU,oDAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,2BACXC,SAAU,8BAEd,CACID,UAAW,2BACXC,SAAU,8BAEd,CACID,UAAW,iCACXC,SAAU,oCAEd,CACID,UAAW,uCACXC,SAAU,0CAEd,CACID,UAAW,qBACXC,SAAU,wBAEd,CACID,UAAW,MACXE,UAAW,qBACXD,SAAU,sEAEd,CACID,UAAW,IACXE,UAAW,mBACXD,SAAU,gCAEd,CACID,UAAW,IACXE,UAAW,mBACXD,SAAU,sCAEd,CACID,UAAW,IACXE,UAAW,mBACXD,SAAU,0BAEd,CACID,UAAW,IACXE,UAAW,mBACXD,SAAU,4CAEd,CACID,UAAW,qBACXC,SAAU,wBAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,eACXC,SAAU,oDAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SAAU,+BAEd,CACID,UAAW,2BACXC,SAAU,8BAEd,CACID,UAAW,iCACXC,SAAU,oCAEd,CACID,UAAW,qBACXC,SAAU,qCAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,eACXC,SAAU,oDAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,eACXC,SAAU,kCAEd,CACID,UAAW,eACXC,SAAU,0DAEd,CACID,UAAW,eACXC,SAAU,+BAEd,CACID,UAAW,eACXC,SAAU,yBAEd,CACID,UAAW,YACXE,UAAW,qCACXD,SAAU,gEACVE,aAAc,iEAElB,CACIH,UAAW,WACXE,UAAW,oCACXD,SAAU,6CACVE,aAAc,8CAElB,CACIH,UAAW,KACXE,UAAW,8BACXD,SAAU,yDAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,eACXC,SAAU,oDAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,eACXC,SAAU,kCAEd,CACID,UAAW,eACXC,SAAU,wCAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,eACXC,SAAU,8CAEd,CACID,UAAW,SACXC,SAAU,mBAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SAAU,mBAEd,CACID,UAAW,SACXC,SAAU,mBAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SAAU,mBAEd,CACID,UAAW,SACXC,SAAU,mBAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SAAU,mBAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SAAU,mBAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SAAU,yBAEd,CACID,UAAW,SACXC,SA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CL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,SACL,SAAK,SACL,SAAK,SAEL,IAAK,SAKL,SAAK,SACL,SAAK,SACL,SAAK,SACL,SAAK,SACL,SAAK,SACL,SAAK,SACL,SAAK,SACL,SAAK,SACL,SAAK,SACL,SAAK,SACL,SAAK,SACL,SAAK,SACL,SAAK,SACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,KAEIC,GAA4C,CACrD,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IACL,SAAK,IAEL,SAAK,SACL,SAAK,SACL,SAAK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","file":"static/js/main.c983a2b2.chunk.js","sourcesContent":["export const BackgroundTypeList = [\r\n    {\r\n        value: 'fit' as const,\r\n        label: 'Fit to art border',\r\n    },\r\n    {\r\n        value: 'full' as const,\r\n        label: 'Span all the card',\r\n    },\r\n];\r\nexport type BackgroundType = typeof BackgroundTypeList[0]['value'];\r\n\r\n/**\r\n * @summary About x y headache.\r\n * \r\n * * Normal (True): Actual position / size on the card. If the coordinate / size is multiplied by a ratio, it is likely a normal value.\r\n * * Scaled: Position or size on a hypothesis (scaled) canvas. For example a 1000px wide canvas with scaleX of 0.5 can be treated as a 2000px wide canvas with scaleX of 1. So draw a point at x 50 in this hypothesis canvas will result an actual point at x = 25. If the coordinate / size is divided by a ratio, it is likely a scaled value.\r\n * * Inverse-scaled: Position or size on a hypothesis canvas. For example a letter that much has exactly 50px wide on every scale. So in a 1000px wide canvas with scaleX of 0.5 the letter actually has 100px width, and vice versa in a 1000px wide canvas with scaleX of 2.0, the letter will have 25px width only.\r\n */\r\nexport type MasterSeriesCanvas = {\r\n    artworkCanvasRef: React.RefObject<HTMLCanvasElement>,\r\n    backgroundCanvasRef: React.RefObject<HTMLCanvasElement>,\r\n    drawCanvasRef: React.RefObject<HTMLCanvasElement>,\r\n    frameCanvasRef: React.RefObject<HTMLCanvasElement>,\r\n    cardIconCanvasRef: React.RefObject<HTMLCanvasElement>,\r\n    pendulumScaleCanvasRef: React.RefObject<HTMLCanvasElement>,\r\n    pendulumEffectCanvasRef: React.RefObject<HTMLCanvasElement>,\r\n    typeCanvasRef: React.RefObject<HTMLCanvasElement>,\r\n    effectCanvasRef: React.RefObject<HTMLCanvasElement>,\r\n    nameCanvasRef: React.RefObject<HTMLCanvasElement>,\r\n    statCanvasRef: React.RefObject<HTMLCanvasElement>,\r\n    setIdCanvasRef: React.RefObject<HTMLCanvasElement>,\r\n    passwordCanvasRef: React.RefObject<HTMLCanvasElement>,\r\n    creatorCanvasRef: React.RefObject<HTMLCanvasElement>,\r\n    stickerCanvasRef: React.RefObject<HTMLCanvasElement>,\r\n    finishCanvasRef: React.RefObject<HTMLCanvasElement>,\r\n    lightboxCanvasRef: React.RefObject<HTMLCanvasElement>,\r\n};\r\n\r\n/** Some coordination data must be rounded into nearest integer so it does not create those janky ghost pixels. */\r\nexport const CanvasConst = {\r\n    width: 813,\r\n    height: 1185,\r\n    topToPendulumStructure: 210,\r\n    pendulumStructureHeight: 912,\r\n    leftToPendulumStructure: 52,\r\n};\r\n\r\nexport const DEFAULT_BASE_FILL_COLOR = '#404040';\r\nexport const getDefaultCardOpacity = () => ({\r\n    body: 100,\r\n    pendulum: 100,\r\n    text: 100,\r\n    name: 100,\r\n    baseFill: DEFAULT_BASE_FILL_COLOR,\r\n    artBorder: true,\r\n    nameBorder: true,\r\n    boundless: false,\r\n});\r\nexport type CardOpacity = ReturnType<typeof getDefaultCardOpacity>;\r\nexport const CardArtCanvasCoordinateMap = {\r\n    normal: {\r\n        artFinishX: 100,\r\n        artFinishY: 219,\r\n        artWidth: 614,\r\n        artX: 100,\r\n        artY: 219,\r\n        ratio: 1,\r\n        type: 'normal' as const,\r\n    },\r\n    pendulum: {\r\n        artFinishX: 56,\r\n        artFinishY: 213,\r\n        artWidth: 702,\r\n        artX: 56,\r\n        artY: 213,\r\n        ratio: 1.325,\r\n        type: 'pendulum' as const,\r\n    },\r\n    /** Normal distribution, with artwork extends under effect's box. */\r\n    extendedCard: {\r\n        artFinishX: 100,\r\n        artFinishY: 219,\r\n        artWidth: 702,\r\n        artX: 56,\r\n        artY: 213,\r\n        ratio: 0.775,\r\n        type: 'extendedCard' as const,\r\n    },\r\n    /** Pendulum distribution, with artwork extends under pendulum effect's box and effect's box. */\r\n    extendedPendulum: {\r\n        artFinishX: 56,\r\n        artFinishY: 213,\r\n        artWidth: 702,\r\n        artX: 56,\r\n        artY: 213,\r\n        ratio: 0.775,\r\n        type: 'extendedPendulum' as const,\r\n    },\r\n    /** Pendulum distribution, with artwork extends under pendulum effect's box. It is actually the \"default\" mode of pendulum cards in practices. But most of the time the artwork only cut the visible image part because it is very hard to find the full image of a card unless an official source provide it. */\r\n    truePendulum: {\r\n        artFinishX: 56,\r\n        artFinishY: 213,\r\n        artWidth: 702,\r\n        artX: 56,\r\n        artY: 213,\r\n        ratio: 1.057,\r\n        type: 'truePendulum' as const,\r\n    },\r\n    /** Normal distribution with artwork span the entire card over the frame, use boundless mode to show frame above it. */\r\n    fullCard: {\r\n        artFinishX: 100,\r\n        artFinishY: 219,\r\n        artWidth: 758,\r\n        artX: 28,\r\n        artY: 28,\r\n        ratio: 0.670,\r\n        type: 'fullCard' as const,\r\n    },\r\n    /** Pendulum distribution with artwork span the entire card over the frame, use boundless mode to show frame above it. */\r\n    fullPendulum: {\r\n        artFinishX: 56,\r\n        artFinishY: 213,\r\n        artWidth: 758,\r\n        artX: 28,\r\n        artY: 28,\r\n        ratio: 0.670,\r\n        type: 'fullPendulum' as const,\r\n    },\r\n};\r\nexport const getArtCanvasCoordinate = (\r\n    isPendulum: boolean,\r\n    opacity?: Partial<CardOpacity>,\r\n    backgroundType?: BackgroundType,\r\n) => {\r\n    const {\r\n        boundless,\r\n        body,\r\n        pendulum,\r\n        text,\r\n    } = { ...getDefaultCardOpacity(), ...opacity };\r\n    const normalizedBoundless = backgroundType === 'fit'\r\n        ? false\r\n        : boundless;\r\n\r\n    if (backgroundType === 'full') return CardArtCanvasCoordinateMap.fullCard;\r\n    const artType = normalizedBoundless || body < 100\r\n        ? isPendulum\r\n            ? 'fullPendulum'\r\n            : 'fullCard'\r\n        : isPendulum\r\n            ? text < 100\r\n                ? 'extendedPendulum'\r\n                : pendulum < 100\r\n                    ? 'truePendulum'\r\n                    : 'pendulum'\r\n            : text < 100\r\n                ? 'extendedCard'\r\n                : 'normal';\r\n\r\n    return CardArtCanvasCoordinateMap[artType];\r\n};\r\n","import { CloseCircleOutlined } from '@ant-design/icons';\r\n\r\nexport const NO_ATTRIBUTE = 'NONE';\r\nexport const AttributeList = [\r\n    {\r\n        name: NO_ATTRIBUTE,\r\n        color: '#000000',\r\n    },\r\n    {\r\n        name: 'DARK',\r\n        label: 'Dark',\r\n        color: '#b41dda',\r\n    },\r\n    {\r\n        name: 'EARTH',\r\n        label: 'Earth',\r\n        color: '#8d8e8e',\r\n    },\r\n    {\r\n        name: 'FIRE',\r\n        label: 'Fire',\r\n        color: '#e51b23',\r\n    },\r\n    {\r\n        name: 'LIGHT',\r\n        label: 'Light',\r\n        color: '#bfae32',\r\n    },\r\n    {\r\n        name: 'WATER',\r\n        label: 'Water',\r\n        color: '#008ecd',\r\n    },\r\n    {\r\n        name: 'WIND',\r\n        label: 'Wind',\r\n        color: '#28ab35',\r\n    },\r\n    {\r\n        name: 'DIVINE',\r\n        label: 'Divine',\r\n        color: '#ef6300',\r\n    },\r\n    {\r\n        name: 'SPELL',\r\n        label: 'Spell',\r\n        color: '#1b8f83',\r\n    },\r\n    {\r\n        name: 'TRAP',\r\n        label: 'TRAP',\r\n        color: '#c32a8c',\r\n    },\r\n];\r\n\r\nexport const NO_ICON = 'NO ICON';\r\nexport const IconList = [\r\n    { label: <CloseCircleOutlined />, value: NO_ICON },\r\n    { label: 'Field', value: 'FIELD' },\r\n    { label: 'Continuous', value: 'CONTINUOUS' },\r\n    { label: 'Quick-Play', value: 'QUICK-PLAY' },\r\n    { label: 'Ritual', value: 'RITUAL' },\r\n    { label: 'Equip', value: 'EQUIP' },\r\n    { label: 'Counter', value: 'COUNTER' },\r\n];\r\nexport const IconValueList = IconList.map(entry => entry.value);\r\n\r\nexport const StickerList = [\r\n    'no-sticker',\r\n    'gold',\r\n    'silver',\r\n    'beta',\r\n    'holo5',\r\n    'holo4',\r\n    'holo3',\r\n    'holo2',\r\n    'holo1',\r\n    'limited',\r\n    'unlimited',\r\n];","export type NameStyleType = 'auto' | 'custom' | 'predefined';\r\nexport type NameStyle = ReturnType<typeof getDefaultNameStyle>;\r\nexport const getDefaultNameStyle = () => ({\r\n    font: 'Default',\r\n    fillStyle: '#000000',\r\n    headTextFillStyle: '#000000',\r\n    shadowColor: '#000000',\r\n    shadowOffsetY: 0,\r\n    shadowOffsetX: 0,\r\n    shadowBlur: 0,\r\n    hasShadow: false,\r\n    lineColor: '#000000',\r\n    lineWidth: 0,\r\n    lineOffsetY: 0,\r\n    lineOffsetX: 0,\r\n    hasOutline: false,\r\n    gradientAngle: 0,\r\n    gradientColor: '0.000|#eef10b,0.5|#d78025,1.000|#7e20cf',\r\n    hasGradient: false,\r\n    preset: 'commonB' as PresetNameStyle,\r\n    pattern: 'none',\r\n});\r\n\r\nconst createPresetNameStyle = (presetValue: Partial<NameStyle>): Partial<NameStyle> => ({\r\n    hasGradient: false,\r\n    hasOutline: false,\r\n    hasShadow: false,\r\n    pattern: 'none',\r\n    ...presetValue\r\n});\r\nexport type PresetNameStyle = 'commonB' | 'commonW'\r\n| 'skillDefault' | 'skillArial'\r\n| 'rare' | 'secretGradient' | 'secret' | 'platinum2' | 'ultra' | 'ultra2' | 'platinum' | 'gold'\r\n| 'animeRed' | 'animeSilver' | 'animeGold'\r\n| 'promo';\r\nexport const PresetNameStyleMap: Record<PresetNameStyle, {\r\n    key: PresetNameStyle,\r\n    label: string,\r\n    image: string,\r\n    value: Partial<NameStyle>,\r\n}> = {\r\n    commonB: {\r\n        key: 'commonB',\r\n        label: 'Common (Black)',\r\n        image: 'asset/image/other/name-common-b.png',\r\n        value: createPresetNameStyle({\r\n            preset: 'commonB',\r\n            fillStyle: '#000000',\r\n        }),\r\n    },\r\n    commonW: {\r\n        key: 'commonW',\r\n        label: 'Common (White)',\r\n        image: 'asset/image/other/name-common-w.png',\r\n        value: createPresetNameStyle({\r\n            preset: 'commonW',\r\n            fillStyle: '#ffffff',\r\n        }),\r\n    },\r\n    skillDefault: {\r\n        key: 'skillDefault',\r\n        label: 'Skill (Default)',\r\n        image: 'asset/image/other/name-skill-default.png',\r\n        value: createPresetNameStyle({\r\n            preset: 'skillDefault',\r\n            fillStyle: '#ffffff',\r\n            lineWidth: 6,\r\n            lineColor: '#000',\r\n            hasOutline: true,\r\n        }),\r\n    },\r\n    skillArial: {\r\n        key: 'skillArial',\r\n        label: 'Skill (Arial)',\r\n        image: 'asset/image/other/name-skill-arial.png',\r\n        value: createPresetNameStyle({\r\n            preset: 'skillArial',\r\n            font: 'Arial',\r\n            fillStyle: '#ffffff',\r\n            lineWidth: 6,\r\n            lineColor: '#000',\r\n            lineOffsetX: 1,\r\n            hasOutline: true,\r\n        }),\r\n    },\r\n    rare: {\r\n        key: 'rare',\r\n        label: 'Rare',\r\n        image: 'asset/image/other/name-rare.png',\r\n        value: createPresetNameStyle({\r\n            preset: 'rare',\r\n            fillStyle: '#cfc6de',\r\n        }),\r\n    },\r\n    secretGradient: {\r\n        key: 'secretGradient',\r\n        label: 'Secret (Gradient)',\r\n        image: 'asset/image/other/name-secret-gradient.png',\r\n        value: createPresetNameStyle({\r\n            preset: 'secretGradient',\r\n            gradientAngle: 180,\r\n            gradientColor: '0.000|#7a71a6,1.000|#a8c1e5',\r\n            hasGradient: true,\r\n        }),\r\n    },\r\n    secret: {\r\n        key: 'secret',\r\n        label: 'Secret',\r\n        image: 'asset/image/other/name-secret.png',\r\n        value: createPresetNameStyle({\r\n            preset: 'secret',\r\n            fillStyle: '#8a8381',\r\n        }),\r\n    },\r\n    platinum2: {\r\n        key: 'platinum2',\r\n        label: 'Platinum',\r\n        image: 'asset/image/other/name-platinum.png',\r\n        value: createPresetNameStyle({\r\n            preset: 'platinum2',\r\n            fillStyle: '#a49f9e',\r\n        }),\r\n    },\r\n    ultra: {\r\n        key: 'ultra',\r\n        label: 'Ultra',\r\n        image: 'asset/image/other/name-ultra.png',\r\n        value: createPresetNameStyle({\r\n            preset: 'ultra',\r\n            fillStyle: '#dbb473',\r\n        }),\r\n    },\r\n    ultra2: {\r\n        key: 'ultra2',\r\n        label: 'Ultra (Type 2)',\r\n        image: 'asset/image/other/name-ultra-2.png',\r\n        value: createPresetNameStyle({\r\n            preset: 'ultra2',\r\n            fillStyle: '#fee002',\r\n        }),\r\n    },\r\n    platinum: {\r\n        key: 'platinum',\r\n        label: 'Foil Platinum',\r\n        image: 'asset/image/other/name-foil-platinum.png',\r\n        value: createPresetNameStyle({\r\n            preset: 'platinum',\r\n            fillStyle: '#CCCCCC',\r\n            shadowColor: '#FFFFFF',\r\n            shadowOffsetY: 1,\r\n            shadowOffsetX: 0,\r\n            shadowBlur: 1,\r\n            hasShadow: true,\r\n        }),\r\n    },\r\n    gold: {\r\n        key: 'gold',\r\n        label: 'Foil Gold',\r\n        image: 'asset/image/other/name-foil-gold.png',\r\n        value: createPresetNameStyle({\r\n            preset: 'gold',\r\n            fillStyle: '#b88c43',\r\n            shadowColor: '#FCC400',\r\n            shadowOffsetY: 1,\r\n            shadowOffsetX: 0,\r\n            shadowBlur: 1,\r\n            hasShadow: true,\r\n        }),\r\n    },\r\n    animeRed: {\r\n        key: 'animeRed',\r\n        label: 'Anime (Type Red)',\r\n        image: 'asset/image/other/name-anime-red.png',\r\n        value: createPresetNameStyle({\r\n            preset: 'animeRed',\r\n            gradientAngle: 180,\r\n            gradientColor: '0.000|#d81961,0.220|#b81654,0.270|#9e1348,0.330|#95093e,0.380|#95093e,0.450|#ba3264,0.530|#ff5e99,0.620|#ffa0c3,0.690|#ffffff,0.770|#ff5e99,0.870|#d81961,1.000|#b81654',\r\n            hasGradient: true,\r\n            hasOutline: true,\r\n            hasShadow: true,\r\n            lineColor: '#333333',\r\n            lineOffsetX: 1,\r\n            lineOffsetY: 0,\r\n            lineWidth: 3,\r\n            shadowBlur: 2,\r\n            shadowColor: '#383838',\r\n            shadowOffsetX: 2,\r\n            shadowOffsetY: 3,\r\n        }),\r\n    },\r\n    animeSilver: {\r\n        key: 'animeSilver',\r\n        label: 'Anime (Type Silver)',\r\n        image: 'asset/image/other/name-anime-silver.png',\r\n        value: createPresetNameStyle({\r\n            preset: 'animeSilver',\r\n            shadowColor: '#383838',\r\n            shadowOffsetY: 3,\r\n            shadowOffsetX: 2,\r\n            shadowBlur: 2,\r\n            hasShadow: true,\r\n            lineColor: '#333333',\r\n            lineWidth: 3,\r\n            lineOffsetX: 1,\r\n            lineOffsetY: 0,\r\n            hasOutline: true,\r\n            gradientAngle: 180,\r\n            gradientColor: '0.000|#cecbb8,0.220|#b0ad9b,0.270|#94917e,0.330|#797768,0.380|#797768,0.450|#d9d9d9,0.610|#ffffff,0.700|#ffffff,0.870|#d6d7c7,1.000|#c9cbb6',\r\n            hasGradient: true,\r\n        }),\r\n    },\r\n    animeGold: {\r\n        key: 'animeGold',\r\n        label: 'Anime (Type Gold)',\r\n        image: 'asset/image/other/name-anime-gold.png',\r\n        value: createPresetNameStyle({\r\n            preset: 'animeGold',\r\n            shadowColor: '#383838',\r\n            shadowOffsetY: 3,\r\n            shadowOffsetX: 2,\r\n            shadowBlur: 2,\r\n            hasShadow: true,\r\n            lineColor: '#333333',\r\n            lineWidth: 3,\r\n            lineOffsetX: 1,\r\n            lineOffsetY: 0,\r\n            hasOutline: true,\r\n            gradientAngle: 180,\r\n            gradientColor: '0.000|#eee317,0.220|#dbbe15,0.270|#d0920c,0.330|#b57f0b,0.380|#d0920c,0.450|#ffff6b,0.610|#ffffff,0.700|#ffffff,0.870|#e5dd2d,1.000|#e3da23',\r\n            hasGradient: true,\r\n        }),\r\n    },\r\n    promo: {\r\n        key: 'promo',\r\n        label: 'Promo',\r\n        image: 'asset/image/other/name-promo.png',\r\n        value: createPresetNameStyle({\r\n            preset: 'promo',\r\n            fillStyle: '#c7080b',\r\n            shadowColor: '#333333',\r\n            shadowOffsetY: 0,\r\n            shadowOffsetX: 0,\r\n            shadowBlur: 1,\r\n            hasShadow: true,\r\n            lineColor: '#8a1801',\r\n            lineWidth: 3,\r\n            lineOffsetX: 0,\r\n            hasOutline: true,\r\n            lineOffsetY: 0\r\n        }),\r\n    },\r\n};\r\nexport const PresetNameStyleList = Object.values(PresetNameStyleMap);\r\n\r\nexport const PatternMap: Record<string, {\r\n    key: string,\r\n    patternImage: string,\r\n    blendMode: GlobalCompositeOperation,\r\n    overrideFill?: boolean,\r\n}> = {\r\n    none: {\r\n        key: 'none',\r\n        patternImage: '',\r\n        blendMode: 'source-atop',\r\n    },\r\n    type1: {\r\n        key: 'type1',\r\n        patternImage: 'finish-name-type1',\r\n        blendMode: 'source-atop',\r\n    },\r\n    type2: {\r\n        key: 'type2',\r\n        patternImage: 'finish-name-type2',\r\n        blendMode: 'source-atop',\r\n    },\r\n    type3: {\r\n        key: 'type3',\r\n        patternImage: 'finish-name-type3',\r\n        blendMode: 'source-atop',\r\n    },\r\n    type4: {\r\n        key: 'type4',\r\n        patternImage: 'finish-name-type4',\r\n        blendMode: 'source-atop',\r\n    },\r\n    type5: {\r\n        key: 'type5',\r\n        patternImage: 'finish-name-type5',\r\n        blendMode: 'multiply',\r\n        overrideFill: true,\r\n    },\r\n    type6: {\r\n        key: 'type6',\r\n        patternImage: 'finish-name-type6',\r\n        blendMode: 'source-atop',\r\n    },\r\n    type7: {\r\n        key: 'type7',\r\n        patternImage: 'finish-name-type7',\r\n        blendMode: 'lighter',\r\n        overrideFill: true,\r\n    },\r\n    type8: {\r\n        key: 'type8',\r\n        patternImage: 'finish-name-type8',\r\n        blendMode: 'source-atop',\r\n    },\r\n    type9: {\r\n        key: 'type9',\r\n        patternImage: 'finish-name-type9',\r\n        blendMode: 'source-atop',\r\n    },\r\n};\r\nexport const PatternList = Object.values(PatternMap);","export type CoordinateData = {\r\n    edgeAlignment?: 'left' | 'right',\r\n    trueWidth: number,\r\n    trueBaseline: number,\r\n    trueEdge: number,\r\n};\r\n\r\nexport const EffectCoordinateData: Record<string, CoordinateData[]> = {\r\n    'tcg': [\r\n        { trueWidth: 684, trueBaseline: 890.23, trueEdge: 64.8 },\r\n    ],\r\n    'tcg-stat': [\r\n        { trueWidth: 684, trueBaseline: 890.23, trueEdge: 64.8 },\r\n    ],\r\n    'tcg-type-stat': [\r\n        { trueWidth: 684, trueBaseline: 919.8, trueEdge: 64.5 },\r\n    ],\r\n    'tcg-type': [\r\n        { trueWidth: 684, trueBaseline: 921.8, trueEdge: 64.5 },\r\n    ],\r\n    'ocg': [\r\n        { trueWidth: 684, trueBaseline: 895.23, trueEdge: 64.8 },\r\n    ],\r\n    'ocg-stat': [\r\n        { trueWidth: 684, trueBaseline: 891.23, trueEdge: 64.8 },\r\n    ],\r\n    'ocg-type-stat': [\r\n        { trueWidth: 684, trueBaseline: 918.5, trueEdge: 64.5 },\r\n    ],\r\n    'ocg-type': [\r\n        { trueWidth: 684, trueBaseline: 918.5, trueEdge: 64.5 },\r\n    ],\r\n};\r\n\r\nexport const PendulumEffectCoordinate: CoordinateData[] = [\r\n    { trueWidth: 555.47, trueBaseline: 746.29, trueEdge: 128.94 },\r\n    { trueWidth: 555.47, trueBaseline: 746.29, trueEdge: 128.94 },\r\n];\r\n\r\nexport const TypeAbilityCoordinateMap: Record<string, Record<string, CoordinateData>> = {\r\n    tcg: {\r\n        small: {\r\n            trueBaseline: 919,\r\n            trueEdge: 62.50,\r\n            trueWidth: 684.5,\r\n        },\r\n        medium: {\r\n            trueBaseline: 920,\r\n            trueEdge: 62.50,\r\n            trueWidth: 684.5,\r\n        },\r\n        large: {\r\n            trueBaseline: 187.5,\r\n            trueEdge: 732.00,\r\n            edgeAlignment: 'right',\r\n            trueWidth: 648.5,\r\n        },\r\n    },\r\n    ocg: {\r\n        small: {\r\n            trueBaseline: 917,\r\n            trueEdge: 63.70,\r\n            trueWidth: 684.5,\r\n        },\r\n        medium: {\r\n            trueBaseline: 917,\r\n            trueEdge: 63.70,\r\n            trueWidth: 684.5,\r\n        },\r\n        large: {\r\n            trueBaseline: 190.5,\r\n            trueEdge: 728.00,\r\n            edgeAlignment: 'right',\r\n            trueWidth: 642.5,\r\n        },\r\n    },\r\n};\r\n\r\nexport const CreatorCoordinateMap: Record<string, CoordinateData> = {\r\n    ocg: {\r\n        trueBaseline: 1146.5,\r\n        trueEdge: 736,\r\n        trueWidth: 435,\r\n    },\r\n    tcg: {\r\n        trueBaseline: 1149.5,\r\n        trueEdge: 733,\r\n        trueWidth: 380,\r\n    },\r\n};","/** Dicitionary that convert popular letters combination into a fragment block with (most of the time) corresponding furigana attached.\r\n * \r\n * This is created based on pure survey only. Also this is based on regex, so do not add too many entries into this one. Around 300 would be a nice limit to stop, after all this is just a helper. There are much more rules and block words in practice that we basically have no way to collect and implement.\r\n * \r\n * Each dicitionary entry has at most 4 fields.\r\n *  * `shortForm`: Pure letters without decoration, act as the primary key in this dictionary.\r\n *  * `regexForm`: Some words may blend inside fragment and will get falsely detected, especially English letter. For example \"銀翼のAXE－サリー\" OCG has letter X in its name, which maybe detected as Xyz Monster. Regex form will (try to) solve this problem.\r\n *  * `rubyForm`: The full version of `shortForm`, with furigana and control characters attached.\r\n *  * `rubyFormName`: In very rare case, the same `shortForm` has different treatment based on the section it belong in. This field (if existed) will be preferred when converting the name of the card.\r\n * \r\n * Overall we want to sort this list based on the length of the shortForm, so we match larger entry first. For example, the letter \"族\" appears both as a standalone letter and in the word \"種族\", we naturally want to match the word \"種族\" first.\r\n */\r\nexport const ocgKeywordDataList = [\r\n    {\r\n        shortForm: '特殊召喚',\r\n        rubyForm: '{特|とく}{殊|しゅ}{召|しょう}{喚|かん}',\r\n    },\r\n    {\r\n        shortForm: 'カード',\r\n        rubyForm: '{カード}',\r\n    },\r\n    {\r\n        shortForm: 'デュエル',\r\n        rubyForm: '{デュエル}',\r\n    },\r\n    {\r\n        shortForm: 'マッチ',\r\n        rubyForm: '{マッチ}',\r\n    },\r\n    {\r\n        shortForm: 'ターン',\r\n        rubyForm: '{ターン}',\r\n    },\r\n    {\r\n        shortForm: 'プレイヤー',\r\n        rubyForm: '{プレイヤー}',\r\n    },\r\n    {\r\n        shortForm: '自分',\r\n        rubyForm: '{自|じ}{分|ぶん}',\r\n    },\r\n    {\r\n        shortForm: '相手',\r\n        rubyForm: '{相|あい}{手|て}',\r\n    },\r\n    {\r\n        shortForm: 'LP',\r\n        regexForm: '(?<![a-zA-Z_])LP(?![a-zA-Z_])',\r\n        rubyForm: '{LP|ライフポイント}',\r\n    },\r\n    {\r\n        shortForm: 'デッキ',\r\n        rubyForm: '{デッキ}',\r\n    },\r\n    {\r\n        shortForm: 'メイン',\r\n        rubyForm: '{メイン}',\r\n    },\r\n    {\r\n        shortForm: 'サイド',\r\n        rubyForm: '{サイド}',\r\n    },\r\n    {\r\n        shortForm: 'EX',\r\n        regexForm: '(?<!\\\\w)EX(?!\\\\w)',\r\n        rubyForm: '{EX|エクストラ}',\r\n    },\r\n    {\r\n        shortForm: 'フィールド',\r\n        rubyForm: '{フィールド}',\r\n    },\r\n    {\r\n        shortForm: '墓地',\r\n        rubyForm: '{墓|ぼ}{地|ち}',\r\n    },\r\n    {\r\n        shortForm: '手札',\r\n        rubyForm: '{手|て}{札|ふだ}',\r\n    },\r\n    {\r\n        shortForm: 'ゾーン',\r\n        rubyForm: '{ゾーン}',\r\n    },\r\n    {\r\n        shortForm: 'モンスター',\r\n        rubyForm: '{モンスター}',\r\n    },\r\n    {\r\n        shortForm: '縦列',\r\n        rubyForm: '{縦|たて}{列|れつ}',\r\n    },\r\n    {\r\n        shortForm: 'コントローラー',\r\n        rubyForm: '{コントローラー}',\r\n    },\r\n    {\r\n        shortForm: '持ち主',\r\n        rubyForm: '{持|も}ち{主|ぬし}',\r\n    },\r\n    {\r\n        shortForm: 'ダメージ',\r\n        rubyForm: '{ダメージ}',\r\n    },\r\n    {\r\n        shortForm: '戦闘',\r\n        rubyForm: '{戦|せん}{闘|とう}',\r\n    },\r\n    {\r\n        shortForm: 'スペル',\r\n        rubyForm: '{スペル}',\r\n    },\r\n    {\r\n        shortForm: 'スピード',\r\n        rubyForm: '{スピード}',\r\n    },\r\n    {\r\n        shortForm: 'チェーン',\r\n        rubyForm: '{チェーン}',\r\n    },\r\n    {\r\n        shortForm: 'ブロック',\r\n        rubyForm: '{ブロック}',\r\n    },\r\n    {\r\n        shortForm: '直接',\r\n        rubyForm: '{直|ちょく}{接|せつ}',\r\n    },\r\n    {\r\n        shortForm: '素材',\r\n        rubyForm: '{素|そ}{材|ざい}',\r\n    },\r\n    {\r\n        shortForm: '名',\r\n        rubyForm: '{名|めい}',\r\n    },\r\n    {\r\n        shortForm: '条件',\r\n        rubyForm: '{条|じょう}{件|けん}',\r\n    },\r\n    {\r\n        shortForm: 'コイン',\r\n        rubyForm: '{コイン}',\r\n    },\r\n    {\r\n        shortForm: 'サイコロ',\r\n        rubyForm: '{サイコロ}',\r\n    },\r\n    {\r\n        shortForm: '元',\r\n        rubyForm: '{元|もと}',\r\n    },\r\n    {\r\n        shortForm: '先',\r\n        rubyForm: '{先|さき}',\r\n    },\r\n    {\r\n        shortForm: '状態',\r\n        rubyForm: '{状|じょう}{態|たい}',\r\n    },\r\n    {\r\n        shortForm: '相互',\r\n        rubyForm: '{相|そう}{互|ご}',\r\n    },\r\n    {\r\n        shortForm: 'エクストラ',\r\n        rubyForm: '{エクストラ}',\r\n    },\r\n    {\r\n        shortForm: 'フェイズ',\r\n        rubyForm: '{フェイズ}',\r\n    },\r\n    {\r\n        shortForm: 'ドロー',\r\n        rubyForm: '{ドロー}',\r\n    },\r\n    {\r\n        shortForm: 'スタンバイ',\r\n        rubyForm: '{スタンバイ}',\r\n    },\r\n    {\r\n        shortForm: 'バトル',\r\n        rubyForm: '{バトル}',\r\n    },\r\n    {\r\n        shortForm: 'エンド',\r\n        rubyForm: '{エンド}',\r\n    },\r\n    {\r\n        shortForm: 'スタート',\r\n        rubyForm: '{スタート}',\r\n    },\r\n    {\r\n        shortForm: 'ステップ',\r\n        rubyForm: '{ステップ}',\r\n    },\r\n    {\r\n        shortForm: '種類',\r\n        rubyForm: '{種|しゅ}{類|るい}',\r\n    },\r\n    {\r\n        shortForm: '形式',\r\n        rubyForm: '{形|けい}{式|しき}',\r\n    },\r\n    {\r\n        shortForm: '表側',\r\n        rubyForm: '{表|おもて}{側|がわ}',\r\n    },\r\n    {\r\n        shortForm: '裏側',\r\n        rubyForm: '{裏|うら}{側|がわ}',\r\n    },\r\n    {\r\n        shortForm: '表示',\r\n        rubyForm: '{表|ひょう}{示|じ}',\r\n    },\r\n    {\r\n        shortForm: '罠',\r\n        rubyForm: '{罠|トラップ}',\r\n    },\r\n    {\r\n        shortForm: 'アクション',\r\n        rubyForm: 'アクション',\r\n    },\r\n    {\r\n        shortForm: '装備',\r\n        rubyForm: '{装|そう}{備|び}',\r\n    },\r\n    {\r\n        shortForm: '速攻',\r\n        rubyForm: '{速|そっ}{攻|こう}',\r\n    },\r\n    {\r\n        shortForm: '永続',\r\n        rubyForm: '{永|えい}{続|ぞく}',\r\n    },\r\n    {\r\n        shortForm: 'カウンター',\r\n        rubyForm: '{カウンター}',\r\n    },\r\n    {\r\n        shortForm: 'レベル',\r\n        rubyForm: '{レベル}',\r\n    },\r\n    {\r\n        shortForm: 'ランク',\r\n        rubyForm: '{ランク}',\r\n    },\r\n    {\r\n        shortForm: 'スケール',\r\n        rubyForm: '{スケール}',\r\n    },\r\n    {\r\n        shortForm: '攻撃力',\r\n        rubyForm: '{攻|こう}{撃|げき}{力|りょく}',\r\n    },\r\n    {\r\n        shortForm: '守備力',\r\n        rubyForm: '{守|しゅ}{備|び}{力|りょく}',\r\n    },\r\n    {\r\n        shortForm: '撃力',\r\n        rubyForm: '{撃|げき}{力|りょく}',\r\n    },\r\n    {\r\n        shortForm: '勝利',\r\n        rubyForm: '{勝|しょう}{利|り}',\r\n    },\r\n    {\r\n        shortForm: '属性',\r\n        rubyForm: '{属|ぞく}{性|せい}',\r\n    },\r\n    {\r\n        shortForm: '種族',\r\n        rubyForm: '{種|しゅ}{族|ぞく}',\r\n    },\r\n    {\r\n        shortForm: '効果',\r\n        rubyForm: '{効|こう}{果|か}',\r\n    },\r\n    {\r\n        shortForm: '融合',\r\n        rubyForm: '{融|ゆう}{合|ごう}',\r\n    },\r\n    {\r\n        shortForm: '儀式',\r\n        rubyForm: '{儀|ぎ}{式|しき}',\r\n    },\r\n    {\r\n        shortForm: 'マキシマム',\r\n        rubyForm: '{マキシマム}',\r\n    },\r\n    {\r\n        shortForm: 'トークン',\r\n        rubyForm: '{トークン}',\r\n    },\r\n    {\r\n        shortForm: 'チューナー',\r\n        rubyForm: '{チューナー}',\r\n    },\r\n    {\r\n        shortForm: 'デュアル',\r\n        rubyForm: '{デュアル}',\r\n    },\r\n    {\r\n        shortForm: 'リバース',\r\n        rubyForm: '{リバース}',\r\n    },\r\n    {\r\n        shortForm: 'トゥーン',\r\n        rubyForm: '{トゥーン}',\r\n    },\r\n    {\r\n        shortForm: 'スピリット',\r\n        rubyForm: '{スピリット}',\r\n    },\r\n    {\r\n        shortForm: 'ユニオン',\r\n        rubyForm: '{ユニオン}',\r\n    },\r\n    {\r\n        shortForm: '光',\r\n        rubyForm: '{光|ひかり}',\r\n    },\r\n    {\r\n        shortForm: '闇',\r\n        rubyForm: '{闇|やみ}',\r\n    },\r\n    {\r\n        shortForm: '地',\r\n        rubyForm: '{地|ち}',\r\n    },\r\n    {\r\n        shortForm: '水',\r\n        rubyForm: '{水|みず}',\r\n    },\r\n    {\r\n        shortForm: '炎',\r\n        rubyForm: '{炎|ほのお}',\r\n    },\r\n    {\r\n        shortForm: '風',\r\n        rubyForm: '{風|かぜ}',\r\n    },\r\n    {\r\n        shortForm: '獣戦士',\r\n        rubyForm: '{獣|じゅう}{戦|せん}{士|し}',\r\n    },\r\n    {\r\n        shortForm: '創造神',\r\n        rubyForm: '{創|そう}{造|ぞう}{神|しん}',\r\n    },\r\n    {\r\n        shortForm: 'サイバース',\r\n        rubyForm: '{サイバース}',\r\n    },\r\n    {\r\n        shortForm: '恐竜',\r\n        rubyForm: '{恐|きょう}{竜|りゅう}',\r\n    },\r\n    {\r\n        shortForm: '幻神獣',\r\n        rubyForm: '{幻|げん}{神|しん}{獣|じゅう}',\r\n    },\r\n    {\r\n        shortForm: '天使',\r\n        rubyForm: '{天|てん}{使|し}',\r\n    },\r\n    {\r\n        shortForm: '悪魔',\r\n        rubyForm: '{悪|あく}{魔|ま}',\r\n    },\r\n    {\r\n        shortForm: '魚',\r\n        rubyForm: '{魚|さかな}',\r\n    },\r\n    {\r\n        shortForm: 'ギャラクシー',\r\n        rubyForm: '{ギャラクシー}',\r\n    },\r\n    {\r\n        shortForm: '幻想魔',\r\n        rubyForm: '{幻|げん}{想|そう}{魔|ま}',\r\n    },\r\n    {\r\n        shortForm: '昆虫',\r\n        rubyForm: '{昆|こん}{虫|ちゅう}',\r\n    },\r\n    {\r\n        shortForm: '機械',\r\n        rubyForm: '{機|き}{械|かい}',\r\n    },\r\n    {\r\n        shortForm: '植物',\r\n        rubyForm: '{植|しょく}{物|ぶつ}',\r\n    },\r\n    {\r\n        shortForm: '爬虫類',\r\n        rubyForm: '{爬|は}{虫|ちゅう}{類|るい}',\r\n    },\r\n    {\r\n        shortForm: '岩石',\r\n        rubyForm: '{岩|がん}{石|せき}',\r\n    },\r\n    {\r\n        shortForm: '海竜',\r\n        rubyForm: '{海|かい}{竜|りゅう}',\r\n    },\r\n    {\r\n        shortForm: '魔法使い',\r\n        rubyForm: '{魔|ま}{法|ほう}{使|つか}い',\r\n    },\r\n    {\r\n        shortForm: '雷',\r\n        rubyForm: '{雷|いかずち}',\r\n    },\r\n    {\r\n        shortForm: '鳥獣',\r\n        rubyForm: '{鳥|ちょう}{獣|じゅう}',\r\n    },\r\n    {\r\n        shortForm: '幻竜',\r\n        rubyForm: '{幻|げん}{竜|りゅう}',\r\n    },\r\n    {\r\n        shortForm: 'アンデット',\r\n        rubyForm: '{アンデット}',\r\n    },\r\n    {\r\n        shortForm: 'サイボーグ',\r\n        rubyForm: '{サイボーグ}',\r\n    },\r\n    {\r\n        shortForm: '天界戦士',\r\n        rubyForm: '{天|てん}{界|かい}{戦|せん}{士|し}',\r\n    },\r\n    {\r\n        shortForm: 'ハイドラゴン',\r\n        rubyForm: '{ハイドラゴン}',\r\n    },\r\n    {\r\n        shortForm: '魔導騎士',\r\n        rubyForm: '{魔|ま}{導|どう}{騎|き}{士|し}',\r\n    },\r\n    {\r\n        shortForm: '無効化',\r\n        rubyForm: '{無|む}{効|こう}{化|か}',\r\n    },\r\n    {\r\n        shortForm: 'オメガ',\r\n        rubyForm: '{オメガ}',\r\n    },\r\n    {\r\n        shortForm: 'サイキック',\r\n        rubyForm: '{サイキック}',\r\n    },\r\n    {\r\n        shortForm: '捨てる',\r\n        rubyForm: '{捨|す}てる',\r\n    },\r\n    {\r\n        shortForm: '加える',\r\n        rubyForm: '{加|くわ}える',\r\n    },\r\n    {\r\n        shortForm: 'から離れる',\r\n        rubyForm: 'から{離|はな}れる',\r\n    },\r\n    {\r\n        shortForm: '与える',\r\n        rubyForm: '{与|あた}える',\r\n    },\r\n    {\r\n        shortForm: '重ねる',\r\n        rubyForm: '{重|かさ}ねる',\r\n    },\r\n    {\r\n        shortForm: '取り除く',\r\n        rubyForm: '{取|と}り{除|ぞ}く',\r\n    },\r\n    {\r\n        shortForm: '取り除い',\r\n        rubyForm: '{取|と}り{除|ぞ}い',\r\n    },\r\n    {\r\n        shortForm: '除く',\r\n        rubyForm: '{除|のぞ}く',\r\n    },\r\n    {\r\n        shortForm: '行う',\r\n        rubyForm: '{行|おこな}う',\r\n    },\r\n    {\r\n        shortForm: '対す',\r\n        rubyForm: '{対|たい}す',\r\n    },\r\n    {\r\n        shortForm: '送る',\r\n        rubyForm: '{送|おく}る',\r\n    },\r\n    {\r\n        shortForm: '置く',\r\n        rubyForm: '{置|お}く',\r\n    },\r\n    {\r\n        shortForm: 'めくる',\r\n        rubyForm: '{めくる}',\r\n    },\r\n    {\r\n        shortForm: 'アドバンス',\r\n        rubyForm: '{アドバンス}',\r\n    },\r\n    {\r\n        shortForm: '反転',\r\n        rubyForm: '{反|はん}{転|てん}',\r\n    },\r\n    {\r\n        shortForm: '特殊',\r\n        rubyForm: '{特|とく}{殊|しゅ}',\r\n    },\r\n    {\r\n        shortForm: '発動',\r\n        rubyForm: '{発|はつ}{動|どう}',\r\n    },\r\n    {\r\n        shortForm: '破壊',\r\n        rubyForm: '{破|は}{壊|かい}',\r\n    },\r\n    {\r\n        shortForm: '対象',\r\n        rubyForm: '{対|たい}{象|しょう}',\r\n    },\r\n    {\r\n        shortForm: '無効',\r\n        rubyForm: '{無|む}{効|こう}',\r\n    },\r\n    {\r\n        shortForm: '攻撃',\r\n        rubyForm: '{攻|こう}{撃|げき}',\r\n    },\r\n    {\r\n        shortForm: '処理',\r\n        rubyForm: '{処|しょ}{理|り}',\r\n    },\r\n    {\r\n        shortForm: '宣言',\r\n        rubyForm: '{宣|せん}{言|げん}',\r\n    },\r\n    {\r\n        shortForm: '除外',\r\n        rubyForm: '{除|じょ}{外|がい}',\r\n    },\r\n    {\r\n        shortForm: 'リリース',\r\n        rubyForm: '{リリース}',\r\n    },\r\n    {\r\n        shortForm: 'スキップ',\r\n        rubyForm: '{スキップ}',\r\n    },\r\n    {\r\n        shortForm: 'シャッフル',\r\n        rubyForm: '{シャッフル}',\r\n    },\r\n    {\r\n        shortForm: 'コントロール',\r\n        rubyForm: '{コントロール}',\r\n    },\r\n    {\r\n        shortForm: 'セット',\r\n        rubyForm: '{セット}',\r\n    },\r\n    {\r\n        shortForm: 'RUM',\r\n        regexForm: '(?<!\\\\w)RUM(?!\\\\w)',\r\n        rubyForm: '{RUM|ランクアップマジック}',\r\n    },\r\n    {\r\n        shortForm: 'S',\r\n        regexForm: '(?<!\\\\w)S(?!\\\\w)',\r\n        rubyForm: '{S|シンクロ}',\r\n    },\r\n    {\r\n        shortForm: 'X',\r\n        regexForm: '(?<!\\\\w)X(?!\\\\w)',\r\n        rubyForm: '{X|エクシーズ}',\r\n    },\r\n    {\r\n        shortForm: 'L',\r\n        regexForm: '(?<!\\\\w)L(?!\\\\w)',\r\n        rubyForm: '{L|リンク}',\r\n    },\r\n    {\r\n        shortForm: 'P',\r\n        regexForm: '(?<!\\\\w)P(?!\\\\w)',\r\n        rubyForm: '{P|ペンデュラム}',\r\n    },\r\n    {\r\n        shortForm: 'リンク',\r\n        rubyForm: '{リンク}',\r\n    },\r\n    {\r\n        shortForm: '守備',\r\n        rubyForm: '{守|しゅ}{備|び}',\r\n    },\r\n    {\r\n        shortForm: '通常',\r\n        rubyForm: '{通|つう}{常|じょう}',\r\n    },\r\n    {\r\n        shortForm: '可能',\r\n        rubyForm: '{可|か}{能|のう}',\r\n    },\r\n    {\r\n        shortForm: '神',\r\n        rubyForm: '{神|かみ}',\r\n    },\r\n    {\r\n        shortForm: '獣',\r\n        rubyForm: '{獣|けもの}',\r\n    },\r\n    {\r\n        shortForm: 'ドラゴン',\r\n        rubyForm: '{ドラゴン}',\r\n    },\r\n    {\r\n        shortForm: 'サイキック',\r\n        rubyForm: '{サイキック}',\r\n    },\r\n    {\r\n        shortForm: '重ねて',\r\n        rubyForm: '{重|かさ}ねて',\r\n    },\r\n    {\r\n        shortForm: '魔法',\r\n        rubyForm: '{魔|ま}{法|ほう}',\r\n    },\r\n    {\r\n        shortForm: '戦士',\r\n        rubyForm: '{戦|せん}{士|し}',\r\n    },\r\n    {\r\n        shortForm: '召喚',\r\n        rubyForm: '{召|しょう}{喚|かん}',\r\n    },\r\n    {\r\n        shortForm: '合計',\r\n        rubyForm: '{合|ごう}{計|けい}',\r\n    },\r\n    {\r\n        shortForm: '以上',\r\n        rubyForm: '{以|い}{上|じょう}',\r\n    },\r\n    {\r\n        shortForm: '場合',\r\n        rubyForm: '{場|ば}{合|あい}',\r\n    },\r\n    {\r\n        shortForm: '降臨',\r\n        rubyForm: '{降|こう}{臨|りん}',\r\n    },\r\n    {\r\n        shortForm: '以外',\r\n        rubyForm: '{以|い}{外|がい}',\r\n    },\r\n    {\r\n        shortForm: '使用',\r\n        rubyForm: '{使|し}{用|よう}',\r\n    },\r\n    {\r\n        shortForm: '存在',\r\n        rubyForm: '{存|そん}{在|ざい}',\r\n    },\r\n    {\r\n        shortForm: '最大',\r\n        rubyForm: '{最|さい}{大|だい}',\r\n    },\r\n    {\r\n        shortForm: '成功',\r\n        rubyForm: '{成|せい}{功|こう}',\r\n    },\r\n    {\r\n        shortForm: '自身',\r\n        rubyForm: '{自|じ}{身|しん}',\r\n    },\r\n    {\r\n        shortForm: '以下',\r\n        rubyForm: '{以|い}{下|か}',\r\n    },\r\n    {\r\n        shortForm: '終了',\r\n        rubyForm: '{終|しゅう}{了|りょう}',\r\n    },\r\n    {\r\n        shortForm: '全て',\r\n        rubyForm: '{全|すべ}て',\r\n    },\r\n    {\r\n        shortForm: '捨て',\r\n        rubyForm: '{捨|す}て',\r\n    },\r\n    {\r\n        shortForm: 'CNo．',\r\n        regexForm: '(?<![a-zA-Z])CNo．(?![a-zA-Z])',\r\n        rubyForm: '{CNo．||カオスナンバーズ}',\r\n        rubyFormName: '{CNo||カオスナンバーズ}．',\r\n    },\r\n    {\r\n        shortForm: 'No．',\r\n        regexForm: '(?<![a-zA-Z])No．(?![a-zA-Z])',\r\n        rubyForm: '{No．||ナンバーズ}',\r\n        rubyFormName: '{No||ナンバーズ}．',\r\n    },\r\n    {\r\n        shortForm: 'CX',\r\n        regexForm: '(?<![a-zA-Z])CX(?![a-zA-Z])',\r\n        rubyForm: '{CX|カオスエクシーズ}',\r\n    },\r\n    {\r\n        shortForm: '適用',\r\n        rubyForm: '{適|てき}{用|よう}',\r\n    },\r\n    {\r\n        shortForm: '数値',\r\n        rubyForm: '{数|すう}{値|ち}',\r\n    },\r\n    {\r\n        shortForm: '計算',\r\n        rubyForm: '{計|けい}{算|さん}',\r\n    },\r\n    {\r\n        shortForm: '必要',\r\n        rubyForm: '{必|ひつ}{要|よう}',\r\n    },\r\n    {\r\n        shortForm: '選択',\r\n        rubyForm: '{選|せん}{択|たく}',\r\n    },\r\n    {\r\n        shortForm: '半分',\r\n        rubyForm: '{半|はん}{分|ぶん}',\r\n    },\r\n    {\r\n        shortForm: '開始',\r\n        rubyForm: '{開|かい}{始|し}',\r\n    },\r\n    {\r\n        shortForm: '裏表',\r\n        rubyForm: '{裏|うら}{表|おもて}',\r\n    },\r\n    {\r\n        shortForm: '回復',\r\n        rubyForm: '{回|かい}{復|ふく}',\r\n    },\r\n    {\r\n        shortForm: '指定',\r\n        rubyForm: '{指|し}{定|てい}',\r\n    },\r\n    {\r\n        shortForm: '位置',\r\n        rubyForm: '{位|い}{置|ち}',\r\n    },\r\n    {\r\n        shortForm: '移動',\r\n        rubyForm: '{移|い}{動|どう}',\r\n    },\r\n    {\r\n        shortForm: '方法',\r\n        rubyForm: '{方|ほう}{法|ほう}',\r\n    },\r\n    {\r\n        shortForm: '変更',\r\n        rubyForm: '{変|へん}{更|こう}',\r\n    },\r\n    {\r\n        shortForm: '発生',\r\n        rubyForm: '{発|はっ}{生|せい}',\r\n    },\r\n    {\r\n        shortForm: '公開',\r\n        rubyForm: '{公|こう}{開|かい}',\r\n    },\r\n    {\r\n        shortForm: '超',\r\n        rubyForm: '{超|こ}',\r\n    },\r\n    {\r\n        shortForm: '毎',\r\n        rubyForm: '{毎|ごと}',\r\n    },\r\n    {\r\n        shortForm: '前',\r\n        rubyForm: '{前|まえ}',\r\n    },\r\n    {\r\n        shortForm: '違',\r\n        rubyForm: '{違|ちが}',\r\n    },\r\n    {\r\n        shortForm: '続',\r\n        rubyForm: '{続|つづ}',\r\n    },\r\n    {\r\n        shortForm: '残',\r\n        rubyForm: '{残|のこ}',\r\n    },\r\n    {\r\n        shortForm: '他',\r\n        rubyForm: '{他|ほか}',\r\n    },\r\n    {\r\n        shortForm: '当',\r\n        rubyForm: '{当|あ}',\r\n    },\r\n    {\r\n        shortForm: '度',\r\n        rubyForm: '{度|ど}',\r\n    },\r\n    {\r\n        shortForm: '時',\r\n        rubyForm: '{時|とき}',\r\n    },\r\n    {\r\n        shortForm: '族',\r\n        rubyForm: '{族|ぞく}',\r\n    },\r\n    {\r\n        shortForm: '数',\r\n        rubyForm: '{数|かず}',\r\n    },\r\n    {\r\n        shortForm: '体',\r\n        rubyForm: '{体|たい}',\r\n    },\r\n    {\r\n        shortForm: '限',\r\n        rubyForm: '{限|ゲン}',\r\n    },\r\n    {\r\n        shortForm: '置',\r\n        rubyForm: '{置|チ}',\r\n    },\r\n    {\r\n        shortForm: '受',\r\n        rubyForm: '{受|う}',\r\n    },\r\n    {\r\n        shortForm: '枚',\r\n        rubyForm: '{枚|まい}',\r\n    },\r\n    {\r\n        shortForm: '後',\r\n        rubyForm: '{後|ご}',\r\n    },\r\n    {\r\n        shortForm: '送',\r\n        rubyForm: '{送|おく}',\r\n    },\r\n    {\r\n        shortForm: '事',\r\n        rubyForm: '{事|こと}',\r\n    },\r\n    {\r\n        shortForm: '内',\r\n        rubyForm: '{内|うち}',\r\n    },\r\n    {\r\n        shortForm: '見',\r\n        rubyForm: '{見|み}',\r\n    },\r\n    {\r\n        shortForm: '中',\r\n        rubyForm: '{中|なか}',\r\n    },\r\n    {\r\n        shortForm: '加',\r\n        rubyForm: '{加|くわ}',\r\n    },\r\n    {\r\n        shortForm: '選',\r\n        rubyForm: '{選|えら}',\r\n    },\r\n    {\r\n        shortForm: '一',\r\n        rubyForm: '{一|いち}',\r\n    },\r\n    {\r\n        shortForm: '番',\r\n        rubyForm: '{番|ばん}',\r\n    },\r\n    {\r\n        shortForm: '同',\r\n        rubyForm: '{同|どう}',\r\n    },\r\n    {\r\n        shortForm: '回',\r\n        rubyForm: '{回|かい}',\r\n    },\r\n    {\r\n        shortForm: '扱',\r\n        rubyForm: '{扱|あつか}',\r\n    },\r\n    {\r\n        shortForm: '星',\r\n        rubyForm: '{星|レベル}',\r\n    },\r\n    {\r\n        shortForm: '攻',\r\n        rubyForm: '{攻|こう}',\r\n    },\r\n    {\r\n        shortForm: '守',\r\n        rubyForm: '{守|しゅ}',\r\n    },\r\n    {\r\n        shortForm: '戻',\r\n        rubyForm: '{戻|もど}',\r\n    },\r\n    {\r\n        shortForm: '上',\r\n        rubyForm: '{上|うえ}',\r\n    },\r\n    {\r\n        shortForm: '次',\r\n        rubyForm: '{次|つぎ}',\r\n    },\r\n    {\r\n        shortForm: '値',\r\n        rubyForm: '{値|ち}',\r\n    },\r\n    {\r\n        shortForm: '含',\r\n        rubyForm: '{含|ふく}',\r\n    },\r\n    {\r\n        shortForm: '与',\r\n        rubyForm: '{与|むた}',\r\n    },\r\n    {\r\n        shortForm: '得',\r\n        rubyForm: '{得|え}',\r\n    },\r\n    {\r\n        shortForm: '及',\r\n        rubyForm: '{及|およ}',\r\n    },\r\n    {\r\n        shortForm: '異',\r\n        rubyForm: '{異|こと}',\r\n    },\r\n    {\r\n        shortForm: '記',\r\n        rubyForm: '{記|しる}',\r\n    },\r\n    {\r\n        shortForm: '繰',\r\n        rubyForm: '{繰|く}',\r\n    },\r\n    {\r\n        shortForm: '返',\r\n        rubyForm: '{返|かえ}',\r\n    },\r\n    {\r\n        shortForm: '決',\r\n        rubyForm: '{決|き}',\r\n    },\r\n    {\r\n        shortForm: '互',\r\n        rubyForm: '{互|たが}',\r\n    },\r\n    {\r\n        shortForm: '払',\r\n        rubyForm: '{払|はら}',\r\n    },\r\n    {\r\n        shortForm: '多',\r\n        rubyForm: '{多|おお}',\r\n    },\r\n    {\r\n        shortForm: '持',\r\n        rubyForm: '{持|おお}',\r\n    },\r\n    {\r\n        shortForm: '持',\r\n        rubyForm: '{持|も}',\r\n    },\r\n    {\r\n        shortForm: '間',\r\n        rubyForm: '{間|あいだ}',\r\n    },\r\n    {\r\n        shortForm: '所',\r\n        rubyForm: '{所|しょ}',\r\n    },\r\n    {\r\n        shortForm: '高',\r\n        rubyForm: '{高|たか}',\r\n    },\r\n    {\r\n        shortForm: '倍',\r\n        rubyForm: '{倍|ばい}',\r\n    },\r\n];\r\nexport const ocgKeywordDataMap = ocgKeywordDataList.reduce((acc, cur) => {\r\n    acc[cur.shortForm] = cur;\r\n    return acc;\r\n}, {} as Record<string, typeof ocgKeywordDataList[0]>);","type FinishInstruction = { opacity?: number, blendMode?: GlobalCompositeOperation };\r\nconst type3CommonInstruction: FinishInstruction[] = [{ blendMode: 'overlay', opacity: 1 }];\r\nconst type8CommonInstruction: FinishInstruction[] = [\r\n    { blendMode: 'overlay', opacity: 0.65 },\r\n    { blendMode: 'multiply', opacity: 0.55 },\r\n];\r\n\r\n/** @summary Web engine has less blend mode than photoshop (or any desktop image manipulators for that matter), the behavior of similar blend mode is also different, so we currently we cannot have a 1:1 conversion between photoshop layer into canvas. */\r\n\r\nexport type FinishInformation = {\r\n    value: string,\r\n    label: React.ReactNode,\r\n    partInstructionMap: Record<string, FinishInstruction[]>,\r\n};\r\nexport const FinishMap: Record<string, FinishInformation> = {\r\n    type1: {\r\n        value: 'type1',\r\n        label: '1',\r\n        partInstructionMap: {},\r\n    },\r\n    type2: {\r\n        value: 'type2',\r\n        label: '2',\r\n        partInstructionMap: {},\r\n    },\r\n    type3: {\r\n        value: 'type3',\r\n        label: '3',\r\n        partInstructionMap: {\r\n            'art-overlay': type3CommonInstruction,\r\n            'art-border': type3CommonInstruction,\r\n            'art-border-pendulum': type3CommonInstruction,\r\n            'border-pendulum': type3CommonInstruction,\r\n            'attribute': type3CommonInstruction,\r\n            'frame': type3CommonInstruction,\r\n        },\r\n    },\r\n    type4: {\r\n        value: 'type4',\r\n        label: '4',\r\n        partInstructionMap: {},\r\n    },\r\n    type5: {\r\n        value: 'type5',\r\n        label: '5',\r\n        partInstructionMap: {},\r\n    },\r\n    type6: {\r\n        value: 'type6',\r\n        label: '6',\r\n        partInstructionMap: {},\r\n    },\r\n    type7: {\r\n        value: 'type7',\r\n        label: '7',\r\n        partInstructionMap: {\r\n            'total-overlay': [{ blendMode: 'screen', opacity: 0.175 }, { blendMode: 'color-dodge', opacity: 0.125 }],\r\n        },\r\n    },\r\n    type8: {\r\n        value: 'type8',\r\n        label: '8',\r\n        partInstructionMap: {\r\n            'art-border': type8CommonInstruction,\r\n            'art-border-pendulum': type8CommonInstruction,\r\n            'border-pendulum': type8CommonInstruction,\r\n            'frame': type8CommonInstruction,\r\n            'frame-background': type8CommonInstruction,\r\n            'name': type8CommonInstruction,\r\n            'star': type8CommonInstruction,\r\n        },\r\n    },\r\n    type9: {\r\n        value: 'type9',\r\n        label: '9',\r\n        partInstructionMap: {\r\n            'total-overlay': [{ blendMode: 'screen', opacity: 0.45 }],\r\n        },\r\n    },\r\n};\r\n\r\nexport const ArtFinishMap: Record<string, FinishInformation> = {\r\n    type1: {\r\n        value: 'type1',\r\n        label: '1',\r\n        partInstructionMap: {\r\n            art: [{}],\r\n        },\r\n    },\r\n    type2: {\r\n        value: 'type2',\r\n        label: '2',\r\n        partInstructionMap: {\r\n            art: [\r\n                { opacity: 0.08, blendMode: 'darken' },\r\n                { opacity: 0.28, blendMode: 'color-dodge' },\r\n                { opacity: 0.48, blendMode: 'multiply' },\r\n            ],\r\n        },\r\n    },\r\n    type3: {\r\n        value: 'type3',\r\n        label: '3',\r\n        partInstructionMap: {\r\n            art: [{ opacity: 0.66, blendMode: 'color-dodge' }, { opacity: 0.64, blendMode: 'multiply' }],\r\n        },\r\n    },\r\n    type4: {\r\n        value: 'type4',\r\n        label: '4',\r\n        partInstructionMap: {\r\n            art: [{ opacity: 0.31, blendMode: 'color-dodge' }, { opacity: 0.6, blendMode: 'multiply' }]\r\n        },\r\n    },\r\n    type5: {\r\n        value: 'type5',\r\n        label: '5',\r\n        partInstructionMap: {\r\n            art: [{ opacity: 0.19, blendMode: 'color-dodge' }, { opacity: 0.6, blendMode: 'multiply' }]\r\n        },\r\n    },\r\n    type6: {\r\n        value: 'type6',\r\n        label: '6',\r\n        partInstructionMap: {\r\n            art: [{ opacity: 0.25, blendMode: 'color-dodge' }, { opacity: 0.6, blendMode: 'multiply' }]\r\n        },\r\n    },\r\n    type7: {\r\n        value: 'type7',\r\n        label: '7',\r\n        partInstructionMap: {\r\n            art: [{}],\r\n        },\r\n    },\r\n};\r\n\r\nexport const FoilList = [\r\n    {\r\n        name: 'normal' as const,\r\n        label: 'None',\r\n        color: '#747b95',\r\n    },\r\n    {\r\n        name: 'gold' as const,\r\n        label: 'Gold',\r\n        color: '#cfa65f',\r\n    },\r\n    {\r\n        name: 'platinum' as const,\r\n        label: 'Platinum',\r\n        color: '#b1b1b1',\r\n    },\r\n];\r\nexport type Foil = typeof FoilList[0]['name'];","import { createFontGetter } from 'src/util';\r\n\r\nexport type FontSizeData = {\r\n    fontSize: number,\r\n    lineHeight: number,\r\n    lineCount: number,\r\n    offsetY?: number,\r\n    bulletSymbolWidth: number,\r\n    iconSymbolWidth?: number,\r\n    capitalLetterRatio?: number,\r\n    squareBracketRatio?: number,\r\n    largeSymbolRatio?: number,\r\n    letterSpacing?: number,\r\n    wordLetterSpacing?: number,\r\n    headTextFontRatio?: number,\r\n    headTextSpacing?: number,\r\n};\r\nexport const DefaultFontSizeData = {\r\n    offsetY: 0,\r\n    capitalLetterRatio: 1,\r\n    squareBracketRatio: 1,\r\n    largeSymbolRatio: 1.35,\r\n    letterSpacing: 0,\r\n    headTextFontRatio: 0.325,\r\n    headTextSpacing: 1,\r\n};\r\nexport const DefaultFontData = {\r\n    headTextHeightRatio: 0.800,\r\n    headTextOverflow: 'normal' as 'normal' | 'condense',\r\n};\r\n\r\nexport type MetricMethod = 'name' | 'standard' | 'compact' | 'creator' | 'furigana';\r\nexport type FontData = {\r\n    alphabetFont: string,\r\n    font: string,\r\n    fontList: FontSizeData[],\r\n    furiganaFont: string,\r\n    headTextFillStyle?: string,\r\n    metricMethod?: MetricMethod,\r\n    numberFont?: string,\r\n    numberFontRatio?: number,\r\n    ordinalFont: string,\r\n    headTextHeightRatio?: number,\r\n    fontStyle: string,\r\n    symbolFont: string,\r\n    symbolFontRatio: number,\r\n    weight?: 'bold',\r\n    headTextOverflow?: 'normal' | 'condense',\r\n};\r\nexport type TextData = {\r\n    fontData: FontData,\r\n    fontLevel: number,\r\n    currentFont: ReturnType<typeof createFontGetter>,\r\n};\r\n\r\nconst DefaultEffectFontData = {\r\n    alphabetFont: '\"Yu-Gi-Oh! DF Leisho 3\"',\r\n    furiganaFont: 'DFHSGothic-W3-WIN-RKSJ-H',\r\n    headTextFontRatio: 0.7,\r\n    headTextHeightRatio: 0.815,\r\n    ordinalFont: '\"DFKakuTaiHiStd-W4\"',\r\n    symbolFont: 'matrix',\r\n    symbolFontRatio: 1,\r\n};\r\nconst DefaultTCGEffectFontData: FontData = {\r\n    ...DefaultEffectFontData,\r\n    font: 'MatrixBook',\r\n    headTextHeightRatio: 0.750,\r\n    fontStyle: 'tcg',\r\n    fontList: [],\r\n};\r\nexport const DefaultTCGNormalFontData: FontData = {\r\n    ...DefaultEffectFontData,\r\n    font: '\"stone-serif-regular\"',\r\n    headTextHeightRatio: 0.750,\r\n    fontStyle: 'tcg',\r\n    fontList: [],\r\n};\r\nconst DefaultOCGEffectFontData: FontData = {\r\n    ...DefaultEffectFontData,\r\n    font: '\"Yu-Gi-Oh! DF Leisho 3\"',\r\n    fontStyle: 'ocg',\r\n    metricMethod: 'compact',\r\n    fontList: [],\r\n};\r\n\r\nexport const EffectFontData: Record<string, FontData> = {\r\n    'tcg': {\r\n        ...DefaultTCGEffectFontData,\r\n        fontList: [\r\n            { bulletSymbolWidth: 23, fontSize: 24.38, lineHeight: 24.7, lineCount: 8 },\r\n            { bulletSymbolWidth: 23, fontSize: 19.94, lineHeight: 21.15, lineCount: 10 },\r\n        ],\r\n    },\r\n    'tcg-stat': {\r\n        ...DefaultTCGEffectFontData,\r\n        fontList: [\r\n            { bulletSymbolWidth: 23, fontSize: 25.2, lineHeight: 24.9, lineCount: 7 },\r\n        ]\r\n    },\r\n    'tcg-type-stat': {\r\n        ...DefaultTCGEffectFontData,\r\n        fontList: [\r\n            { bulletSymbolWidth: 23, fontSize: 25.2, lineHeight: 24.9, lineCount: 6 },\r\n            { bulletSymbolWidth: 23, fontSize: 19.95, lineHeight: 21.5, lineCount: 7 },\r\n            { bulletSymbolWidth: 23, fontSize: 18.8, lineHeight: 18.8, lineCount: 8 },\r\n            { bulletSymbolWidth: 19, fontSize: 16.7, lineHeight: 16.7, lineCount: 9 },\r\n            { bulletSymbolWidth: 19, fontSize: 15.0, lineHeight: 15.0, lineCount: 10 },\r\n        ]\r\n    },\r\n    'tcg-type': {\r\n        ...DefaultTCGEffectFontData,\r\n        fontList: [\r\n            { bulletSymbolWidth: 23, fontSize: 25.2, lineHeight: 24.9, lineCount: 7 },\r\n        ]\r\n    },\r\n    'ocg': {\r\n        ...DefaultOCGEffectFontData,\r\n        fontList: [\r\n            { bulletSymbolWidth: 16, fontSize: 22, lineHeight: 26, lineCount: 7 },\r\n            { bulletSymbolWidth: 16, fontSize: 22, lineHeight: 26, lineCount: 8 },\r\n        ]\r\n    },\r\n    'ocg-stat': {\r\n        ...DefaultOCGEffectFontData,\r\n        fontList: [\r\n            { bulletSymbolWidth: 16, fontSize: 22.05, lineHeight: 25.8, lineCount: 7 },\r\n        ]\r\n    },\r\n    'ocg-type-stat': {\r\n        ...DefaultOCGEffectFontData,\r\n        fontList: [\r\n            { bulletSymbolWidth: 16, fontSize: 22.05, lineHeight: 25.8, lineCount: 6 },\r\n        ]\r\n    },\r\n    'ocg-type': {\r\n        ...DefaultOCGEffectFontData,\r\n        fontList: [\r\n            { bulletSymbolWidth: 16, fontSize: 22.05, lineHeight: 25.8, lineCount: 7 },\r\n        ]\r\n    },\r\n};\r\n\r\nexport const TCGVanillaTypeStatFontList = [\r\n    { bulletSymbolWidth: 23, fontSize: 21.8, lineHeight: 24.9, lineCount: 6 },\r\n    { bulletSymbolWidth: 23, fontSize: 17.28, lineHeight: 21.5, lineCount: 7 },\r\n    { bulletSymbolWidth: 23, fontSize: 16.28, lineHeight: 18.8, lineCount: 8 },\r\n    { bulletSymbolWidth: 19, fontSize: 14.46, lineHeight: 16.7, lineCount: 9 },\r\n    { bulletSymbolWidth: 19, fontSize: 12.99, lineHeight: 15.0, lineCount: 10 },\r\n];\r\n\r\nexport const PendulumEffectFontData: Record<string, FontData> = {\r\n    tcg: {\r\n        ...DefaultTCGEffectFontData,\r\n        fontList: [\r\n            { bulletSymbolWidth: 23, fontSize: 24.3, lineHeight: 24.35, lineCount: 5 },\r\n        ],\r\n    },\r\n    ocg: {\r\n        ...DefaultOCGEffectFontData,\r\n        fontList: [\r\n            {\r\n                bulletSymbolWidth: 16,\r\n                fontSize: 22.05,\r\n                lineHeight: 25.2,\r\n                headTextFontRatio: 0.325,\r\n                lineCount: 5,\r\n            },\r\n        ],\r\n    },\r\n};\r\n\r\nexport type CondenseType = 'veryStrict' | 'veryLoose' | 'strict' | 'loose' | 'relaxed';\r\nexport const CondenseTolerantMap: Record<CondenseType, Record<string, number>> = {\r\n    veryStrict: {\r\n        '1': 600,\r\n        '2': 620,\r\n        '3': 640,\r\n    },\r\n    strict: {\r\n        '1': 645,\r\n        '2': 665,\r\n        '3': 685,\r\n    },\r\n    loose: {\r\n        '1': 700,\r\n        '2': 710,\r\n        '3': 720,\r\n    },\r\n    veryLoose: {\r\n        '1': 740,\r\n        '2': 770,\r\n        '3': 800,\r\n    },\r\n    relaxed: {\r\n        '1': 800,\r\n        '2': 850,\r\n        '3': 900,\r\n    },\r\n};\r\nexport const CondenseTolerantLabelMap: Record<CondenseType, { label: string, order: number }> = {\r\n    veryStrict: {\r\n        label: '5',\r\n        order: 1,\r\n    },\r\n    strict: {\r\n        label: '4',\r\n        order: 2,\r\n    },\r\n    loose: {\r\n        label: '3',\r\n        order: 3,\r\n    },\r\n    veryLoose: {\r\n        label: '2',\r\n        order: 4,\r\n    },\r\n    relaxed: {\r\n        label: '1',\r\n        order: 5,\r\n    },\r\n};","import { FontData } from './font-data-effect';\r\n\r\nexport type NameFontData = {\r\n    value: string,\r\n    label: React.ReactNode,\r\n    fontData: FontData,\r\n};\r\nexport const NameFontDataMap: Record<'Default' | 'Arial' | 'OCG', NameFontData> = {\r\n    Default: {\r\n        value: 'Default',\r\n        label: 'Default',\r\n        fontData: {\r\n            alphabetFont: 'MatrixRegularSmallCaps',\r\n            font: 'MatrixRegularSmallCaps',\r\n            furiganaFont: 'DFHSGothic-W3-WIN-RKSJ-H',\r\n            ordinalFont: '\"DFKakuTaiHiStd-W4\"',\r\n            fontStyle: 'tcg',\r\n            symbolFont: 'matrix',\r\n            symbolFontRatio: 0.775,\r\n            headTextHeightRatio: 0.55,\r\n            fontList: [{\r\n                bulletSymbolWidth: 64,\r\n                fontSize: 91.5,\r\n                headTextFontRatio: 0.190,\r\n                letterSpacing: 0.015,\r\n                lineCount: 1,\r\n                lineHeight: 91.5,\r\n                offsetY: 0,\r\n            }],\r\n        },\r\n    },\r\n    Arial: {\r\n        value: 'Arial',\r\n        label: 'Arial (Bold)',\r\n        fontData: {\r\n            alphabetFont: 'Arial',\r\n            font: 'Arial',\r\n            furiganaFont: 'DFHSGothic-W3-WIN-RKSJ-H',\r\n            ordinalFont: '\"DFKakuTaiHiStd-W4\"',\r\n            fontStyle: 'tcg',\r\n            symbolFont: 'matrix',\r\n            symbolFontRatio: 0.775,\r\n            headTextHeightRatio: 0.825,\r\n            weight: 'bold',\r\n            fontList: [{\r\n                bulletSymbolWidth: 40.67,\r\n                fontSize: 61,\r\n                headTextFontRatio: 0.190,\r\n                letterSpacing: -0.14,\r\n                lineCount: 1,\r\n                lineHeight: 61,\r\n                offsetY: 3,\r\n            }],\r\n        },\r\n    },\r\n    OCG: {\r\n        value: 'OCG',\r\n        label: 'OCG',\r\n        fontData: {\r\n            alphabetFont: '\"Yu-Gi-Oh! DF Leisho 3\"',\r\n            font: '\"Yu-Gi-Oh! DF Leisho 3\"',\r\n            furiganaFont: 'DFHSGothic-W3-WIN-RKSJ-H',\r\n            headTextHeightRatio: 0.775,\r\n            headTextOverflow: 'condense',\r\n            metricMethod: 'name',\r\n            numberFont: 'DFKakuTaiHiStd-W4',\r\n            numberFontRatio: 1.00,\r\n            ordinalFont: '\"DFKakuTaiHiStd-W4\"',\r\n            symbolFont: 'matrix',\r\n            symbolFontRatio: 0.775,\r\n            fontStyle: 'ocg',\r\n            fontList: [{\r\n                bulletSymbolWidth: 42.67,\r\n                fontSize: 64,\r\n                headTextFontRatio: 0.190,\r\n                headTextSpacing: 3,\r\n                letterSpacing: -0.03,\r\n                lineCount: 1,\r\n                lineHeight: 64,\r\n                offsetY: 0,\r\n            }],\r\n        }\r\n    },\r\n};","import { FontData } from './font-data-effect';\r\n\r\nexport const tcgCreatorFontData: FontData = {\r\n    font: 'stone-serif-regular',\r\n    alphabetFont: 'stone-serif-regular',\r\n    symbolFont: 'matrix',\r\n    symbolFontRatio: 0.8,\r\n    ordinalFont: 'stone-serif-regular',\r\n    furiganaFont: 'DFHSGothic-W3-WIN-RKSJ-H',\r\n    fontStyle: 'tcg',\r\n    fontList: [\r\n        {\r\n            offsetY: -1,\r\n            bulletSymbolWidth: 20.05,\r\n            fontSize: 21.2,\r\n            lineHeight: 21.2,\r\n            lineCount: 1,\r\n            letterSpacing: -0.01,\r\n            headTextFontRatio: 0.4,\r\n            largeSymbolRatio: 1.25,\r\n        },\r\n        {\r\n            bulletSymbolWidth: 20.05,\r\n            fontSize: 20,\r\n            lineHeight: 20,\r\n            lineCount: 1,\r\n            letterSpacing: -0.01,\r\n            headTextFontRatio: 0.4,\r\n            largeSymbolRatio: 1.25,\r\n        },\r\n    ],\r\n};\r\nexport const ocgCreatorFontData: FontData = {\r\n    font: '\"FOT-Rodin Pro M\"',\r\n    alphabetFont: '\"FOT-Rodin Pro M\"',\r\n    symbolFont: 'matrix',\r\n    symbolFontRatio: 0.8,\r\n    ordinalFont: '\"DFKakuTaiHiStd-W4\"',\r\n    furiganaFont: 'DFHSGothic-W3-WIN-RKSJ-H',\r\n    metricMethod: 'creator',\r\n    fontStyle: 'ocg',\r\n    fontList: [{\r\n        bulletSymbolWidth: 18,\r\n        fontSize: 19.0,\r\n        letterSpacing: -0.11,\r\n        lineHeight: 20.5,\r\n        lineCount: 1,\r\n        headTextFontRatio: 0,\r\n        wordLetterSpacing: 0.11,\r\n    }],\r\n};\r\nexport const CreatorFontData: Record<string, FontData> = {\r\n    tcg: tcgCreatorFontData,\r\n    ocg: ocgCreatorFontData,\r\n};\r\n\r\nexport const tcgTypeAbilityFontData: FontData = {\r\n    font: 'YuGiOhITCStoneSerifBSc',\r\n    alphabetFont: 'YuGiOhITCStoneSerifBSc',\r\n    symbolFont: 'matrix',\r\n    symbolFontRatio: 0.8,\r\n    ordinalFont: 'YuGiOhITCStoneSerifBSc',\r\n    furiganaFont: 'DFHSGothic-W3-WIN-RKSJ-H',\r\n    fontStyle: 'tcg',\r\n    fontList: [\r\n        {\r\n            bulletSymbolWidth: 20.05,\r\n            fontSize: 31.5,\r\n            lineHeight: 31.5,\r\n            lineCount: 1,\r\n            iconSymbolWidth: 26,\r\n            capitalLetterRatio: 0.95,\r\n            letterSpacing: 0.02,\r\n            headTextFontRatio: 0.4,\r\n        },\r\n        {\r\n            bulletSymbolWidth: 21.80,\r\n            fontSize: 32.75,\r\n            lineHeight: 32.75,\r\n            lineCount: 1,\r\n            iconSymbolWidth: 26,\r\n            capitalLetterRatio: 0.95,\r\n            letterSpacing: -0.03,\r\n            headTextFontRatio: 0.4,\r\n        },\r\n        {\r\n            bulletSymbolWidth: 14.80,\r\n            fontSize: 44.5,\r\n            lineHeight: 44.5,\r\n            lineCount: 1,\r\n            iconSymbolWidth: 45,\r\n            // Noticeable baseline mismatch when this ratio reach 0.9, some rounding magic fuckery is going on here\r\n            capitalLetterRatio: 0.90001,\r\n            squareBracketRatio: 0.94001,\r\n            letterSpacing: -0.03,\r\n            headTextFontRatio: 0.4,\r\n        },\r\n    ],\r\n};\r\nexport const ocgTypeAbilityFontData: FontData = {\r\n    font: '\"Yu-Gi-Oh! DF Leisho 3\"',\r\n    alphabetFont: '\"Yu-Gi-Oh! DF Leisho 3\"',\r\n    symbolFont: 'matrix',\r\n    symbolFontRatio: 0.8,\r\n    headTextHeightRatio: 0.775,\r\n    ordinalFont: '\"DFKakuTaiHiStd-W4\"',\r\n    furiganaFont: 'DFHSGothic-W3-WIN-RKSJ-H',\r\n    fontStyle: 'ocg',\r\n    fontList: [\r\n        {\r\n            bulletSymbolWidth: 20.05,\r\n            fontSize: 25.2,\r\n            lineHeight: 25.2,\r\n            lineCount: 1,\r\n            iconSymbolWidth: 26,\r\n            headTextFontRatio: 0.300,\r\n        },\r\n        {\r\n            bulletSymbolWidth: 21.80,\r\n            fontSize: 26.5,\r\n            lineHeight: 26.5,\r\n            lineCount: 1,\r\n            iconSymbolWidth: 26,\r\n            headTextFontRatio: 0.300,\r\n        },\r\n        {\r\n            bulletSymbolWidth: 36.80,\r\n            fontSize: 48,\r\n            lineHeight: 48,\r\n            lineCount: 1,\r\n            iconSymbolWidth: 45,\r\n            headTextFontRatio: 0.25,\r\n            headTextSpacing: 6,\r\n            letterSpacing: -0.07,\r\n            squareBracketRatio: 1.02501,\r\n        },\r\n    ],\r\n};\r\nexport const getTypeAbilityFontData = (): Record<string, FontData> => ({\r\n    tcg: tcgTypeAbilityFontData,\r\n    ocg: ocgTypeAbilityFontData,\r\n});","/** Normalize various variant of a general letter into a single version for easier manage. For example OCG has their own version of full-width alphabet characters and digits. */\r\nexport const tcgToOCGLetterMap: Record<string, string> = {\r\n    '０': '0',\r\n    '１': '1',\r\n    '２': '2',\r\n    '３': '3',\r\n    '４': '4',\r\n    '５': '5',\r\n    '６': '6',\r\n    '７': '7',\r\n    '８': '8',\r\n    '９': '9',\r\n    'ａ': 'a',\r\n    'ｂ': 'b',\r\n    'ｃ': 'c',\r\n    'ｄ': 'd',\r\n    'ｅ': 'e',\r\n    'ｆ': 'f',\r\n    'ｇ': 'g',\r\n    'ｈ': 'h',\r\n    'ｉ': 'i',\r\n    'ｊ': 'j',\r\n    'ｋ': 'k',\r\n    'ｌ': 'l',\r\n    'ｍ': 'm',\r\n    'ｎ': 'n',\r\n    'ｏ': 'o',\r\n    'ｐ': 'p',\r\n    'ｑ': 'q',\r\n    'ｒ': 'r',\r\n    'ｓ': 's',\r\n    'ｔ': 't',\r\n    'ｕ': 'u',\r\n    'ｖ': 'v',\r\n    'ｗ': 'w',\r\n    'ｘ': 'x',\r\n    'ｙ': 'y',\r\n    'ｚ': 'z',\r\n    'Ａ': 'A',\r\n    'Ｂ': 'B',\r\n    'Ｃ': 'C',\r\n    'Ｄ': 'D',\r\n    'Ｅ': 'E',\r\n    'Ｆ': 'F',\r\n    'Ｇ': 'G',\r\n    'Ｈ': 'H',\r\n    'Ｉ': 'I',\r\n    'Ｊ': 'J',\r\n    'Ｋ': 'K',\r\n    'Ｌ': 'L',\r\n    'Ｍ': 'M',\r\n    'Ｎ': 'N',\r\n    'Ｏ': 'O',\r\n    'Ｐ': 'P',\r\n    'Ｑ': 'Q',\r\n    'Ｒ': 'R',\r\n    'Ｓ': 'S',\r\n    'Ｔ': 'T',\r\n    'Ｕ': 'U',\r\n    'Ｖ': 'V',\r\n    'Ｗ': 'W',\r\n    'Ｘ': 'X',\r\n    'Ｙ': 'Y',\r\n    'Ｚ': 'Z',\r\n    '「': '｢',\r\n    '」': '｣',\r\n    '、': '､',\r\n    // '/': '／',\r\n    ':': '：',\r\n    // 'ー': 'ｰ',\r\n    // '・': '･',\r\n    // '・': '･',\r\n    // '：': ':',\r\n    '∀': 'Ɐ',\r\n    'ꓯ': 'Ɐ',\r\n    'ꓛ': 'Ɔ',\r\n    'ꓱ': 'Ǝ',\r\n    'ꓞ': 'Ⅎ',\r\n    'ꓨ': '⅁',\r\n    'ꓘ': 'Ʞ',\r\n    'ꓶ': 'Ꞁ',\r\n    '⅂': 'Ꞁ',\r\n    'ꓒ': 'Ԁ',\r\n    'ꓕ': 'Ʇ',\r\n    'Ո': 'ꓵ',\r\n    'ꓥ': 'Ʌ',\r\n    '＜': '<',\r\n    '＞': '>',\r\n    '！': '!',\r\n    '（': '(',\r\n    '）': ')',\r\n    '＆': '&',\r\n    '＇': '\\'',\r\n    '＠': '@',\r\n};\r\nexport const ocgToTCGLetterMap: Record<string, string> = {\r\n    '０': '0',\r\n    '１': '1',\r\n    '２': '2',\r\n    '３': '3',\r\n    '４': '4',\r\n    '５': '5',\r\n    '６': '6',\r\n    '７': '7',\r\n    '８': '8',\r\n    '９': '9',\r\n    'ａ': 'a',\r\n    'ｂ': 'b',\r\n    'ｃ': 'c',\r\n    'ｄ': 'd',\r\n    'ｅ': 'e',\r\n    'ｆ': 'f',\r\n    'ｇ': 'g',\r\n    'ｈ': 'h',\r\n    'ｉ': 'i',\r\n    'ｊ': 'j',\r\n    'ｋ': 'k',\r\n    'ｌ': 'l',\r\n    'ｍ': 'm',\r\n    'ｎ': 'n',\r\n    'ｏ': 'o',\r\n    'ｐ': 'p',\r\n    'ｑ': 'q',\r\n    'ｒ': 'r',\r\n    'ｓ': 's',\r\n    'ｔ': 't',\r\n    'ｕ': 'u',\r\n    'ｖ': 'v',\r\n    'ｗ': 'w',\r\n    'ｘ': 'x',\r\n    'ｙ': 'y',\r\n    'ｚ': 'z',\r\n    'Ａ': 'A',\r\n    'Ｂ': 'B',\r\n    'Ｃ': 'C',\r\n    'Ｄ': 'D',\r\n    'Ｅ': 'E',\r\n    'Ｆ': 'F',\r\n    'Ｇ': 'G',\r\n    'Ｈ': 'H',\r\n    'Ｉ': 'I',\r\n    'Ｊ': 'J',\r\n    'Ｋ': 'K',\r\n    'Ｌ': 'L',\r\n    'Ｍ': 'M',\r\n    'Ｎ': 'N',\r\n    'Ｏ': 'O',\r\n    'Ｐ': 'P',\r\n    'Ｑ': 'Q',\r\n    'Ｒ': 'R',\r\n    'Ｓ': 'S',\r\n    'Ｔ': 'T',\r\n    'Ｕ': 'U',\r\n    'Ｖ': 'V',\r\n    'Ｗ': 'W',\r\n    'Ｘ': 'X',\r\n    'Ｙ': 'Y',\r\n    'Ｚ': 'Z',\r\n    // '｡': '。',\r\n    '｢': '「',\r\n    '｣': '」',\r\n    '､': '、',\r\n    // '／': '/',\r\n    '：': ':',\r\n    // 'ｰ': 'ー',\r\n    // '･': '・',\r\n    // '･': '・',\r\n    // ':': '：',\r\n    '∀': 'Ɐ',\r\n    'ꓯ': 'Ɐ',\r\n    'ꓛ': 'Ɔ',\r\n    'ꓱ': 'Ǝ',\r\n    'ꓞ': 'Ⅎ',\r\n    'ꓨ': '⅁',\r\n    'ꓘ': 'Ʞ',\r\n    'ꓶ': 'Ꞁ',\r\n    '⅂': 'Ꞁ',\r\n    'ꓒ': 'Ԁ',\r\n    'ꓕ': 'Ʇ',\r\n    'Ո': 'ꓵ',\r\n    'ꓥ': 'Ʌ',\r\n    '＜': '<',\r\n    '＞': '>',\r\n    '！': '!',\r\n    '（': '(',\r\n    '）': ')',\r\n    '＆': '&',\r\n    '＇': '\\'',\r\n    '＠': '@',\r\n};\r\n\r\n// const MirrorableLetter = {\r\n//     'ꟻ': 'Ｆ',\r\n//     '⅃': 'Ｌ',\r\n//     'ꟼ': 'Ｐ',\r\n//     'И': 'Ｎ',\r\n//     'Я': 'Ｒ',\r\n// };\r\n\r\nexport const ocgNumberCircleMap: Record<string, string> = {\r\n    '(１)': '①',\r\n    '(２)': '②',\r\n    '(３)': '③',\r\n    '(４)': '④',\r\n    '(５)': '⑤',\r\n    '(６)': '⑥',\r\n    '(７)': '⑦',\r\n    '(８)': '⑧',\r\n    '(９)': '⑨',\r\n    '(１０)': '⑩',\r\n    '(１１)': '⑪',\r\n    '(１２)': '⑫',\r\n    '(１３)': '⑬',\r\n    '(１４)': '⑭',\r\n    '(１５)': '⑮',\r\n    '(１６)': '⑯',\r\n    '(１７)': '⑰',\r\n    '(１８)': '⑱',\r\n    '(１９)': '⑲',\r\n    '(２０)': '⑳',\r\n    '(1)': '①',\r\n    '(2)': '②',\r\n    '(3)': '③',\r\n    '(4)': '④',\r\n    '(5)': '⑤',\r\n    '(6)': '⑥',\r\n    '(7)': '⑦',\r\n    '(8)': '⑧',\r\n    '(9)': '⑨',\r\n    '(10)': '⑩',\r\n    '(11)': '⑪',\r\n    '(12)': '⑫',\r\n    '(13)': '⑬',\r\n    '(14)': '⑭',\r\n    '(15)': '⑮',\r\n    '(16)': '⑯',\r\n    '(17)': '⑰',\r\n    '(18)': '⑱',\r\n    '(19)': '⑲',\r\n    '(20)': '⑳',\r\n};\r\n\r\n/** Automatically convert popular OCG terms into their TCG counterpart. Never introduce machine translation here :'( */\r\nexport const ocgToTCGTermMap: Record<string, string> = {\r\n    /** monster type */\r\n    '水族': 'Aqua',\r\n    '獣族': 'Beast',\r\n    '獣戦士族': 'Beast-Warrior',\r\n    '創造神族': 'Creator God',\r\n    'サイバース族': 'Cyberse',\r\n    '恐竜族': 'Dinosaur',\r\n    '幻神獣族': 'Divine-Beast',\r\n    'ドラゴン族': 'Dragon',\r\n    '天使族': 'Fairy',\r\n    '悪魔族': 'Fiend',\r\n    '魚族': 'Fish',\r\n    'ギャラクシー族': 'Galaxy',\r\n    '幻想魔族': 'Illusion',\r\n    '昆虫族': 'Insect',\r\n    '機械族': 'Machine',\r\n    '植物族': 'Plant',\r\n    'サイキック族': 'Psychic',\r\n    '炎族': 'Pyro',\r\n    '爬虫類族': 'Reptile',\r\n    '岩石族': 'Rock',\r\n    '海竜族': 'Sea Serpent',\r\n    '魔法使い族': 'Spellcaster',\r\n    '雷族': 'Thunder',\r\n    '戦士族': 'Warrior',\r\n    '鳥獣族': 'Winged Beast',\r\n    '幻竜族': 'Wyrm',\r\n    'アンデット族': 'Zombie',\r\n    'サイボーグ族': 'Cyborg',\r\n    '天界戦士族': 'Celestial Warrior',\r\n    'ハイドラゴン族': 'High Dragon',\r\n    '魔導騎士族': 'Magical Knight',\r\n    'オメガサイキック族': 'Omega Psychic',\r\n    /** type */\r\n    'モンスター': 'Monster',\r\n    '魔法カード': 'Spell Card',\r\n    '罠カード': 'Trap Card',\r\n    'アクション': 'Action',\r\n    /** subType */\r\n    '通常': 'Normal',\r\n    '効果': 'Effect',\r\n    '儀式': 'Ritual',\r\n    'フュージョン': 'Fusion', // This is Fusion in Rush Duel, when we translate this map into TCG one these two entries will have the same \"Fusion\" key. We place this one above so it will got overwritten by the normal OCG text for Fusion in the master series.\r\n    '融合': 'Fusion',\r\n    'シンクロ': 'Synchro',\r\n    'エクシーズ': 'Xyz',\r\n    'ペンデュラム': 'Pendulum',\r\n    'リンク': 'Link',\r\n    'マキシマム': 'Maximum',\r\n    'トークン': 'Token',\r\n    '特殊召喚': 'Special Summon',\r\n    'ダークシンクロモンスター': 'Dark Synchro',\r\n    /** ability */\r\n    'チューナー': 'Tuner',\r\n    'デュアル': 'Gemini',\r\n    'リバース': 'Flip',\r\n    'トゥーン': 'Toon',\r\n    'スピリット': 'Spirit',\r\n    'ユニオン': 'Union',\r\n    /** creator */\r\n    '©高橋和希 スタジオ・ダイス／集英社': '©1996 KAZUKI TAKAHASHI',\r\n    '©スタジオ・ダイス／集英社・テレビ東京・KONAMI': '©2020 Studio Dice/SHUEISHA, TV TOKYO, KONAMI',\r\n    /** sample card */\r\n    '{純|ジュン}{狐|こ}': 'Junko',\r\n    [`自分フィールドの効果モンスター×２体以上\r\n①：このカードがモンスターゾーンに存在する限り、相手フィールドのモンスターが効果を発動する度に、その相手の表側表示モンスターにピュアカウンターを１つ置く(最大１つまで）。②：このカードはピュアカウンターが置かれているモンスターが発動した効果を受けない。③：このカードはピュアカウンターが置かれているモンスターとの戦闘では破壊されない。`]: `[2+ Effect Monsters on your field]\r\nEach time an opponent's monster activates its effect, place 1 Pure Counter on that opponent's monster (max. 1) after that effect resolves. Unaffected by activated effects from monster with a Pure Counter. Cannot be destroyed by battle with monsters with a Pure Counter.`\r\n};\r\nexport const tcgToOCGTermMap = Object.entries(ocgToTCGTermMap).reduce((acc, cur) => {\r\n    const [ocgTerm, tcgTerm] = cur;\r\n    acc[tcgTerm] = ocgTerm;\r\n\r\n    return acc;\r\n}, {} as Record<string, string>);","export type FrameInfo = {\r\n    name: string,\r\n    edition: 'normal' | 'extendend',\r\n    labelColor: string,\r\n    labelBackgroundColor?: string,\r\n    labelBackgroundColorList?: string[],\r\n    labelBackgroundImage?: string,\r\n};\r\nexport const FrameInfoMap: Record<string, FrameInfo> = {\r\n    'normal': {\r\n        name: 'normal',\r\n        labelColor: '#ffffff',\r\n        edition: 'normal',\r\n        labelBackgroundColor: '#c49c5e',\r\n    },\r\n    'effect': {\r\n        name: 'effect',\r\n        labelColor: '#ffffff',\r\n        edition: 'normal',\r\n        labelBackgroundColor: '#b96c49',\r\n    },\r\n    'fusion': {\r\n        name: 'fusion',\r\n        labelColor: '#ffffff',\r\n        edition: 'normal',\r\n        labelBackgroundColor: '#8948a4',\r\n    },\r\n    'synchro': {\r\n        name: 'synchro',\r\n        labelColor: '#000',\r\n        edition: 'normal',\r\n        labelBackgroundColor: '#efefef',\r\n    },\r\n    'xyz': {\r\n        name: 'xyz',\r\n        labelColor: '#ffffff',\r\n        edition: 'normal',\r\n        labelBackgroundColor: '#000000',\r\n    },\r\n    'link': {\r\n        name: 'link',\r\n        labelColor: '#ffffff',\r\n        edition: 'normal',\r\n        labelBackgroundColor: '#0c8ac6',\r\n    },\r\n    'ritual': {\r\n        name: 'ritual',\r\n        labelColor: '#ffffff',\r\n        edition: 'normal',\r\n        labelBackgroundColor: '#5e85c9',\r\n    },\r\n    'spell': {\r\n        name: 'spell',\r\n        labelColor: '#ffffff',\r\n        edition: 'normal',\r\n        labelBackgroundColor: '#1b8f83',\r\n    },\r\n    'trap': {\r\n        name: 'trap',\r\n        labelColor: '#ffffff',\r\n        edition: 'normal',\r\n        labelBackgroundColor: '#c32a8c',\r\n    },\r\n    'token': {\r\n        name: 'token',\r\n        labelColor: '#ffffff',\r\n        edition: 'normal',\r\n        labelBackgroundColor: '#6f6c6b',\r\n    },\r\n    'dark-synchro': {\r\n        name: 'dark-synchro',\r\n        labelColor: '#ffffff',\r\n        edition: 'extendend',\r\n        labelBackgroundColor: '#4d4543',\r\n    },\r\n    'obelisk': {\r\n        name: 'obelisk',\r\n        labelColor: '#ffffff',\r\n        edition: 'extendend',\r\n        labelBackgroundColor: '#515eb0',\r\n    },\r\n    'osiris': {\r\n        name: 'osiris',\r\n        labelColor: '#ffffff',\r\n        edition: 'extendend',\r\n        labelBackgroundColor: '#bd5044',\r\n    },\r\n    'ra': {\r\n        name: 'ra',\r\n        labelColor: '#000',\r\n        edition: 'extendend',\r\n        labelBackgroundColor: '#b9ad34',\r\n    },\r\n    'raviel': {\r\n        name: 'raviel',\r\n        labelColor: '#ffffff',\r\n        edition: 'extendend',\r\n        labelBackgroundColor: '#313c5f',\r\n    },\r\n    'uria': {\r\n        name: 'uria',\r\n        labelColor: '#ffffff',\r\n        edition: 'extendend',\r\n        labelBackgroundColor: '#623320',\r\n    },\r\n    'hamon': {\r\n        name: 'hamon',\r\n        labelColor: '#ffffff',\r\n        edition: 'extendend',\r\n        labelBackgroundColor: '#534a19',\r\n    },\r\n    'lg-dragon': {\r\n        name: 'lg-dragon',\r\n        labelColor: '#ffffff',\r\n        edition: 'extendend',\r\n        labelBackgroundColor: '#4e84a4',\r\n    },\r\n    'speed-skill': {\r\n        name: 'speed-skill',\r\n        labelColor: '#ffffff',\r\n        edition: 'extendend',\r\n        labelBackgroundColor: '#199cd5',\r\n    },\r\n    'zarc': {\r\n        name: 'zarc',\r\n        labelColor: '#000',\r\n        edition: 'extendend',\r\n        labelBackgroundColorList: [\r\n            'rgba(185,108,73,1)',\r\n            'rgba(137,72,164,1)',\r\n            'rgba(239,239,239,1)',\r\n            'rgba(0,0,0,1)',\r\n        ],\r\n        labelBackgroundImage: `linear-gradient(90deg, ${[\r\n            'rgba(185,108,73,1) 23%',\r\n            'rgba(137,72,164,1) 27%',\r\n            'rgba(137,72,164,1) 48%',\r\n            'rgba(239,239,239,1) 52%',\r\n            'rgba(239,239,239,1) 73%',\r\n            'rgba(0,0,0,1) 77%',\r\n        ].join(', ')})`,\r\n    },\r\n};\r\nexport const frameList = Object.values(FrameInfoMap);","export const arrowPositionList = [\r\n    { top: 175, left: 55, width: 100, height: 100 },\r\n    { top: 165, left: 323, width: 170, height: 80 },\r\n    { top: 175, left: 655, width: 100, height: 100 },\r\n    { top: 442, left: 45, width: 70, height: 170 },\r\n    { top: 0, left: 0, width: 0, height: 0 },   /** Middle */\r\n    { top: 442, left: 700, width: 70, height: 170 },\r\n    { top: 775, left: 55, width: 100, height: 100 },\r\n    { top: 810, left: 323, width: 170, height: 80 },\r\n    { top: 775, left: 655, width: 100, height: 100 },\r\n];","import { ocgKeywordDataList } from './dictionary';\r\n\r\nexport const ST_ICON_SYMBOL = '⦾';\r\n\r\nexport const CAPITAL_LETTER_SOURCE = '[A-ZＡ-Ｚ]';\r\nexport const CapitalLetterRegex = new RegExp(CAPITAL_LETTER_SOURCE);\r\n\r\nexport const SQUARE_BRACKET_SOURCE = '[\\\\[\\\\]【】]';\r\nexport const SquareBracketLetterRegex = new RegExp(SQUARE_BRACKET_SOURCE);\r\n\r\nexport const WHOLE_WORD_SOURCE = '[#@∞a-zａ-ｚA-ZＡ-Ｚ0-9０-９!！+×＃#@∞‘“’”:;\\\\[\\\\]\\\\(\\\\)【】\\\\.,]+';\r\nexport const WholeWordRegex = new RegExp(WHOLE_WORD_SOURCE);\r\n\r\nexport const FragmentSplitRegex = new RegExp(`({[^{}]+?}|${WHOLE_WORD_SOURCE}|.)`);\r\n// export const FragmentSplitRegex = new RegExp('({[^{}]+?}|.)');\r\n\r\nexport const UNCOMPRESSED_SOURCE = '{{([^{}]+?)}}';\r\n\r\nexport const NB_WORD_OPEN = '⦉';\r\nexport const NB_WORD_CLOSE = '⦊';\r\nexport const NB_LINE_OPEN = '⟅';\r\nexport const NB_LINE_CLOSE = '⟆';\r\nexport const NB_UNCOMPRESSED_START = '⟬';\r\nexport const NB_UNCOMPRESSED_END = '⟭';\r\n/** Remove all control characters */\r\nexport const NormalizeTextRegex = new RegExp(`[${[\r\n    NB_WORD_OPEN,\r\n    NB_WORD_CLOSE,\r\n    NB_LINE_OPEN,\r\n    NB_LINE_CLOSE,\r\n    NB_UNCOMPRESSED_START,\r\n    NB_UNCOMPRESSED_END,\r\n].join('')}]|(\\\\|[^}]+})`, 'g');\r\n\r\nexport const NON_BREAKABLE_SYMBOL_SOURCE = `${NB_WORD_OPEN}|${NB_WORD_CLOSE}`;\r\nexport const nonBreakableSymbolRegex = new RegExp(NON_BREAKABLE_SYMBOL_SOURCE);\r\n\r\n/** Pretty hard to automatically detect condition clause inside flavor text. We must assume that the clause is always put inside a parentheses (as official cards do). */\r\nexport const FLAVOR_CONDITION_SOURCE = `(\\\\n^[\\\\r\\\\t\\\\f\\\\v \\\\u00a0\\\\u1680\\\\u2000-\\\\u200a\\\\u2028\\\\u2029\\\\u202f\\\\u205f\\\\u3000\\\\ufeff]*\\\\n${NB_WORD_OPEN}?\\\\([\\\\w\\\\W]+\\\\)${NB_WORD_CLOSE}?)\\\\s*$`;\r\n\r\n/** Small reminder: `g` flag turn regex into stateful, and cannot be reused without reset it first. */\r\nexport const TCG_LETTER_JOINLIST = '&A-Za-z0-9\\\\-/\\\\s\\\\(\\\\)!,.‘“’”:;<>\\\\[\\\\]\\\\\\\\';\r\nexport const TCGSpecialLetterRegex = new RegExp(`[^${TCG_LETTER_JOINLIST}]`);\r\n\r\nexport const OCG_KEYWORD_JOIN_REGEX = ocgKeywordDataList.map(entry => entry.regexForm ?? entry.shortForm).join('|');\r\nexport const OCG_KEYWORD_SOURCE = `(${OCG_KEYWORD_JOIN_REGEX})(?![^{]*})`;\r\n\r\nexport const CHIISAI_KANA_JOINLIST = 'ヽヾーァィゥェォッャュョヮヵヶぁぃぅぇぉっゃゅょゎゕゖㇰㇱㇲㇳㇴㇵㇶㇷㇸㇹㇺㇻㇼㇽㇾㇿ々〻';\r\nexport const ChiisaiRegex = new RegExp(`[${CHIISAI_KANA_JOINLIST}]`);\r\n\r\nexport const OCG_RUBY_SOURCE = '{[^{}]+?}';\r\nexport const NOT_START_OF_LINE_SOURCE = `.[${CHIISAI_KANA_JOINLIST})\\\\]｝〕〉》」｣』】〙〗〟'\"’”｠»‐゠–〜？!‼⁇⁈⁉・、:;,。.｡､]+`;\r\nexport const NOT_END_OF_LINE_SOURCE = '[(\\\\[｛〔〈《「｢『【〘〖〝\\'\"‘“｟«●]+.';\r\nexport const NOT_SPLIT_SOURCE = '.[—...‥〳〴〵)]+[^\\\\s]';\r\nexport const OCG_BULLET_SOURCE = '[①-⑳]：.';\r\n\r\nexport const OCG_ALPHABET_SOURCE = '[Ａ-Ｚａ-ｚ]';\r\nexport const OCGAlphabetRegex = new RegExp(OCG_ALPHABET_SOURCE);\r\n\r\nexport const OCGNumberRegex = new RegExp('[０-９]');\r\nexport const NumberRegex = new RegExp('[0-9]');\r\n\r\nexport const HiraganaRegex = /[あいうえおかがきぎくぐけげこごさざしじすずせぜそぞただちぢつづてでとどなにぬねのはばぱひびぴふぶぷへべぺほぼぽまみむめもやゆよらりるれろわゐゑをんゔ]/;\r\n\r\nexport const KatakanaRegex = /[アイウエオカガキギクグケゲコゴサザシジスズセゼソゾタダチヂツヅテデトドナニヌネノハバパヒビピフブプヘベペホボポマミムメモヤユヨラリルレロワヰヱヲンヴヷヸヹヺ]/;\r\n\r\nexport const OCGDotRegex = new RegExp('[・]');\r\nexport const ChoonpuRegex = new RegExp('[ー]');\r\nexport const NoSpaceRegex = new RegExp('[―]');\r\n\r\nconst OCG_INCREASED_LEVEL_2_WIDTH_JOINLIST = '：';\r\nexport const OCGIncreasedLevel2WidthRegex = new RegExp(`[${OCG_INCREASED_LEVEL_2_WIDTH_JOINLIST}]`);\r\n\r\nconst OCG_INCREASED_WIDTH_JOINLIST = '。､';\r\nexport const OCGIncreasedWidthRegex = new RegExp(`[${OCG_INCREASED_WIDTH_JOINLIST}]`);\r\n\r\nconst OCG_NO_OVERHEAD_GAP_JOINLIST = '：';\r\nexport const OCGNoOverheadGapRegex = new RegExp(`[${OCG_NO_OVERHEAD_GAP_JOINLIST}]`);\r\n\r\nexport const OCGOffsetMap: Record<string, number> = {\r\n    '。': -0.2,\r\n    '､': -0.2,\r\n    '｢': 0,\r\n    '｣': 0,\r\n    '：': 0.5,\r\n    '>': 0.25,\r\n    '<': -0.25,\r\n};\r\nexport const OCGLastOfLineOffsetMap: Record<string, number> = {\r\n    '。': -0.5,\r\n    '：': -0.75,\r\n};\r\nexport const OCGBoxSpacingRatioMap: Record<string, number> = {\r\n    '>': 0.125,\r\n    '<': 0.125,\r\n};\r\nexport const TCGOffsetMap: Record<string, number> = {\r\n    '\\\\': -0.025,\r\n};\r\nexport const TCGLastOfLineOffsetMap: Record<string, number> = {\r\n};\r\nexport const TCGBoxSpacingRatioMap: Record<string, number> = {\r\n    '\\\\': 0.3,\r\n};\r\n\r\nexport const OCG_REDUCED_AT_END_LINE_RATIO = 0.500;\r\n\r\nexport const BULLET_LETTER = '●';\r\nexport const getBulletSpacing = (format: string) => format === 'tcg' ? 7 : 1;\r\n\r\nexport const MAX_LINE_REVERSE_INDENT = 20;\r\nexport const START_OF_LINE_ALPHABET_OFFSET = 4;\r\n\r\nexport const RUBY_REGEX = /{[^{}]+?}/;\r\n/** If foot text consist of multiple letter and overflow mode is `condense`, head text will also condense but with a smaller rate (that mean they are less compressed), this is the bonus rate. So if foot text is compressed by 50%, head text only got compressed by 40%. */\r\nexport const RUBY_BONUS_RATIO = 0.1;\r\n\r\nexport const BREAKABLE_LETTER = '\\\\s\\\\-/';\r\n/** Default ratio to calculate the gap of a letter. We do not want head text to overlap, so a letter cannot give more space than half of it size. 40% is nice enough. */\r\nexport const LETTER_GAP_RATIO = -0.4;\r\nexport const GAP_PER_WIDTH_RATIO = -2.25;\r\nexport const GAP_PADDING_RATIO = 0.03125;","import { BackgroundType, CardOpacity, getDefaultCardOpacity } from './canvas';\r\nimport { Foil } from './foil-finish';\r\nimport { CondenseType } from './font-data-effect';\r\nimport { NO_ICON } from './icon';\r\nimport { getDefaultNameStyle, NameStyle, NameStyleType } from './name-preset';\r\n\r\nexport type Card = ReturnType<typeof getDefaultCard>;\r\nexport const getDefaultCard = () => ({\r\n    version: 0,\r\n    format: 'tcg',\r\n    frame: 'fusion',\r\n    foil: 'normal' as Foil,\r\n    opacity: getDefaultCardOpacity() as Partial<CardOpacity>,\r\n    finish: [] as string[],\r\n    artFinish: 'normal',\r\n    name: 'Junko',\r\n    nameStyleType: 'auto' as NameStyleType,\r\n    nameStyle: getDefaultNameStyle() as Partial<NameStyle>,\r\n    attribute: 'LIGHT',\r\n    subFamily: NO_ICON,\r\n    cardIcon: 'auto',\r\n    star: 6,\r\n    art: 'https://i.imgur.com/h5kXZeC.png',\r\n    artCrop: {\r\n        x: 0,\r\n        y: 4,\r\n        width: 100,\r\n        height: 89.5,\r\n        unit: '%',\r\n        aspect: 1,\r\n    } as Partial<ReactCrop.Crop>,\r\n    hasBackground: false,\r\n    background: '',\r\n    backgroundType: 'fit' as BackgroundType,\r\n    backgroundCrop: {\r\n        x: 0,\r\n        y: 4,\r\n        width: 100,\r\n        height: 89.5,\r\n        unit: '%',\r\n        aspect: 1,\r\n    } as Partial<ReactCrop.Crop>,\r\n    linkMap: [\r\n        '1',\r\n        '3',\r\n        '7',\r\n        '9',\r\n    ] as string[],\r\n    isPendulum: false,\r\n    pendulumFrame: 'auto',\r\n    pendulumEffect: 'Once per turn: You can pay 800 LP, increase this card\\'s Pendulum Scale by 1.',\r\n    pendulumScaleRed: '4',\r\n    pendulumScaleBlue: '4',\r\n    typeAbility: ['Fairy',\r\n        'Fusion',\r\n        'Effect'] as string[],\r\n    effectStyle: {\r\n        condenseTolerant: 'strict' as CondenseType,\r\n    },\r\n    effect: `[2+ Effect Monsters on your field]\r\nEach time an opponent's monster activates its effect, place 1 Pure Counter on that opponent's monster (max. 1) after that effect resolves. Unaffected by activated effects from monster with a Pure Counter. Cannot be destroyed by battle with monsters with a Pure Counter.`,\r\n    setId: 'YGOC-EN001',\r\n    atk: '2000',\r\n    def: '2000',\r\n    password: '18111996',\r\n    sticker: 'holo5',\r\n    isFirstEdition: true,\r\n    isSpeedCard: false,\r\n    isDuelTerminalCard: false,\r\n    creator: '©2020 Studio Dice/SHUEISHA, TV TOKYO, KONAMI',\r\n    furiganaHelper: true,\r\n});\r\nexport const getEmptyCard = (): Card => ({\r\n    version: 0,\r\n    format: 'tcg',\r\n    frame: 'effect',\r\n    foil: 'normal',\r\n    opacity: getDefaultCardOpacity(),\r\n    finish: [],\r\n    artFinish: 'normal',\r\n    name: '',\r\n    nameStyleType: 'auto',\r\n    nameStyle: getDefaultNameStyle(),\r\n    attribute: 'LIGHT',\r\n    subFamily: NO_ICON,\r\n    cardIcon: 'auto',\r\n    star: 6,\r\n    art: 'https://i.imgur.com/jjtCuG5.png',\r\n    artCrop: {\r\n        x: 0,\r\n        y: 4,\r\n        width: 100,\r\n        height: 89.5,\r\n        unit: '%',\r\n        aspect: 1,\r\n    },\r\n    hasBackground: false,\r\n    background: '',\r\n    backgroundType: 'fit',\r\n    backgroundCrop: {\r\n        x: 0,\r\n        y: 4,\r\n        width: 100,\r\n        height: 89.5,\r\n        unit: '%',\r\n        aspect: 1,\r\n    },\r\n    linkMap: [],\r\n    isPendulum: false,\r\n    pendulumFrame: 'auto',\r\n    pendulumEffect: '',\r\n    pendulumScaleRed: '4',\r\n    pendulumScaleBlue: '4',\r\n    typeAbility: [],\r\n    effectStyle: {\r\n        condenseTolerant: 'strict',\r\n    },\r\n    effect: '',\r\n    setId: '',\r\n    atk: '0',\r\n    def: '0',\r\n    password: '',\r\n    sticker: 'no-sticker',\r\n    isFirstEdition: false,\r\n    isSpeedCard: false,\r\n    isDuelTerminalCard: false,\r\n    creator: '',\r\n    furiganaHelper: true,\r\n});\r\n\r\nexport const OpacityList = [\r\n    {\r\n        type: 'body' as const,\r\n        subType: 'artBorder' as const,\r\n        label: 'Card',\r\n        tooltip: 'Keep art border even if the card\\'s body is transparent.',\r\n    },\r\n    {\r\n        type: 'name' as const,\r\n        subType: 'nameBorder' as const,\r\n        label: 'Name',\r\n        tooltip: 'Draw name\\'s border and finish whenever possible.',\r\n    },\r\n    {\r\n        type: 'pendulum' as const,\r\n        label: 'Pendulum',\r\n        tooltip: null,\r\n    },\r\n    {\r\n        type: 'text' as const,\r\n        label: 'Effect',\r\n        tooltip: null,\r\n    },\r\n];\r\n\r\nexport * from './icon';\r\nexport * from './canvas';\r\nexport * from './coordinate-data';\r\nexport * from './dictionary';\r\nexport * from './foil-finish';\r\nexport * from './font-data-effect';\r\nexport * from './font-data-name';\r\nexport * from './font-data-other';\r\nexport * from './format';\r\nexport * from './frame';\r\nexport * from './link';\r\nexport * from './name-preset';\r\nexport * from './regex';","import { Card, Foil, frameList, NameStyle, NameStyleType, PresetNameStyleMap } from '../model';\r\n\r\nexport const checkNormal = (card: Pick<Card, 'frame'>) => {\r\n    return card.frame === 'normal' && checkMonster(card);\r\n};\r\nexport const checkXyz = (card: Pick<Card, 'frame'>) => {\r\n    return card.frame === 'xyz';\r\n};\r\nexport const checkDarkSynchro = (card: Pick<Card, 'frame'>) => {\r\n    return card.frame === 'dark-synchro';\r\n};\r\nexport const checkLink = (card: Pick<Card, 'frame'>) => {\r\n    return card.frame === 'link' && checkMonster(card);\r\n};\r\nexport const checkSpeedSkill = (card: Pick<Card, 'frame'>) => {\r\n    return card.frame === 'speed-skill' && !checkMonster(card);\r\n};\r\nexport const checkMonster = (card: Pick<Card, 'frame'>) => {\r\n    return card.frame !== 'spell' && card.frame !== 'trap' && card.frame !== 'speed-skill';\r\n};\r\n\r\nexport const getCardFrame = (frame: string) => {\r\n    return frameList.find(entry => entry.name === frame.toLowerCase())?.name ?? 'effect';\r\n};\r\nexport const getCardIconFromFrame = (frame: string) => {\r\n    if (frame === 'spell' || frame === 'trap') return 'st';\r\n    if (frame === 'xyz') return 'rank';\r\n    if (frame === 'dark-synchro') return 'negative-level';\r\n    if (frame === 'speed-skill') return 'none';\r\n    return 'level';\r\n};\r\n\r\nexport const checkLightHeader = (frame: string) => {\r\n    return !checkMonster({ frame }) || checkLightFrame(frame);\r\n};\r\n\r\nexport const checkLightFrame = (frame: string) => {\r\n    return ['link', 'xyz', 'dark-synchro', 'speed-skill', 'hamon', 'uria', 'raviel'].includes(frame);\r\n};\r\n\r\nexport const resolveNameStyle = ({\r\n    format,\r\n    frame,\r\n    nameStyle,\r\n    nameStyleType,\r\n    foil,\r\n}: {\r\n    nameStyleType: NameStyleType,\r\n    nameStyle: Partial<NameStyle>,\r\n    frame: string,\r\n    format: string,\r\n    foil: Foil,\r\n}) => {\r\n    /** Custom style will be kept as is */\r\n    if (nameStyleType === 'custom') {\r\n        return nameStyle;\r\n    }\r\n\r\n    const isSpeedSkill = checkSpeedSkill({ frame });\r\n    const lightHeader = checkLightHeader(frame);\r\n\r\n    let contextualFont = 'Default';\r\n    if (format === 'ocg') contextualFont = 'OCG';\r\n    if (isSpeedSkill && format === 'tcg') contextualFont = 'Arial';\r\n\r\n    /** Predefined name style has dynamic font based on format unless explictly stated */\r\n    let contextualColor = {\r\n        fillStyle: lightHeader ? '#ffffff' : '#000000',\r\n        headTextFillStyle: lightHeader ? '#ffffff' : '#000000',\r\n    };\r\n    if (nameStyleType === 'predefined') {\r\n        const resultNameStyle = { ...PresetNameStyleMap[nameStyle.preset ?? 'commonB'].value };\r\n        if (!PresetNameStyleMap[resultNameStyle.preset ?? 'commonB'].value.font) {\r\n            resultNameStyle.font = contextualFont;\r\n        }\r\n\r\n        return {\r\n            ...contextualColor,\r\n            ...resultNameStyle,\r\n        };\r\n    }\r\n\r\n    let contextualOutline = isSpeedSkill\r\n        ? {\r\n            hasOutline: true,\r\n            lineWidth: 6,\r\n            strokeStyle: '#000',\r\n        }\r\n        : {};\r\n\r\n    const foilStyle = foil !== 'normal' ? PresetNameStyleMap[foil].value ?? {} : {};\r\n    const frameStyle = frame === 'zarc' ? PresetNameStyleMap.animeGold.value : {};\r\n\r\n    /** Auto name style has dynamic font, outline, color, fully affected by foil and frame */\r\n    return {\r\n        font: contextualFont,\r\n        ...contextualColor,\r\n        ...contextualOutline,\r\n        ...foilStyle,\r\n        ...frameStyle,\r\n    };\r\n};","const MAX_CONDENSER_THRESHOLD = 1000;\r\n/** Simple iteration method\r\n * 1 The initial threshold is 1000, initial step is 100, max step count is 30.\r\n * 1. If current threshold satisfy the driver, or step count is already 0, return the current threshold.\r\n * 1. Step down the threshold, and keep stepdown until driver return satisfy signal, reduce step count by 1 for each step made.\r\n * 1. Otherwise if step value is less than 1, finish with the current threshold.\r\n * 1. Otherwise step up the threshold by 1 step, and cut down the step value tenfold. Repeat from step 2.\r\n * \r\n * Example, we want to reach satisfy target at 487:\r\n *\r\n```\r\nCurr  Step    Count Explain\r\n1000  100     30    Initial\r\n900   100     29    Down\r\n800   100     28    Down\r\n700   100     27    Down\r\n600   100     26    Down\r\n500   100     25    Down\r\n400   100     24    Down\r\n500   10      24    Up => Step / 10\r\n490   10      23    Down\r\n480   10      22    Down\r\n490   1       21    Up => Step / 10\r\n489   1       20    Down\r\n488   1       19    Down\r\n487   1       18    Down => Satisfy\r\n * ```\r\n */\r\nexport const createCondenser = (minThreshold = 0, maxThreshold = MAX_CONDENSER_THRESHOLD) => {\r\n    let min = minThreshold;\r\n    let max = maxThreshold;\r\n    let median = max;\r\n    let lastEffective = median;\r\n    let iterateCount = 30;\r\n    let magnitude = 100;\r\n    let magnitudeReductionRatio = 10;\r\n\r\n    const reverseSearch = () => {\r\n        if (magnitude === 1) finish();\r\n        else {\r\n            median += magnitude;\r\n            magnitude /= magnitudeReductionRatio;\r\n            median -= magnitude;\r\n        }\r\n\r\n        return Math.min(median, max);\r\n    };\r\n\r\n    const searchDown = () => {\r\n        median -= magnitude;\r\n        iterateCount -= 1;\r\n\r\n        return median;\r\n    };\r\n\r\n    const reset = (minThreshold = min, maxThreshold = max) => {\r\n        min = minThreshold;\r\n        max = maxThreshold;\r\n        median = maxThreshold;\r\n        iterateCount = 30;\r\n        magnitude = 100;\r\n        lastEffective = maxThreshold;\r\n    };\r\n\r\n    const getMedian = () => median;\r\n    const setMedian = (newMedian: number) => median = newMedian;\r\n\r\n    const setLastEffective = (forceMedian = median) => lastEffective = forceMedian;\r\n    const getLastEffective = () => lastEffective;\r\n    const applyLastEffective = () => {\r\n        median = lastEffective;\r\n        iterateCount = -1;\r\n        return median;\r\n    };\r\n\r\n    const getIterateCount = () => iterateCount;\r\n    const finish = () => iterateCount = -1;\r\n\r\n    return {\r\n        reset,\r\n        searchDown,\r\n        reverseSearch,\r\n        finish,\r\n        getMedian,\r\n        setMedian,\r\n        setLastEffective,\r\n        getLastEffective,\r\n        applyLastEffective,\r\n        getIterateCount,\r\n    };\r\n};\r\n\r\nexport const condense = (\r\n    worker: (currentMedian: number) => boolean,\r\n    minThreshold = 100,\r\n) => {\r\n    let effectiveMedian = MAX_CONDENSER_THRESHOLD;\r\n    const condenser = createCondenser();\r\n    while (condenser.getIterateCount() >= 0) {\r\n        if (condenser.getIterateCount() <= 0) {\r\n            /** Support minThreshold here, we don't want to deal with 0. In practices, most text become unreadable when condense with ratio of 400 or lower. */\r\n            const finalMedian = condenser.getMedian();\r\n\r\n            effectiveMedian = finalMedian;\r\n            break;\r\n        } else {\r\n            const satisfy = worker(condenser.getMedian());\r\n\r\n            if (!satisfy && condenser.getMedian() > 0) {\r\n                /** If overflow, lower the median and apply it */\r\n                condenser.searchDown();\r\n            } else {\r\n                /** Return immediately if max threshold is enough to satisfy the driver */\r\n                if (condenser.getMedian() === MAX_CONDENSER_THRESHOLD) break;\r\n                else effectiveMedian = condenser.reverseSearch();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Ensure worker does not run with undesirable threshold (it may have side effect depend on the current ratio, for example, scale canvas). So we run worker with the final median one last time to make sure any side effects from it is affected by the ratio we gonna return.\r\n     */\r\n    const forcedMedian = Math.max(minThreshold, Math.min(effectiveMedian, MAX_CONDENSER_THRESHOLD));\r\n    if (forcedMedian !== effectiveMedian) worker(forcedMedian);\r\n    return forcedMedian;\r\n};","export type FontGetter = {\r\n    getFont: () => string,\r\n    getFontInfo: () => {\r\n        style: '' | 'italic' | 'small-caps',\r\n        size: `${number}px`,\r\n        sizeAsNumber: number,\r\n        family: string,\r\n        weight: '' | 'bold',\r\n    },\r\n    setWeight(nextWeight: '' | 'bold'): FontGetter,\r\n    setStyle(nextStyle: '' | 'italic' | 'small-caps'): FontGetter,\r\n    setSize(nextSize: number | `${number}px` | ((currentSize: number) => number | `${number}px`)): FontGetter,\r\n    setFamily(nextFamily: string): FontGetter,\r\n}\r\nexport const createFontGetter = (props?: {\r\n    defaultWeight?: '' | 'bold',\r\n    defaultStyle?: '' | 'italic' | 'small-caps',\r\n    defaultSize?: number | `${number}px`,\r\n    defaultFamily?: string,\r\n}): FontGetter => {\r\n    const {\r\n        defaultWeight = '',\r\n        defaultStyle = '',\r\n        defaultSize = '10px',\r\n        defaultFamily = 'Arial',\r\n    } = props ?? {};\r\n    let weight = defaultWeight;\r\n    let style = defaultStyle;\r\n    let size: `${number}px` = typeof defaultSize === 'number' ? `${defaultSize}px` : defaultSize;\r\n    let sizeAsNumber = typeof defaultSize === 'number' ? defaultSize : parseFloat(defaultSize.replaceAll('px', ''));\r\n    let family = defaultFamily;\r\n\r\n    return {\r\n        getFont: () => `${[style, weight, size, family].filter(part => part !== '').join(' ')}, Arial`,\r\n        getFontInfo: () => ({ style, size, family, sizeAsNumber, weight }),\r\n        setWeight(nextWeight) {\r\n            weight = nextWeight;\r\n            return this;\r\n        },\r\n        setStyle(nextStyle) {\r\n            style = nextStyle;\r\n            return this;\r\n        },\r\n        setSize(nextSize) {\r\n            const calculatedSize = typeof nextSize === 'function' ? nextSize(sizeAsNumber) : nextSize;\r\n            size = typeof calculatedSize === 'number' ? `${calculatedSize}px` : calculatedSize;\r\n            sizeAsNumber = typeof calculatedSize === 'number' ? calculatedSize : parseFloat(calculatedSize.replaceAll('px', ''));\r\n            return this;\r\n        },\r\n        setFamily(nextFamily) {\r\n            family = nextFamily;\r\n            return this;\r\n        },\r\n    };\r\n};","import { ColorPoint } from 'react-linear-gradient-picker';\r\nimport { getDefaultNameStyle } from 'src/model';\r\n\r\nexport const getDefaultGradientPalette = (): ColorPoint[] => parsePalette(getDefaultNameStyle().gradientColor);\r\n\r\nexport const stringifyPalette = (palette?: ColorPoint[]) => (palette ?? [])\r\n    .map(({ color, offset }) => `${offset}|${color}`).join(',');\r\nexport const parsePalette = (stringifiedPalette?: string): ColorPoint[] => stringifiedPalette\r\n    ? stringifiedPalette.split(',')\r\n        .map((entry, index) => {\r\n            const [offset, color] = entry.split('|');\r\n\r\n            return { color, offset, id: index + 1 };\r\n        })\r\n    : parsePalette(getDefaultNameStyle().gradientColor);","export const getNavigationProps = ({\r\n    debug,\r\n    optionLength,\r\n    stopPropagation = false,\r\n    setFocus,\r\n    onTrigger,\r\n    onCancel,\r\n    onKeyPress,\r\n}: {\r\n    debug?: string,\r\n    optionLength: number,\r\n    stopPropagation?: boolean,\r\n    setFocus: (value: React.SetStateAction<number>) => void,\r\n    onTrigger: () => void,\r\n    onCancel?: () => void,\r\n    onKeyPress?: (ev: React.KeyboardEvent<any>) => (void | boolean),\r\n}) => {\r\n    return {\r\n        tabIndex: 0,\r\n        onFocus: () => {\r\n            if (debug) console.info('Navigation Focus', debug);\r\n            setFocus(0);\r\n        },\r\n        onBlur: () => {\r\n            if (debug) console.info('Navigation Blur', debug);\r\n            setFocus(-1);\r\n        },\r\n        onKeyDown: (e: React.KeyboardEvent<any>) => {\r\n            if (stopPropagation) e.stopPropagation();\r\n            if (debug) console.info('Navigation Keydown', debug, e.key);\r\n            if (onKeyPress?.(e) === false) return;\r\n            if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {\r\n                e.preventDefault();\r\n                setFocus(cur => Math.max(0, optionLength + cur + 1) % optionLength);\r\n            }\r\n            else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {\r\n                e.preventDefault();\r\n                setFocus(cur => Math.max(0, optionLength + cur - 1) % optionLength);\r\n            }\r\n            else if (e.key === 'Enter' || e.key === ' ') {\r\n                onTrigger();\r\n            }\r\n            else if (e.key === 'Escape') {\r\n                onCancel?.();\r\n            }\r\n        },\r\n    };\r\n};","// @ts-nocheck\r\n/* eslint-disable */\r\n// JSONCrush by Frank Force [MIT] https://github.com/KilledByAPixel/JSONCrush\r\n\"use strict\"\r\nexport const JSONCrush=(e,n=50)=>{for(var r=[],o=127;--o;)(48<=o&&57>=o||65<=o&&90>=o||97<=o&&122>=o||\"-_.!~*'()\".includes(String.fromCharCode(o)))&&r.push(String.fromCharCode(o));for(o=32;255>o;++o){var t=String.fromCharCode(o);\"\\\\\"==t||r.includes(t)||r.unshift(t)}e=e.replace(/\\u0001/g,\"\"),e=JSONCrushSwap(e),o=r.length,t=\"\";for(var i={},l=2;l<n;l++)for(var f=0;f<e.length-l;++f){var h=e.substr(f,l);if(!i[h]){var a=h.charCodeAt(0),g=h.charCodeAt(h.length-1);if(!(a=56320<=a&&57343>=a||55296<=g&&56319>=g)){for(a=1,g=e.indexOf(h,f+l);0<=g;++a)g=e.indexOf(h,g+l);1<a&&(i[h]=a)}}}for(;;){for(;o--&&e.includes(r[o]););if(0>o)break;n=r[o];var d=void 0;l=0,f=encodeURI(encodeURIComponent(n)).replace(/%../g,\"i\").length;for(let e in i)h=((h=i[e])-1)*encodeURI(encodeURIComponent(e)).replace(/%../g,\"i\").length-(h+1)*f,t.length||(h-=encodeURI(encodeURIComponent(\"\u0001\")).replace(/%../g,\"i\").length),0>=h?delete i[e]:h>l&&(d=e,l=h);if(!d)break;e=e.split(d).join(n)+n+d,t=n+t,l={};for(let r in i){for(i=r.split(d).join(n),f=0,h=e.indexOf(i);0<=h;++f)h=e.indexOf(i,h+i.length);1<f&&(l[i]=f)}i=l}return d=e,(r=t).length&&(d+=\"\u0001\"+r),encodeURIComponent(d+\"_\")},JSONUncrush=e=>{var n=(e=e.substring(0,e.length-1)).split(\"\u0001\");if(e=n[0],1<n.length){n=n[1];for(let r of n)e=(e=e.split(r)).join(e.pop())}return JSONCrushSwap(e,0)},JSONCrushSwap=(e,n=1)=>{const r=[['\"',\"'\"],[\"':\",\"!\"],[\",'\",\"~\"],[\"}\",\")\",\"\\\\\",\"\\\\\"],[\"{\",\"(\",\"\\\\\",\"\\\\\"]],o=(e,n)=>e.replace(new RegExp(`${(n[2]?n[2]:\"\")+n[0]}|${(n[3]?n[3]:\"\")+n[1]}`,\"g\"),e=>e===n[0]?n[1]:n[0]);if(n)for(n=0;n<r.length;++n)e=o(e,r[n]);else for(n=r.length;n--;)e=o(e,r[n]);return e}","import { clone } from 'ramda';\r\nimport { JSONUncrush } from '../3rd';\r\nimport { Card, getDefaultCardOpacity, getEmptyCard } from '../model';\r\nimport { notification } from 'antd';\r\n\r\nconst currentCardFieldShortenMap: Record<keyof Card, string | Record<string, string>> = {\r\n    version: 've',\r\n    format: 'fm',\r\n    frame: 'fr',\r\n    foil: 'fo',\r\n    opacity: {\r\n        _newKey: 'op',\r\n        body: 'opbd',\r\n        pendulum: 'oppd',\r\n        name: 'opnm',\r\n        text: 'optx',\r\n        boundless: 'opbl',\r\n        /** legacy */\r\n        artFrame: 'opaf',\r\n        artBorder: 'opab',\r\n        nameBorder: 'opnb',\r\n        baseFill: 'opbf',\r\n    },\r\n    finish: 'fn',\r\n    art: 'ar',\r\n    artFinish: 'afn',\r\n    artCrop: {\r\n        _newKey: 'arc',\r\n        x: 'arx',\r\n        y: 'ary',\r\n        width: 'arw',\r\n        height: 'arh',\r\n        unit: 'aru',\r\n        aspect: 'ara',\r\n    },\r\n    hasBackground: 'hbg',\r\n    background: 'bg',\r\n    backgroundType: 'bgt',\r\n    backgroundCrop: {\r\n        _newKey: 'bgc',\r\n        x: 'bgx',\r\n        y: 'bgy',\r\n        width: 'bgw',\r\n        height: 'bgh',\r\n        unit: 'bgu',\r\n        aspect: 'bga',\r\n    },\r\n    name: 'na',\r\n    nameStyleType: 'nst',\r\n    effectStyle: {\r\n        _newKey: 'es',\r\n        condenseTolerant: 'cdtl',\r\n    },\r\n    nameStyle: {\r\n        _newKey: 'ns',\r\n        font: 'nsft',\r\n        fillStyle: 'nsfs',\r\n        headTextFillStyle: 'nshfs',\r\n        shadowColor: 'nssc',\r\n        shadowOffsetY: 'nssoy',\r\n        shadowOffsetX: 'nssox',\r\n        shadowBlur: 'nssb',\r\n        hasShadow: 'nshs',\r\n        lineColor: 'nslc',\r\n        lineWidth: 'nslw',\r\n        lineOffsetY: 'nsloy',\r\n        lineOffsetX: 'nslox',\r\n        hasOutline: 'nshl',\r\n        gradientAngle: 'nsgd',\r\n        gradientColor: 'nscg',\r\n        hasGradient: 'nshg',\r\n        preset: 'nspr',\r\n        pattern: 'nspt',\r\n    },\r\n    attribute: 'at',\r\n    subFamily: 'sf',\r\n    star: 'st',\r\n    cardIcon: 'it',\r\n    linkMap: 'lm',\r\n    isPendulum: 'ip',\r\n    pendulumFrame: 'pf',\r\n    pendulumEffect: 'pe',\r\n    pendulumScaleRed: 'rs',\r\n    pendulumScaleBlue: 'bs',\r\n    typeAbility: 'ta',\r\n    effect: 'ef',\r\n    setId: 'si',\r\n    atk: 'atk',\r\n    def: 'def',\r\n    password: 'pw',\r\n    sticker: 'sti',\r\n    isFirstEdition: 'ife',\r\n    isSpeedCard: 'isp',\r\n    isDuelTerminalCard: 'idt',\r\n    creator: 'cr',\r\n    furiganaHelper: 'fh',\r\n};\r\nconst legacyCardFieldShortenMap = {\r\n    passcode: 'pc',\r\n    picture: 'pt',\r\n    pictureCrop: {\r\n        _newKey: 'ptc',\r\n        x: 'ptx',\r\n        y: 'pty',\r\n        width: 'ptw',\r\n        height: 'pth',\r\n        unit: 'ptu',\r\n        aspect: 'pta',\r\n    },\r\n};\r\nconst cardFieldShortenMap = {\r\n    ...currentCardFieldShortenMap,\r\n    ...legacyCardFieldShortenMap,\r\n};\r\n\r\nexport const decodeCardWithCompatibility = (cardData: Record<string, any> | string | null): Card => {\r\n    let decodedCard = getEmptyCard();\r\n    if (!cardData) return decodedCard;\r\n    try {\r\n        decodedCard = rebuildCardData(cardData) as Card;\r\n    } catch (e) {\r\n        console.error('decodedCard', cardData, e);\r\n        try {\r\n            decodedCard = legacyRebuildCardData(cardData, true) as Card;\r\n            notification.info({\r\n                message: 'Card data has outdated format',\r\n                description: 'System will automatically convert it into newer version.',\r\n            });\r\n        } catch (e) {\r\n            console.error('cardData', cardData, e);\r\n            notification.error({\r\n                message: 'Card data cannot be decoded',\r\n                description: 'It is either malformed or not compatible.',\r\n            });\r\n        }\r\n    }\r\n    return decodedCard;\r\n};\r\n\r\nexport const compressCardData = (\r\n    card: Record<string, any>,\r\n    shortenMap: Record<string, any> = cardFieldShortenMap,\r\n    serialize = true,\r\n) => {\r\n    const condensedCard: Record<string, any> = {};\r\n    Object.keys(card).forEach(fieldKey => {\r\n        const fieldValue = card[fieldKey];\r\n\r\n        if (typeof fieldValue === 'object' && fieldValue !== null && !Array.isArray(fieldValue)) {\r\n            const newKey = shortenMap[fieldKey]?._newKey;\r\n\r\n            if (newKey) {\r\n                condensedCard[newKey] = compressCardData(fieldValue, shortenMap[fieldKey], false);\r\n            }\r\n        } else {\r\n            const newFieldKey = shortenMap[fieldKey];\r\n\r\n            if (typeof newFieldKey === 'string') condensedCard[newFieldKey] = fieldValue;\r\n        }\r\n    });\r\n\r\n    if (serialize) return JSON.stringify(condensedCard);\r\n    return condensedCard;\r\n};\r\n\r\nexport const decompressCardData = (\r\n    condensedCard: Record<string, any>,\r\n    shortenMap: Record<string, any> = cardFieldShortenMap,\r\n) => {\r\n    const fullCard: Record<string, any> = {};\r\n    Object.keys(shortenMap).forEach(fullKey => {\r\n        const shortenKey = shortenMap[fullKey];\r\n\r\n        if (typeof shortenKey === 'object' && shortenKey !== null && !Array.isArray(shortenKey)) {\r\n            const shortendKey = shortenKey?._newKey;\r\n\r\n            if (shortendKey && condensedCard[shortendKey]) {\r\n                fullCard[fullKey] = decompressCardData(condensedCard[shortendKey], shortenMap[fullKey]);\r\n            }\r\n        } else {\r\n            if (condensedCard[shortenKey] != null) {\r\n                fullCard[fullKey] = condensedCard[shortenKey];\r\n            }\r\n        }\r\n    });\r\n    return fullCard;\r\n};\r\nexport const legacyReverseCardDataShortener = (\r\n    condensedCard: Record<string, any> | string,\r\n    shortenMap: Record<string, any> = cardFieldShortenMap,\r\n) => {\r\n    const normalizedCondensedCard = typeof condensedCard === 'string'\r\n        ? JSON.parse(JSONUncrush(decodeURIComponent(condensedCard)))\r\n        : condensedCard;\r\n\r\n    const fullCard: Record<string, any> = {};\r\n    Object.keys(shortenMap).forEach(fullKey => {\r\n        const shortenKey = shortenMap[fullKey];\r\n\r\n        if (typeof shortenKey === 'object' && shortenKey !== null && !Array.isArray(shortenKey)) {\r\n            const shortendKey = shortenKey?._newKey;\r\n\r\n            if (shortendKey && normalizedCondensedCard[shortendKey]) {\r\n                fullCard[fullKey] = legacyReverseCardDataShortener(normalizedCondensedCard[shortendKey], shortenMap[fullKey]);\r\n            }\r\n        } else {\r\n            if (normalizedCondensedCard[shortenKey] != null) {\r\n                fullCard[fullKey] = normalizedCondensedCard[shortenKey];\r\n            }\r\n        }\r\n    });\r\n    return fullCard;\r\n};\r\n\r\nexport const rebuildCardData = (\r\n    card: Record<string, any> | string,\r\n) => {\r\n    const normalizedCard = typeof card === 'string'\r\n        ? JSON.parse(card)\r\n        : card;\r\n    const fullCard: Record<string, any> = decompressCardData(normalizedCard);\r\n\r\n    return migrateCardData(fullCard);\r\n};\r\nexport const legacyRebuildCardData = (\r\n    card: Record<string, any> | string,\r\n    isCondensed = false,\r\n) => {\r\n    let fullCard: Record<string, any>;\r\n    if (isCondensed) {\r\n        fullCard = legacyReverseCardDataShortener(card);\r\n    } else {\r\n        fullCard = typeof card === 'string'\r\n            ? JSON.parse(card)\r\n            : card;\r\n    }\r\n\r\n    return migrateCardData(fullCard);\r\n};\r\n\r\n/** Migrate old version of card data into the new version without information loss */\r\nexport const migrateCardData = (card: Record<string, any>) => {\r\n    const migratedCard = {\r\n        ...getEmptyCard(),\r\n        ...clone(card)\r\n    };\r\n\r\n    if (migratedCard.effectStyle == null) {\r\n        migratedCard.effectStyle = {\r\n            ...getEmptyCard().effectStyle\r\n        };\r\n    }\r\n\r\n    if (migratedCard.version == null) migratedCard.version = 1;\r\n    if (migratedCard.format == null) migratedCard.format = 'tcg';\r\n    if (migratedCard.pendulumFrame == null) migratedCard.pendulumFrame = 'auto';\r\n    if (migratedCard.finish == null) migratedCard.finish = [];\r\n\r\n    if (migratedCard.artFinish == null) migratedCard.artFinish = 'normal';\r\n    if ((migratedCard as any).picture && !card.art) migratedCard.art = (migratedCard as any).picture;\r\n    delete (migratedCard as any).picture;\r\n\r\n    if ((migratedCard as any).pictureCrop && !card.artCrop) migratedCard.artCrop = (migratedCard as any).pictureCrop;\r\n    delete (migratedCard as any).pictureCrop;\r\n\r\n    /** Seems like no image is fine for now. */\r\n    // if ((migratedCard.art ?? '') === '') migratedCard.art = 'https://i.imgur.com/jjtCuG5.png';\r\n    if ((migratedCard.art ?? '') === '') migratedCard.art = '';\r\n\r\n    if (typeof (migratedCard.opacity as any).artFrame === 'boolean' && migratedCard.opacity.boundless == null) {\r\n        migratedCard.opacity.boundless = !(migratedCard.opacity as any).artFrame;\r\n        delete (migratedCard.opacity as any).artFrame;\r\n    }\r\n    migratedCard.opacity = { ...getDefaultCardOpacity(), ...migratedCard.opacity };\r\n\r\n    if ((migratedCard.background ?? '') === '') migratedCard.background = '';\r\n    if (migratedCard.hasBackground == null && (migratedCard.background || migratedCard.opacity.baseFill)) migratedCard.hasBackground = true;\r\n\r\n    if ((migratedCard as any).kanjiHelper && !card.furiganaHelper) migratedCard.furiganaHelper = (migratedCard as any).kanjiHelper;\r\n    delete (migratedCard as any).kanjiHelper;\r\n    if (migratedCard.furiganaHelper === undefined) migratedCard.furiganaHelper = true;\r\n\r\n    if ((migratedCard as any).passcode && !card.password) migratedCard.password = (migratedCard as any).passcode;\r\n    delete (migratedCard as any).passcode;\r\n\r\n    return migratedCard;\r\n};","export const randomCharacter = (charSet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', length = 1) => {\r\n    let result = '';\r\n    const charactersLength = charSet.length;\r\n    for (let i = 0; i < length; i++) {\r\n        result += charSet.charAt(Math.floor(Math.random() * charactersLength));\r\n    }\r\n    return result;\r\n};\r\n\r\nexport const randomSetID = (format: string) => {\r\n    return randomCharacter('ABCDEFGHIJKLMNOPQRSTUVWXYZ', 4)\r\n        + '-'\r\n        + (format === 'OCG' ? 'JP' : 'EN')\r\n        /** Most set does not reach 200+ index, so 0, 1 and 2 has significantly higher chance to roll */\r\n        + randomCharacter('0000000000111111111122222222223456789', 1)\r\n        + randomCharacter('0123456789', 2);\r\n};\r\n\r\nexport const randomPassword = () => {\r\n    return `${randomCharacter('0123456789', 8)}`;\r\n};\r\n\r\nexport const nextChar = (c: string) => {\r\n    return String.fromCharCode(c.charCodeAt(0) + 1);\r\n};\r\n\r\nexport function insertUrlParam(key: string, value: string) {\r\n    if (window.history.pushState) {\r\n        let searchParams = new URLSearchParams(window.location.search);\r\n        searchParams.set(key, value);\r\n        let newurl = window.location.protocol + '//' + window.location.host + window.location.pathname + '?' + searchParams.toString();\r\n        window.history.pushState({ path: newurl }, '', newurl);\r\n    }\r\n};\r\n\r\nexport const normalizedCardName = (name: string) => {\r\n    return name.replaceAll(/\\{([^{}|]*)\\|+?[^{}|]*\\}/g, '$1');\r\n};\r\n\r\n/** Seriously, what the hell? */\r\nexport const isMobileDevice = () => {\r\n    let check = false;\r\n    (function(a){if(/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(a.substr(0,4))) check = true;})(\r\n        navigator.userAgent\r\n        || navigator.vendor\r\n        || (window as any).opera);\r\n    return check;\r\n};\r\n\r\nexport function mergeClass(...args: (boolean | string | undefined | null)[]) {\r\n    return args.filter(Boolean).join(' ');\r\n}\r\n\r\nexport * from './categorize';\r\nexport * from './condenser';\r\nexport * from './font';\r\nexport * from './gradient';\r\nexport * from './hook';\r\nexport * from './navigation';\r\nexport * from './codec';","import { Spin } from 'antd';\r\nimport styled from 'styled-components';\r\n\r\nconst StyledLoadingFullViewContainer = styled.div`\r\n    display: flex;\r\n\tposition: absolute;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\tbackground-image: linear-gradient(#fafafaaa, #fafafaaa);\r\n    justify-content: center;\r\n    align-items: center;\r\n    z-index: 999;\r\n`;\r\n\r\nexport const Loading = () => {\r\n    return <Spin />;\r\n};\r\nLoading.FullView = () => {\r\n    return <StyledLoadingFullViewContainer className=\"loading-fullview\">\r\n        <Spin size=\"large\" />\r\n    </StyledLoadingFullViewContainer>;\r\n};","import { Tooltip } from 'antd';\r\nimport { SyncOutlined } from '@ant-design/icons';\r\nimport { ExtractProps } from 'src/type';\r\nimport styled from 'styled-components';\r\n\r\nconst StyledIconButtonContainer = styled.span`\r\n    display: inline-flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    margin-left: var(--spacing-xs);\r\n    width: 24px;\r\n    height: 24px;\r\n    border: var(--bw) solid var(--sub-level-1);\r\n    background-color: var(--main-level-4);\r\n    border-radius: var(--br-lg);\r\n    box-shadow: var(--bs-button);\r\n\tcursor: pointer;\r\n\t&:hover {\r\n\t\tbackground-color: var(--sub-level-4);\r\n\t}\r\n`;\r\n\r\nexport type IconButton = {\r\n    Icon: typeof SyncOutlined,\r\n    onClick: () => void,\r\n    iconProps?: ExtractProps<typeof SyncOutlined>,\r\n    tooltipProps: ExtractProps<typeof Tooltip>,\r\n    containerProps?: React.HTMLAttributes<HTMLSpanElement>,\r\n}\r\nexport const IconButton = ({\r\n    Icon,\r\n    onClick,\r\n    iconProps,\r\n    tooltipProps,\r\n    containerProps,\r\n}: IconButton) => {\r\n    const { className, onClick: customOnClick, onKeyDown, ...restContainerProps } = containerProps ?? {};\r\n\r\n    return <Tooltip {...tooltipProps}>\r\n        <StyledIconButtonContainer\r\n            tabIndex={0}\r\n            {...restContainerProps}\r\n            onClick={e => {\r\n                onClick();\r\n                customOnClick?.(e);\r\n            }}\r\n            onKeyDown={e => {\r\n                onKeyDown?.(e);\r\n                if (e.key === 'Enter') {\r\n                    onClick();\r\n                }\r\n            }}\r\n            className={['icon-button', className ?? ''].join(' ')}\r\n        >\r\n            <Icon {...iconProps} />\r\n        </StyledIconButtonContainer>\r\n    </Tooltip>;\r\n};","import { Input, Radio, Tooltip } from 'antd';\r\nimport React, { useState, useCallback, useRef, useEffect, useImperativeHandle } from 'react';\r\nimport ReactCrop from 'react-image-crop';\r\nimport { DownloadOutlined, ExclamationCircleOutlined } from '@ant-design/icons';\r\nimport { Loading } from '../loading';\r\nimport { IconButton } from '../icon-button';\r\nimport 'react-image-crop/dist/ReactCrop.css';\r\nimport './image-cropper.scss';\r\n\r\nfunction generateDownload(canvas: HTMLCanvasElement | null, crop: ReactCrop.Crop | null) {\r\n    if (!crop || !canvas) return;\r\n    canvas.toBlob(\r\n        (blob) => {\r\n            if (blob !== null) {\r\n                const previewUrl = window.URL.createObjectURL(blob);\r\n\r\n                const anchor = document.createElement('a');\r\n                anchor.download = 'crop-preview.png';\r\n                anchor.href = URL.createObjectURL(blob);\r\n                anchor.click();\r\n\r\n                window.URL.revokeObjectURL(previewUrl);\r\n            }\r\n        },\r\n        'image/png',\r\n        1\r\n    );\r\n}\r\n\r\n/**\r\n * Historic reason: cropData initially used `px` as unit, but this create a hard link between cropData and size of the cropper (NOT the actual image). This means the cropData only match a specific cropper size, and will become incorrect if the size change (which is happening when we got to v2).\r\n * \r\n * So from now on every cropData with `px` unit in it (old data) will be converted into the new one that use `%` data, which is more tricky to calculate but remove the link entirely.\r\n */\r\nconst normalizeCrop = (crop: Partial<ReactCrop.Crop>, image: HTMLImageElement | null, ratio: number) => {\r\n    if (!image) return crop;\r\n    const { width: cropWidth, height: cropHeight, x = 0, y = 0, unit } = crop;\r\n\r\n    /** Migrate old unit */\r\n    if (unit === 'px') {\r\n        const oldHeightToWidthRatio = 300 / 375;\r\n        const newHeightToWidthRatio = 400 / 300;\r\n        const { width: imageWidth, height: imageHeight } = image;\r\n\r\n        const isHeightRestricted = (imageHeight / imageWidth) >= oldHeightToWidthRatio;\r\n        const scaleRatio = isHeightRestricted ? newHeightToWidthRatio : 1;\r\n        const nextX = Math.min((x ?? 0) * scaleRatio, imageWidth);\r\n        const nextY = Math.min((y ?? 0) * scaleRatio, imageHeight);\r\n        const newWidth = Math.min((cropWidth ?? 0) * scaleRatio, imageWidth);\r\n\r\n        return {\r\n            unit: '%' as 'px' | '%',\r\n            x: nextX / imageWidth * 100,\r\n            y: nextY / imageHeight * 100,\r\n            width: newWidth / imageWidth * 100,\r\n            height: newWidth / (ratio ?? 1) / imageHeight * 100,\r\n            aspect: ratio,\r\n        };\r\n    }\r\n\r\n    if (x < 0) return { ...crop, x: 0 };\r\n    if (y < 0) return { ...crop, y: 0 };\r\n    const { naturalHeight, naturalWidth } = image;\r\n    const width = cropWidth ?? 0;\r\n    const height = cropHeight ?? 0;\r\n    /** Avoid recalculate if current ratio is in acceptable limit, so we don't cascade calculation error */\r\n    const acceptableError = (naturalHeight > naturalWidth ? naturalHeight : naturalWidth) * 0.05;\r\n    const isRatioAcceptable = Math.abs(height * naturalHeight * ratio - width * naturalWidth) <= acceptableError;\r\n\r\n    return {\r\n        ...crop,\r\n        x: x < 0 ? 0 : x,\r\n        y: y < 0 ? 0 : y,\r\n        height: isRatioAcceptable\r\n            ? height\r\n            : width * image.naturalWidth /** Restore original size */\r\n                / ratio /** Get height with corresponding aspect ratio */\r\n                / image.naturalHeight /** Convert back to percent */,\r\n        aspect: ratio,\r\n    };\r\n};\r\n\r\nexport type ImageCropperRef = {\r\n    setRatio: (ratio: number) => void,\r\n    forceExternalSource: (artLink: string, cropInfo: Partial<ReactCrop.Crop>) => void,\r\n}\r\nexport type ImageCropper = {\r\n    title?: React.ReactNode,\r\n    backgroundColor?: string,\r\n    className?: string,\r\n    defaultExternalSource?: string,\r\n    receivingCanvas?: HTMLCanvasElement | null,\r\n    children?: React.ReactNode,\r\n    beforeCropper?: React.ReactNode,\r\n    defaultCropInfo: Partial<ReactCrop.Crop>,\r\n    ratio: number,\r\n    onSourceChange?: (source: string) => void,\r\n    onSourceLoaded?: () => void,\r\n    onCropChange?: (cropInfo: Partial<ReactCrop.Crop>, sourceType: 'internal' | 'external') => void,\r\n    onTainted: () => void,\r\n}\r\nexport const ImageCropper = React.forwardRef<ImageCropperRef, ImageCropper>(({\r\n    title = 'Card Art',\r\n    backgroundColor,\r\n    className,\r\n    defaultExternalSource = '',\r\n    receivingCanvas,\r\n    children,\r\n    beforeCropper,\r\n    defaultCropInfo,\r\n    ratio,\r\n    onSourceLoaded = () => { },\r\n    onSourceChange = () => { },\r\n    onCropChange = () => { },\r\n    onTainted = () => { },\r\n}: ImageCropper, forwardedRef) => {\r\n    const [\r\n        crossorigin,\r\n        // setCrossOrigin,\r\n    ] = useState<'anonymous' | 'use-credentials' | undefined>('anonymous');\r\n    const [redrawSignal, setRedrawSignal] = useState(0);\r\n    // const [ratio, setRatio] = useState(defaultRatio);\r\n    const [sourceType, setSourceType] = useState<'internal' | 'external'>('external');\r\n    const [inputMode, setInputMode] = useState<'internal' | 'external'>('external');\r\n    const [internalSource, setInternalSource] = useState('');\r\n    const [isLoading, setLoading] = useState(false);\r\n    const [error, setError] = useState<any>(null);\r\n    const [externalSource, setExternalSource] = useState(defaultExternalSource);\r\n    const imgRef = useRef<HTMLImageElement | null>(null);\r\n    const [crop, setCrop] = useState({\r\n        current: defaultCropInfo,\r\n        completed: null as ReactCrop.Crop | null,\r\n    });\r\n    // const [completedCrop, setCompletedCrop] = useState<ReactCrop.Crop | null>(null);\r\n    const [isMigrated, setMigrated] = useState(defaultCropInfo.unit === '%');\r\n    const {\r\n        current: currentCrop,\r\n        completed: completedCrop,\r\n    } = crop;\r\n\r\n    const applyOfflineSource = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        if (e.target.files && e.target.files.length > 0) {\r\n            setLoading(true);\r\n            const reader = new FileReader();\r\n            reader.addEventListener('load', () => {\r\n                if (typeof reader.result === 'string') {\r\n                    setInternalSource(reader.result);\r\n                    setSourceType('internal');\r\n                    setInputMode('internal');\r\n                }\r\n            });\r\n            reader.readAsDataURL(e.target.files[0]);\r\n        } else alert('No file uploaded');\r\n    };\r\n\r\n    const pendingCrop = useRef({\r\n        source: '',\r\n        crop: null as Partial<ReactCrop.Crop> | null,\r\n    });\r\n    const onLoad = useCallback((img: HTMLImageElement) => {\r\n        setLoading(false);\r\n        setError(null);\r\n        onSourceLoaded();\r\n        imgRef.current = img;\r\n        /** @todo Check if we really need timeout delay here */\r\n        if (img.src === pendingCrop.current.source && pendingCrop.current.crop) {\r\n            const internalId = pendingId.current;\r\n            setTimeout(() => {\r\n                if (internalId !== pendingId.current || !pendingCrop.current.crop) return;\r\n                const normalizedCrop = normalizeCrop(pendingCrop.current.crop, img, ratio);\r\n                setCrop({\r\n                    completed: normalizedCrop,\r\n                    current: normalizedCrop,\r\n                });\r\n                setMigrated(true);\r\n                pendingCrop.current = {\r\n                    source: '',\r\n                    crop: null,\r\n                };\r\n            }, 250);\r\n        } else {\r\n            setTimeout(() => {\r\n                setCrop(cur => {\r\n                    const normalizedCrop = normalizeCrop(cur.current, img, ratio);\r\n\r\n                    return {\r\n                        completed: normalizedCrop,\r\n                        current: normalizedCrop,\r\n                    };\r\n                });\r\n                setMigrated(true);\r\n            }, 250);\r\n        }\r\n    }, [onSourceLoaded, ratio]);\r\n\r\n    const applyOnlineSource = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const source = e.target.value;\r\n\r\n        setLoading(true);\r\n        setSourceType('external');\r\n        setInputMode('external');\r\n        onSourceChange(source);\r\n        setExternalSource(source);\r\n    };\r\n\r\n    useEffect(() => {\r\n        const image = imgRef.current;\r\n        if (!completedCrop || !receivingCanvas || !image) return;\r\n\r\n        const { aspect: ratio } = completedCrop;\r\n\r\n        /** Increase image size for a bit */\r\n        receivingCanvas.style.transform = 'scale(2)';\r\n        const ctx = receivingCanvas.getContext('2d');\r\n        if (!ctx || typeof ratio !== 'number' || ratio <= 0) return;\r\n\r\n        const { naturalHeight, naturalWidth } = image;\r\n        const zoomX = naturalWidth / image.width;\r\n        const zoomY = naturalHeight / image.height;\r\n        const cropUnit = completedCrop.unit ?? 'px';\r\n        const pixelRatio = window.devicePixelRatio;\r\n\r\n        ctx.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\r\n        /** Snap sizing into whole pixel for a more crispy image. */\r\n        let expectedDrawWidth = Math.floor((completedCrop.width ?? 0) * (cropUnit === 'px' ? zoomX : naturalWidth / 100));\r\n        let drawWidth = Math.min(naturalWidth, expectedDrawWidth);\r\n        let expectedDrawHeight = Math.floor(expectedDrawWidth / ratio);\r\n        let drawHeight = Math.min(naturalHeight, expectedDrawHeight);\r\n        let drawCoordinateX = Math.min(\r\n            naturalWidth,\r\n            Math.floor((completedCrop.x ?? 0) * (cropUnit === 'px' ? zoomX : naturalWidth / 100))\r\n        );\r\n        let drawCoordinateY = Math.min(\r\n            naturalHeight,\r\n            Math.floor((completedCrop.y ?? 0) * (cropUnit === 'px' ? zoomY : naturalHeight / 100))\r\n        );\r\n        ctx.imageSmoothingQuality = 'high';\r\n        if (drawWidth <= 0 || drawHeight <= 0) return;\r\n\r\n        let fitCropData: Partial<ReactCrop.Crop> | undefined = undefined;\r\n        /** If the crop section is overflowed (mainly because change of ratio), we try to snap it back to the cropper. */\r\n        if (\r\n            // Size overflow\r\n            (drawCoordinateX + drawWidth) > naturalWidth\r\n            || (drawCoordinateY + drawHeight) > naturalHeight\r\n            // Edge overflow\r\n            || drawCoordinateX < 0\r\n            || drawCoordinateY < 0\r\n            // Ratio overflow\r\n            || Math.abs((expectedDrawWidth - drawWidth) / drawWidth) > 0.01\r\n            || Math.abs((expectedDrawHeight - drawHeight) / drawHeight) > 0.01\r\n        ) {\r\n            /** Try to maximize new crop section's area */\r\n            const prominentSide = ratio * naturalHeight > naturalWidth ? 'width' : 'height';\r\n            /** Automatically center current crop section. @todo For the best UX, it should actually be proportional based on the x and y before the snap. */\r\n            if (prominentSide === 'width') {\r\n                drawWidth = naturalWidth;\r\n                drawHeight = drawWidth / ratio;\r\n                drawCoordinateX = 0;\r\n                drawCoordinateY = (naturalHeight - drawHeight) / 2;\r\n                fitCropData = {\r\n                    unit: '%',\r\n                    aspect: ratio,\r\n                    height: drawHeight / naturalHeight * 100,\r\n                    width: drawWidth / naturalWidth * 100,\r\n                    x: 0,\r\n                    y: drawCoordinateY / naturalHeight * 100,\r\n                };\r\n            } else {\r\n                drawWidth = naturalHeight * ratio;\r\n                drawHeight = naturalHeight;\r\n                drawCoordinateX = (naturalWidth - drawWidth) / 2;\r\n                drawCoordinateY = 0;\r\n                fitCropData = {\r\n                    unit: '%',\r\n                    aspect: ratio,\r\n                    height: drawHeight / naturalHeight * 100,\r\n                    width: drawWidth / naturalWidth * 100,\r\n                    x: drawCoordinateX / naturalWidth * 100,\r\n                    y: 0,\r\n                };\r\n            }\r\n        }\r\n        // const boundingWidth = Math.ceil(receivingCanvas.getBoundingClientRect().width);\r\n        // const boundingHeight = Math.ceil(receivingCanvas.getBoundingClientRect().height);\r\n\r\n        receivingCanvas.width = (drawWidth ?? 0);\r\n        receivingCanvas.height = (drawHeight ?? 0);\r\n\r\n        ctx.drawImage(\r\n            image,\r\n            drawCoordinateX,\r\n            drawCoordinateY,\r\n            drawWidth,\r\n            drawHeight,\r\n            0,\r\n            0,\r\n            drawWidth,\r\n            drawHeight,\r\n        );\r\n        if (sourceType === 'internal' && (internalSource ?? '').length <= 0) { }\r\n        else if (ratio === completedCrop.aspect) {\r\n            onCropChange(completedCrop, sourceType);\r\n        }\r\n        if (fitCropData) {\r\n            setCrop(cur => ({ ...cur, current: fitCropData }));\r\n        }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [completedCrop, receivingCanvas, redrawSignal]);\r\n\r\n    useEffect(() => {\r\n        setCrop(cur => {\r\n            if (imgRef.current != null && cur.current) {\r\n                const newValue = normalizeCrop(cur.current, imgRef.current, ratio);\r\n                return {\r\n                    current: newValue,\r\n                    completed: newValue,\r\n                };\r\n            }\r\n            return cur;\r\n        });\r\n    }, [ratio]);\r\n\r\n    const pendingId = useRef(0);\r\n    useImperativeHandle(forwardedRef, () => ({\r\n        setRatio: ratio => {\r\n            // setRatio(ratio);\r\n            // setRedrawSignal(cur => cur + 1);\r\n        },\r\n        forceExternalSource: (source, cropInfo) => {\r\n            const currentSource = sourceType === 'internal' ? internalSource : externalSource;\r\n            if (currentSource !== source) {\r\n                setLoading(true);\r\n                setSourceType('external');\r\n                setInputMode('external');\r\n                onSourceChange(source);\r\n                setExternalSource(source);\r\n            }\r\n            setMigrated(cropInfo.unit === '%');\r\n            pendingId.current += 1;\r\n            pendingCrop.current = {\r\n                source,\r\n                crop: cropInfo,\r\n            };\r\n            setRedrawSignal(cur => cur + 1);\r\n        }\r\n    }));\r\n\r\n    const isDownloadable = receivingCanvas && !isLoading && completedCrop?.width && completedCrop?.height;\r\n    return (\r\n        <div className={`card-image-cropper ${className}`}>\r\n            <div className=\"card-image-source-input\">\r\n                {children}\r\n                <div className=\"card-image-source-input-container\">\r\n                    <div className=\"card-image-source-input-title\">\r\n                        <span className=\"field-title\">\r\n                            {title} <IconButton\r\n                                Icon={DownloadOutlined}\r\n                                containerProps={{ className: isDownloadable ? '' : 'disabled' }}\r\n                                tooltipProps={{ overlay: isDownloadable ? 'Download cropped image' : 'Image is not loaded yet' }}\r\n                                onClick={() => (isDownloadable && receivingCanvas)\r\n                                        && generateDownload(receivingCanvas, completedCrop)}\r\n                            />\r\n                        </span>\r\n                        <Radio.Group\r\n                            className=\"card-image-source-type-input\"\r\n                            onChange={e => {\r\n                                const value = e.target.value;\r\n                                setInputMode(value);\r\n                                if (\r\n                                    ((internalSource ?? '').length > 0 && value === 'internal')\r\n                                    || ((externalSource ?? '').length > 0 && value === 'external')\r\n                                ) setSourceType(value);\r\n                            }}\r\n                            value={inputMode}\r\n                        >\r\n                            <Radio.Button value={'external'} checked={inputMode === 'external'}>\r\n                                Online\r\n                            </Radio.Button>\r\n                            <Tooltip title={<div className=\"image-warning\">\r\n                                Card data with offline image cannot be exported or auto-saved.\r\n                            </div>}>\r\n                                <Radio.Button value={'internal'} checked={inputMode === 'internal'}>\r\n                                    Offline <ExclamationCircleOutlined />\r\n                                </Radio.Button>\r\n                            </Tooltip>\r\n                        </Radio.Group>\r\n                    </div>\r\n                    <div className={['card-image-input', inputMode === 'external' ? '' : 'input-inactive'].join(' ')}>\r\n                        <Input key=\"key\"\r\n                            placeholder=\"Image link\"\r\n                            value={externalSource}\r\n                            onChange={applyOnlineSource}\r\n                            maxLength={512}\r\n                            allowClear\r\n                        />\r\n                        {error\r\n                            ? <div className=\"online-image-tip image-warning\">\r\n                                Image not found.\r\n                            </div>\r\n                            : <div className=\"online-image-tip\">\r\n                                You may use popular hosts such as imgur.\r\n                            </div>}\r\n                    </div>\r\n                    <div className={['card-image-input', inputMode === 'internal' ? '' : 'input-inactive'].join(' ')}>\r\n                        <Input type=\"file\" accept=\"image/*\" onChange={applyOfflineSource} />\r\n                        <hr />\r\n                        Offline image cannot be exported or auto-saved.\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            {beforeCropper}\r\n            <div className=\"card-cropper\">\r\n                {isLoading && <Loading.FullView />}\r\n                <ReactCrop key={`${sourceType}-${isMigrated}-${redrawSignal}`}\r\n                    src={sourceType === 'internal' ? internalSource : externalSource}\r\n                    imageStyle={backgroundColor\r\n                        ? {\r\n                            backgroundColor,\r\n                        }\r\n                        : {\r\n                            backgroundImage: `url(\"${process.env.PUBLIC_URL}/asset/image/texture/transparent-tile.png\")`\r\n                        }}\r\n                    onImageLoaded={onLoad}\r\n                    onImageError={() => {\r\n                        pendingCrop.current = {\r\n                            source: '',\r\n                            crop: null,\r\n                        };\r\n                        setError('Image error');\r\n                        setLoading(false);\r\n                        if (sourceType === 'external' && (externalSource ?? '') === '' && receivingCanvas) {\r\n                            const { width, height } = receivingCanvas;\r\n                            const ctx = receivingCanvas.getContext('2d');\r\n\r\n                            ctx?.clearRect(0, 0, width, height);\r\n                            if (completedCrop) onCropChange(completedCrop, sourceType);\r\n                            onSourceLoaded();\r\n                        } else {\r\n                            onTainted();\r\n                        }\r\n                        // setCrossOrigin(undefined);\r\n                    }}\r\n                    crop={currentCrop}\r\n                    onChange={(_, percentCropData) => {\r\n                        if (pendingCrop.current.crop) return;\r\n                        const image = imgRef.current;\r\n\r\n                        setCrop(cur => {\r\n                            return {\r\n                                ...cur,\r\n                                current: normalizeCrop(percentCropData, image, ratio)\r\n                            };\r\n                        });\r\n                    }}\r\n                    onComplete={(_, percentData) => {\r\n                        if (!pendingCrop.current.crop) setCrop(cur => ({ ...cur, completed: percentData }));\r\n                    }}\r\n                    ruleOfThirds={true}\r\n                    crossorigin={crossorigin}\r\n                />\r\n            </div>\r\n        </div>\r\n    );\r\n});\r\n","import { Tooltip } from 'antd';\r\nimport { useEffect, useState } from 'react';\r\nimport { CloseCircleOutlined } from '@ant-design/icons';\r\nimport './link-marker.scss';\r\n\r\nexport type LinkMarkChooser = {\r\n    defaultValue?: string[],\r\n    onChange?: (value: string[]) => void,\r\n};\r\nexport const LinkMarkChooser = ({\r\n    defaultValue = [],\r\n    onChange = () => {},\r\n}: LinkMarkChooser) => {\r\n    const [choosenArrow, setChoosenArrow] = useState(defaultValue);\r\n    const rotateMap = [-45, 0, 45, -90, 0, 90, -135, 180, 135];\r\n\r\n    const literalChoosenArrow = JSON.stringify(choosenArrow);\r\n    useEffect(() => {\r\n        onChange(choosenArrow);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [literalChoosenArrow]);\r\n\r\n    return <div className=\"link-marker-chooser\">\r\n        <div className=\"title\">\r\n            Link Arrows\r\n        </div>\r\n        <div className=\"container\">\r\n            {[...Array(9)].map((entry, index) => {\r\n                const normalizedIndex = `${index + 1}`;\r\n\r\n                if (normalizedIndex === '5') return <Tooltip key=\"5\" overlay=\"Reset\">\r\n                    <div className=\"link-marker-reset\" onClick={() => {\r\n                        setChoosenArrow([]);\r\n                    }}>\r\n                        <CloseCircleOutlined />\r\n                    </div>\r\n                </Tooltip>;\r\n\r\n                return <div key={normalizedIndex}\r\n                    className={`link-marker-button marker-${index + 1} ${choosenArrow.includes(normalizedIndex) ? 'marker-checked' : ''}`}\r\n                    onClick={() => {\r\n                        setChoosenArrow(cur => {\r\n                            let newMap = [...cur];\r\n\r\n                            if (newMap.includes(normalizedIndex)) newMap = newMap.filter(entry => entry !== normalizedIndex);\r\n                            else newMap.push(normalizedIndex);\r\n\r\n                            return newMap;\r\n                        });\r\n                    }}\r\n                >\r\n                    <div className={`link-marker-icon link-marker-icon-${index + 1}`} style={{ transform: `rotate(${rotateMap[index]}deg)` }} />\r\n                </div>;\r\n            })}\r\n        </div>\r\n    </div>;\r\n};","import { Popover } from 'antd';\r\nimport { ExclamationCircleOutlined } from '@ant-design/icons';\r\nimport { ExtractProps } from 'src/type';\r\nimport './explanation.scss';\r\n\r\nexport type Explanation = {\r\n    iconProps?: ExtractProps<typeof ExclamationCircleOutlined>,\r\n} & ExtractProps<typeof Popover>;\r\nexport const Explanation = ({\r\n    overlayClassName,\r\n    iconProps,\r\n    ...rest\r\n}: Explanation) => {\r\n    const { className, ...restIconProps } = iconProps ?? {};\r\n\r\n    return <Popover overlayClassName={['explanation-overlay', overlayClassName ?? ''].join(' ')} {...rest}>\r\n        <ExclamationCircleOutlined className={['explanation-icon', className ?? ''].join(' ')} {...restIconProps} />\r\n    </Popover>;\r\n};","import { Button, Drawer } from 'antd';\r\nimport { useState } from 'react';\r\nimport styled from 'styled-components';\r\nimport { BulbFilled, SettingFilled } from '@ant-design/icons';\r\nimport './formatting-guide.scss';\r\n\r\nconst StyledCode = styled.span`\r\n    background: var(--main-level-1);\r\n    padding: var(--spacing-px) var(--spacing-xxs);\r\n    border: var(--bw) solid #4e84a4;\r\n    border-radius: var(--br);\r\n    font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New', monospace;\r\n`;\r\nconst StyledPanel = styled.div`\r\n    display: grid;\r\n    grid-template-columns: 615fr 703fr;\r\n    gap: var(--spacing-sm);\r\n    padding: var(--spacing-sm) 0;\r\n    overflow: hidden;\r\n    .panel-box {\r\n        min-width: 0;\r\n        position: relative;\r\n        overflow: hidden;\r\n    }\r\n`;\r\n\r\nconst StyledImageWithCaptionContainer = styled.div`\r\n    min-width: 0;\r\n    position: relative;\r\n    overflow: hidden;\r\n    .caption {\r\n        position: absolute;\r\n        right: 0;\r\n        bottom: 0;\r\n        padding: var(--spacing-px) var(--spacing-sm);\r\n        background: var(--main-level-5);\r\n        border-radius: var(--br-lg) 0 0 0;\r\n        box-shadow: var(--bs-block);\r\n    }\r\n    > img {\r\n        max-width: 100%;\r\n        border: var(--bw) solid var(--sub-level-1);\r\n        border-radius: var(--br-lg);\r\n    }\r\n`;\r\nexport type ImageWithCaption = {\r\n    caption?: React.ReactNode,\r\n    containerProps?: React.HTMLAttributes<HTMLDivElement>,\r\n} & React.ImgHTMLAttributes<HTMLImageElement>;\r\nexport const ImageWithCaption = ({\r\n    caption,\r\n    containerProps,\r\n    alt,\r\n    ...rest\r\n}: ImageWithCaption) => {\r\n    const { className } = containerProps ?? {};\r\n\r\n    return <StyledImageWithCaptionContainer className={`image-with-caption ${className}`}>\r\n        <img alt={alt} {...rest} />\r\n        <div className=\"caption\">{caption}</div>\r\n    </StyledImageWithCaptionContainer>;\r\n};\r\n\r\nexport const FormattingHelpDrawer = () => {\r\n    const [modalOpen, setDrawerOpen] = useState(false);\r\n\r\n    return <>\r\n        <Drawer\r\n            footer={null}\r\n            visible={modalOpen}\r\n            width={'60%'}\r\n            title={<div className=\"overlay-title\">Formatting Guide <Button\r\n                size=\"small\"\r\n                type=\"primary\"\r\n                onClick={() => {\r\n                    setDrawerOpen(false);\r\n                }}\r\n            >Close</Button></div>}\r\n            className=\"formattting-guide-overlay\"\r\n            onClose={() => {\r\n                setDrawerOpen(false);\r\n            }}\r\n        >\r\n            <div>\r\n                <p>\r\n                    Formatting should work out-of-the-box, but in case you need to fine-tune your cards, here are some additional formatting syntax.\r\n                    <br />\r\n                    The behavior may be differents based on the input.\r\n                    <br />\r\n                    You can turn on/off hotkey usage in Setting <SettingFilled />.\r\n                </p>\r\n                <h2>Non-breakable line</h2>\r\n                Wrap a line of text inside a <StyledCode>{'['}</StyledCode> and <StyledCode>{']'}</StyledCode> to prevent the text from breaking down into multiple lines.\r\n                <br />\r\n                If hotkeys are allowed, you can wrap your desired text and press <StyledCode>{'Ctrl-1'}</StyledCode> or <StyledCode>{'⌘-1'}</StyledCode>.\r\n                <StyledPanel className=\"panel-figure\">\r\n                    <ImageWithCaption\r\n                        containerProps={{ className: 'panel-box box-raw' }}\r\n                        alt={'non-breakable line raw'}\r\n                        src={`${process.env.PUBLIC_URL}/asset/image/syntax/syntax-1-raw.jpg`}\r\n                        caption=\"Input\"\r\n                    />\r\n                    <ImageWithCaption\r\n                        containerProps={{ className: 'panel-box box-preview' }}\r\n                        alt={'non-breakable line preview'}\r\n                        src={`${process.env.PUBLIC_URL}/asset/image/syntax/syntax-1-preview.jpg`}\r\n                        caption=\"Output\"\r\n                    />\r\n                </StyledPanel>\r\n                <h2>Non-breakable text</h2>\r\n                Wrap a piece of text inside a <StyledCode>{'{'}</StyledCode> and <StyledCode>{'}'}</StyledCode> to prevent the text from breaking down into multiple lines.\r\n                <br />\r\n                If hotkeys are allowed, you can wrap your desired text and press <StyledCode>{'Ctrl-2'}</StyledCode> or <StyledCode>{'⌘-2'}</StyledCode>.\r\n                <StyledPanel className=\"panel-figure\">\r\n                    <ImageWithCaption\r\n                        containerProps={{ className: 'panel-box box-raw' }}\r\n                        alt={'non-breakable line raw'}\r\n                        src={`${process.env.PUBLIC_URL}/asset/image/syntax/syntax-2-raw.jpg`}\r\n                        caption=\"Input\"\r\n                    />\r\n                    <ImageWithCaption\r\n                        containerProps={{ className: 'panel-box box-preview' }}\r\n                        alt={'non-breakable line preview'}\r\n                        src={`${process.env.PUBLIC_URL}/asset/image/syntax/syntax-2-preview.jpg`}\r\n                        caption=\"Output\"\r\n                    />\r\n                </StyledPanel>\r\n                <h2>Ruby</h2>\r\n                Put a <StyledCode>{'|'}</StyledCode> in between of a non-breakable text to annotate the text with small letters above it.\r\n                <br />\r\n                If hotkeys are allowed, you can wrap your desired text and press <StyledCode>{'Ctrl-3'}</StyledCode> or <StyledCode>{'⌘-3'}</StyledCode>.\r\n                <StyledPanel className=\"panel-figure\">\r\n                    <ImageWithCaption\r\n                        containerProps={{ className: 'panel-box box-raw' }}\r\n                        alt={'non-breakable line raw'}\r\n                        src={`${process.env.PUBLIC_URL}/asset/image/syntax/syntax-3-raw.jpg`}\r\n                        caption=\"Input\"\r\n                    />\r\n                    <ImageWithCaption\r\n                        containerProps={{ className: 'panel-box box-preview' }}\r\n                        alt={'non-breakable line preview'}\r\n                        src={`${process.env.PUBLIC_URL}/asset/image/syntax/syntax-3-preview.jpg`}\r\n                        caption=\"Output\"\r\n                    />\r\n                </StyledPanel>\r\n                <h2>Compressable Ruby</h2>\r\n                Put a <StyledCode>{'||'}</StyledCode> in between of a non-breakable text to annotate it compressable small letters that does not try to extend beyond the text below it.\r\n                <br />\r\n                If hotkeys are allowed, you can wrap your desired text and press <StyledCode>{'Ctrl-4'}</StyledCode> or <StyledCode>{'⌘-4'}</StyledCode>.\r\n                <StyledPanel className=\"panel-figure\">\r\n                    <ImageWithCaption\r\n                        containerProps={{ className: 'panel-box box-raw' }}\r\n                        alt={'non-breakable line raw'}\r\n                        src={`${process.env.PUBLIC_URL}/asset/image/syntax/syntax-4-raw.jpg`}\r\n                        caption=\"Input\"\r\n                    />\r\n                    <ImageWithCaption\r\n                        containerProps={{ className: 'panel-box box-preview' }}\r\n                        alt={'non-breakable line preview'}\r\n                        src={`${process.env.PUBLIC_URL}/asset/image/syntax/syntax-4-preview.jpg`}\r\n                        caption=\"Output\"\r\n                    />\r\n                </StyledPanel>\r\n                <h2>Non-compressable text</h2>\r\n                Wrap a piece of text inside a <StyledCode>{'{{'}</StyledCode> and <StyledCode>{'}}'}</StyledCode> to prevent the text from being compressed.\r\n                <br />\r\n                If hotkeys are allowed, you can wrap your desired text and press <StyledCode>{'Ctrl-5'}</StyledCode> or <StyledCode>{'⌘-5'}</StyledCode>.\r\n                <StyledPanel className=\"panel-figure\">\r\n                    <ImageWithCaption\r\n                        containerProps={{ className: 'panel-box box-raw' }}\r\n                        alt={'non-breakable line raw'}\r\n                        src={`${process.env.PUBLIC_URL}/asset/image/syntax/syntax-5-raw.jpg`}\r\n                        caption=\"Input\"\r\n                    />\r\n                    <ImageWithCaption\r\n                        containerProps={{ className: 'panel-box box-preview' }}\r\n                        alt={'non-breakable line preview'}\r\n                        src={`${process.env.PUBLIC_URL}/asset/image/syntax/syntax-5-preview.jpg`}\r\n                        caption=\"Output\"\r\n                    />\r\n                </StyledPanel>\r\n            </div>\r\n        </Drawer>\r\n        <Button\r\n            className=\"formatting-help-button\"\r\n            type=\"primary\"\r\n            onClick={() => {\r\n                setDrawerOpen(true);\r\n            }}\r\n        >\r\n            Formatting Help <BulbFilled />\r\n        </Button>\r\n    </>;\r\n};","import { FrameInfo } from 'src/model';\r\nimport styled from 'styled-components';\r\n\r\nconst StyledFrameContainer = styled.div<{ $withPillar: boolean }>`\r\n    display: grid;\r\n    ${({ $withPillar }) => $withPillar ? 'grid-template-columns: max-content 1fr;' : 'grid-template-columns: 1fr;'}\r\n    > label {\r\n        cursor: pointer;\r\n        padding: 0 var(--spacing-xxs);\r\n        text-transform: capitalize;\r\n        text-align: center;\r\n    }\r\n`;\r\nconst StyledFramePillar = styled.div`\r\n    display: inline-block;\r\n    width: 10px;\r\n`;\r\nexport const FrameInfoBlock = ({\r\n    name,\r\n    labelBackgroundColor,\r\n    labelBackgroundColorList,\r\n    className,\r\n}: Omit<FrameInfo, 'edition' | 'labelColor'> & { className?: string }) => {\r\n    return <StyledFrameContainer\r\n        className={`frame-info-block ${className ?? ''}`}\r\n        $withPillar={!!(labelBackgroundColor || labelBackgroundColorList)}\r\n    >\r\n        {labelBackgroundColorList\r\n            ? <StyledFramePillar>\r\n                {labelBackgroundColorList.map(color => <div\r\n                    key={color} \r\n                    style={{ backgroundColor: color, height: `${100 / labelBackgroundColorList.length}%` }}\r\n                />)}\r\n            </StyledFramePillar>\r\n            : labelBackgroundColor\r\n                ? <StyledFramePillar style={{ backgroundColor: labelBackgroundColor }} />\r\n                : null}\r\n        <label className=\"frame-info-block-label\">{name.replaceAll('-', ' ')}</label>\r\n    </StyledFrameContainer>;\r\n};\r\n","import { Card, ocgToTCGTermMap, tcgToOCGTermMap } from 'src/model';\r\n\r\nexport const changeCardFormat = (card: Card, targetFormat: string): Card => {\r\n    const {\r\n        creator,\r\n        effect,\r\n        format,\r\n        isFirstEdition,\r\n        name,\r\n        setId,\r\n        typeAbility,\r\n    } = card;\r\n\r\n    if (format === targetFormat) return card;\r\n\r\n    const termMap = targetFormat === 'ocg' ? tcgToOCGTermMap : ocgToTCGTermMap;\r\n    const newSetId = (targetFormat === 'ocg' && /-EN/.test(setId))\r\n        ? setId.replace('-EN', '-JP')\r\n        : targetFormat === 'tcg' && /-JP/.test(setId)\r\n            ? setId.replace('-JP', '-EN')\r\n            : setId;\r\n\r\n    return {\r\n        ...card,\r\n        name: termMap[name] ?? name,\r\n        format: targetFormat,\r\n        effect: termMap[effect] ?? effect,\r\n        typeAbility: typeAbility.map(entry => termMap[entry] ?? entry),\r\n        creator: termMap[creator] ?? creator,\r\n        setId: newSetId,\r\n        isFirstEdition: targetFormat === 'ocg' ? false : isFirstEdition,\r\n    };\r\n};","import { Card, getDefaultCard } from 'src/model';\r\nimport { create } from 'zustand';\r\nimport debounce from 'lodash.debounce';\r\nimport throttle from 'lodash.throttle';\r\nimport { decodeCardWithCompatibility, migrateCardData } from 'src/util';\r\n\r\n/**\r\n * Acquire saved card when the session is just initialized. URL source is preferred over local storage source.\r\n */\r\nexport const retrieveSavedCard = () => {\r\n    try {\r\n        const localCardVersion = window.localStorage.getItem('card-version');\r\n        const localCardData = window.localStorage.getItem('card-data');\r\n\r\n        const cardURLData = (new URLSearchParams(window.location.search)).get('data');\r\n        if (cardURLData) {\r\n            return decodeCardWithCompatibility(cardURLData);\r\n        } else if (localCardData !== null && localCardVersion === process.env.REACT_APP_VERSION) {\r\n            return migrateCardData(JSON.parse(localCardData)) as Card;\r\n        }\r\n        return getDefaultCard();\r\n    } catch (e) {\r\n        console.error(e);\r\n        return getDefaultCard();\r\n    }\r\n};\r\n\r\nconst VariantConfigMap = {\r\n    debounce: { type: 'debounce' as const, wait: 400 },\r\n    throttle: { type: 'throttle' as const, wait: 1000 },\r\n};\r\nexport type CardStore = {\r\n    card: Card,\r\n    setCard: (cardTransform: Card | ((currentCard: Card) => Card)) => void,\r\n    getUpdater: (\r\n        key: string,\r\n        valueTransform?: (value: any) => any,\r\n        variant?: 'throttle' | 'debounce' | { type: 'throttle', wait: number } | { type: 'debounce', wait: number },\r\n    ) => (e: any) => void,\r\n};\r\nexport const useCard = create<CardStore>((set, get) => {\r\n    return {\r\n        card: retrieveSavedCard(),\r\n        setCard: cardTransform => {\r\n            if (typeof cardTransform === 'function') set(cur => ({ card: cardTransform(cur.card) }));\r\n            else set({ card: cardTransform });\r\n        },\r\n        getUpdater: (\r\n            key: string,\r\n            valueTransform: (value: any) => any = (value) => value,\r\n            variant,\r\n        ) => {\r\n            const { setCard } = get();\r\n            const returnFunction = (e: any) => {\r\n                setCard(current => ({\r\n                    ...current,\r\n                    [key]: valueTransform(typeof e === 'string' || typeof e === 'number' || Array.isArray(e) ? e : e?.target?.value),\r\n                }));\r\n            };\r\n\r\n            if (!variant) return returnFunction;\r\n            const variantConfig = typeof variant === 'string'\r\n                ? VariantConfigMap[variant] ?? undefined\r\n                : variant;\r\n\r\n            if (!variantConfig) return returnFunction;\r\n            const { wait, type } = variantConfig;\r\n\r\n            if (type === 'debounce') return debounce(returnFunction, wait);\r\n            if (type === 'throttle') return throttle(returnFunction, wait);\r\n\r\n            return returnFunction;\r\n        }\r\n    };\r\n});","import { create } from 'zustand';\r\n\r\nexport type Setting = {\r\n    showCreativeOption: boolean,\r\n    showExtraDecorativeOption: boolean,\r\n    allowHotkey: boolean,\r\n    reduceMotionColor: boolean,\r\n};\r\nexport type SettingStore = {\r\n    setting: Setting,\r\n    updateSetting: (transformerOrPayload: Partial<Setting> | ((currentSetting: Setting) => Setting)) => void,\r\n};\r\nexport const useSetting = create<SettingStore>((set) => {\r\n    const {\r\n        allowHotkey,\r\n        reduceMotionColor,\r\n        showCreativeOption,\r\n        showExtraDecorativeOption,\r\n    } = ((): Record<string, any> => {\r\n        try {\r\n            const cachedStore = JSON.parse(window.localStorage.getItem('setting') ?? '{}');\r\n\r\n            if (cachedStore && typeof cachedStore === 'object' && !Array.isArray(cachedStore)) return cachedStore;\r\n            return {};\r\n        } catch (e) {\r\n            console.error('useSetting: Error when getting cached setting', e);\r\n            return {};\r\n        }\r\n    })();\r\n\r\n    return {\r\n        setting: {\r\n            allowHotkey: typeof allowHotkey === 'boolean' ? allowHotkey : true,\r\n            reduceMotionColor: typeof reduceMotionColor === 'boolean' ? reduceMotionColor : false,\r\n            showCreativeOption: typeof showCreativeOption === 'boolean' ? showCreativeOption : true,\r\n            showExtraDecorativeOption: typeof showExtraDecorativeOption === 'boolean' ? showExtraDecorativeOption : true,\r\n        },\r\n        updateSetting: transformerOrPayload => {\r\n            set(currentStore => {\r\n                const newSetting = typeof transformerOrPayload === 'function'\r\n                    ? transformerOrPayload(currentStore.setting)\r\n                    : { ...currentStore.setting, ...transformerOrPayload };\r\n\r\n                window.localStorage.setItem('setting', JSON.stringify(newSetting));\r\n\r\n                return {\r\n                    setting: newSetting,\r\n                };\r\n            });\r\n        }\r\n    };\r\n});","import { CanvasConst, FinishInformation, FinishMap } from 'src/model';\r\n\r\nconst { height: CanvasHeight, width: CanvasWidth } = CanvasConst;\r\n\r\nexport const randomDarkColor = () => '#000000'.replace(/0/g, () => (~~(Math.random() * 12 + 2)).toString(16));\r\n\r\n/** Draw a straight line with random color, used for measurement debug. It take true edge and width, but will draw based on the current scale ratio. */\r\nexport const drawMarker = ({\r\n    ctx,\r\n    color = randomDarkColor(), width,\r\n    offset = 4,\r\n    edge, baseline,\r\n    xRatio,\r\n}: {\r\n    ctx: CanvasRenderingContext2D,\r\n    color?: string, width: number,\r\n    offset?: number,\r\n    edge: number, baseline: number,\r\n    xRatio: number,\r\n}) => {\r\n    const currentFillStyle = ctx.fillStyle;\r\n    ctx.fillStyle = color;\r\n    ctx.beginPath();\r\n    ctx.rect(edge / xRatio, baseline + 1 + Math.random() * offset, width / xRatio, 2);\r\n    // ctx.fill();\r\n    ctx.fillStyle = currentFillStyle;\r\n};\r\n\r\n/**\r\n * @summary Letter spacing rules:\r\n * * It is based on the letter width (so each letter has different spacing), default is no spacing (0).\r\n * * Positive letter spacing will create a gap between each letter, and vice versa.\r\n * * Each letter distribute the gap evenly to their left and right side. So for example if letter spacing is 50% (0.5), it will have a gap equal to 25% (0.25) of its width.\r\n */\r\n\r\n/** Draw a left-aligned text with provided letter spacing. This function take true edge and baseline. It return the right side of the newly created text. */\r\nexport const fillTextLeftWithSpacing = (\r\n    ctx: CanvasRenderingContext2D | null | undefined,\r\n    str: string,\r\n    letterSpacingRatio: number,\r\n    edge: number,\r\n    baseline: number,\r\n    option?: {\r\n        stroke?: boolean,\r\n    }\r\n) => {\r\n    if (!ctx || !str) return edge;\r\n\r\n    const { stroke = false } = option ?? {};\r\n    ctx.textAlign = 'left';\r\n    const charList = str.split('');\r\n    let curLeft = edge;\r\n\r\n    charList.forEach(char => {\r\n        ctx.fillText(char, curLeft, baseline);\r\n        if (stroke) ctx.strokeText(char, curLeft, baseline);\r\n        curLeft += ctx.measureText(char).width * (2 + letterSpacingRatio) / 2;\r\n    });\r\n\r\n    return curLeft;\r\n};\r\n/** Draw a right-aligned text with provided letter spacing. This function take true edge and baseline. It return the left side of the newly created text. */\r\nexport const fillTextRightWithSpacing = (\r\n    ctx: CanvasRenderingContext2D | null | undefined,\r\n    str: string,\r\n    letterSpacing: number,\r\n    edge: number,\r\n    baseline: number,\r\n    option?: {\r\n        stroke?: boolean,\r\n    }\r\n) => {\r\n    if (!ctx || !str) return edge;\r\n\r\n    const { stroke = false } = option ?? {};\r\n    ctx.textAlign = 'right';\r\n    const charList = str.split('');\r\n    let curRight = edge;\r\n\r\n    charList.forEach((c, index) => {\r\n        const char = charList[charList.length - index - 1];\r\n        ctx.fillText(char, curRight, baseline);\r\n        if (stroke) ctx.strokeText(char, curRight, baseline);\r\n        curRight -= ctx.measureText(char).width * (2 + letterSpacing) / 2;\r\n    });\r\n    return curRight;\r\n};\r\n\r\n/** Clear current canvas, it also ensure canvas existed so we do not need to check for afterward. */\r\nexport const clearCanvas = (\r\n    ctx: CanvasRenderingContext2D | null | undefined,\r\n    width = CanvasWidth,\r\n    height = CanvasHeight,\r\n): ctx is CanvasRenderingContext2D => {\r\n    if (ctx) {\r\n        ctx.clearRect(0, 0, width, height);\r\n\r\n        return true;\r\n    };\r\n    return false;\r\n};\r\n\r\n/** Each finish object may contain many parts, each part has its own set of instruction. This function will abstract all the looping logic so we can instantly apply a finish to some card's part. */\r\nexport const getFinishIterator = (\r\n    finish: string[],\r\n    finishMap: Record<string, FinishInformation> = FinishMap,\r\n) => {\r\n    return async (\r\n        ctx?: CanvasRenderingContext2D | null,\r\n        name?: string,\r\n        caller?: (finishType: string) => Promise<any>,\r\n    ) => {\r\n        if (!ctx || !Array.isArray(finish) || finish.length <= 0) return Promise.resolve();\r\n        for (const finishType of finish) {\r\n            const finishInformation = finishMap[finishType];\r\n            if (caller && finishMap[finishType]) {\r\n                const { partInstructionMap } = finishInformation;\r\n                const instructionList = name ? partInstructionMap[name] ?? [] : [];\r\n\r\n                if (instructionList.length) {\r\n                    for (const { blendMode = 'source-over', opacity = 1 } of instructionList) {\r\n                        ctx.globalCompositeOperation = blendMode;\r\n                        ctx.globalAlpha = opacity;\r\n\r\n                        await caller(finishType);\r\n                    }\r\n                } else {\r\n                    await caller(finishType);\r\n                }\r\n                ctx.globalAlpha = 1;\r\n                ctx.globalCompositeOperation = 'source-over';\r\n            }\r\n        }\r\n        ctx.globalAlpha = 1;\r\n        ctx.globalCompositeOperation = 'source-over';\r\n    };\r\n};","const imageCacheMap: Record<string, {\r\n    image: HTMLImageElement,\r\n    ready: boolean,\r\n}> = {};\r\n\r\nexport const drawFrom = async (\r\n    ctx: CanvasRenderingContext2D | null | undefined,\r\n    source: string,\r\n    sx: number | ((image: HTMLImageElement) => number) = 0,\r\n    sy: number | ((image: HTMLImageElement) => number) = 0,\r\n) => {\r\n    if (!ctx || source === '') return new Promise<boolean>(resolve => resolve(false));\r\n    return new Promise<boolean>(resolve => {\r\n        /** @todo Do manual caching really needed? Need proper benchmark for this. */\r\n        if (imageCacheMap[source]?.ready === true) {\r\n            const img = imageCacheMap[source].image;\r\n            const normalizedX = typeof sx === 'number' ? sx : sx(img);\r\n            const normalizedY = typeof sy === 'number' ? sy : sy(img);\r\n\r\n            ctx.drawImage(img, normalizedX, normalizedY);\r\n            resolve(true);\r\n        } else {\r\n            const img = new Image();\r\n            img.src = process.env.PUBLIC_URL + source;\r\n            img.onload = () => {\r\n                const normalizedX = typeof sx === 'number' ? sx : sx(img);\r\n                const normalizedY = typeof sy === 'number' ? sy : sy(img);\r\n\r\n                ctx.drawImage(img, normalizedX, normalizedY);\r\n                imageCacheMap[source].ready = true;\r\n                resolve(true);\r\n            };\r\n            img.onerror = () => {\r\n                resolve(false);\r\n            };\r\n            imageCacheMap[source] = {\r\n                image: img,\r\n                ready: false,\r\n            };\r\n        }\r\n    });\r\n};\r\nexport const drawAsset = async (\r\n    ctx: CanvasRenderingContext2D | null | undefined,\r\n    source: string,\r\n    sx: number | ((image: HTMLImageElement) => number) = 0,\r\n    sy: number | ((image: HTMLImageElement) => number) = 0,\r\n) => {\r\n    return await drawFrom(\r\n        ctx,\r\n        '/asset/image/' + source,\r\n        sx, sy,\r\n    );\r\n};\r\n\r\nexport const drawFromWithSize = async (\r\n    ctx: CanvasRenderingContext2D | null | undefined,\r\n    source: string,\r\n    sx: number | ((image: HTMLImageElement) => number),\r\n    sy: number | ((image: HTMLImageElement) => number),\r\n    dw: number | ((image: HTMLImageElement) => number),\r\n    dh: number | ((image: HTMLImageElement) => number),\r\n) => {\r\n    if (!ctx || source === '') return new Promise<boolean>(resolve => resolve(false));\r\n    return new Promise<boolean>(resolve => {\r\n        if (imageCacheMap[source]?.ready === true) {\r\n            const img = imageCacheMap[source].image;\r\n            const normalizedX = typeof sx === 'number' ? sx : sx(img);\r\n            const normalizedY = typeof sy === 'number' ? sy : sy(img);\r\n            const normalizedW = typeof dw === 'number' ? dw : dw(img);\r\n            const normalizedH = typeof dh === 'number' ? dh : dh(img);\r\n\r\n            ctx.drawImage(img, normalizedX, normalizedY, normalizedW, normalizedH);\r\n            resolve(true);\r\n        } else {\r\n            const img = new Image();\r\n            img.src = process.env.PUBLIC_URL + source;\r\n            img.onload = () => {\r\n                const normalizedX = typeof sx === 'number' ? sx : sx(img);\r\n                const normalizedY = typeof sy === 'number' ? sy : sy(img);\r\n                const normalizedW = typeof dw === 'number' ? dw : dw(img);\r\n                const normalizedH = typeof dh === 'number' ? dh : dh(img);\r\n    \r\n                ctx.drawImage(img, normalizedX, normalizedY, normalizedW, normalizedH);\r\n                imageCacheMap[source].ready = true;\r\n                resolve(true);\r\n            };\r\n            img.onerror = () => {\r\n                resolve(false);\r\n            };\r\n            imageCacheMap[source] = {\r\n                image: img,\r\n                ready: false,\r\n            };\r\n        }\r\n    });\r\n};\r\nexport const drawAssetWithSize: typeof drawFromWithSize = async (\r\n    ctx,\r\n    source,\r\n    sx, sy,\r\n    dw, dh,\r\n) => {\r\n    return await drawFromWithSize(\r\n        ctx,\r\n        '/asset/image/' + source,\r\n        sx, sy,\r\n        dw, dh,\r\n    );\r\n};","import {\r\n    ChiisaiRegex,\r\n    ChoonpuRegex,\r\n    HiraganaRegex,\r\n    KatakanaRegex,\r\n    MetricMethod,\r\n    NoSpaceRegex,\r\n    OCGBoxSpacingRatioMap,\r\n    OCGDotRegex,\r\n    OCGIncreasedLevel2WidthRegex,\r\n    OCGIncreasedWidthRegex,\r\n    OCGLastOfLineOffsetMap,\r\n    OCGNumberRegex,\r\n    OCGOffsetMap,\r\n    OCG_REDUCED_AT_END_LINE_RATIO,\r\n    TCGBoxSpacingRatioMap,\r\n    TCGLastOfLineOffsetMap,\r\n    TCGOffsetMap,\r\n    nonBreakableSymbolRegex,\r\n} from 'src/model';\r\n\r\n/**\r\n * Return the width of a letter. This function return true width of a scalable letter, but will return the inverse-scaled width of a non-scalable letter (based on the `xRatio` property). For example:\r\n *  * Canvas does not scaled: Letter \"A\" return 50px, while letter \"①\" (non-scalable) return 50px.\r\n *  * Canvas scaled down by 0.5: Letter \"A\" return 50px, while letter \"①\" (non-scalable) return 100px.\r\n *\r\n * Each letter has 3 main values:\r\n *  * `width`: The width of a character based on font size, for example all kanji with the same font size will have the same width, because each letter is designed within a consistent box.\r\n *  * `actualBoundWidth`: The width of actual image of a character based on its shape, for example letter of the sokuon \"ァ\" will have actualBoundingWidth much smaller than the kanji letter \"道\", even though they have the same font-size (and therefore same width).\r\n *  * `boundWidth`: It is actualBoundWidth + small padding at left and right so that the letter does not stick closely to each other.\r\n * \r\n * `metricMethod` dictate the ratio and calculation method of a letter, used for different use-cases.\r\n * \r\n * DO NOT apply font weight to the canvas while calling this function, as the result will become inconsistent.\r\n */\r\nexport const getLetterWidth = ({\r\n    ctx,\r\n    letter,\r\n    isLastOfLine = false,\r\n    debug,\r\n    fontStyle,\r\n    xRatio,\r\n    metricMethod = 'standard',\r\n}: {\r\n    ctx: CanvasRenderingContext2D,\r\n    letter: string,\r\n    isLastOfLine?: boolean,\r\n    fontStyle: string,\r\n    xRatio: number,\r\n    metricMethod?: MetricMethod,\r\n    debug?: string,\r\n}) => {\r\n    if (nonBreakableSymbolRegex.test(letter)) return {\r\n        width: 0,\r\n        boundWidth: 0,\r\n    };\r\n\r\n    const boxSpacingRatioMap = fontStyle === 'tcg'\r\n        ? TCGBoxSpacingRatioMap\r\n        : OCGBoxSpacingRatioMap;\r\n    const offsetMap = fontStyle === 'tcg'\r\n        ? TCGOffsetMap\r\n        : OCGOffsetMap;\r\n    const lastOfLineOffsetMap = fontStyle === 'tcg'\r\n        ? TCGLastOfLineOffsetMap\r\n        : OCGLastOfLineOffsetMap;\r\n    const metric = ctx.measureText(letter);\r\n    const {\r\n        width,\r\n        actualBoundingBoxLeft,\r\n        actualBoundingBoxRight,\r\n    } = metric;\r\n    const actualBoundWidth = actualBoundingBoxLeft + actualBoundingBoxRight;\r\n    let kerningScaleRatio = 1;\r\n    if (metricMethod === 'name') {\r\n        kerningScaleRatio = 1 + (1 - xRatio) * 8;\r\n    }\r\n    const spacingRatio = metricMethod === 'name' || metricMethod === 'compact' || metricMethod === 'furigana'\r\n            ? 0.046875\r\n            : 0;\r\n    let boundWidth = actualBoundWidth;\r\n    let offsetRatio = (isLastOfLine\r\n        ? lastOfLineOffsetMap[letter]\r\n        : offsetMap[letter]) ?? 0;\r\n\r\n    if (fontStyle === 'tcg') {\r\n        let letterBoxSpacing = (boxSpacingRatioMap[letter] ?? 0) * width;\r\n\r\n        return {\r\n            width,\r\n            actualBoundWidth,\r\n            boundWidth: width + 2 * letterBoxSpacing,\r\n            metric,\r\n            offsetRatio,\r\n        };\r\n    }\r\n\r\n    let letterBoxSpacing = (boxSpacingRatioMap[letter] ?? 0) * width\r\n        + (metricMethod === 'furigana'\r\n            ? 0\r\n            : Math.min(\r\n                width * 0.075,\r\n                Math.max(0.450, width * spacingRatio) * kerningScaleRatio,\r\n            ));\r\n    let letterRatio = 1;\r\n    let endLineRatio = 1;\r\n    let standardMetricRatio = 1.000;\r\n    if (OCGDotRegex.test(letter)) {\r\n        boundWidth = metricMethod === 'furigana' ? actualBoundWidth : actualBoundWidth * (metricMethod === 'creator' ? 1.750 : 2.500);\r\n        standardMetricRatio = 0.600;\r\n    }\r\n    else if (ChoonpuRegex.test(letter)) {\r\n        boundWidth = metricMethod === 'furigana' ? actualBoundWidth : Math.max(actualBoundWidth, width * 0.75);\r\n        letterBoxSpacing = metricMethod === 'furigana' ? 0 : 2;\r\n    }\r\n    else if (ChiisaiRegex.test(letter)) {\r\n        boundWidth = metricMethod === 'furigana' ? actualBoundWidth : Math.max(actualBoundWidth, width * 0.7);\r\n    }\r\n    else if (OCGNumberRegex.test(letter)) {\r\n        boundWidth = width;\r\n    }\r\n    else if (OCGIncreasedLevel2WidthRegex.test(letter)) {\r\n        boundWidth = actualBoundWidth * 2;\r\n    }\r\n    else if (OCGIncreasedWidthRegex.test(letter)) {\r\n        boundWidth = actualBoundWidth * 1.250 * (isLastOfLine ? OCG_REDUCED_AT_END_LINE_RATIO : 1);\r\n    }\r\n    else if (HiraganaRegex.test(letter)) {\r\n        boundWidth = metricMethod === 'furigana' ? actualBoundWidth : Math.max(actualBoundWidth, width * 0.750);\r\n    }\r\n    else if (KatakanaRegex.test(letter)) {\r\n        boundWidth = Math.max(actualBoundWidth, width * 0.690)\r\n            * (metricMethod === 'creator' ? 0.97500 : 1.000);\r\n    }\r\n    else if (NoSpaceRegex.test(letter)) {\r\n        boundWidth = width;\r\n        letterBoxSpacing = 0;\r\n    }\r\n    else {\r\n        boundWidth = metricMethod === 'furigana' ? actualBoundWidth : Math.max(actualBoundWidth, width * 0.750);\r\n    }\r\n\r\n    const actualLetterWidth = width * letterRatio * endLineRatio;\r\n\r\n    if (debug) console.info(`getLetterWidth ${debug}`, letter, metric, letterRatio, endLineRatio, '|', actualLetterWidth);\r\n    return {\r\n        width,\r\n        actualBoundWidth,\r\n        boundWidth: metricMethod === 'standard'\r\n            ? width * standardMetricRatio\r\n            : boundWidth + letterBoxSpacing * 2,\r\n        metric,\r\n        offsetRatio,\r\n    };\r\n};\r\n\r\nexport type TextDrawer = (props: {\r\n    ctx: CanvasRenderingContext2D,\r\n    letter: string,\r\n    scaledEdge: number,\r\n    scaledBaseline: number,\r\n}) => void;\r\n/** \r\n * Draw the letter with a provided worker. It take true edge as paramter, but will pass scaled edge to the worker.\r\n */\r\nexport const drawLetter = ({\r\n    ctx,\r\n    baseline,\r\n    edge,\r\n    letter,\r\n    xRatio,\r\n    letterMetric,\r\n    textDrawer,\r\n}: {\r\n    ctx: CanvasRenderingContext2D,\r\n    letter: string,\r\n    letterMetric?: ReturnType<typeof getLetterWidth>,\r\n    edge: number,\r\n    baseline: number,\r\n    xRatio: number,\r\n    textDrawer?: TextDrawer,\r\n}) => {\r\n    const {\r\n        boundWidth,\r\n        metric = ctx.measureText(letter),\r\n        offsetRatio = 0,\r\n    } = letterMetric ?? {};\r\n    const letterWidth = metric.width * xRatio;\r\n    const scaledBoundingWidth = boundWidth ? boundWidth * xRatio : letterWidth;\r\n    const worker = textDrawer ?? (({\r\n        ctx,\r\n        letter,\r\n        scaledBaseline,\r\n        scaledEdge,\r\n    }) => {\r\n        ctx.fillText(letter, scaledEdge, scaledBaseline);\r\n    });\r\n\r\n    const boundingOffset = (letterWidth - scaledBoundingWidth) / 2;\r\n    const externalOffset = scaledBoundingWidth * offsetRatio;\r\n    worker({\r\n        ctx,\r\n        letter,\r\n        scaledEdge: edge / xRatio - boundingOffset - externalOffset,\r\n        scaledBaseline: baseline,\r\n    });\r\n};","import {\r\n    BREAKABLE_LETTER,\r\n    DefaultFontSizeData,\r\n    FontData,\r\n    FontSizeData,\r\n    NB_WORD_CLOSE,\r\n    NB_WORD_OPEN,\r\n} from 'src/model';\r\nimport { createFontGetter } from 'src/util';\r\n\r\nexport const tokenizeText = (text: string, keepControlCharacter = false) => {\r\n    const regex = keepControlCharacter\r\n        ? new RegExp(`([${BREAKABLE_LETTER}])|(${NB_WORD_OPEN}[\\\\w\\\\W]+?${NB_WORD_CLOSE})|(.+?)`)\r\n        : new RegExp(`([${BREAKABLE_LETTER}])|${NB_WORD_OPEN}([\\\\w\\\\W]+?)${NB_WORD_CLOSE}|(.+?)`);\r\n\r\n    return text\r\n        .split(regex)\r\n        .filter(token => token != null && token !== '');\r\n};\r\n\r\nexport const getTextWorker = (\r\n    ctx: CanvasRenderingContext2D,\r\n    fontData: FontData,\r\n    fontSizeData: FontSizeData,\r\n    fontController: ReturnType<typeof createFontGetter>,\r\n) => {\r\n    const {\r\n        fontSize,\r\n        headTextFontRatio = DefaultFontSizeData.headTextFontRatio,\r\n    } = fontSizeData;\r\n    const {\r\n        font,\r\n        ordinalFont,\r\n        symbolFont,\r\n        symbolFontRatio,\r\n        numberFont = font,\r\n        numberFontRatio = 1,\r\n        furiganaFont,\r\n    } = fontData;\r\n\r\n    let numberFontMemory = fontController.getFontInfo();\r\n    const applyNumberFont = () => {\r\n        numberFontMemory = fontController.getFontInfo();\r\n        ctx.font = fontController.setFamily(numberFont).setSize(fontSize * numberFontRatio).getFont();\r\n    };\r\n    const stopApplyNumberFont = () => {\r\n        ctx.font = fontController\r\n            .setFamily(numberFontMemory.family)\r\n            .setSize(numberFontMemory.size)\r\n            .getFont();\r\n    };\r\n\r\n    let symbolFontMemory = fontController.getFontInfo();\r\n    const applySymbolFont = () => {\r\n        symbolFontMemory = fontController.getFontInfo();\r\n        ctx.font = fontController.setFamily(symbolFont).setSize(fontSize * symbolFontRatio).getFont();\r\n    };\r\n    const stopApplySymbolFont = () => {\r\n        ctx.font = fontController\r\n            .setFamily(symbolFontMemory.family)\r\n            .setSize(symbolFontMemory.size)\r\n            .getFont();\r\n    };\r\n\r\n    let ordinalFontMemory = fontController.getFontInfo();\r\n    const applyOrdinalFont = () => {\r\n        ordinalFontMemory = fontController.getFontInfo();\r\n        ctx.font = fontController.setFamily(ordinalFont).setSize(fontSize / 1.1).getFont();\r\n    };\r\n    const stopApplyOrdinalFont = () => {\r\n        ctx.font = fontController\r\n            .setFamily(ordinalFontMemory.family)\r\n            .setSize(ordinalFontMemory.size)\r\n            .getFont();\r\n    };\r\n\r\n    const resetScale = () => {\r\n        ctx.setTransform(1, 0, 0, 1, 0, 0);\r\n    };\r\n\r\n    const applyAsymmetricScale = (xRatio = 1, yRatio = 1) => {\r\n        ctx.scale(xRatio, yRatio);\r\n    };\r\n\r\n    let furiganaFontMemory = fontController.getFontInfo();\r\n    const applyFuriganaFont = (bold = false) => {\r\n        furiganaFontMemory = fontController.getFontInfo();\r\n        ctx.font = fontController.setFamily(furiganaFont).setWeight(bold ? 'bold' : '').setSize(fontSize * headTextFontRatio).getFont();\r\n    };\r\n    const stopApplyFuriganaFont = () => {\r\n        ctx.font = fontController\r\n            .setFamily(furiganaFontMemory.family)\r\n            .setWeight(furiganaFontMemory.weight)\r\n            .setSize(furiganaFontMemory.size)\r\n            .getFont();\r\n    };\r\n\r\n    const applyScale = (xScale = 1, yScale = xScale) => {\r\n        ctx.scale(xScale, yScale);\r\n    };\r\n\r\n    const reverseScale = (scaleValue = 1) => {\r\n        ctx.scale(1 / scaleValue, 1 / scaleValue);\r\n    };\r\n\r\n    let largerTextFontMemory = fontController.getFontInfo();\r\n    const applyLargerText = (fontRatio = 1) => {\r\n        largerTextFontMemory = fontController.getFontInfo();\r\n        ctx.font = fontController.setSize(fontSize * fontRatio).getFont();\r\n    };\r\n    const stopApplyLargerText = () => {\r\n        ctx.font = fontController.setSize(largerTextFontMemory.size).getFont();\r\n    };\r\n\r\n    return {\r\n        applyNumberFont, stopApplyNumberFont,\r\n        applyLargerText, stopApplyLargerText,\r\n        applySymbolFont, stopApplySymbolFont,\r\n        applyOrdinalFont, stopApplyOrdinalFont,\r\n        applyFuriganaFont, stopApplyFuriganaFont,\r\n\r\n        applyAsymmetricScale,\r\n        applyScale,\r\n        resetScale,\r\n        reverseScale,\r\n    };\r\n};\r\n\r\n/** We do not actually use the ● letter for bullet, instead we a draw a black circle with fixed size. Bullets not only does not condense, but also does not actually scale with font-size. They are the same size even if we use smaller font to add more lines (\"Agave Dragon\" TCG), this in turn prevent us from reducing the font size too small.\r\n * \r\n * In TCG the space behind bullet is fixed, so multiple lines with bullet at the start will align perfectly, it is not seems to be the case in OCG.\r\n*/\r\nexport const drawBullet = (ctx: CanvasRenderingContext2D, edge: number, baseline: number, width: number, spaceAfter: number) => {\r\n    const bulletRadius = (width - spaceAfter) / 2;\r\n    ctx.beginPath();\r\n    ctx.arc(edge + bulletRadius, baseline - bulletRadius - 1, bulletRadius, 0, 2 * Math.PI, false);\r\n    ctx.fill();\r\n    ctx.lineWidth = 1;\r\n    ctx.strokeStyle = '#003300';\r\n    ctx.stroke();\r\n};\r\n\r\n/**\r\n * This function analyze head text of a token, and return various information: its width (same calculation rule with `analyzeToken`), alignment type, gap as well as drawing information (letter spacing and customized condense ratio).\r\n * \r\n * @summary All ruby (head text) rules:\r\n * * A token may or may not has head text.\r\n * * Head text take space above foot text, if foot text still has space left, the token has negative gap. On the other hand if head text is too long it may growth out of foot text's vertical boundary (overflowing), in this case the token has positive gap.\r\n * * Head text with positive gap may take negative gap from the previous token. Read knoweledge diagram for a visual presentation. They take available gap in such a way that head text never overlap with each other, and foot text also does not overlap with each other.\r\n * * Foot text may got pushed around a bit so empty space is distributed uniformly (\"Beyond the Pendulum\" OCG). The current implementation cannot achieve such effect automatically, but only to a degree.\r\n * * Head text above a single letter is always center-aligned. Head text above multiple letters is align using space-around distribution if it does not overflow, and center otherwise.\r\n * * Head text that is way too long compare to its foot text underneath will be condensed and has negative letter spacing (\"PenduLuMoon\" OCG), in some cases make it completely unreadable.\r\n * * Head text of the first token of a line can \"spill\" out of line's boundary. (\"Beyond the Pendulum\" OCG) Even if this is the case, all foot text must be perfectly aligned vertically.\r\n * * Head text above a single letter will not be condensed (\"Recette de Poisson (Fish Recipe)\" OCG) unless forced to by special syntax.\r\n * * Head text above multiple-letters foot text condeses with a slower rate than normal (\"Number C92: Heart-eartH Chaos Dragon\" OCG).\r\n * * Head text above a whole line will be condensed so it does not overflow (\"Amaze Attraction Viking Vortex\" OCG).\r\n * * Those letters do not have gap, and therefore do not allow head text to overflow over them: Bullet ●, ordinal letter lie ⑤ (\"Pendulum Dimension\" OCG).\r\n * */\r\nexport const analyzeHeadText = ({\r\n    footText, footTextWidth,\r\n    headText, headTextLetterWidth,\r\n    headTextGap,\r\n    headTextSpacing,\r\n    gapPadding,\r\n    debug,\r\n    fitFootText,\r\n    sentenceXRatio,\r\n    xRatio,\r\n}: {\r\n    headText: string,\r\n    headTextLetterWidth: number,\r\n    footText: string,\r\n    footTextWidth: number,\r\n    headTextGap: number,\r\n    headTextSpacing: number,\r\n    gapPadding: number,\r\n    debug?: string,\r\n    fitFootText: boolean,\r\n    sentenceXRatio: number,\r\n    xRatio: number,\r\n}) => {\r\n    const noHeadText = headText.length === 0;\r\n    const condenseHeadText = headTextLetterWidth / footTextWidth * sentenceXRatio;\r\n    let alignCenterLetterSpacing = headTextSpacing;\r\n    let internalXRatio = 0;\r\n    /** We use width ratio between head text (letters only) and foot text to determine that it is too long or not. For each ratio threshold, a different treatment is applied. */\r\n    if (condenseHeadText <= 0.95) {\r\n        /** Most case fall to this category */\r\n        alignCenterLetterSpacing = headTextSpacing;\r\n    }\r\n    else if (condenseHeadText <= 1.175) {\r\n        /** If the head text is a bit too long, we force all head text's letters to stay close together. Example like \"EX\" - Extra Deck in OCG. */\r\n        alignCenterLetterSpacing = 0;\r\n    }\r\n    else if (condenseHeadText <= 1.575) {\r\n        /** If the head text is too long, we start to introduce negative spacing. Example like \"S\" - Synchro in OCG. */\r\n        alignCenterLetterSpacing = headTextSpacing * -1/4;\r\n    }\r\n    else {\r\n        /** If the head text is way too long, not only we introduce negative spacing, but also condense the actual letter. \"P\" - Pendulum is a notorious example. */\r\n        internalXRatio = 0.66;\r\n        alignCenterLetterSpacing = headTextSpacing * -1/4;\r\n    }\r\n    if (fitFootText || xRatio < 1) {\r\n        alignCenterLetterSpacing = headTextSpacing;\r\n    }\r\n\r\n    const alignCenterHeadTextWidth = headTextLetterWidth * ((xRatio && !fitFootText)\r\n        ? xRatio\r\n            : (!internalXRatio || fitFootText) ? 1 : internalXRatio)\r\n            + alignCenterLetterSpacing * (headText.length - 1);\r\n    const alignEvenlyLetterSpacing = noHeadText ? 0 : (footTextWidth - headTextLetterWidth) / headText.length;\r\n    const alignEvenlyHeadTextWidth = footTextWidth;\r\n\r\n    const alignment = footText.length === 1 || (gapPadding * 2 + alignCenterHeadTextWidth > footTextWidth)\r\n        ? 'center' as const\r\n        : 'space-around' as const;\r\n    const letterSpacing = alignment === 'center'\r\n        ? alignCenterLetterSpacing\r\n        : alignEvenlyLetterSpacing;\r\n    const trueHeadTextWidth = alignment === 'center'\r\n        ? gapPadding * 2 + alignCenterHeadTextWidth\r\n        : alignEvenlyHeadTextWidth;\r\n    const headTextWidth = fitFootText\r\n        ? Math.min(trueHeadTextWidth, footTextWidth)\r\n        : trueHeadTextWidth;\r\n    const baseHalfGap = alignment === 'center'\r\n        ? (alignCenterHeadTextWidth - footTextWidth) / 2\r\n        : 0;\r\n    const halfGap = Math.max(\r\n        headTextGap,\r\n        fitFootText ? Math.min(baseHalfGap, 0) : baseHalfGap,\r\n    );\r\n\r\n    if (debug) console.info(\r\n        `analyzeHeadText ${debug}`,\r\n        alignment,\r\n        letterSpacing,\r\n        '|',\r\n        headText, headTextWidth, trueHeadTextWidth,\r\n        footText, footTextWidth,\r\n        halfGap,\r\n    );\r\n    return {\r\n        gapPadding,\r\n        letterSpacing,\r\n        trueHeadTextWidth,\r\n        headTextWidth,\r\n        /**\r\n         * Simple visualization:\r\n         * * Center: `[gap][letter + spacing][gap]`\r\n         * * Space-around: `[half-gap][letter][gap][letter][half-gap]`\r\n         */\r\n        alignment,\r\n        /** \r\n         * * Positive gap will take space from other.\r\n         * * Negative app allow other to use their space.\r\n         */\r\n        halfGap,\r\n        headTextXRatio: alignment === 'center' ? internalXRatio : 0,\r\n    };\r\n};\r\n\r\n/**\r\n * Calculate the lost width from the left side of a token becaues of gap. This width is scalar and therefore ALWAYS positive. Visit knowledge diagram for a clearer visualization.\r\n * \r\n * * If the previous gap is positive (push to their right):\r\n *   * If current gap is positive (push to the left): No space is lost, they simply stand next to each other.\r\n *   * If current gap is negative (previous token pull them): Current token lose some width, but no more than what the previous token can take.\r\n * * If the previous gap is negative (pull the next token to them):\r\n *   * If current gap is positive (push to the left): Current token lose some width, but no more than what the previous token can give.\r\n *   * If current gap is negative (previous token pull them): No space is lost, they do not interfere with each other.\r\n */\r\nexport const getLostLeftWidth = (prevGap: number, curGap: number) => {\r\n    return prevGap >= 0\r\n        ? curGap >= 0\r\n            ? 0\r\n            : Math.max(prevGap * -1, curGap) * -1\r\n        : curGap >= 0\r\n            ? Math.max(prevGap, curGap * -1) * -1\r\n            : 0;\r\n};","import {\r\n    FontData,\r\n    BULLET_LETTER,\r\n    TCGSpecialLetterRegex,\r\n    OCGAlphabetRegex,\r\n    MAX_LINE_REVERSE_INDENT,\r\n    START_OF_LINE_ALPHABET_OFFSET,\r\n    FragmentSplitRegex,\r\n    WholeWordRegex,\r\n    DefaultFontSizeData,\r\n    ST_ICON_SYMBOL,\r\n    TextData,\r\n    NoSpaceRegex,\r\n    LETTER_GAP_RATIO,\r\n    NB_UNCOMPRESSED_START,\r\n    NB_UNCOMPRESSED_END,\r\n    SquareBracketLetterRegex,\r\n    CapitalLetterRegex,\r\n    NumberRegex,\r\n    OCGNoOverheadGapRegex,\r\n    GAP_PER_WIDTH_RATIO,\r\n    GAP_PADDING_RATIO,\r\n    RUBY_REGEX,\r\n    DefaultFontData,\r\n    RUBY_BONUS_RATIO,\r\n    NON_BREAKABLE_SYMBOL_SOURCE,\r\n} from 'src/model';\r\nimport { getTextWorker, analyzeHeadText, tokenizeText, getLostLeftWidth } from './text-util';\r\nimport { createFontGetter } from 'src/util';\r\nimport { getLetterWidth } from './letter';\r\n\r\n/** \r\n * Return information of a token.\r\n * @returns\r\n *  * `totalWidth`: The width of the token based on xRatio. In the same fashion with `getLetterWidth`, we get the true width for scalable letter, and inverse-scaled width of a non-scalable letter. `totalWidth` does no include whitespaces since they are not calculate traditionally.\r\n *  * `leftMostLetter`: The left most letter of a token (not counting control characters), there is a special treatment based on what is the left most letter of a token (mainly indentation).\r\n *  * `spaceCount`: Number of whitespaces in a token, their width will be calculated afterward.\r\n *  * `spaceAtEnd`: Whether or not the token end with a space, for example most of English word requires a whitespace between words, while Japanese does not. We also does not allow a line to end with a whitespace unless it is the last line.\r\n *  * `rightGap`, `leftGap`: Gap of a token based on its overhead letters. The token may consist of multiple letters each with their own gap, so it is easy to see that right and left gap of a token is respectively left gap of the leftmost letter and right gap of the rightmost letter.\r\n */\r\nexport const analyzeToken = ({\r\n    ctx,\r\n    token: rawToken, nextToken,\r\n    xRatio,\r\n    previousTokenGap = 0,\r\n    letterSpacing = DefaultFontSizeData.letterSpacing,\r\n    format,\r\n    textData,\r\n    // debug = false,\r\n}: {\r\n    ctx: CanvasRenderingContext2D,\r\n    token: string,\r\n    nextToken: string | undefined,\r\n    xRatio: number,\r\n    previousTokenGap?: number,\r\n    letterSpacing?: number,\r\n    format: string,\r\n    // debug?: boolean,\r\n    textData: {\r\n        fontData: FontData,\r\n        fontLevel: number,\r\n        currentFont: ReturnType<typeof createFontGetter>,\r\n    },\r\n}) => {\r\n    if (!ctx || !rawToken) return {\r\n        totalWidth: 0,\r\n        leftMostLetter: '',\r\n        spaceCount: 0,\r\n        spaceAtEnd: false,\r\n        rightGap: 0,\r\n        leftGap: 0,\r\n    };\r\n    const {\r\n        currentFont,\r\n        fontData,\r\n        fontLevel,\r\n    } = textData;\r\n    const {\r\n        metricMethod,\r\n        headTextOverflow = DefaultFontData.headTextOverflow,\r\n        fontStyle,\r\n    } = fontData;\r\n    const fontSizeData = fontData.fontList[fontLevel];\r\n    const {\r\n        bulletSymbolWidth,\r\n        capitalLetterRatio,\r\n        fontSize,\r\n        iconSymbolWidth = bulletSymbolWidth,\r\n        largeSymbolRatio = DefaultFontSizeData.largeSymbolRatio,\r\n        headTextSpacing = DefaultFontSizeData.headTextSpacing,\r\n        squareBracketRatio,\r\n        wordLetterSpacing,\r\n    } = fontSizeData;\r\n    const defaultGap = fontSize * LETTER_GAP_RATIO;\r\n    const {\r\n        applyScale, reverseScale,\r\n        applyLargerText, stopApplyLargerText,\r\n        applyFuriganaFont, stopApplyFuriganaFont,\r\n        applyOrdinalFont, stopApplyOrdinalFont,\r\n        applySymbolFont, stopApplySymbolFont,\r\n        applyNumberFont, stopApplyNumberFont,\r\n    } = getTextWorker(ctx, fontData, fontSizeData, currentFont);\r\n    const token = rawToken.replaceAll(new RegExp(NON_BREAKABLE_SYMBOL_SOURCE, 'g'), '');\r\n    const letterSpacingRatio = 1 + letterSpacing / 2;\r\n    let leftMostLetter = '';\r\n    let totalWidth = 0;\r\n    let spaceCount = 0;\r\n    let spaceAtEnd = false;\r\n    const isLastOfLine = nextToken === undefined;\r\n    /** The right gap of a token will influence the left gap of the next token */\r\n    let currentRightGap = previousTokenGap ?? 0;\r\n    /** Whether or not it is affected by rebalance calculation */\r\n    let offsetable = false;\r\n    let leftMostGap = 0;\r\n\r\n    const fragmentList = token.split(FragmentSplitRegex).filter(entry => entry != null && entry !== '');\r\n    for (let cnt = 0; cnt < fragmentList.length; cnt++) {\r\n        const isLeftmostFragment = cnt === 0;\r\n        const fragment = fragmentList[cnt];\r\n\r\n        /** S/T symbol is unscalable (it does not condense no matter the ratio) */\r\n        if (fragment === ST_ICON_SYMBOL) {\r\n            currentRightGap = 0;\r\n            const fragmentWidth = iconSymbolWidth / xRatio;\r\n            totalWidth += fragmentWidth * letterSpacingRatio;\r\n\r\n            if (isLeftmostFragment) {\r\n                leftMostGap = 0;\r\n                leftMostLetter = fragment[0];\r\n            }\r\n        }\r\n        /** Bullet symbol is unscalable (\"Agave Dragon\" OCG/TCG) */\r\n        else if (fragment === BULLET_LETTER) {\r\n            currentRightGap = 0;\r\n            const fragmentWidth = bulletSymbolWidth / xRatio;\r\n            totalWidth += fragmentWidth * letterSpacingRatio;\r\n\r\n            if (isLeftmostFragment) {\r\n                leftMostGap = 0;\r\n                leftMostLetter = fragment[0];\r\n            }\r\n        }\r\n        /** Copyright symbol © is unscalable (creator text) */\r\n        else if (/[©]/.test(fragment)) {\r\n            currentRightGap = 0;\r\n            applyLargerText(largeSymbolRatio);\r\n            const fragmentWidth = ctx.measureText(fragment).width / xRatio;\r\n            stopApplyLargerText();\r\n            totalWidth += fragmentWidth * letterSpacingRatio;\r\n\r\n            if (isLeftmostFragment) {\r\n                leftMostGap = 0;\r\n                leftMostLetter = fragment[0];\r\n            }\r\n        }\r\n        /** OCG Ordinal symbol is unscalable */\r\n        else if (/[①-⑳]/.test(fragment)) {\r\n            currentRightGap = 0;\r\n            applyOrdinalFont();\r\n            const fragmentWidth = ctx.measureText(fragment).width / xRatio;\r\n            stopApplyOrdinalFont();\r\n            totalWidth += fragmentWidth * letterSpacingRatio;\r\n\r\n            spaceCount += 1;\r\n            if (isLeftmostFragment) {\r\n                leftMostGap = 0;\r\n                leftMostLetter = fragment[0];\r\n            }\r\n        }\r\n        /** Process ruby syntax */\r\n        else if (RUBY_REGEX.test(fragment)) {\r\n            const [footText, rubyType, headText = ''] = fragment.replaceAll(/{|}/g, '').split(/(\\|+)/);\r\n            const fitFootText = rubyType === '||';\r\n            /** Calculate foot text's width */\r\n            const {\r\n                totalWidth: footTextWidth,\r\n            } = analyzeToken({ ctx, token: footText, nextToken, xRatio, letterSpacing, previousTokenGap: 0, format, textData });\r\n\r\n            /** Calculate head text's width */\r\n            applyFuriganaFont();\r\n            const headTextLetterWidth = headText\r\n                .split('')\r\n                .map(letter => getLetterWidth({ ctx, letter, fontStyle, metricMethod: 'furigana', xRatio: 1 }).boundWidth)\r\n                .reduce((acc, cur) => acc + cur, 0);\r\n            stopApplyFuriganaFont();\r\n\r\n            /** Calculate gap */\r\n            const { halfGap: baseHalfGap, headTextWidth } = analyzeHeadText({\r\n                headText,\r\n                headTextLetterWidth: headTextLetterWidth / xRatio,\r\n                footText,\r\n                footTextWidth,\r\n                headTextGap: defaultGap / xRatio,\r\n                headTextSpacing,\r\n                gapPadding: GAP_PADDING_RATIO * fontSize / xRatio,\r\n                fitFootText,\r\n                sentenceXRatio: xRatio,\r\n                xRatio: (headTextOverflow === 'condense' && footText.length > 1) ? Math.min(1, xRatio + RUBY_BONUS_RATIO) : 0,\r\n            });\r\n            const halfGap = headText.length === 0\r\n                ? Math.max(defaultGap, footTextWidth / GAP_PER_WIDTH_RATIO)\r\n                : baseHalfGap;\r\n            const leftGap = halfGap;\r\n            const rightGap = halfGap;\r\n            const boundWidth = Math.max(headTextWidth, footTextWidth);\r\n            const lostLeftWidth = getLostLeftWidth(currentRightGap, leftGap);\r\n\r\n            currentRightGap = rightGap;\r\n            totalWidth += boundWidth - lostLeftWidth;\r\n            spaceCount += 1;\r\n\r\n            if (isLeftmostFragment) {\r\n                offsetable = true;\r\n                leftMostGap = leftGap;\r\n                leftMostLetter = footText[0];\r\n            }\r\n        }\r\n        /** Process whole word. Because the font has contextual kerning, the width when we draw the whole word will be different compare to the width when we draw each letter next to each other, sometimes the different may become noticeable (for example in the word \"AWA\", there is a very noticeable distance between these letters), so we try to simulate that behavior. */\r\n        else if (WholeWordRegex.test(fragment)) {\r\n            /** Whole word may have their own spacing ratio */\r\n            const normalizedWordSpacingRatio = wordLetterSpacing\r\n                ? 1 + wordLetterSpacing / 2\r\n                : letterSpacingRatio;\r\n            ctx.letterSpacing = `${(normalizedWordSpacingRatio - 1) * currentFont.getFontInfo().sizeAsNumber}px`;\r\n\r\n            let remainFragment = fragment;\r\n            let fragmentWidth = 0;\r\n            /** A simple algorithm to simulate contextual kerning, for each letter, we do these steps:\r\n             * * Split the current word into two part: The first letter and the rest of the word.\r\n             * * Calculate the width of a letter, then calculate the width of the remaining word.\r\n             * * By subtract them, we will have the actual width of a letter, when put into the word and affected by contextual kerning.\r\n             */\r\n            while (remainFragment !== '') {\r\n                let currentLetter = remainFragment[0];\r\n                let nextRemainFragment = remainFragment.slice(1);\r\n                let actualLetterWidth = ctx.measureText(remainFragment).width - ctx.measureText(nextRemainFragment).width;\r\n                /** Square brackets (\"[\" and \"]\") may have different scaling */\r\n                if (SquareBracketLetterRegex.test(currentLetter)) {\r\n                    applyScale(squareBracketRatio);\r\n                    actualLetterWidth = ctx.measureText(remainFragment).width - ctx.measureText(nextRemainFragment).width;\r\n                    reverseScale(squareBracketRatio);\r\n                }\r\n                /** Captial letters may have different scaling */\r\n                else if (CapitalLetterRegex.test(currentLetter)) {\r\n                    applyScale(capitalLetterRatio);\r\n                    actualLetterWidth = ctx.measureText(remainFragment).width - ctx.measureText(nextRemainFragment).width;\r\n                    reverseScale(capitalLetterRatio);\r\n                }\r\n                /** Number letters may use different font, for the sake of simplicity, we assume that the font does not affect (too much) to the letter's width. In short, we assume that the letter \"8\" in font X have the same width with the letter \"8\" in font Y, just different shape. */\r\n                else if (NumberRegex.test(currentLetter)) {\r\n                    applyNumberFont();\r\n                    actualLetterWidth = ctx.measureText(remainFragment).width - ctx.measureText(nextRemainFragment).width;\r\n                    stopApplyNumberFont();\r\n                }\r\n                /** Special symbol in TCG card (\"Evil☆Twin\") may use different font, again we assume the letter have similar size. */\r\n                else if (TCGSpecialLetterRegex.test(currentLetter) && fontStyle === 'tcg') {\r\n                    applySymbolFont();\r\n                    actualLetterWidth = ctx.measureText(remainFragment).width - ctx.measureText(nextRemainFragment).width;\r\n                    stopApplySymbolFont();\r\n                }\r\n                /** No special treatment for the usual letters */\r\n                else {\r\n                    actualLetterWidth = ctx.measureText(remainFragment).width - ctx.measureText(nextRemainFragment).width;\r\n                }\r\n                fragmentWidth += actualLetterWidth;\r\n                remainFragment = nextRemainFragment;\r\n            }\r\n\r\n            const leftGap = Math.max(defaultGap, fragmentWidth / GAP_PER_WIDTH_RATIO);\r\n            const rightGap = leftGap;\r\n            const lostLeftWidth = getLostLeftWidth(currentRightGap, leftGap);\r\n\r\n            totalWidth += fragmentWidth - lostLeftWidth;\r\n            currentRightGap = rightGap;\r\n\r\n            if (isLeftmostFragment) {\r\n                leftMostGap = leftGap;\r\n                leftMostLetter = fragment[0];\r\n            }\r\n            ctx.letterSpacing = '0px';\r\n        }\r\n        /** Special symbol in TCG card (\"Evil☆Twin\") may use different font */\r\n        else if (TCGSpecialLetterRegex.test(fragment) && fontStyle === 'tcg') {\r\n            applySymbolFont();\r\n            const fragmentWidth = ctx.measureText(fragment).width * letterSpacingRatio;\r\n            stopApplySymbolFont();\r\n\r\n            const leftGap = Math.max(defaultGap, fragmentWidth / GAP_PER_WIDTH_RATIO);\r\n            const rightGap = leftGap;\r\n            const lostLeftWidth = getLostLeftWidth(currentRightGap, leftGap);\r\n\r\n            totalWidth += fragmentWidth - lostLeftWidth;\r\n            currentRightGap = rightGap;\r\n\r\n            if (isLeftmostFragment) {\r\n                leftMostGap = leftGap;\r\n                leftMostLetter = fragment[0];\r\n            }\r\n        }\r\n        else {\r\n            const { boundWidth } = getLetterWidth({ ctx, letter: fragment, isLastOfLine, fontStyle, metricMethod, xRatio });\r\n            const fragmentWidth = boundWidth * letterSpacingRatio;\r\n            const leftGap = Math.max(defaultGap, fragmentWidth / GAP_PER_WIDTH_RATIO);\r\n            const rightGap = leftGap;\r\n            const lostLeftWidth = getLostLeftWidth(currentRightGap, leftGap);\r\n\r\n            totalWidth += fragmentWidth - lostLeftWidth;\r\n            currentRightGap = rightGap;\r\n            if (\r\n                (format === 'ocg' || (format === 'tcg' && /\\s+/.test(fragment)))\r\n                && NoSpaceRegex.test(fragment) === false\r\n            ) {\r\n                spaceCount += 1;\r\n                if (cnt === fragmentList.length - 1) spaceAtEnd = true;\r\n            }\r\n            if (isLeftmostFragment) {\r\n                leftMostGap = leftGap;\r\n                leftMostLetter = fragment[0];\r\n            }\r\n            if (OCGNoOverheadGapRegex.test(fragment)) {\r\n                leftMostGap = 0;\r\n                currentRightGap = 0;\r\n            }\r\n        }\r\n    }\r\n\r\n    return {\r\n        totalWidth,\r\n        spaceCount,\r\n        spaceAtEnd,\r\n        leftMostLetter,\r\n        rightGap: currentRightGap,\r\n        leftGap: leftMostGap,\r\n        offsetable,\r\n    };\r\n};\r\n\r\n/**\r\n * Analyze a line again after we split it with suitable ratio. Text in line are justify-aligned, so we will calculate the sum of width of all tokens, then distribute the remaining space to the amount of whitespaces in the line, that means each whitespace will have additional width add into them so that the line fit perfectly into the available space.\r\n * \r\n * Special treatment for last line of a paragraph, because the last line may not be filled entirely unlike all the lines above, we will decide a threshold for them, if the remaining space is too large, we do not distribute them and just left the line as-is.\r\n */\r\nexport const analyzeLine = ({\r\n    ctx,\r\n    line,\r\n    width,\r\n    xRatio: baseXRatio,\r\n    format,\r\n    isLast,\r\n    textData,\r\n}: {\r\n    ctx: CanvasRenderingContext2D,\r\n    line: string,\r\n    width: number,\r\n    xRatio: number,\r\n    format: string,\r\n    isLast: boolean,\r\n    textData: TextData,\r\n}) => {\r\n    const tokenList = tokenizeText(line);\r\n    let totalContentWidth = 0;\r\n    let lineSpaceCount = 0;\r\n    let currentGap = 0;\r\n\r\n    for (let cnt = 0, xRatio = baseXRatio; cnt < tokenList.length; cnt++) {\r\n        const token = tokenList[cnt];\r\n        const nextToken = tokenList[cnt + 1];\r\n        /** Non-compressable mode */\r\n        if (token === NB_UNCOMPRESSED_START) {\r\n            xRatio = 1;\r\n            continue;\r\n        }\r\n        else if (token === NB_UNCOMPRESSED_END) {\r\n            xRatio = baseXRatio;\r\n            continue;\r\n        }\r\n        const {\r\n            spaceCount,\r\n            totalWidth,\r\n            spaceAtEnd,\r\n            leftGap,\r\n            rightGap,\r\n            leftMostLetter,\r\n        } = analyzeToken({ ctx, token, nextToken, xRatio, previousTokenGap: currentGap / xRatio, textData, format });\r\n        /** Check `createLineList` function about first token indentation. */\r\n        const indent = (\r\n            (cnt === 0 && leftGap > 0 ? Math.min(MAX_LINE_REVERSE_INDENT, leftGap * xRatio) * -1 : 0)\r\n            +\r\n            (cnt === 0 && OCGAlphabetRegex.test(leftMostLetter) ? START_OF_LINE_ALPHABET_OFFSET * xRatio : 0)\r\n        );\r\n\r\n        currentGap = rightGap * xRatio;\r\n        totalContentWidth += totalWidth * xRatio + indent;\r\n        lineSpaceCount += spaceCount - (spaceAtEnd && nextToken === undefined ? 1 : 0);\r\n    }\r\n    const expectedSpaceWidth = lineSpaceCount > 0 ? (width - totalContentWidth) / lineSpaceCount : 0;\r\n    const spaceWidth = isLast\r\n        ? format === 'tcg'\r\n            ? expectedSpaceWidth > 1.500 ? 0 : expectedSpaceWidth\r\n            : expectedSpaceWidth > 3.650 ? 0 : expectedSpaceWidth\r\n        : expectedSpaceWidth;\r\n\r\n    return {\r\n        tokenList,\r\n        spaceWidth,\r\n    };\r\n};","import {\r\n    OCGAlphabetRegex,\r\n    MAX_LINE_REVERSE_INDENT,\r\n    START_OF_LINE_ALPHABET_OFFSET,\r\n    TextData,\r\n    NB_UNCOMPRESSED_END,\r\n    NB_UNCOMPRESSED_START,\r\n} from 'src/model';\r\nimport { tokenizeText } from './text-util';\r\nimport { analyzeToken } from './text-analyze';\r\n\r\n/** Turn a paragraph into a list of lines with provided ratio (median). Basically we test with some ratio until reach a desirable list. Each line contains the information about its content, its actual width and whether or not it is the last line of a paragraph. Easy to see that actual width of all tokens on a line is always smaller or equal to the hypothesis width of the line. */\r\nexport const createLineList = ({\r\n    ctx,\r\n    median,\r\n    paragraphList,\r\n    additionalLineCount = 0,\r\n    width,\r\n    format,\r\n    textData,\r\n}: {\r\n    ctx: CanvasRenderingContext2D,\r\n    median: number,\r\n    width: number,\r\n    paragraphList: string[],\r\n    additionalLineCount?: number,\r\n    format: string,\r\n    textData: TextData,\r\n}) => {\r\n    const { fontData, fontLevel } = textData;\r\n    const { letterSpacing } = fontData.fontList[fontLevel];\r\n    const currentLineList: { line: string, isLast: boolean, effectiveMedian: number, actualLineWidth: number }[] = [];\r\n    const currentLineCount = paragraphList.reduce((accumulatedLineCount, curr) => {\r\n        // Calculate hypothesis canvas width with the provided median ratio\r\n        const baseXRatio = (median <= 100 ? 100 : median) / 1000;\r\n        const scaledWidth = width / baseXRatio;\r\n        const tokenList = tokenizeText(curr, true);\r\n        let addedLineCount = 1;\r\n        let wordList: string[] = [];\r\n        let currentLineWidth = 0;\r\n        let currentGap = 0;\r\n        let unCompressedFlag = 0;\r\n\r\n        for (let cnt = 0, xRatio = baseXRatio; cnt < tokenList.length; cnt++) {\r\n            const token = tokenList[cnt];\r\n            const nextToken = tokenList[cnt + 1];\r\n            /** Because NB_UNCOMPRESS control letters may affect multiple lines, but we want to reduce the dependencies between each line as much as possible (in other words, each line should not know about the line below or above it).\r\n             * To solve this, we will automatically add a NB_UNCOMPRESS_END letter to the end of a sentence, if it has an unclosed NB_UNCOMPRESS_START letter somewhere. Then we will add a NB_UNCOMPRESS_START letter immediately at the start of the next line.\r\n             * Control letters do not get draw so this will not affect the calculation result.\r\n             */\r\n            if (token === NB_UNCOMPRESSED_START) {\r\n                unCompressedFlag += 1;\r\n                xRatio = 1;\r\n            } else if (token === NB_UNCOMPRESSED_END) {\r\n                unCompressedFlag -= 1;\r\n                xRatio = baseXRatio;\r\n            }\r\n            let {\r\n                leftMostLetter,\r\n                totalWidth,\r\n                rightGap,\r\n                leftGap,\r\n            } = analyzeToken({ ctx, token, nextToken, xRatio, previousTokenGap: currentGap, format, letterSpacing, textData });\r\n\r\n            /** First token of a line may have the head text overflow to the left of the paragraph. On one hand we ensure that the foot text of that token does not overflow, on the other hand we also ensure that the head text cannot overflow too far so it overlap with the section's border (if any).\r\n             */\r\n            const indent = cnt === 0\r\n                ? (leftGap > 0 ? Math.min(MAX_LINE_REVERSE_INDENT / xRatio, leftGap) * -1 : 0)\r\n                    + (OCGAlphabetRegex.test(leftMostLetter) ? START_OF_LINE_ALPHABET_OFFSET : 0)\r\n                : 0;\r\n            let tokenWidth = totalWidth / (unCompressedFlag > 0 ? baseXRatio : 1) + indent;\r\n            /** Last token is not allowed to become overflow (no known cases said otherwise). */\r\n            if (currentLineWidth + tokenWidth > scaledWidth) {\r\n                let line = wordList.join('').trim();\r\n                if (unCompressedFlag > 0) line = line + NB_UNCOMPRESSED_END;\r\n                if (unCompressedFlag < 0) line = NB_UNCOMPRESSED_START + line;\r\n                unCompressedFlag = 0;\r\n                currentLineList.push({\r\n                    line,\r\n                    effectiveMedian: median,\r\n                    isLast: false,\r\n                    actualLineWidth: currentLineWidth,\r\n                });\r\n                /** If the next token is gonna made the line become overflow, we will create a new line with it becoming the first token. We also re-calulate the width of that token since now the right side of it is not the \"previous token\" anymore, but the edge of a new line. */\r\n                let {\r\n                    totalWidth,\r\n                    rightGap,\r\n                    leftGap,\r\n                } = analyzeToken({ ctx, token, nextToken, xRatio, previousTokenGap: 0, format, textData });\r\n                /** Of course we also re-calculate overflow possibility. */\r\n                const indent = (leftGap > 0 ? Math.min(MAX_LINE_REVERSE_INDENT / xRatio, leftGap) * -1 : 0)\r\n                    + (OCGAlphabetRegex.test(leftMostLetter) ? START_OF_LINE_ALPHABET_OFFSET : 0);\r\n                let tokenWidth = totalWidth + indent;\r\n                currentLineWidth = tokenWidth;\r\n                currentGap = rightGap;\r\n                wordList = [token];\r\n                addedLineCount += 1;\r\n            } else {\r\n                currentLineWidth += tokenWidth;\r\n                currentGap = rightGap;\r\n                wordList.push(token);\r\n            }\r\n        }\r\n\r\n        /** If no more tokens left in the sentence, wrap them into the last line. */\r\n        let line = wordList.join('').trim();\r\n        if (unCompressedFlag > 0) line = line + NB_UNCOMPRESSED_END;\r\n        if (unCompressedFlag < 0) line = NB_UNCOMPRESSED_START + line;\r\n        unCompressedFlag = 0;\r\n        currentLineList.push({\r\n            line,\r\n            effectiveMedian: median,\r\n            isLast: true,\r\n            actualLineWidth: currentLineWidth,\r\n        });\r\n\r\n        return accumulatedLineCount + addedLineCount;\r\n    }, 0) + (additionalLineCount ?? 0);\r\n\r\n    return { currentLineList, currentLineCount };\r\n};","import {\r\n    analyzeHeadText,\r\n    getTextWorker,\r\n} from './text-util';\r\nimport { getLetterWidth } from './letter';\r\nimport { GAP_PADDING_RATIO, RUBY_BONUS_RATIO } from 'src/model';\r\n\r\n/** Fill head text, by furigana rules, they have their own scaling space so they do not necessarily respect current ratio of the foot text. This function receive true coordinations.\r\n * \r\n * Head text has four cases of compression:\r\n * * Case 1: They do not condense at all, this is the default case for single-letter foot text.\r\n * * Case 2: They condense with a smaller rate compare to foot text, this is the default case for multiple-letters foot text.\r\n * * Case 3: They condense because the head text is way wider than the foot text, especially in the case of single-letter foot text.\r\n * * Case 4: They condense because overflow mode is explicitly set to `condense` by compressable ruby syntax. This prevent them from growth out of foot text's boundary, and has the highest priority, but only apply in the case of multiple-letters foot text.\r\n*/\r\nexport const fillHeadText = ({\r\n    ctx,\r\n    fontSize,\r\n    edge, baseline,\r\n    headText, headTextLetterWidth,\r\n    footText, footTextWidth,\r\n    headTextGap,\r\n    headTextSpacing,\r\n    headTextHeightRatio,\r\n    xRatio,\r\n    fontStyle,\r\n    textWorker,\r\n    fitFootText,\r\n    headTextOverflow,\r\n}: {\r\n    ctx: CanvasRenderingContext2D,\r\n    fontSize: number,\r\n    headText: string, headTextLetterWidth: number,\r\n    footText: string, footTextWidth: number,\r\n    edge: number, baseline: number,\r\n    headTextGap: number,\r\n    headTextSpacing: number,\r\n    headTextHeightRatio: number,\r\n    xRatio: number,\r\n    fontStyle: string,\r\n    textWorker: ReturnType<typeof getTextWorker>,\r\n    fitFootText: boolean,\r\n    headTextOverflow: 'normal' | 'condense',\r\n}) => {\r\n    const { applyFuriganaFont, stopApplyFuriganaFont, resetScale, applyScale } = textWorker;\r\n    /** Custom ratio for case 2 */\r\n    const externalHeadTextXRatio = (headTextOverflow === 'condense' && footText.length > 1)\r\n        ? Math.min(1, xRatio + RUBY_BONUS_RATIO)\r\n        : 0;\r\n    const {\r\n        gapPadding,\r\n        letterSpacing,\r\n        trueHeadTextWidth,\r\n        halfGap,\r\n        alignment,\r\n        headTextXRatio,\r\n    } = analyzeHeadText({\r\n        headText, headTextLetterWidth,\r\n        footText, footTextWidth: footTextWidth * xRatio,\r\n        headTextGap, headTextSpacing: headTextSpacing * xRatio,\r\n        gapPadding: fontSize * GAP_PADDING_RATIO,\r\n        fitFootText,\r\n        sentenceXRatio: xRatio,\r\n        xRatio: externalHeadTextXRatio,\r\n    });\r\n    const overflow = trueHeadTextWidth > footTextWidth * xRatio;\r\n\r\n    if (headText.length === 0) return {\r\n        trueHeadTextWidth,\r\n        halfGap,\r\n    };\r\n\r\n    /** Custom ratio for case 4 */\r\n    const baseLoneTokenRatio = fitFootText\r\n        ? Math.min(1, footTextWidth * xRatio / trueHeadTextWidth)\r\n        : 1;\r\n\r\n    /** Priority: Case 4 => Case 3 and 2, in practice, case 2 and 3 are usually mutual exclusive, because case 2 currently only apply in card's name, while all case 3 only happens in card's effect. */\r\n    const finalizedRatio = fitFootText\r\n        ? baseLoneTokenRatio\r\n        : (externalHeadTextXRatio && alignment === 'center')\r\n            ? externalHeadTextXRatio\r\n            : headTextXRatio;\r\n\r\n    let currentEdge = edge;\r\n    resetScale();\r\n    if (fitFootText || finalizedRatio) {\r\n        applyScale(finalizedRatio, 1);\r\n        currentEdge = edge / finalizedRatio;\r\n    }\r\n\r\n    if (alignment === 'center') {\r\n        currentEdge += gapPadding;\r\n        /** Adjust head text's drawing position to fit case. */\r\n        if (!overflow) {\r\n            currentEdge += (footTextWidth * xRatio - trueHeadTextWidth) / 2;\r\n        } else if (finalizedRatio > baseLoneTokenRatio) {\r\n            currentEdge += (footTextWidth * xRatio / finalizedRatio - trueHeadTextWidth) / 2 / finalizedRatio;\r\n        }\r\n    } else {\r\n        currentEdge += letterSpacing / 2;\r\n    }\r\n\r\n    for (const letter of headText) {\r\n        /** `getLetterWidth` does not run properly in the case of bold font, so we must turn it off when calculating text width, before turn in on again and draw the actual text. */\r\n        applyFuriganaFont();\r\n        const { width, boundWidth } = getLetterWidth({ ctx, letter, fontStyle, metricMethod: 'furigana', xRatio: 1 });\r\n        const boundingOffset = (width - boundWidth) / 2;\r\n        stopApplyFuriganaFont();\r\n\r\n        applyFuriganaFont(true);\r\n        ctx.fillText(letter, currentEdge - boundingOffset, baseline - fontSize * headTextHeightRatio);\r\n        stopApplyFuriganaFont();\r\n        currentEdge += (boundWidth + letterSpacing);\r\n    }\r\n    if (fitFootText || finalizedRatio) {\r\n        resetScale();\r\n    }\r\n    applyScale(xRatio, 1);\r\n\r\n    return {\r\n        trueHeadTextWidth,\r\n        halfGap,\r\n    };\r\n};","import {\r\n    BULLET_LETTER,\r\n    CapitalLetterRegex,\r\n    DefaultFontData,\r\n    DefaultFontSizeData,\r\n    FragmentSplitRegex,\r\n    GAP_PADDING_RATIO,\r\n    LETTER_GAP_RATIO,\r\n    MAX_LINE_REVERSE_INDENT,\r\n    NB_UNCOMPRESSED_END,\r\n    NB_UNCOMPRESSED_START,\r\n    NoSpaceRegex,\r\n    NumberRegex,\r\n    OCGAlphabetRegex,\r\n    OCGNoOverheadGapRegex,\r\n    RUBY_BONUS_RATIO,\r\n    RUBY_REGEX,\r\n    START_OF_LINE_ALPHABET_OFFSET,\r\n    ST_ICON_SYMBOL,\r\n    SquareBracketLetterRegex,\r\n    TCGSpecialLetterRegex,\r\n    TextData,\r\n    WholeWordRegex,\r\n    getBulletSpacing,\r\n} from 'src/model';\r\nimport {\r\n    drawBullet,\r\n    getLostLeftWidth,\r\n    analyzeHeadText,\r\n    getTextWorker,\r\n    tokenizeText,\r\n} from './text-util';\r\nimport { analyzeToken } from './text-analyze';\r\nimport { TextDrawer, drawLetter, getLetterWidth } from './letter';\r\nimport { fillHeadText } from './text-overhead';\r\nimport { drawMarker } from './canvas-util';\r\n\r\n/**\r\n * This is the heart and soul of drawer, please test this thoroughly for each change.\r\n * \r\n * @summary Text hierachy\r\n *   * Letter: Individual (1) letter. E.g. \"a\", \"1\", \"み\", \"装\", \"-\", \"①\"\r\n *   * Fragment: Multiple letters with decorate control characters. E.g. \"{無|む}\", \"Damage\"\r\n *   * Token: Multiple fragments with group control characters (NB_WORD_OPEN and NB_WORD_CLOSE) or a whole word, splitted by space or other breakable letters. E.g. \"⦉{相|あい}{手|て}⦊\"\r\n *   * Sentence: Sequence of tokens. E.g. \"Cannot be destroyed by battle or card effects\"\r\n *   * Paragraph: Consecutive sentences without new line characters (\"\\n\").\r\n *   * Block: Whole text in a section.\r\n * \r\n * Line: Line is a special unit, when a sentence hit the end of current text box, it wrap to new line without using the actual new line character. In this case the sentence is broke down into multiple lines. Line can be manully enforced with line control characters (NB_LINE_OPEN and NB_LINE_CLOSE), or created from text split function.\r\n * **/\r\nexport const drawLine = ({\r\n    ctx,\r\n    tokenList,\r\n    trueEdge, trueBaseline,\r\n    spaceWidth = 0,\r\n    xRatio: baseXRatio, yRatio = 1,\r\n    textData,\r\n    format,\r\n    textDrawer,\r\n    debug = false,\r\n}: {\r\n    ctx: CanvasRenderingContext2D,\r\n    format: string,\r\n    tokenList: string[],\r\n    xRatio: number,\r\n    yRatio?: number,\r\n    trueEdge: number,\r\n    trueBaseline: number,\r\n    spaceWidth?: number,\r\n    textData: TextData,\r\n    textDrawer?: TextDrawer,\r\n    debug?: boolean,\r\n}) => {\r\n    const {\r\n        currentFont,\r\n        fontData,\r\n        fontLevel,\r\n    } = textData;\r\n    const fontSizeData = fontData.fontList[fontLevel];\r\n    const {\r\n        headTextFillStyle,\r\n        headTextHeightRatio = DefaultFontData.headTextHeightRatio,\r\n        headTextOverflow = DefaultFontData.headTextOverflow,\r\n        metricMethod,\r\n        fontStyle,\r\n    } = fontData;\r\n    const {\r\n        letterSpacing = DefaultFontSizeData.letterSpacing,\r\n        wordLetterSpacing,\r\n        capitalLetterRatio = DefaultFontSizeData.capitalLetterRatio,\r\n        squareBracketRatio = DefaultFontSizeData.squareBracketRatio,\r\n        fontSize,\r\n        bulletSymbolWidth,\r\n        iconSymbolWidth = bulletSymbolWidth,\r\n        largeSymbolRatio = DefaultFontSizeData.largeSymbolRatio,\r\n        headTextSpacing = DefaultFontSizeData.headTextSpacing,\r\n    } = fontSizeData;\r\n    const textWorker = getTextWorker(ctx, fontData, fontSizeData, currentFont);\r\n    const {\r\n        stopApplyFuriganaFont, applyFuriganaFont,\r\n        stopApplyLargerText, applyLargerText,\r\n        stopApplyNumberFont, applyNumberFont,\r\n        stopApplyOrdinalFont, applyOrdinalFont,\r\n        applyScale, reverseScale,\r\n        applySymbolFont, stopApplySymbolFont,\r\n        applyAsymmetricScale, resetScale,\r\n    } = textWorker;\r\n\r\n    const letterSpacingRatio = 1 + letterSpacing / 2;\r\n    const baseline = trueBaseline / yRatio;\r\n    let previousTokenGap = 0;\r\n    let iconPositionList: { edge: number, size: number, baseline: number }[] = [];\r\n    let previousTokenRebalanceOffset = 0;\r\n    let tokenEdge = trueEdge;\r\n\r\n    /** To reach a acceptable degree of calculation, we usually need to look ahead 1 or 2 next tokens, same with fragments. */\r\n    /** To prevent cascading calculation, we disconnect the relationship between fragments and tokens. We use all information to calculate an empty space for each token, then fragments of that token is drawn inside that empty space assuming they would fit. In other words, drawing fragments of a token DOES NOT interfere with the next token. That means in theory we can skip all fragments of a token to draw the next token right away.\r\n     */\r\n    for (let tokenCnt = 0, xRatio = baseXRatio; tokenCnt < tokenList.length; tokenCnt++) {\r\n        const token = tokenList[tokenCnt];\r\n        /** Turn on/off non-condenseable mode */\r\n        if (token === NB_UNCOMPRESSED_START) {\r\n            xRatio = 1;\r\n            ctx.setTransform(1, 0, 0, 1, 0, 0);\r\n            continue;\r\n        }\r\n        else if (token === NB_UNCOMPRESSED_END) {\r\n            xRatio = baseXRatio;\r\n            ctx.scale(xRatio, 1);\r\n            continue;\r\n        }\r\n        const gapRatio = LETTER_GAP_RATIO * xRatio;\r\n        const defaultGap = fontSize * gapRatio;\r\n        const nextToken = tokenList[tokenCnt + 1];\r\n        const next2ndToken = tokenList[tokenCnt + 2];\r\n        const analyzeTokenParameter = {\r\n            ctx,\r\n            xRatio,\r\n            letterSpacing,\r\n            format,\r\n            textData,\r\n        };\r\n        const drawLetterParameter = {\r\n            ctx,\r\n            baseline,\r\n            xRatio,\r\n            textDrawer,\r\n        };\r\n        const fragmentList = token.split(FragmentSplitRegex).filter(entry => entry != null && entry !== '');\r\n        /** Analyze current token again, this will dictate the width of a token, no matter what is actually drawn. We expect to draw nothing but the calculation must stay correct. */\r\n        const {\r\n            leftMostLetter,\r\n            leftGap,\r\n            rightGap: tokenRightGap,\r\n            totalWidth: totalTokenWidth,\r\n            spaceCount,\r\n        } = analyzeToken({\r\n            token, nextToken, previousTokenGap: previousTokenGap / xRatio, ...analyzeTokenParameter,\r\n        });\r\n\r\n        /** Again, first token indentation. */\r\n        const indent = tokenCnt === 0\r\n            ? (leftGap > 0 ? Math.min(MAX_LINE_REVERSE_INDENT, leftGap * xRatio) * -1 : 0)\r\n                + (OCGAlphabetRegex.test(leftMostLetter) ? START_OF_LINE_ALPHABET_OFFSET : 0)\r\n            : 0;\r\n        let fragmentEdge = tokenEdge + indent;\r\n        let currentRightGap = previousTokenGap;\r\n\r\n        /** Draw all the fragments of a token. */\r\n        for (let fragmentCnt = 0; fragmentCnt < fragmentList.length; fragmentCnt++) {\r\n            const fragment = fragmentList[fragmentCnt];\r\n            const nextFragment = fragmentList[fragmentCnt + 1] ?? nextToken;\r\n            const next2ndFragment = fragmentList[tokenCnt + 2] ?? next2ndToken;\r\n\r\n            /** These fragments do not have any visual */\r\n            if (token === NB_UNCOMPRESSED_START || token === NB_UNCOMPRESSED_END) {}\r\n            /** We do not actually draw S/T Icon here, but we record its position and leave a suitable space for it. */\r\n            else if (fragment === ST_ICON_SYMBOL) {\r\n                iconPositionList.push({ edge: fragmentEdge, size: iconSymbolWidth, baseline });\r\n                fragmentEdge += iconSymbolWidth * letterSpacingRatio;\r\n                currentRightGap = 0;\r\n                previousTokenRebalanceOffset = 0;\r\n            }\r\n            /** Bullet symbol ● is not condenseable, and has specialized draw worker. */\r\n            else if (fragment === BULLET_LETTER) {\r\n                resetScale();\r\n                drawBullet(ctx, fragmentEdge, trueBaseline, bulletSymbolWidth, getBulletSpacing(format));\r\n                fragmentEdge += bulletSymbolWidth * letterSpacingRatio;\r\n                applyAsymmetricScale(xRatio, yRatio);\r\n\r\n                currentRightGap = 0;\r\n                previousTokenRebalanceOffset = 0;\r\n            }\r\n            /** Copyright symbol © is not condenseable and use larger font. */\r\n            else if (/[©]/.test(fragment)) {\r\n                resetScale();\r\n                applyLargerText(largeSymbolRatio);\r\n                drawLetter({\r\n                    ...drawLetterParameter,\r\n                    letter: fragment,\r\n                    edge: fragmentEdge * xRatio,\r\n                    baseline: trueBaseline + (format === 'tcg' ? 1 : 2),\r\n                });\r\n                fragmentEdge += ctx.measureText(fragment).width * letterSpacingRatio;\r\n                stopApplyLargerText();\r\n                applyAsymmetricScale(xRatio, yRatio);\r\n\r\n                currentRightGap = 0;\r\n                previousTokenRebalanceOffset = 0;\r\n            }\r\n            /** OCG Ordinal symbol is not condenseable and use different font. */\r\n            else if (/[①-⑳]/.test(fragment)) {\r\n                resetScale();\r\n                applyOrdinalFont();\r\n                drawLetter({\r\n                    ...drawLetterParameter,\r\n                    letter: fragment,\r\n                    edge: fragmentEdge * xRatio,\r\n                    baseline: trueBaseline - 2\r\n                });\r\n                fragmentEdge += ctx.measureText(fragment).width * letterSpacingRatio;\r\n                stopApplyOrdinalFont();\r\n                applyAsymmetricScale(xRatio, yRatio);\r\n\r\n                fragmentEdge += spaceWidth;\r\n                currentRightGap = 0;\r\n                previousTokenRebalanceOffset = 0;\r\n            }\r\n            /** Fragment with overhead text. */\r\n            else if (RUBY_REGEX.test(fragment)) {\r\n                const [footText, rubyType, headText = ''] = fragment.replaceAll(/{|}/g, '').split(/(\\|+)/);\r\n                const fitFootText = rubyType === '||';\r\n                /** We do not support nested overhead text. */\r\n                const { totalWidth: footTextWidth } = analyzeToken({\r\n                    token: footText, nextToken: nextFragment,\r\n                    previousTokenGap: 0,\r\n                    ...analyzeTokenParameter,\r\n                });\r\n\r\n                /** Calculate letter width first before deciding the spacing. */\r\n                applyFuriganaFont();\r\n                const headTextLetterWidth = headText\r\n                    .split('')\r\n                    .map(letter => getLetterWidth({ ctx, letter, fontStyle, metricMethod: 'furigana', xRatio: 1 }).boundWidth)\r\n                    .reduce((acc, cur) => acc + cur, 0);\r\n                stopApplyFuriganaFont();\r\n\r\n                /** Notice what is scaled and what is not in those params. It is a headache to work with sometime. */\r\n                const {\r\n                    headTextWidth,\r\n                    halfGap: baseHalfGap,\r\n                } = analyzeHeadText({\r\n                    headText,\r\n                    headTextLetterWidth,\r\n                    footText,\r\n                    footTextWidth: footTextWidth * xRatio,\r\n                    headTextGap: defaultGap,\r\n                    headTextSpacing: headTextSpacing * xRatio,\r\n                    gapPadding: fontSize * GAP_PADDING_RATIO,\r\n                    fitFootText,\r\n                    sentenceXRatio: xRatio,\r\n                    xRatio: (headTextOverflow === 'condense' && footText.length > 1) ? Math.min(1, xRatio + RUBY_BONUS_RATIO) : 0,\r\n                });\r\n                const halfGap = headText.length === 0\r\n                    ? Math.max(defaultGap, footTextWidth * gapRatio)\r\n                    : baseHalfGap;\r\n                const rightGap = halfGap;\r\n                const leftGap = halfGap;\r\n                /** Lost left width because of negative gap of the previous fragment OR token */\r\n                const lostLeftWidth = getLostLeftWidth(currentRightGap, leftGap);\r\n                const vacantLeftWidth = leftGap > 0 ? leftGap - lostLeftWidth : 0;\r\n\r\n                const {\r\n                    offsetable: isNextTokenOffsetable,\r\n                    leftGap: nextUncompressedLeftGap\r\n                } = analyzeToken({\r\n                    token: nextFragment, nextToken: next2ndFragment,\r\n                    previousTokenGap: rightGap / xRatio,\r\n                    ...analyzeTokenParameter,\r\n                });\r\n                const nextLeftGap = nextUncompressedLeftGap * xRatio;\r\n                const lostRightWidth = getLostLeftWidth(rightGap, nextLeftGap);\r\n                const vacantRightWidth = rightGap > 0 ? rightGap - lostRightWidth : 0;\r\n                const totalVacantSpace = vacantLeftWidth + vacantRightWidth;\r\n                let rebalancedSpace = 0;\r\n                let nextTokenRebalanceOffset = 0;\r\n\r\n                /** Rebalance tactic here. In essential, we try to calculate the empty space of a fragment. These spaces are because the head text is too long compare to the foot text underneath. Then we divide those spaces in such a way that the foot text has roughly equal space each side so they looks more pleasant. */\r\n                if (totalVacantSpace > 0 && nextLeftGap >= -2 && isNextTokenOffsetable) {\r\n                    rebalancedSpace = (totalVacantSpace + Math.max(nextLeftGap, 0) * 2) / 3;\r\n                    nextTokenRebalanceOffset = Math.max(nextLeftGap, 0) - rebalancedSpace;\r\n                } else {\r\n                    // rebalancedSpace = totalVacantSpace / 2;\r\n                    rebalancedSpace = vacantLeftWidth;\r\n                }\r\n                const footTextFragmentEdge = fragmentEdge\r\n                    + (halfGap < 0 ? -lostLeftWidth : (indent ? -indent : rebalancedSpace))\r\n                    + previousTokenRebalanceOffset;\r\n                previousTokenRebalanceOffset = nextTokenRebalanceOffset;\r\n\r\n                /** Draw actual foot text here */\r\n                drawLine({\r\n                    ctx,\r\n                    format,\r\n                    textData,\r\n                    tokenList: tokenizeText(footText),\r\n                    trueBaseline: baseline,\r\n                    trueEdge: footTextFragmentEdge,\r\n                    xRatio,\r\n                    yRatio,\r\n                    spaceWidth: 0,\r\n                    textDrawer,\r\n                    debug: false,\r\n                });\r\n\r\n                /** Head text may have different text style than foot text, so we store the current style before start drawing head text. */\r\n                const currentFillStyle = ctx.fillStyle;\r\n                const currentStrokeStyle = ctx.strokeStyle;\r\n                const currentShadowColor = ctx.shadowColor;\r\n                const currentShadowOffsetX = ctx.shadowOffsetX;\r\n                const currentShadowOffsetY = ctx.shadowOffsetY;\r\n                const currentShadowBlur = ctx.shadowBlur;\r\n                if (headTextFillStyle) {\r\n                    ctx.fillStyle = headTextFillStyle;\r\n                    ctx.strokeStyle = '';\r\n                    ctx.shadowColor = '';\r\n                    ctx.shadowOffsetX = 0;\r\n                    ctx.shadowOffsetY = 0;\r\n                    ctx.shadowBlur = 0;\r\n                }\r\n                /** Draw head text here, remember head text and foot text most of the time do not align at all. */\r\n                const headTextFragmentEdge = fragmentEdge - lostLeftWidth;\r\n                fillHeadText({\r\n                    ctx,\r\n                    fontSize,\r\n                    edge: headTextFragmentEdge, baseline,\r\n                    headText, headTextLetterWidth,\r\n                    footText, footTextWidth,\r\n                    headTextGap: defaultGap,\r\n                    headTextSpacing,\r\n                    headTextHeightRatio,\r\n                    xRatio,\r\n                    fontStyle,\r\n                    textWorker,\r\n                    fitFootText,\r\n                    headTextOverflow,\r\n                });\r\n                /** Restore foot text's original style */\r\n                ctx.fillStyle = currentFillStyle;\r\n                ctx.strokeStyle = currentStrokeStyle;\r\n                ctx.shadowColor = currentShadowColor;\r\n                ctx.shadowOffsetX = currentShadowOffsetX;\r\n                ctx.shadowOffsetY = currentShadowOffsetY;\r\n                ctx.shadowBlur = currentShadowBlur;\r\n\r\n                fragmentEdge += Math.max(footTextWidth * xRatio, headTextWidth) - lostLeftWidth + spaceWidth;\r\n                currentRightGap = rightGap;\r\n            }\r\n            /** Draw \"whole words\". */\r\n            else if (WholeWordRegex.test(fragment)) {\r\n                const normalizedWordSpacingRatio = wordLetterSpacing\r\n                    ? 1 + wordLetterSpacing / 2\r\n                    : letterSpacingRatio;\r\n                ctx.letterSpacing = `${(normalizedWordSpacingRatio - 1) * currentFont.getFontInfo().sizeAsNumber}px`;\r\n\r\n                /**\r\n                 * A problem here: We cannot calculate the gap of a fragment unless knowing its actual width, so that means we must calculate it first, then calculate the gap, then go back and calculate the actual width all over again when we draw. These are doable but it make this ugly long code become needlessly more ugly and long. So we just naively measure the word without any kind of special treatment, take the gap based on it and call it a day.\r\n                 * \r\n                 * Even if the actual width of the fragment is different than when we measure it naively, the gap ratio itself have a bit of room for error (around 40% when maximum is 50%), so most of the time we can avoid any overlap unless in extreme condensing situation.\r\n                 */\r\n                const fragmentNaiveWidth = ctx.measureText(fragment).width * xRatio;\r\n                const leftGap = Math.max(defaultGap, fragmentNaiveWidth * gapRatio);\r\n                const rightGap = leftGap;\r\n                const lostLeftWidth = getLostLeftWidth(currentRightGap, leftGap);\r\n                fragmentEdge -= lostLeftWidth;\r\n\r\n                /** Read the comment in `analyzeToken` function, we repeat exactly the treatment there, the different is we actually draw the letter along the way. */\r\n                let remainFragment = fragment;\r\n                let currentPosition = fragmentEdge;\r\n                while (remainFragment !== '') {\r\n                    let currentLetter = remainFragment[0];\r\n                    let nextRemainFragment = remainFragment.slice(1);\r\n                    let actualLetterWidth = 0;\r\n                    const drawLetterofWordParameter = { ...drawLetterParameter, letter: currentLetter, edge: currentPosition };\r\n                    if (SquareBracketLetterRegex.test(currentLetter)) {\r\n                        applyScale(squareBracketRatio);\r\n                        actualLetterWidth = ctx.measureText(remainFragment).width - ctx.measureText(nextRemainFragment).width;\r\n                        drawLetter({\r\n                            ...drawLetterofWordParameter,\r\n                            edge: currentPosition / squareBracketRatio,\r\n                            baseline: baseline / squareBracketRatio,\r\n                        });\r\n                        reverseScale(squareBracketRatio);\r\n                    } else if (CapitalLetterRegex.test(currentLetter)) {\r\n                        applyScale(capitalLetterRatio);\r\n                        actualLetterWidth = ctx.measureText(remainFragment).width - ctx.measureText(nextRemainFragment).width;\r\n                        const letterOffset = (actualLetterWidth > ctx.measureText(currentLetter).width * capitalLetterRatio)\r\n                            ? Math.round(actualLetterWidth * (1 - capitalLetterRatio)) / 2\r\n                            : 0;\r\n                        drawLetter({\r\n                            ...drawLetterofWordParameter,\r\n                            edge: currentPosition / capitalLetterRatio + letterOffset,\r\n                            baseline: baseline / capitalLetterRatio\r\n                        });\r\n                        reverseScale(capitalLetterRatio);\r\n                    } else if (NumberRegex.test(currentLetter)) {\r\n                        applyNumberFont();\r\n                        actualLetterWidth = ctx.measureText(remainFragment).width - ctx.measureText(nextRemainFragment).width;\r\n                        drawLetter(drawLetterofWordParameter);\r\n                        stopApplyNumberFont();\r\n                    } else if (TCGSpecialLetterRegex.test(currentLetter) && fontStyle === 'tcg') {\r\n                        applySymbolFont();\r\n                        actualLetterWidth = ctx.measureText(remainFragment).width - ctx.measureText(nextRemainFragment).width;\r\n                        drawLetter(drawLetterofWordParameter);\r\n                        stopApplySymbolFont();\r\n                    } else {\r\n                        actualLetterWidth = ctx.measureText(remainFragment).width - ctx.measureText(nextRemainFragment).width;\r\n                        drawLetter(drawLetterofWordParameter);\r\n                    }\r\n                    currentPosition += actualLetterWidth * xRatio;\r\n                    remainFragment = nextRemainFragment;\r\n                }\r\n\r\n                fragmentEdge = currentPosition;\r\n                currentRightGap = rightGap;\r\n                previousTokenRebalanceOffset = 0;\r\n                ctx.letterSpacing = '0px';\r\n            }\r\n            /** Some specific letter (\"Evil★Twin's Trouble Sunny\" TCG) requires different font. */\r\n            else if (TCGSpecialLetterRegex.test(fragment) && fontStyle === 'tcg') {\r\n                const letter = fragment;\r\n                applySymbolFont();\r\n\r\n                const letterWidth = ctx.measureText(letter).width * letterSpacingRatio * xRatio;\r\n                const leftGap = Math.max(defaultGap, letterWidth * gapRatio);\r\n                const rightGap = leftGap;\r\n                const lostLeftWidth = getLostLeftWidth(currentRightGap, leftGap);\r\n\r\n                fragmentEdge -= lostLeftWidth;\r\n                drawLetter({ ...drawLetterParameter, letter, edge: fragmentEdge });\r\n                fragmentEdge += letterWidth;\r\n\r\n                stopApplySymbolFont();\r\n\r\n                currentRightGap = rightGap;\r\n                previousTokenRebalanceOffset = 0;\r\n            }\r\n            /** All other fragments */\r\n            else {\r\n                const letter = fragment;\r\n                const letterMetric = getLetterWidth({\r\n                    ctx,\r\n                    letter,\r\n                    fontStyle,\r\n                    metricMethod,\r\n                    isLastOfLine: nextFragment === undefined,\r\n                    xRatio,\r\n                });\r\n                const letterWidth = letterMetric.boundWidth * letterSpacingRatio * xRatio;\r\n                const leftGap = Math.max(defaultGap, letterWidth * gapRatio);\r\n                const rightGap = leftGap;\r\n                const lostLeftWidth = getLostLeftWidth(currentRightGap, leftGap);\r\n\r\n                fragmentEdge -= lostLeftWidth;\r\n                drawLetter({ ...drawLetterParameter, letter, edge: fragmentEdge, letterMetric });\r\n                fragmentEdge += letterWidth;\r\n                if (\r\n                    (format === 'ocg' || (format === 'tcg' && /\\s+/.test(letter)))\r\n                    && NoSpaceRegex.test(letter) !== true\r\n                ) {\r\n                    fragmentEdge += spaceWidth;\r\n                }\r\n                if (!OCGNoOverheadGapRegex.test(letter)) currentRightGap = rightGap;\r\n                previousTokenRebalanceOffset = 0;\r\n            }\r\n        }\r\n\r\n        /** Make space for the next token, as we can see it does not involve any variables from the fragment drawing process. */\r\n        previousTokenGap = tokenRightGap * xRatio;\r\n        if (debug) drawMarker({ ctx, baseline, edge: tokenEdge, width: totalTokenWidth * xRatio, xRatio });\r\n        tokenEdge += totalTokenWidth * xRatio + spaceCount * spaceWidth + indent;\r\n    }\r\n\r\n    return {\r\n        tokenEdge,\r\n        iconPositionList,\r\n    };\r\n};","import {\r\n    NB_LINE_OPEN,\r\n    NB_LINE_CLOSE,\r\n    OCG_RUBY_SOURCE,\r\n    OCG_KEYWORD_SOURCE,\r\n    ocgKeywordDataMap,\r\n    WHOLE_WORD_SOURCE,\r\n    NOT_END_OF_LINE_SOURCE,\r\n    NOT_START_OF_LINE_SOURCE,\r\n    NOT_SPLIT_SOURCE,\r\n    OCG_BULLET_SOURCE,\r\n    tcgToOCGLetterMap,\r\n    ocgToTCGLetterMap,\r\n    UNCOMPRESSED_SOURCE,\r\n    ocgNumberCircleMap,\r\n    NB_WORD_OPEN,\r\n    NB_WORD_CLOSE,\r\n    FLAVOR_CONDITION_SOURCE,\r\n    NB_UNCOMPRESSED_START,\r\n    NB_UNCOMPRESSED_END\r\n} from 'src/model';\r\n\r\nexport const splitEffect = (effect: string, isNormal = false) => {\r\n    let effectText = effect;\r\n\r\n    let fullLineList = [];\r\n    const wholeLineRegex = new RegExp(`^(${NB_LINE_OPEN}([^${NB_LINE_CLOSE}]*)${NB_LINE_CLOSE}\\\\s*)`);\r\n    let materialReplacement;\r\n    let material;\r\n    do {\r\n        materialReplacement = wholeLineRegex.exec(effectText)?.[1];\r\n        material = wholeLineRegex.exec(effectText)?.[2];\r\n\r\n        if (material && materialReplacement) {\r\n            fullLineList.push(material);\r\n            effectText = effectText.replace(materialReplacement, '');\r\n        }\r\n    } while (materialReplacement && material);\r\n\r\n    let effectFlavorCondition = '';\r\n    const flavorConditionRegex = new RegExp(FLAVOR_CONDITION_SOURCE, 'm');\r\n    const potentialFlavorConditionText = flavorConditionRegex.exec(effect)?.[1];\r\n    if (potentialFlavorConditionText && isNormal) {\r\n        effectFlavorCondition = potentialFlavorConditionText;\r\n        effectText = effectText.replace(potentialFlavorConditionText, '');\r\n    } else effectFlavorCondition = '';\r\n\r\n    return {\r\n        fullLineList,\r\n        effectText,\r\n        effectFlavorCondition,\r\n    };\r\n};\r\n\r\nexport const normalizeCardText = (\r\n    text: string,\r\n    format: string,\r\n    option?: { multiline?: boolean, furiganaHelper?: boolean, dictionaryType?: 'rubyForm' | 'rubyFormName' },\r\n) => {\r\n    const {\r\n        multiline = true,\r\n        furiganaHelper = true,\r\n        dictionaryType = 'rubyForm',\r\n    } = option ?? {};\r\n    const nonNullableText = text ?? '';\r\n\r\n    /** Normalize the text based on format, by swapping letters to their corresponding form. For example full-width captial A \"Ａ\" will become normal capital \"A\" after normalized. */\r\n    let normalizedText = '';\r\n    let letterSwapMap = format === 'ocg'\r\n        ? tcgToOCGLetterMap\r\n        : ocgToTCGLetterMap;\r\n    for (const letter of nonNullableText) {\r\n        normalizedText += letterSwapMap[letter] ?? letter;\r\n    }\r\n\r\n    /** OCG text sometimes enter new line follow letter \"、\" or \"。\", we will automatically join them. It is debatable whether this feature is need or not. */\r\n    // const textAfterJoinRow = normalizedText.replace(/(､|｡|。|、)\\n(?!●)/g, '$1');\r\n    const textAfterJoinRow = normalizedText;\r\n\r\n    /** Translate non-wrappable line syntax into internal control characters, beware that \"Qliphort Scout\" does use square brackets in its flavor text, so the regex must exclude that case. */\r\n    const textAfterSplitBlockRow = multiline\r\n        ? textAfterJoinRow\r\n            .replace(/^\\[([\\w\\W]*?)\\](?=(\\n|$))/gm, `${NB_LINE_OPEN}$1${NB_LINE_CLOSE}`)\r\n        : textAfterJoinRow;\r\n\r\n    /** Various contextual swaps */\r\n    const textAfterSwapLetter = textAfterSplitBlockRow\r\n        .replace(/(^|[-\\u2014\\s([\"])'/g, '$1\\u2018')        /** Turn straight single quote ' into contextual curly quote ‘ */\r\n        .replace(/'/g, '\\u2019')                            /** Close open curly quote ’ */\r\n        .replace(/(^|[-\\u2014/[(\\u2018\\s])\"/g, '$1\\u201c')  /** Turn straight double quote \" into contextual curly double quote “ */\r\n        .replace(/\"/g, '\\u201d')                            /** Close open curly double quote ” */\r\n        .replace(/--/g, '\\u2014')                           /** Turn double dash \"--\" into em-dash \"—\" */\r\n        .replace(/● /g, '●')                                /** Remove direct whitespace after bullet, bullet have their own fixed space that we will draw later */\r\n        /** Convert ordinal shorthand syntax, for example \"(15)\" will become \"⑮\", used in OCG effect */\r\n        .replace(/(\\([０-９0-9]{1,2}\\))/g, m => {\r\n            const correspondingCircleSymbol = ocgNumberCircleMap[m];\r\n\r\n            return correspondingCircleSymbol ?? m;\r\n        });\r\n\r\n    const textAfterDetectBlockWord = textAfterSwapLetter\r\n        /** Convert non-compressable syntax into internal control characters */\r\n        .replaceAll(new RegExp(UNCOMPRESSED_SOURCE, 'g'), m => m.replaceAll('{{', NB_UNCOMPRESSED_START).replaceAll('}}', NB_UNCOMPRESSED_END))\r\n        /** Convert ruby syntax into internal control characters */\r\n        .replaceAll(new RegExp(OCG_RUBY_SOURCE, 'g'), m => `${NB_WORD_OPEN}${m}${NB_WORD_CLOSE}`);\r\n\r\n    /** Apply dictionary */\r\n    const textAfterDictionaryMatch = format === 'tcg' || furiganaHelper === false\r\n        ? textAfterDetectBlockWord\r\n        : textAfterDetectBlockWord\r\n            .replaceAll(new RegExp(OCG_KEYWORD_SOURCE, 'g'), m => {\r\n                const keywordSubtitue = ocgKeywordDataMap[m][dictionaryType] ?? ocgKeywordDataMap[m].rubyForm;\r\n\r\n                return `${NB_WORD_OPEN}${keywordSubtitue}${NB_WORD_CLOSE}`;\r\n            });\r\n    /** Analyze various typography rules in OCG card (mainly Kinsoku Shorit)\r\n     * * Some letters cannot stand at the start of the line, so they form a block with the token before them.\r\n     * * Some letters cannot stand at the end of a line, so they form a block with the token next to them.\r\n     * * Some letters cannot be splitted into two lines, so they form a block with both tokens around them.\r\n     * * Ordinal letters must always followed by a colon \"：\", and cannot stand at the end of a line.\r\n    */\r\n    const textAfterProcessing = textAfterDictionaryMatch\r\n        .replaceAll(new RegExp(WHOLE_WORD_SOURCE, 'g'), m => `${NB_WORD_OPEN}${m}${NB_WORD_CLOSE}`)\r\n        .replaceAll(new RegExp(NOT_END_OF_LINE_SOURCE, 'g'), m => `${NB_WORD_OPEN}${m}${NB_WORD_CLOSE}`)\r\n        .replaceAll(new RegExp(NOT_START_OF_LINE_SOURCE, 'g'), m => `${NB_WORD_OPEN}${m}${NB_WORD_CLOSE}`)\r\n        .replaceAll(new RegExp(NOT_SPLIT_SOURCE, 'g'), m => `${NB_WORD_OPEN}${m}${NB_WORD_CLOSE}`)\r\n        .replaceAll(new RegExp(OCG_BULLET_SOURCE, 'g'), m => `${NB_WORD_OPEN}${m}${NB_WORD_CLOSE}`);\r\n\r\n    /** Eliminate overlapping group control characters, we perform a simple algorithm to reduce various overlapping forms into non-overlapping ones.\r\n     * * `((()))` => `()`\r\n     * * `(()())` => `()`\r\n     * * `((()()))` => `()`\r\n     * * `()()()` => `()()()`\r\n     */\r\n    let textAfterNormalizeBlockWord = [];\r\n    let currentDepth = 0;\r\n    for (const letter of textAfterProcessing) {\r\n        if (letter === NB_WORD_OPEN) {\r\n            if (currentDepth === 0) textAfterNormalizeBlockWord.push(letter);\r\n            currentDepth += 1;\r\n        } else if (letter === NB_WORD_CLOSE) {\r\n            currentDepth -= 1;\r\n            if (currentDepth === 0) textAfterNormalizeBlockWord.push(letter);\r\n        } else textAfterNormalizeBlockWord.push(letter);\r\n    }\r\n    /** Non-wrappable line syntax has higher priority than non-wrappable word syntax, so we re-arrange control characters to fit such case. */\r\n    const finalizedText = textAfterNormalizeBlockWord.join('')\r\n        .replaceAll(`${NB_LINE_CLOSE}${NB_WORD_CLOSE}`, `${NB_WORD_CLOSE}${NB_LINE_CLOSE}`)\r\n        .replaceAll(`${NB_WORD_OPEN}${NB_LINE_OPEN}`, `${NB_LINE_OPEN}${NB_WORD_OPEN}`)\r\n        .replaceAll(`${NB_UNCOMPRESSED_START}${NB_WORD_CLOSE}`, `${NB_WORD_CLOSE}${NB_UNCOMPRESSED_START}`)\r\n        .replaceAll(`${NB_WORD_OPEN}${NB_UNCOMPRESSED_END}`, `${NB_UNCOMPRESSED_END}${NB_WORD_OPEN}`)\r\n        .replaceAll(`${NB_LINE_OPEN}${NB_LINE_CLOSE}`, '')\r\n        .replaceAll(`${NB_WORD_OPEN}${NB_WORD_CLOSE}`, '');\r\n\r\n    return finalizedText;\r\n};","import {\r\n    CanvasConst,\r\n    CondenseType,\r\n    EffectFontData,\r\n    CoordinateData,\r\n    EffectCoordinateData,\r\n    CondenseTolerantMap,\r\n    FontData,\r\n    TCGVanillaTypeStatFontList,\r\n    DefaultTCGNormalFontData,\r\n} from '../../model';\r\nimport { condense, createFontGetter } from '../../util';\r\nimport { createLineList } from '../line';\r\nimport { drawLine } from '../text';\r\nimport { analyzeLine } from '../text-analyze';\r\nimport { normalizeCardText, splitEffect } from '../text-normalize';\r\nimport { tokenizeText } from '../text-util';\r\n\r\n/** Sections inside effect box (stats and type) will affect the amount of line and applicaable font size use for the text. */\r\nexport const getEffectSizeAndCoordinate = ({\r\n    format,\r\n    isNormal,\r\n    statInEffect,\r\n    typeInEffect,\r\n}: {\r\n    format: string,\r\n    statInEffect: boolean,\r\n    typeInEffect: boolean,\r\n    isNormal: boolean,\r\n}) => {\r\n    const coordinateKey = [format, typeInEffect ? 'type' : '', statInEffect ? 'stat' : '']\r\n        .filter(entry => entry !== '').join('-');\r\n    const fontDataKey = [format, typeInEffect ? 'type' : '', statInEffect ? 'stat' : '']\r\n        .filter(entry => entry !== '').join('-');\r\n\r\n    let fontData = EffectFontData[fontDataKey];\r\n    if (statInEffect && typeInEffect && isNormal && format === 'tcg') {\r\n        fontData = DefaultTCGNormalFontData;\r\n        fontData.fontList = TCGVanillaTypeStatFontList;\r\n    }\r\n\r\n    return {\r\n        fontData,\r\n        sizeList: EffectCoordinateData[coordinateKey],\r\n    };\r\n};\r\n\r\nconst {\r\n    width: CanvasWidth,\r\n} = CanvasConst;\r\nexport const drawEffect = ({\r\n    ctx,\r\n    content,\r\n    isNormal = false,\r\n    fontData = EffectFontData.tcg,\r\n    sizeList = EffectCoordinateData['tcg-type'],\r\n    condenseTolerant = 'strict',\r\n    format,\r\n    furiganaHelper,\r\n}: {\r\n    ctx: CanvasRenderingContext2D | null | undefined,\r\n    content: string,\r\n    isNormal?: boolean,\r\n    fontData?: FontData,\r\n    sizeList?: CoordinateData[],\r\n    condenseTolerant?: CondenseType,\r\n    format: string,\r\n    furiganaHelper: boolean,\r\n}) => {\r\n    let effectSizeLevel = 0;\r\n    if (!ctx || !content) return effectSizeLevel;\r\n\r\n    const normalizedContent = normalizeCardText(content.trim(), format, { furiganaHelper });\r\n    const tolerancePerSentence: Record<string, number> = format === 'tcg'\r\n        ? CondenseTolerantMap[condenseTolerant] ?? CondenseTolerantMap['strict']\r\n        : {\r\n            '1': 800,\r\n            '2': 800,\r\n            '3': 800,\r\n        };\r\n    const {\r\n        effectText,\r\n        effectFlavorCondition,\r\n        fullLineList,\r\n    } = splitEffect(normalizedContent, isNormal);\r\n\r\n    const additionalLineCount = (fullLineList.length ?? 0) + (effectFlavorCondition.length > 0 ? 1 : 0);\r\n    const paragraphList = effectText ? effectText.split('\\n') : [];\r\n\r\n    const { font, fontList } = fontData;\r\n    const yRatio = 1;\r\n    /** We basically go through each font size, then iterating the content multiple time with different condense ratio until the text is both fit inside the max amount of lines AND the ratio is larger than the current limit threshold. */\r\n    while (effectSizeLevel < fontList.length) {\r\n        const fontSizeData = fontList[effectSizeLevel];\r\n        const {\r\n            fontSize,\r\n            lineHeight,\r\n            lineCount,\r\n        } = fontSizeData;\r\n        const {\r\n            trueEdge,\r\n            trueWidth: trueWidthStart,\r\n            trueBaseline: trueBaselineStart,\r\n        } = sizeList[effectSizeLevel] ?? sizeList[sizeList.length - 1];\r\n        const width = (isNormal && format === 'tcg') ? trueWidthStart - 2 : trueWidthStart;\r\n\r\n        const currentFont = createFontGetter();\r\n        ctx.font = currentFont\r\n            .setStyle(isNormal && format === 'tcg' ? 'italic' : '')\r\n            .setWeight(format === 'tcg' ? '' : '')\r\n            .setSize(fontSize)\r\n            .setFamily(font)\r\n            .getFont();\r\n        ctx.textAlign = 'left';\r\n        const textData = {\r\n            fontData,\r\n            fontLevel: effectSizeLevel,\r\n            currentFont,\r\n        };\r\n        // [CREATE SENTENCE ON EACH LINE]\r\n        let lineListWithRatio: { line: string, isLast: boolean, effectiveMedian: number }[] = [];\r\n\r\n        // [FIND SUITABLE CONDENSE RATIO]\r\n        const effectiveMedian = condense(\r\n            median => {\r\n                const { currentLineList, currentLineCount } = createLineList({\r\n                    ctx,\r\n                    median,\r\n                    paragraphList,\r\n                    additionalLineCount,\r\n                    format, textData,\r\n                    width,\r\n                });\r\n                lineListWithRatio = currentLineList;\r\n\r\n                if (currentLineCount > lineCount) return false;\r\n                return true;\r\n            },\r\n            200,\r\n        );\r\n\r\n        // [START DRAWING]\r\n        /** Usually effect only consist of 1 or 2 paragraphs, but in TCG they try to put each bullet clause in a new line, resulting many more. Still we don't know if having different tolerance based on amount of paragraph is correct or not, since it is very hard to survey the condensation of a real card. */\r\n        const tolerantValue = tolerancePerSentence[`${paragraphList.length}`] ?? tolerancePerSentence['3'];\r\n        if (\r\n            (effectiveMedian < tolerantValue)\r\n            && (effectSizeLevel < fontList.length - 1)\r\n        ) {\r\n            effectSizeLevel += 1;\r\n        } else {\r\n            ctx.clearRect(0, 0, CanvasWidth, 1111);\r\n\r\n            let trueBaseline = trueBaselineStart + lineHeight;\r\n            /** Naturally, non-brekable lines have their own condense ratio. */\r\n            const fullLineListWithRatio = fullLineList.map(line => {\r\n                return {\r\n                    line,\r\n                    isLast: true,\r\n                    effectiveMedian: condense(\r\n                        median => {\r\n                            const { currentLineCount } = createLineList({\r\n                                ctx,\r\n                                median,\r\n                                paragraphList: [line],\r\n                                format, textData,\r\n                                width,\r\n                            });\r\n    \r\n                            if (currentLineCount > 1) return false;\r\n                            return true;\r\n                        },\r\n                    )\r\n                };\r\n            });\r\n\r\n            /** Draw each line based on their token list and corresponding ratio. */\r\n            [\r\n                ...fullLineListWithRatio,\r\n                ...lineListWithRatio,\r\n            ].forEach(({\r\n                line,\r\n                isLast,\r\n                effectiveMedian,\r\n            }) => {\r\n                const xRatio = effectiveMedian / 1000;\r\n                const { tokenList, spaceWidth } = analyzeLine({ ctx, line, xRatio, format, isLast, textData, width });\r\n\r\n                ctx.scale(xRatio, yRatio);\r\n                drawLine({\r\n                    ctx,\r\n                    tokenList,\r\n                    xRatio, yRatio,\r\n                    trueEdge, trueBaseline,\r\n                    spaceWidth,\r\n                    textData,\r\n                    format,\r\n                });\r\n                trueBaseline += lineHeight;\r\n                ctx.setTransform(1, 0, 0, 1, 0, 0);\r\n            });\r\n\r\n            /** Condition clause of flavor text in TCG cards do not use italic font style (\"Summoned Skull\" TCG). */\r\n            if (effectFlavorCondition.length > 0) {\r\n                const internalEffectiveMedian = condense(\r\n                    median => {\r\n                        const { currentLineCount } = createLineList({\r\n                            ctx,\r\n                            median,\r\n                            paragraphList: [effectFlavorCondition],\r\n                            format, textData,\r\n                            width,\r\n                        });\r\n\r\n                        if (currentLineCount > 1) return false;\r\n                        return true;\r\n                    },\r\n                );\r\n                const xRatio = internalEffectiveMedian / 1000;\r\n\r\n                ctx.scale(xRatio, yRatio);\r\n                ctx.font = currentFont.setStyle('').getFont();\r\n                let tokenList = tokenizeText(effectFlavorCondition);\r\n                /** We use two new line character to identify condition clause among flavor text. Because in normal case the user will try to put in many new lines to ensure that the condition clause is placed at bottom of the card text.\r\n                 * \r\n                 * But this method has a caveat: For example if current line limit is 6, and the flavor text already take 5 lines. If user put the condition clause at line 6, it is indistinguishable from a normal paragraph, and therefore drawn with italic font. But if user put a new line between, it will force the draw function to increase the line limit into 7.\r\n                 * \r\n                 * To combat this, we perform a simple remove that additional new line, that means if conditional clause is present, two new lines in textare actually result only one new line. This does not create much hassle since user rarely notice this behavior.\r\n                 * */\r\n                tokenList = tokenList[0] === '\\n'\r\n                    ? tokenList.slice(1)\r\n                    : tokenList;\r\n                drawLine({\r\n                    ctx,\r\n                    tokenList,\r\n                    xRatio, yRatio,\r\n                    trueEdge, trueBaseline,\r\n                    textData,\r\n                    format,\r\n                });\r\n                trueBaseline += lineHeight;\r\n                ctx.setTransform(1, 0, 0, 1, 0, 0);\r\n            }\r\n            break;\r\n        }\r\n    }\r\n\r\n    return effectSizeLevel;\r\n};","\r\nimport { CanvasConst } from 'src/model';\r\nimport { drawAsset, drawAssetWithSize } from '../image';\r\nimport { clearCanvas } from '../canvas-util';\r\n\r\nconst {\r\n    width: CanvasWidth,\r\n} = CanvasConst;\r\n\r\nexport const drawStarIcon = async ({\r\n    ctx,\r\n    cardIcon,\r\n    star,\r\n    onStarDraw,\r\n}: {\r\n    ctx: CanvasRenderingContext2D | null | undefined,\r\n    cardIcon: string,\r\n    star: number,\r\n    onStarDraw: (coordinate: [number, number]) => Promise<void>,\r\n}) => {\r\n    const starWidth = 50;\r\n    const startSpacing = 4;\r\n    const starCount = Math.min(13, star);\r\n    const reverseAlign = ['rank', 'negative-level'].includes(cardIcon);\r\n    const totalWidth = starWidth * starCount + startSpacing * (starCount - 1);\r\n    /** Level / Rank 13 is center-aligned. */\r\n    const leftEdge = starCount <= 12\r\n        ? reverseAlign\r\n            ? 85.9125 - starWidth\r\n            : 728.775\r\n        : reverseAlign\r\n            ? (CanvasWidth - totalWidth) / 2 - starWidth\r\n            : (CanvasWidth - totalWidth) / 2 + totalWidth;\r\n\r\n    let offset = 0 - (starWidth + startSpacing);\r\n\r\n    return Promise.all([...Array(starCount)]\r\n        .map(async () => {\r\n            offset += (starWidth + startSpacing);\r\n            let coordinate: [number, number] = [\r\n                leftEdge + (starWidth + offset) * (reverseAlign ? 1 : -1),\r\n                145,\r\n            ];\r\n            await drawAsset(ctx, `subfamily/subfamily-${cardIcon}.png`, ...coordinate);\r\n            return await onStarDraw(coordinate);\r\n        })\r\n    );\r\n};\r\n\r\nexport const drawSticker = async ({\r\n    ctx,\r\n    sticker,\r\n}: {\r\n    ctx: CanvasRenderingContext2D | null | undefined,\r\n    sticker: string,\r\n}) => {\r\n    if (!clearCanvas(ctx)) return;\r\n\r\n    if (sticker === 'no-sticker') return Promise.resolve();\r\n    return drawAsset(ctx, `sticker/sticker-${sticker.toLowerCase()}.png`, 739.1438, 1110.938);\r\n};\r\n\r\n/** Duel terminal mark and Speed card mark. They overlap if draw together, so we make them mutually exclusive. Maybe it is not worth the effort. */\r\nexport const drawPredefinedMark = async ({\r\n    ctx,\r\n    type,\r\n    isPendulum,\r\n    isLink,\r\n    isDuelTerminalCard,\r\n    isSpeedCard,\r\n    bordered,\r\n}: {\r\n    ctx: CanvasRenderingContext2D | null | undefined,\r\n    type: string,\r\n    isPendulum: boolean,\r\n    isLink: boolean,\r\n    isDuelTerminalCard: boolean,\r\n    isSpeedCard: boolean,\r\n    bordered: boolean,\r\n}) => {\r\n    if (!ctx) return;\r\n\r\n    if (isDuelTerminalCard) {\r\n        const coordinate: [number, number, number, number] = isPendulum\r\n            ? [250, 1087, 180, 20]\r\n            : isLink\r\n                ? [151, 848, 216, 24]\r\n                : [80, 843, 270, 30];\r\n\r\n        await drawAssetWithSize(ctx, `text/text-duel-terminal-${type}${bordered ? '-bordered' : ''}.png`, ...coordinate);\r\n    }\r\n    if (isSpeedCard) {\r\n        const coordinate: [number, number, number, number] = isPendulum\r\n            ? [250, 1090, 176.4, 18]\r\n            : isLink\r\n                ? [151, 855, 215.6, 22]\r\n                : [80, 850, 245, 25];\r\n\r\n        await drawAssetWithSize(ctx, `text/text-speed-duel-${type}${bordered ? '-bordered' : ''}.png`, ...coordinate);\r\n    }\r\n};\r\n\r\nexport const drawLinkRatingText = async (\r\n    ctx?: CanvasRenderingContext2D | null,\r\n    linkMap?: string[],\r\n) => {\r\n    if (!ctx || !Array.isArray(linkMap)) return;\r\n\r\n    await drawAsset(ctx, 'link/link-text.png', 600, 1080);\r\n    ctx.textAlign = 'right';\r\n    ctx.scale(1.2, 1);\r\n    ctx.font = 'bold 35.55px Yugioh Rush Duel Numbers V4';\r\n    ctx.fillStyle = '#000000';\r\n    ctx.fillText(`${linkMap.length}`, 623.36, 1105.01);\r\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\r\n    ctx.textAlign = 'left';\r\n};","import {\r\n    arrowPositionList,\r\n    BackgroundType,\r\n    CanvasConst,\r\n    CardOpacity,\r\n    Foil,\r\n    getArtCanvasCoordinate,\r\n    NO_ATTRIBUTE,\r\n} from 'src/model';\r\nimport { drawAsset, drawAssetWithSize } from '../image';\r\nimport { getCardIconFromFrame } from 'src/util';\r\nimport { drawStarIcon } from './with-image';\r\n\r\nconst {\r\n    topToPendulumStructure,\r\n    pendulumStructureHeight,\r\n    leftToPendulumStructure,\r\n} = CanvasConst;\r\n/** Various function used to draw the layout of a card is abstracted to this factory. */\r\nexport const getLayoutDrawFunction = ({\r\n    ctx,\r\n    artworkCanvas,\r\n    backgroundCanvas,\r\n    format,\r\n    hasBackground,\r\n    frame, bottomFrame,\r\n    backgroundType,\r\n    cardIcon,\r\n    attribute,\r\n    star,\r\n    foil,\r\n    pendulumSize,\r\n    opacity,\r\n    isLink, isSpeedSkill, isXyz,\r\n    isPendulum,\r\n    loopFinish,\r\n    loopArtFinish,\r\n}: {\r\n    ctx: CanvasRenderingContext2D,\r\n    artworkCanvas: HTMLCanvasElement | null,\r\n    backgroundCanvas: HTMLCanvasElement | null,\r\n    format: string,\r\n    frame: string, bottomFrame: string,\r\n    hasBackground: boolean,\r\n    backgroundType: BackgroundType,\r\n    cardIcon: string,\r\n    attribute: string,\r\n    star: number,\r\n    foil: Foil,\r\n    pendulumSize: string,\r\n    opacity: CardOpacity,\r\n    isXyz: boolean, isSpeedSkill: boolean, isLink: boolean,\r\n    isPendulum: boolean,\r\n    loopFinish: (\r\n        ctx?: CanvasRenderingContext2D | null,\r\n        name?: string,\r\n        caller?: (finishType: string) => Promise<any>,\r\n    ) => Promise<void>,\r\n    loopArtFinish: (\r\n        ctx?: CanvasRenderingContext2D | null,\r\n        name?: string,\r\n        caller?: (finishType: string) => Promise<any>,\r\n    ) => Promise<void>,\r\n}) => {\r\n    const {\r\n        artBorder: keepArtBorder,\r\n        nameBorder,\r\n        body: opacityBody,\r\n        name: opacityName,\r\n        pendulum: opacityPendulum,\r\n        text: opacityText,\r\n        boundless,\r\n    } = opacity;\r\n    const {\r\n        artX,\r\n        artY,\r\n        artFinishX,\r\n        artFinishY,\r\n        artWidth,\r\n    } = getArtCanvasCoordinate(isPendulum, opacity);\r\n    const artBorder = opacityBody > 0 ? true : keepArtBorder;\r\n    const artBoxY = 170, artBoxX = 60;\r\n    const effectBoxY = 860, effectBoxX = 35;\r\n    const backgroundEffectBoxY = effectBoxY + 24, backgroundEffectBoxX = effectBoxX + 19;\r\n\r\n    const hasFoil = foil !== 'normal';\r\n    const frameBorderType = isXyz || isSpeedSkill\r\n        ? frame\r\n        : 'normal';\r\n    const nameBorderType = frameBorderType;\r\n    const applyArtFinish = !boundless && artBorder;\r\n\r\n    const resultAPI = {\r\n        /** Calculate new art coordination for creative mode, some configurations may result in the art getting drawn at different location compare to default one used by `drawArtwork` function. A lots of calculation is involved here since we:\r\n         * \r\n         *  * Trying to draw only a portion of the image.\r\n         *  * The source image has totally different size compare to the destination boundary.\r\n         *  * Various anchor points must be located based on the current card layout. Kinda regret making this feature, but they work pretty well so.\r\n         */\r\n        calculateCardArtRedrawCoordination(\r\n            imageCanvas: HTMLCanvasElement,\r\n            customOpacity?: CardOpacity,\r\n            extraHeightRatio = 1,\r\n            customBackgroundType?: BackgroundType,\r\n        ) {\r\n            const normalizedOpacity = customOpacity ?? opacity;\r\n            const {\r\n                body: bodyOpacity\r\n            } = normalizedOpacity;\r\n            const {\r\n                artX,\r\n                artY,\r\n                artWidth,\r\n            } = getArtCanvasCoordinate(isPendulum, normalizedOpacity, customBackgroundType);\r\n            const { width: imageWidth, height: imageHeight } = imageCanvas;\r\n            const imageScaledRatio = artWidth / imageWidth;\r\n            const sourceOffsetX = bodyOpacity < 100\r\n                ? (leftToPendulumStructure - artX) / imageScaledRatio\r\n                : 0;\r\n            const destinationOffsetX = sourceOffsetX * imageScaledRatio;\r\n            const sourceOffsetY = bodyOpacity < 100\r\n                ? (topToPendulumStructure - artY) / imageScaledRatio\r\n                : 0;\r\n            const destinationOffsetY = sourceOffsetY * imageScaledRatio;\r\n            const offsetHeight = bodyOpacity < 100\r\n                ? imageHeight - (pendulumStructureHeight / imageScaledRatio)\r\n                : 0;\r\n\r\n            const destinationX = artX + destinationOffsetX;\r\n            const destinationY = artY + destinationOffsetY;\r\n            const destinationWidth = artWidth - destinationOffsetX * 2;\r\n            const destinationHeight = artWidth / (imageWidth / imageHeight) * extraHeightRatio - offsetHeight * imageScaledRatio;\r\n\r\n            return {\r\n                imageScaledRatio,\r\n                sourceOffsetX,\r\n                sourceOffsetY,\r\n                destinationOffsetX,\r\n                destinationOffsetY,\r\n                offsetHeight,\r\n                destinationX,\r\n                destinationY,\r\n                destinationWidth,\r\n                destinationHeight,\r\n            };\r\n        },\r\n\r\n        /** Main frame consists of top half and bottom half (for pendulum-like) card. */\r\n        drawFrame: async () => {\r\n            ctx.globalAlpha = opacityBody / 100;\r\n            await drawAsset(ctx, `frame/frame-${frame}.png`, 0, 0);\r\n            await drawAsset(ctx, `frame-pendulum/frame-pendulum-${bottomFrame}.png`, 0, 0);\r\n            ctx.globalAlpha = 1;\r\n        },\r\n        /** Draw card artwork is synchronous because the image is already loaded from cropper's canvas. */\r\n        drawCardArt: () => {\r\n            if (!artworkCanvas || !ctx) return;\r\n            const { width: imageWidth, height: imageHeight } = artworkCanvas;\r\n\r\n            if (imageHeight <= 0) return;\r\n            ctx.drawImage(\r\n                artworkCanvas,\r\n                0, 0,\r\n                imageWidth, imageHeight,\r\n                artX, artY,\r\n                artWidth, artWidth / (imageWidth / imageHeight),\r\n            );\r\n        },\r\n        drawBackground: (\r\n            boundary?: 'pendulum',\r\n        ) => {\r\n            if (!backgroundCanvas || !ctx || !hasBackground) return;\r\n            const { width: backgroundWidth, height: backgroundHeight } = backgroundCanvas;\r\n\r\n            if (backgroundHeight <= 0) return;\r\n            if (boundary === 'pendulum') {\r\n                let redrawCoordination = resultAPI.calculateCardArtRedrawCoordination(backgroundCanvas);\r\n\r\n                if (backgroundType === 'full') {\r\n                    redrawCoordination = resultAPI.calculateCardArtRedrawCoordination(\r\n                        backgroundCanvas,\r\n                        { ...opacity, body: 0 },\r\n                        undefined,\r\n                        'full',\r\n                    );\r\n                } else if (backgroundType === 'fit') {\r\n                    redrawCoordination = resultAPI.calculateCardArtRedrawCoordination(\r\n                        backgroundCanvas,\r\n                        opacity,\r\n                        undefined,\r\n                        'fit'\r\n                    );\r\n                }\r\n\r\n                const {\r\n                    sourceOffsetX: backgroundSourceOffsetX, sourceOffsetY: backgroundSourceOffsetY,\r\n                    offsetHeight: backgroundOffsetHeight,\r\n                    destinationX: backgroundDestinationX, destinationY: backgroundDestinationY,\r\n                    destinationWidth: backgroundDestinationWidth, destinationHeight: backgroundDestinationHeight,\r\n                } = redrawCoordination;\r\n                ctx.drawImage(\r\n                    backgroundCanvas,\r\n                    backgroundSourceOffsetX, backgroundSourceOffsetY,\r\n                    backgroundWidth - backgroundSourceOffsetX * 2, backgroundHeight - backgroundOffsetHeight,\r\n                    backgroundDestinationX, backgroundDestinationY,\r\n                    backgroundDestinationWidth, backgroundDestinationHeight,\r\n                );\r\n                return;\r\n            }\r\n\r\n            const {\r\n                artX,\r\n                artY,\r\n                artWidth,\r\n            } = getArtCanvasCoordinate(\r\n                isPendulum,\r\n                { ...opacity, boundless: true },\r\n                backgroundType,\r\n            );\r\n            ctx.drawImage(\r\n                backgroundCanvas,\r\n                0, 0,\r\n                backgroundWidth, backgroundHeight,\r\n                artX, artY,\r\n                artWidth, artWidth / (backgroundWidth / backgroundHeight)\r\n            );\r\n        },\r\n        drawAttribute: async () => {\r\n            await drawAsset(ctx, `attribute/attr-${format}-${attribute.toLowerCase()}.png`, 678, 55);\r\n        },\r\n        drawStar: async () => {\r\n            const normalizedCardIcon = cardIcon === 'auto' ? getCardIconFromFrame(frame) : cardIcon;\r\n            await drawStarIcon({\r\n                ctx,\r\n                cardIcon: normalizedCardIcon,\r\n                star: star ?? 0,\r\n                onStarDraw: async coordinate => {\r\n                    return normalizedCardIcon === 'st'\r\n                        ? Promise.resolve()\r\n                        : await loopFinish(\r\n                            ctx,\r\n                            'star',\r\n                            async type => drawAsset(ctx, `finish/finish-${type}-star.png`, ...coordinate),\r\n                        );\r\n                },\r\n            });\r\n        },\r\n        drawPendulumScaleIcon: async () => {\r\n            await drawAsset(ctx, `frame-pendulum/pendulum-scale-${pendulumSize}.png`, 0, 750);\r\n        },\r\n        /** Individual arrows has two state (active/inactive) and two different parts (base and core) */\r\n        drawLinkArrowMap: async (linkMap: string[]) => {\r\n            await Promise.all<any>([1, 2, 3, 4, 6, 7, 8, 9]\r\n                .map(async entry => {\r\n                    const { left, top, height, width } = arrowPositionList[entry - 1];\r\n                    const isActive = linkMap.includes(`${entry}`);\r\n                    const baseLink = `link/link-inactive-${entry}`;\r\n                    const activeLink = `link/link-active-${entry}`;\r\n                    const coordinate = [left, top, width, height] as const;\r\n\r\n                    await drawAssetWithSize(ctx, `${baseLink}-base${boundless ? '-full' : ''}.png`, ...coordinate);\r\n                    await drawAssetWithSize(ctx, `${baseLink}-core.png`, ...coordinate);\r\n                    if (isActive) {\r\n                        await drawAssetWithSize(ctx, `${activeLink}-base.png`, ...coordinate);\r\n                        return drawAssetWithSize(ctx, `${activeLink}-core.png`, ...coordinate);\r\n                    } else return;\r\n                })\r\n            );\r\n        },\r\n\r\n        /** @summary BACKGROUND section */\r\n\r\n        drawNameBackground: async () => {\r\n            ctx.globalAlpha = opacityName / 100;\r\n            await drawAsset(ctx, `background/background-name-${frame}.png`, 0, 0);\r\n            ctx.globalAlpha = 1;\r\n        },\r\n        /** Background is based on bottom frame. This function draws both background for pendulum part and normal effect part. */\r\n        drawEffectBackground: async (withPendulum = false) => {\r\n            ctx.globalAlpha = opacityText / 100;\r\n            await drawAsset(\r\n                ctx,\r\n                `background/background-text-${bottomFrame}.png`,\r\n                backgroundEffectBoxX, backgroundEffectBoxY,\r\n            );\r\n            if (withPendulum) {\r\n                ctx.globalAlpha = opacityPendulum / 100;\r\n                await drawAsset(ctx, `background/background-pendulum-${bottomFrame}.png`, 55, 738);\r\n            }\r\n            ctx.globalAlpha = 1;\r\n        },\r\n\r\n        /** @summary BORDER section */\r\n\r\n        drawFrameBorder: async () => {\r\n            return drawAsset(ctx, `frame/frame-border-${frameBorderType}.png`, 0, 0);\r\n        },\r\n        drawNameBorder: async () => {\r\n            return nameBorder\r\n                ? drawAsset(ctx, `frame/name-border-${nameBorderType}.png`, 0, 0)\r\n                : Promise.resolve();\r\n        },\r\n        drawArtBorder: async () => {\r\n            if (artBorder) {\r\n                let artFrameSource = '';\r\n                if (isXyz || isSpeedSkill) {\r\n                    artFrameSource = `frame/art-border-${frame}.png`;\r\n                } else if (isLink || ['zarc', 'hamon', 'uria', 'raviel'].includes(frame)) {\r\n                    artFrameSource = 'frame/art-border-special.png';\r\n                } else {\r\n                    artFrameSource = 'frame/art-border.png';\r\n                }\r\n                await drawAsset(ctx, artFrameSource, artBoxX, artBoxY);\r\n            }\r\n        },\r\n        drawPendulumBorder: async (artBorder: boolean, foilType: Foil) => {\r\n            await drawAsset(\r\n                ctx,\r\n                `frame-pendulum/border-pendulum-${pendulumSize}`\r\n                    + `-${foilType}`\r\n                    + (artBorder ? '' : '-artless')\r\n                    + '.png',\r\n                30, 185,\r\n            );\r\n        },\r\n        /** Usually we can draw foil on top of effect border, but speed skill's effect border is thicker so foil cannot cover it properly, in this case we will not draw the effect border knowing foil will be applied. In fact the effect border of speed skill is kinda buggy and not align really well, but we can't really do anything about it. Speed skill is also just a non-standard frame. */\r\n        drawEffectBorder: async () => {\r\n            if (!hasFoil && bottomFrame === 'speed-skill') {\r\n                await drawAsset(ctx, 'frame/effect-border-speed-skill.png', effectBoxX, effectBoxY);\r\n            } else {\r\n                await drawAsset(ctx, 'frame/effect-border.png', effectBoxX, effectBoxY);\r\n            }\r\n        },\r\n        drawCardBorder: async () => {\r\n            await drawAsset(ctx, `frame/card-border${hasFoil ? `-${foil}` : ''}.png`, 0, 0);\r\n        },\r\n\r\n        /** @summary FOIL section */\r\n\r\n        drawArtBorderFoil: async () => {\r\n            if (artBorder) await drawAsset(ctx, `frame/art-border-${foil}.png`, artBoxX, artBoxY);\r\n        },\r\n        drawEffectBorderFoil: async () => {\r\n            await drawAsset(ctx, `frame/effect-border-${foil}.png`, effectBoxX, effectBoxY);\r\n        },\r\n        drawLinkMapFoil: async (withBorder = artBorder) => {\r\n            await drawAsset(ctx, `link/link-overlay-arrow-${foil}${withBorder ? '' : '-artless'}.png`, 0, 175);\r\n        },\r\n\r\n        /** @summary FINISH section */\r\n\r\n        drawNameFinish: async () => {\r\n            if (artBorder || nameBorder) await loopFinish(\r\n                ctx,\r\n                'name',\r\n                async type => {\r\n                    return drawAsset(ctx, `finish/finish-${type}-name.png`, 0, 0);\r\n                },\r\n            );\r\n        },\r\n        drawAttributeFinish: async () => {\r\n            if (attribute !== NO_ATTRIBUTE) {\r\n                await loopFinish(ctx, 'attribute', async type => drawAsset(ctx, `finish/finish-${type}-attribute.png`, 678, 55));\r\n            }\r\n        },\r\n        drawArtFinish: async () => {\r\n            if (applyArtFinish) await loopArtFinish(\r\n                ctx,\r\n                'art',\r\n                async finishType => await drawAsset(\r\n                    ctx,\r\n                    `finish/art-finish-${finishType}${isPendulum ? `-pendulum-${pendulumSize}` : ''}.png`,\r\n                    artFinishX, artFinishY,\r\n                ),\r\n            );\r\n        },\r\n        /**\r\n         * * ArtFinish: Controlled by `artFinish` attribute.\r\n         * * ArtOverlayFinish: Controlled by `finish` attribute, and therfore support multiple layers.\r\n         * \r\n         * * OverlayFinish type `art`: Apply only when art border is present, for example a dark finish will darken all the card EXCEPT the artwork. But when art border is no longer present (for example full-art card), it will darken the whole card.\r\n         * * OverlayFinish type `unart`: Apply only when art border is not present.\r\n         */\r\n        drawArtOverlayFinish: async () => {\r\n            await loopFinish(\r\n                ctx,\r\n                'art-overlay',\r\n                async type => {\r\n                    return drawAsset(\r\n                        ctx,\r\n                        'finish/finish'\r\n                            + `-${type}`\r\n                            + `-${applyArtFinish ? 'art' : 'unart'}`\r\n                            + '-overlay'\r\n                            + (isPendulum ? `-pendulum-${pendulumSize}` : '')\r\n                            + '.png',\r\n                        artFinishX, artFinishY,\r\n                    );\r\n                },\r\n            );\r\n        },\r\n        drawArtBorderFinish: async () => {\r\n            if (artBorder) {\r\n                await loopFinish(\r\n                    ctx,\r\n                    'art-border',\r\n                    async finishType => drawAsset(ctx, `finish/finish-${finishType}-art-border.png`, 0, 0),\r\n                );\r\n            }\r\n        },\r\n        drawPendulumArtBorderFinish: async () => {\r\n            if (artBorder) await loopFinish(\r\n                ctx,\r\n                'art-border-pendulum',\r\n                finishType => drawAsset(ctx, `finish/finish-${finishType}-art-border-pendulum-${pendulumSize}.png`, 0, 0)\r\n            );\r\n        },\r\n        drawBorderPendulumFinish: async () => {\r\n            await loopFinish(\r\n                ctx,\r\n                'border-pendulum',\r\n                async finishType => drawAsset(ctx, `finish/finish-${finishType}-border-pendulum-${pendulumSize}.png`, 0, 0)\r\n            );\r\n        },\r\n        drawFrameFinish: async () => {\r\n            await loopFinish(\r\n                ctx,\r\n                'frame',\r\n                async type => {\r\n                    return drawAsset(ctx, `finish/finish-${type}-frame${isPendulum ? `-pendulum-${pendulumSize}` : ''}.png`, 0, 0);\r\n                },\r\n            );\r\n        },\r\n        drawFrameBackgroundFinish: async () => {\r\n            await loopFinish(\r\n                ctx,\r\n                'frame-background',\r\n                async type => {\r\n                    return drawAsset(ctx, `finish/finish-${type}-frame-background${isPendulum ? `-pendulum-${pendulumSize}` : ''}.png`, 0, 0);\r\n                },\r\n            );\r\n        },\r\n        /** Unlike total overlay, this finish layer lies below card text (name, effect, etc...) */\r\n        drawOverlayFinish: async () => {\r\n            await loopFinish(ctx, 'overlay', async overlayType => drawAsset(ctx, `finish/finish-${overlayType}-overlay.png`, 0, 0));\r\n        },\r\n        drawCardBorderFinish: async () => {\r\n            await loopFinish(ctx, 'card-border', async type => drawAsset(ctx, `finish/finish-${type}-card-border.png`, 0, 0));\r\n        },\r\n    };\r\n\r\n    return resultAPI;\r\n};","import {\r\n    DefaultFontSizeData,\r\n    NormalizeTextRegex,\r\n    NameFontDataMap,\r\n    NameStyle,\r\n    PatternMap,\r\n    TCG_LETTER_JOINLIST,\r\n    getDefaultNameStyle,\r\n} from 'src/model';\r\nimport { parsePalette, createFontGetter, condense } from 'src/util';\r\nimport { tokenizeText } from '../text-util';\r\nimport { drawLine } from '../text';\r\nimport { createLineList } from '../line';\r\nimport { normalizeCardText } from '../text-normalize';\r\nimport { drawAsset, drawAssetWithSize } from '../image';\r\n\r\nconst getNameGradient = (\r\n    ctx: CanvasRenderingContext2D,\r\n    angleAsDegree: number,\r\n    colorStopList: { offset: string, color: string }[],\r\n    edge: number,\r\n    contentWidth: number,\r\n    baseline: number,\r\n    maxAscent: number,\r\n    maxDescent: number,\r\n) => {\r\n    /** Use the knowledge diagram to understand more about the geometry for this, but basically we want to create a rectangle to put the gradient in, this rectangle can be rotated, but no matter what the rotation angle is, it must be large just enought to contains all the card name inside, no more no less.\r\n     * \r\n     * This is deceptively hard because each letters has their own \"hanging\" or \"protruding\" part, magnified by the fact that the gradient is rotable. */\r\n    const baseKAF = angleAsDegree % 360;\r\n    const quarterSlot = `${Math.floor(baseKAF / 90)}`;\r\n    const KAF = baseKAF % 90;\r\n    const originWidth = contentWidth;\r\n    const originHeight = maxAscent + maxDescent;\r\n    // Testing only\r\n    // const originWidth = 16;\r\n    // const originHeight = 8;\r\n    // const edge = 0, baseline = 4, maxDescent = 4, maxAscent = 4;\r\n    const cx = edge + originWidth / 2;\r\n    const cy = baseline + (maxDescent - maxAscent) / 2;\r\n\r\n    let width = originWidth, height = originHeight;\r\n    if (quarterSlot === '1' || quarterSlot === '3') { width = originHeight; height = originWidth }\r\n\r\n    /**\r\n     * The coordinate system is put in the middle of the card name, with its origin lies exactly at the center, thanks to the information about its bounding from parameters.\r\n     * \r\n     * We avoid want to obtuse angle, so we only calculate one quarter, then mirror it vertically and horizontally to fill all fours.\r\n     */\r\n    const AD = Math.sqrt(width ** 2 / 4 + height ** 2 / 4);\r\n    if (AD > 0) {\r\n        const KAD = Math.asin((width / 2) / AD) * 180 / Math.PI;\r\n        const DAF = KAD - KAF;\r\n        const FDA = 90 - DAF;\r\n        const AF = Math.sin(FDA / 180 * Math.PI) * AD;\r\n        const AL = Math.sin(KAF / 180 * Math.PI) * AF;\r\n        const FL = Math.cos(KAF / 180 * Math.PI) * AF;\r\n        let offsetX = AL;\r\n        let offsetY = FL;\r\n        if (quarterSlot === '1') { offsetX = FL; offsetY = -AL }\r\n        if (quarterSlot === '2') { offsetX = -AL; offsetY = -FL }\r\n        if (quarterSlot === '3') { offsetX = -FL; offsetY = AL }\r\n\r\n        const topX = cx + offsetX;\r\n        const topY = cy - offsetY;\r\n        const botX = cx - offsetX;\r\n        const botY = cy + offsetY;\r\n        // console.info('metric', {\r\n        //     quarterSlot, baseKAF,\r\n        //     '\\n', width, height, cx, cy,\r\n        //     '\\n', KAF, KAD, DAF, FDA,\r\n        //     '\\n', AD, AF, AL, FL,\r\n        //     '\\n', maxAscent, maxDescent, baseline,\r\n        //     '\\n', topX, topY, botX, botY,\r\n        // });\r\n        const gradient = ctx.createLinearGradient(topX, topY, botX, botY);\r\n        colorStopList.forEach(({ color, offset }) => gradient.addColorStop(parseFloat(offset), color));\r\n\r\n        return gradient;\r\n    }\r\n    return undefined;\r\n};\r\n\r\n/**\r\n * Draw card name, while the foot text is affected by every custom method, head text ONLY affected by its own color.\r\n */\r\nexport const drawName = async (\r\n    ctx: CanvasRenderingContext2D | null | undefined,\r\n    value: string,\r\n    edge: number,\r\n    trueBaseline: number,\r\n    width: number,\r\n    style: Partial<NameStyle>,\r\n    option: {\r\n        frame: string,\r\n        cloneNode: HTMLCanvasElement | null | undefined,\r\n        format: string,\r\n        isSpeedSkill?: boolean,\r\n        furiganaHelper: boolean,\r\n    },\r\n) => {\r\n    const { isSpeedSkill, format, cloneNode, frame, furiganaHelper } = option;\r\n    const cloneCtx = cloneNode?.getContext('2d');\r\n    if (ctx && cloneCtx && value) {\r\n        const {\r\n            font,\r\n            fillStyle,\r\n            headTextFillStyle,\r\n            shadowBlur,\r\n            hasShadow,\r\n            shadowColor,\r\n            shadowOffsetX,\r\n            shadowOffsetY,\r\n            hasOutline: hasDefaultOutline,\r\n            lineColor,\r\n            lineWidth,\r\n            lineOffsetX,\r\n            lineOffsetY,\r\n            hasGradient,\r\n            gradientAngle,\r\n            gradientColor,\r\n            pattern,\r\n        } = { ...getDefaultNameStyle(), ...style };\r\n        const { patternImage, blendMode: patternBlendMode } = PatternMap[pattern ?? ''] ?? {};\r\n        const hasOutline = hasDefaultOutline;\r\n\r\n        ctx.textAlign = 'left';\r\n        if (hasShadow) {\r\n            ctx.shadowColor = shadowColor;\r\n            ctx.shadowOffsetY = shadowOffsetY;\r\n            ctx.shadowOffsetX = shadowOffsetX;\r\n            ctx.shadowBlur = shadowBlur;\r\n        }\r\n        if (hasDefaultOutline) {\r\n            ctx.lineWidth = lineWidth;\r\n            ctx.strokeStyle = lineColor;\r\n        }\r\n        const fontData = {\r\n            ...(NameFontDataMap[font as keyof typeof NameFontDataMap] ?? NameFontDataMap.Default).fontData,\r\n            headTextFillStyle,\r\n        };\r\n        const fontGetter = createFontGetter({\r\n            defaultFamily: fontData.font,\r\n            defaultSize: fontData.fontList[0].fontSize,\r\n            defaultWeight: fontData.weight,\r\n        });\r\n        const textData = {\r\n            fontLevel: 0,\r\n            fontData,\r\n            currentFont: fontGetter,\r\n        };\r\n        const quoteConvertedValue = normalizeCardText(\r\n            value,\r\n            format,\r\n            { multiline: false, furiganaHelper, dictionaryType: 'rubyFormName' },\r\n        );\r\n\r\n        /** Calculate the bounding box that contains all card name's graphic, and passing it to gradient calculator. Beware - gradient does not apply to head text. */\r\n        const crudeTokenList = format === 'ocg'\r\n            ? [quoteConvertedValue]\r\n            : quoteConvertedValue.split(new RegExp(`([^${TCG_LETTER_JOINLIST}])`, 'g'));\r\n        const fontGetterForWidthCalculating = createFontGetter({\r\n            defaultFamily: fontData.font,\r\n            defaultSize: fontData.fontList[0].fontSize,\r\n            defaultWeight: fontData.weight,\r\n        });\r\n        const normalStyle = fontGetterForWidthCalculating.getFont();\r\n        const symbolStyle = fontGetterForWidthCalculating\r\n            .setSize(cur => cur * fontData.symbolFontRatio)\r\n            .setStyle('small-caps')\r\n            .setFamily(fontData.symbolFont)\r\n            .getFont();\r\n        let maxAscent = 0;\r\n        let maxDescent = 0;\r\n        crudeTokenList.forEach((cur, index) => {\r\n            ctx.font = index % 2 === 0 ? normalStyle : symbolStyle;\r\n\r\n            const textMetric = ctx.measureText(cur.replaceAll(NormalizeTextRegex, ''));\r\n            maxAscent = Math.max(maxAscent, textMetric.actualBoundingBoxAscent);\r\n            maxDescent = Math.max(maxDescent, textMetric.actualBoundingBoxDescent);\r\n        }, 0);\r\n\r\n        ctx.font = normalStyle;\r\n        /** Calculate fitting ratio like normal */\r\n        let actualLineWidth = 0;\r\n        const internalEffectiveMedian = condense(\r\n            median => {\r\n                const { currentLineCount, currentLineList } = createLineList({\r\n                    ctx,\r\n                    median,\r\n                    paragraphList: [quoteConvertedValue],\r\n                    format, textData,\r\n                    width,\r\n                });\r\n\r\n                if (currentLineCount > 1) return false;\r\n                actualLineWidth = currentLineList[0].actualLineWidth;\r\n                return true;\r\n            },\r\n        );\r\n        const xRatio = internalEffectiveMedian / 1000;\r\n        const yRatio = 1;\r\n\r\n        ctx.scale(xRatio, yRatio);\r\n\r\n        /** Calculate gradient and offset based on card's frame. */\r\n        const offsetY = fontData.fontList[0].offsetY ?? DefaultFontSizeData.offsetY;\r\n        const tokenList = tokenizeText(quoteConvertedValue);\r\n        const gradient = actualLineWidth > 0 && hasGradient\r\n            ? getNameGradient(\r\n                ctx,\r\n                gradientAngle,\r\n                parsePalette(gradientColor),\r\n                edge,\r\n                actualLineWidth,\r\n                trueBaseline,\r\n                maxAscent, maxDescent,\r\n            )\r\n            : undefined;\r\n\r\n\r\n        /** First iteration: Draw the card name with color, shadow and gradient */\r\n        ctx.fillStyle = gradient ?? fillStyle;\r\n        drawLine({\r\n            ctx,\r\n            tokenList,\r\n            xRatio, yRatio,\r\n            trueEdge: edge, trueBaseline,\r\n            textData,\r\n            format,\r\n            textDrawer: ({ ctx, letter, scaledEdge, scaledBaseline }) => {\r\n                ctx.fillText(letter, scaledEdge, scaledBaseline - (isSpeedSkill ? offsetY : 0));\r\n            },\r\n        });\r\n\r\n        /** Second iteration, draw pattern, we follow these steps:\r\n         *  * We create a second, temporary canvas node.\r\n         *  * We fill the node with pattern. The pattern is not skewed, but maybe scaled to fit exactly the bounding box of the card name (we reuse the same information when calculate gradient).\r\n         *  * We place the temporary node above the card name's canvas, using suitable blend mode, this way we essential \"coating\" the pattern on top of the text, without damaging it's surrounding.\r\n         */\r\n        if (patternImage && cloneNode) {\r\n            ctx.setTransform(1, 0, 0, 1, 0, 0);\r\n            /** Some patterns are partially transparent, so we need to draw the current frame under it first. */\r\n            await drawAsset(cloneCtx, `frame/frame-${frame}.png`, 0, 0);\r\n            await drawAsset(cloneCtx, `background/background-name-${frame}.png`, 0, 0);\r\n            cloneCtx.globalCompositeOperation = patternBlendMode;\r\n            await drawAssetWithSize(\r\n                cloneCtx, `finish-name/${patternImage}.png`,\r\n                edge, trueBaseline - maxAscent,\r\n                width,\r\n                maxAscent + maxDescent,\r\n            );\r\n            ctx.globalCompositeOperation = 'source-in';\r\n            ctx.drawImage(cloneNode, 0, 0);\r\n            ctx.scale(xRatio, yRatio);\r\n            ctx.globalCompositeOperation = 'source-over';\r\n\r\n            /** Again, foot text is not affected by pattern, so we draw the whole name again but without the foot text part.\r\n             * \r\n             * Because head text is not affected by shadow and outline, and their color is always solid. When placed on top of the head text with pattern, they will cover the pattern perfectly.\r\n             */\r\n            drawLine({\r\n                ctx,\r\n                tokenList,\r\n                xRatio, yRatio,\r\n                trueEdge: edge, trueBaseline,\r\n                textData,\r\n                format,\r\n                textDrawer: () => {},\r\n            });\r\n        }\r\n\r\n        /** Third iteration, we apply \"outline\" to card name. We use stroke method to simulate outline behavior. This is not ideal (like at all), but current canvas has no way to do it properly. */\r\n        if (hasOutline) {\r\n            ctx.globalCompositeOperation = 'destination-over';\r\n            drawLine({\r\n                ctx,\r\n                tokenList,\r\n                xRatio, yRatio,\r\n                trueEdge: edge, trueBaseline,\r\n                textData,\r\n                format,\r\n                textDrawer: ({ ctx, letter, scaledEdge, scaledBaseline }) => {\r\n                    ctx.lineJoin = 'round';\r\n                    ctx.strokeText(\r\n                        letter,\r\n                        scaledEdge + lineOffsetX,\r\n                        scaledBaseline + lineOffsetY - (isSpeedSkill ? offsetY : 0),\r\n                    );\r\n                },\r\n            });\r\n        }\r\n        ctx.globalCompositeOperation = 'source-over';\r\n        ctx.setTransform(1, 0, 0, 1, 0, 0);\r\n\r\n        const defaultTextStyle = getDefaultNameStyle();\r\n        ctx.fillStyle = defaultTextStyle.fillStyle;\r\n        ctx.shadowColor = defaultTextStyle.shadowColor;\r\n        ctx.shadowOffsetY = defaultTextStyle.shadowOffsetY;\r\n        ctx.shadowOffsetX = defaultTextStyle.shadowOffsetX;\r\n        ctx.shadowBlur = defaultTextStyle.shadowBlur;\r\n        ctx.lineWidth = defaultTextStyle.lineWidth;\r\n        ctx.strokeStyle = defaultTextStyle.lineColor;\r\n        ctx.lineJoin = 'miter';\r\n        ctx.globalCompositeOperation = 'source-over';\r\n    }\r\n};","import { clearCanvas } from '../canvas-util';\r\nimport { condense, createFontGetter , checkLightFrame, checkSpeedSkill } from 'src/util';\r\nimport { ST_ICON_SYMBOL, FontData, TypeAbilityCoordinateMap, getTypeAbilityFontData, NO_ICON } from 'src/model';\r\nimport { tokenizeText } from '../text-util';\r\nimport { drawLine } from '../text';\r\nimport { createLineList } from '../line';\r\nimport { normalizeCardText } from '../text-normalize';\r\nimport { drawAssetWithSize } from '../image';\r\n\r\n/** Small and medium size are used for type / ability text in effect box. Large type is used for \"Spell/Trap type\" under card's name. */\r\nconst sizeMap: Record<string, number> = {\r\n    small: 0,\r\n    medium: 1,\r\n    large: 2,\r\n};\r\nexport const drawTypeAbilityText = ({\r\n    ctx,\r\n    value,\r\n    format,\r\n    metricMethod,\r\n    size,\r\n    furiganaHelper,\r\n}: {\r\n    ctx: CanvasRenderingContext2D,\r\n    value: string,\r\n    format: string,\r\n    metricMethod?: FontData['metricMethod'],\r\n    size: 'small' | 'medium' | 'large',\r\n    furiganaHelper: boolean,\r\n}) => {\r\n    const {\r\n        edgeAlignment = 'left',\r\n        trueEdge,\r\n        trueBaseline,\r\n        trueWidth: width,\r\n    } = TypeAbilityCoordinateMap[format]?.[size] ?? TypeAbilityCoordinateMap['tcg']['medium'];\r\n    const fontData = getTypeAbilityFontData()[format];\r\n    if (metricMethod) fontData.metricMethod = metricMethod;\r\n    const { font } = fontData;\r\n    const fontLevel = sizeMap[size];\r\n    const fontSizeData = fontData.fontList[fontLevel];\r\n    const fontGetter = createFontGetter({\r\n        defaultFamily: font,\r\n        defaultSize: `${fontSizeData.fontSize}px`,\r\n    });\r\n    const textData = {\r\n        fontLevel,\r\n        fontData,\r\n        currentFont: fontGetter,\r\n    };\r\n    let actualLineWidth = 0;\r\n\r\n    ctx.font = fontGetter.getFont();\r\n    ctx.textAlign = 'left';\r\n    const normalizedText = normalizeCardText(value, format, { multiline: false, furiganaHelper });\r\n    const internalEffectiveMedian = condense(\r\n        median => {\r\n            const { currentLineCount, currentLineList } = createLineList({\r\n                ctx,\r\n                median,\r\n                paragraphList: [normalizedText],\r\n                format, textData,\r\n                width,\r\n            });\r\n    \r\n            if (currentLineCount > 1) return false;\r\n            actualLineWidth = currentLineList[0].actualLineWidth;\r\n            return true;\r\n        },\r\n    );\r\n    const xRatio = internalEffectiveMedian / 1000;\r\n    const yRatio = 1;\r\n    ctx.scale(xRatio, yRatio);\r\n    const result = drawLine({\r\n        ctx,\r\n        tokenList: tokenizeText(normalizedText),\r\n        xRatio, yRatio,\r\n        trueEdge: edgeAlignment === 'left' ? trueEdge : (trueEdge - actualLineWidth * xRatio),\r\n        trueBaseline,\r\n        textData,\r\n        format,\r\n        textDrawer: ({ ctx, letter, scaledEdge, scaledBaseline }) => {\r\n            ctx.fillText(letter, scaledEdge, scaledBaseline);\r\n        },\r\n    });\r\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\r\n\r\n    return {\r\n        ...result,\r\n        xRatio,\r\n    };\r\n};\r\n\r\nexport const drawTypeAbility = async ({\r\n    ctx,\r\n    typeAbility,\r\n    subFamily,\r\n    format,\r\n    frame,\r\n    size,\r\n    isMonster,\r\n    furiganaHelper,\r\n}: {\r\n    ctx?: CanvasRenderingContext2D | null,\r\n    typeAbility: string,\r\n    subFamily: string,\r\n    format: string,\r\n    frame: string,\r\n    size: 'small' | 'medium' | 'large',\r\n    isMonster: boolean,\r\n    furiganaHelper: boolean,\r\n}) => {\r\n    if (!clearCanvas(ctx)) return;\r\n\r\n    const willDrawTypeAbility = typeAbility.length > 0;\r\n    const willDrawIcon = subFamily !== NO_ICON && size === 'large';\r\n    const typeAbilityWithIcon = typeAbility\r\n        + (willDrawIcon ? ST_ICON_SYMBOL : '');\r\n    const normalizedTypeAbilityText = willDrawTypeAbility\r\n        ? format === 'tcg'\r\n            ? size === 'large'\r\n                ? `[  ${typeAbilityWithIcon}  ]`\r\n                : `[${typeAbilityWithIcon}]`\r\n            : `【${typeAbilityWithIcon}】`\r\n        : '';\r\n    if (!willDrawTypeAbility) return;\r\n\r\n    /** Special treatment for speed skill */\r\n    ctx.fillStyle = checkLightFrame(frame) && !checkSpeedSkill({ frame }) && size === 'large'\r\n        ? '#ffffff'\r\n        : '#000000';\r\n    const { iconPositionList, xRatio } = drawTypeAbilityText({\r\n        ctx,\r\n        format,\r\n        size,\r\n        value: normalizedTypeAbilityText,\r\n        metricMethod: !isMonster ? 'compact' : undefined,\r\n        furiganaHelper,\r\n    });\r\n    let offsetY = format === 'ocg' ? -4 : 0;\r\n    let offsetX = format === 'ocg' ? -3 : 0;\r\n\r\n    if (willDrawIcon) {\r\n        const { edge, baseline } = iconPositionList[0];\r\n        await drawAssetWithSize(\r\n            ctx,\r\n            `subfamily/subfamily-${subFamily.toLowerCase()}.png`,\r\n            image => edge + image.naturalWidth * 0.175 * xRatio + offsetX,\r\n            image => baseline - image.naturalWidth * 0.8 + offsetY,\r\n            image => image.naturalWidth,\r\n            image => image.naturalWidth,\r\n        );\r\n    } else {\r\n        /** Currently, draw icon in place of monster type is undesirable, as the icon seems out of place and user may not know how to turn them off properly if they want to. */\r\n        // await Promise.all(iconPositionList.map(({ edge, baseline, size }) => {\r\n        //     const iconSize = size * 0.9;\r\n\r\n        //     return drawAssetWithSize(\r\n        //         ctx,\r\n        //         `subfamily/subfamily-${subFamily.toLowerCase()}.png`,\r\n        //         () => edge + size * 0.125,\r\n        //         baseline - size * 0.850,\r\n        //         () => iconSize,\r\n        //         () => iconSize,\r\n        //     );\r\n        // }));\r\n    }\r\n};","import { fillTextLeftWithSpacing, fillTextRightWithSpacing } from '../canvas-util';\r\n\r\nexport const drawScale = (\r\n    ctx: CanvasRenderingContext2D | null | undefined,\r\n    value: string,\r\n    edge: number,\r\n    baseline: number,\r\n) => {\r\n    if (ctx && value) {\r\n        const fontSize = 60.5;\r\n        ctx.font = `${fontSize}px MatrixBoldSmallCaps`;\r\n        ctx.textAlign = 'left';\r\n\r\n        const digitScaleRatio = 0.65;\r\n        const digitList = `${value}`.split('');\r\n        let totalWidth = 0;\r\n\r\n        digitList.forEach(digit => {\r\n            totalWidth += ctx.measureText(digit).width * (digit === '1' ? digitScaleRatio : 1);\r\n        });\r\n        let accLeft = edge - totalWidth / 2;\r\n\r\n        digitList.forEach(digit => {\r\n            ctx.fillText(digit, digit === '1' ? accLeft - 3 : accLeft, baseline + fontSize);\r\n            accLeft += ctx.measureText(digit).width * (digit === '1' ? digitScaleRatio : 1);\r\n        });\r\n    }\r\n};\r\n\r\nexport const draw1stEdition = (\r\n    ctx: CanvasRenderingContext2D | null | undefined,\r\n    edge = 99,\r\n    baselineOffset = 0,\r\n    option = { stroke: false },\r\n) => {\r\n    if (!ctx) return;\r\n\r\n    const { stroke = false } = option ?? {};\r\n    ctx.font = 'bold 23.7px palatino-linotype-bold';\r\n\r\n    let left = edge;\r\n    ctx.fillText('1', left, 1150.93 + baselineOffset);\r\n    if (stroke) ctx.strokeText('1', left, 1150.93);\r\n    left += ctx.measureText('1').width - 2;\r\n\r\n    ctx.font = 'bold 17.78px palatino-linotype-bold';\r\n    ctx.fillText('st', left, 1143.53 + baselineOffset);\r\n    if (stroke) ctx.strokeText('st', left, 1143.53);\r\n    left += ctx.measureText('st').width;\r\n\r\n    ctx.font = 'bold 22.22px palatino-linotype-bold';\r\n    ctx.fillText(' Edition', left, 1150.93 + baselineOffset);\r\n    if (stroke) ctx.strokeText(' Edition', left, 1150.93);\r\n};\r\n\r\nexport const drawStatText = (\r\n    ctx: CanvasRenderingContext2D | null | undefined,\r\n    value: string,\r\n    edge: number,\r\n    baseline: number,\r\n) => {\r\n    if (!ctx) return;\r\n\r\n    ctx.fillStyle = '#000';\r\n    ctx.scale(1, 0.98);\r\n    ctx.font = 'bold 35.73px Matrix-Bold';\r\n    const cursorEndOfATK = fillTextLeftWithSpacing(ctx, value, 0.075, edge, baseline / 0.98);\r\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\r\n    ctx.scale(1, 1.01);\r\n    ctx.font = 'bold 34.74px Matrix-Bold';\r\n    fillTextLeftWithSpacing(ctx, '/', 0.15, cursorEndOfATK + 5, baseline / 1.01);\r\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\r\n};\r\n\r\n/** Stats have two special case: \"?\" stat (\"Slifer the Sky Dragon\" TCG) and \"∞\" stat (\"Divine Serpent Geh\" Anime) */\r\nexport const drawStat = (\r\n    ctx: CanvasRenderingContext2D | null | undefined,\r\n    value: string | number,\r\n    edge: number,\r\n    baseline: number,\r\n) => {\r\n    if (!ctx || value == null) return;\r\n\r\n    const statWidth = 73.97;\r\n    if (value === '∞') {\r\n        ctx.textAlign = 'right';\r\n        ctx.font = 'bold 37px matrix';\r\n        ctx.fillText(value, edge + statWidth, baseline);\r\n    } else\r\n    if (value === '?') {\r\n        ctx.textAlign = 'right';\r\n        ctx.font = 'bold 34px matrix';\r\n        ctx.fillText(value, edge + statWidth, baseline);\r\n    } else {\r\n        ctx.textAlign = 'left';\r\n        const tokenizedText = `${value}`.split('?');\r\n\r\n        let totalWidth = tokenizedText.reduce((prev, curr, index) => {\r\n            ctx.font = '37px MatrixBoldSmallCaps';\r\n            let nextWidth = prev + ctx.measureText(curr).width;\r\n\r\n            if (index < tokenizedText.length - 1) {\r\n                ctx.font = '37px matrix';\r\n                nextWidth += ctx.measureText('?').width;\r\n            }\r\n\r\n            return nextWidth;\r\n        }, 0);\r\n\r\n        if (totalWidth > 0) {\r\n            const condenseRatio = Math.min(statWidth / totalWidth, 1);\r\n\r\n            ctx.scale(condenseRatio, 1);\r\n            tokenizedText.reduce((prev, _, index, arr) => {\r\n                const curText = arr[arr.length - 1 - index];\r\n                let nextEdge = prev;\r\n                ctx.font = '37px MatrixBoldSmallCaps';\r\n                nextEdge -= ctx.measureText(curText).width * condenseRatio;\r\n                ctx.fillText(curText, nextEdge / condenseRatio, baseline);\r\n\r\n                if (index < tokenizedText.length - 1) {\r\n                    ctx.font = 'bold 37px matrix';\r\n                    nextEdge -= ctx.measureText('?').width * condenseRatio;\r\n                    ctx.fillText('?', nextEdge / condenseRatio, baseline);\r\n                }\r\n\r\n                return nextEdge;\r\n            }, edge + statWidth);\r\n            ctx.scale(1 / condenseRatio, 1);\r\n        }\r\n    }\r\n};\r\n\r\nexport const drawSetId = (\r\n    ctx: CanvasRenderingContext2D | null | undefined,\r\n    value: string,\r\n    option: { isPendulum: boolean, isLink: boolean, withShadow: boolean, format: string, lightFooter: boolean }\r\n) => {\r\n    if (!ctx) return;\r\n\r\n    const { isPendulum, isLink, withShadow, format, lightFooter } = option;\r\n    let spacing = 0.175;\r\n    let offsetY = 0;\r\n    let xOffset = 0;\r\n    ctx.fillStyle = (lightFooter && !isPendulum) ? '#ffffff' : '#000000';\r\n    ctx.shadowColor = withShadow\r\n        ? lightFooter ? '#000000' : '#ffffff'\r\n        : '#000000';\r\n    ctx.shadowOffsetY = 0;\r\n    ctx.shadowOffsetX = 0;\r\n    ctx.shadowBlur = withShadow && !isPendulum ? 3 : 0;\r\n    ctx.font = `${withShadow ? 'bold' : ''} 22px stone-serif-regular`;\r\n    if (format === 'ocg') {\r\n        spacing = 0.145;\r\n        offsetY = -1;\r\n        xOffset = -3;\r\n    }\r\n\r\n    if (isPendulum) {\r\n        fillTextLeftWithSpacing(ctx, value, spacing, 66.65 + xOffset, 1105.01 + offsetY);\r\n    } else if (isLink) {\r\n        fillTextRightWithSpacing(ctx, value, spacing, 666.56 + xOffset, 872.94 + offsetY);\r\n    } else {\r\n        fillTextRightWithSpacing(ctx, value, spacing, 728.78 + xOffset, 871.50 + offsetY);\r\n    }\r\n};\r\n\r\nexport const drawPassword = ({\r\n    ctx,\r\n    password,\r\n    withShadow,\r\n    lightFooter,\r\n}: {\r\n    ctx?: CanvasRenderingContext2D | null,\r\n    password: string,\r\n    withShadow?: boolean,\r\n    lightFooter: boolean,\r\n}) => {\r\n    if (!ctx) return 0;\r\n\r\n    ctx.fillStyle = lightFooter ? '#ffffff' : '#000000';\r\n    ctx.font = `${withShadow ? 'bold' : ''} 22.219px stone-serif-regular`;\r\n    ctx.shadowColor = withShadow\r\n        ? lightFooter ? '#000000' : '#ffffff'\r\n        : '#000000';\r\n    ctx.shadowOffsetY = 0;\r\n    ctx.shadowOffsetX = 0;\r\n    ctx.shadowBlur = withShadow ? 3 : 0;\r\n\r\n    return fillTextLeftWithSpacing(ctx, password, 0.1, 37.031, 1150.931);\r\n};","import { useCallback, useEffect, useMemo, useRef } from 'react';\r\nimport {\r\n    clearCanvas,\r\n    draw1stEdition,\r\n    drawCreatorText,\r\n    drawEffect,\r\n    drawName,\r\n    drawScale,\r\n    drawStat,\r\n    drawStatText,\r\n    drawSetId,\r\n    drawSticker,\r\n    drawPassword,\r\n    getFinishIterator,\r\n    drawTypeAbility,\r\n    getEffectSizeAndCoordinate,\r\n    drawAsset,\r\n    getLayoutDrawFunction,\r\n    drawLinkRatingText,\r\n    drawPredefinedMark,\r\n} from 'src/draw';\r\nimport {\r\n    CanvasConst,\r\n    MasterSeriesCanvas,\r\n    NO_ATTRIBUTE,\r\n    getArtCanvasCoordinate,\r\n    getDefaultCardOpacity,\r\n    PendulumEffectFontData,\r\n    PendulumEffectCoordinate,\r\n    FinishMap,\r\n    ArtFinishMap,\r\n    CardOpacity,\r\n    CardArtCanvasCoordinateMap,\r\n    DEFAULT_BASE_FILL_COLOR,\r\n} from 'src/model';\r\nimport {\r\n    checkLink,\r\n    checkMonster,\r\n    checkNormal,\r\n    checkSpeedSkill,\r\n    checkXyz,\r\n    resolveNameStyle,\r\n} from 'src/util';\r\nimport { useCard } from './use-card';\r\n\r\nconst {\r\n    height: CanvasHeight,\r\n    width: CanvasWidth,\r\n} = CanvasConst;\r\ntype DrawerProp = {\r\n    imageChangeCount: number,\r\n    pendulumSize?: 'medium',\r\n    isInitializing: boolean,\r\n};\r\nexport const useMasterSeriDrawer = (active: boolean, canvasMap: MasterSeriesCanvas, props: DrawerProp) => {\r\n    const {\r\n        card,\r\n    } = useCard();\r\n    const {\r\n        drawCanvasRef,\r\n        artworkCanvasRef,\r\n        backgroundCanvasRef,\r\n        frameCanvasRef,\r\n        creatorCanvasRef,\r\n        effectCanvasRef,\r\n        nameCanvasRef,\r\n        passwordCanvasRef,\r\n        pendulumEffectCanvasRef,\r\n        pendulumScaleCanvasRef,\r\n        setIdCanvasRef,\r\n        statCanvasRef,\r\n        stickerCanvasRef,\r\n        cardIconCanvasRef,\r\n        typeCanvasRef,\r\n        finishCanvasRef,\r\n        lightboxCanvasRef,\r\n    } = canvasMap;\r\n    const {\r\n        format,\r\n        hasBackground, backgroundType,\r\n        frame, foil, finish, artFinish, opacity,\r\n        name, nameStyle, nameStyleType,\r\n        effect,\r\n        effectStyle,\r\n        typeAbility,\r\n        isPendulum, pendulumFrame, pendulumEffect, pendulumScaleBlue, pendulumScaleRed,\r\n        atk, def, linkMap,\r\n        attribute,\r\n        cardIcon, subFamily, star,\r\n        setId,\r\n        password, creator, sticker,\r\n        isFirstEdition, isDuelTerminalCard, isSpeedCard,\r\n        furiganaHelper,\r\n    } = card;\r\n\r\n    const bottomFrame = pendulumFrame === 'auto'\r\n        ? isPendulum\r\n            ? 'spell'\r\n            : frame\r\n        : pendulumFrame;\r\n\r\n    const condenseTolerant = effectStyle?.condenseTolerant;\r\n\r\n    const isNormal = checkNormal(card);\r\n    const isXyz = checkXyz(card);\r\n    const isLink = checkLink(card);\r\n    const isMonster = checkMonster(card);\r\n    const isSpeedSkill = checkSpeedSkill(card);\r\n\r\n    const { body = 100, boundless } = opacity;\r\n    const requireShadow = !!(body < 50 || boundless);\r\n    const lightFooter = ['xyz', 'dark-synchro', 'speed-skill', 'hamon', 'uria', 'raviel'].includes(bottomFrame);\r\n\r\n    const normalizedSubFamily = subFamily.toUpperCase();\r\n    const normalizedTypeAbility = typeAbility.map(text => text.trim()).join(format === 'ocg' ? '／' : '/');\r\n    const statInEffect = pendulumFrame !== 'auto' || isPendulum\r\n        ? !!(atk || def || (isLink && linkMap.length))\r\n        : isMonster;\r\n    const typeInEffect = cardIcon === 'auto'\r\n        ? isMonster || isSpeedSkill\r\n        : cardIcon !== 'st' || isLink;\r\n\r\n    const {\r\n        isInitializing,\r\n        imageChangeCount,\r\n        pendulumSize = 'medium',\r\n    } = props;\r\n    const readyToDraw = active && isInitializing === false;\r\n\r\n    const loopFinish = useMemo(() => getFinishIterator(finish, FinishMap), [finish]);\r\n    const loopArtFinish = useMemo(() => getFinishIterator([artFinish], ArtFinishMap), [artFinish]);\r\n\r\n    const drawingPipeline = useRef<Record<string, { name: string, order: number, rerun: number, instructor: () => Promise<any> }>>({\r\n        frame: {\r\n            name: 'frame',\r\n            order: 1,\r\n            rerun: 0,\r\n            instructor: () => Promise.resolve(),\r\n        },\r\n        attribute: {\r\n            name: 'attribute',\r\n            order: 2,\r\n            rerun: 0,\r\n            instructor: () => Promise.resolve(),\r\n        },\r\n        sticker: {\r\n            name: 'sticker',\r\n            order: 3,\r\n            rerun: 0,\r\n            instructor: () => Promise.resolve(),\r\n        },\r\n        name: {\r\n            name: 'name',\r\n            order: 4,\r\n            rerun: 0,\r\n            instructor: () => Promise.resolve(),\r\n        },\r\n        typeAbility: {\r\n            name: 'typeAbility',\r\n            order: 5,\r\n            rerun: 0,\r\n            instructor: () => Promise.resolve(),\r\n        },\r\n        overlay: {\r\n            name: 'overlay',\r\n            order: 6,\r\n            rerun: 0,\r\n            instructor: () => Promise.resolve(),\r\n        },\r\n    });\r\n\r\n    /** DRAW CARD STRUCTURE */\r\n    useEffect(() => {\r\n        if (!readyToDraw) return;\r\n        const ctx = frameCanvasRef.current?.getContext('2d');\r\n        const artworkCanvas = artworkCanvasRef.current;\r\n        const backgroundCanvas = backgroundCanvasRef.current;\r\n\r\n        drawingPipeline.current.frame.rerun += 1;\r\n        drawingPipeline.current.frame.instructor = async () => {\r\n            if (!clearCanvas(ctx)) return;\r\n            const normalizedOpacity = { ...getDefaultCardOpacity(), ...opacity };\r\n            const {\r\n                artBorder: keepArtBorder,\r\n                body: opacityBody,\r\n                boundless,\r\n                baseFill,\r\n            } = normalizedOpacity;\r\n\r\n            const fillBaseColor = (x: number, y: number, w: number, h: number) => {\r\n                ctx.fillStyle = hasBackground ? baseFill : DEFAULT_BASE_FILL_COLOR;\r\n                ctx.fillRect(x, y, w, h);\r\n            };\r\n            const hasArtBorder = opacityBody > 0 ? true : keepArtBorder;\r\n\r\n            /** Base colored background so the card is not see-through even with transparent artwork */\r\n            fillBaseColor(0, 0, CanvasWidth, CanvasHeight);\r\n\r\n            const {\r\n                drawFrame,\r\n                drawCardArt,\r\n                drawBackground,\r\n                drawPendulumScaleIcon,\r\n                drawLinkArrowMap,\r\n                drawStar,\r\n                drawAttribute,\r\n\r\n                drawNameBackground,\r\n                drawEffectBackground,\r\n\r\n                drawFrameBorder,\r\n                drawNameBorder,\r\n                drawArtBorder,\r\n                drawPendulumBorder,\r\n                drawBorderPendulumFinish,\r\n                drawEffectBorder,\r\n                drawCardBorder,\r\n\r\n                drawAttributeFinish,\r\n                drawArtBorderFoil,\r\n                drawEffectBorderFoil,\r\n                drawLinkMapFoil,\r\n\r\n                drawNameFinish,\r\n                drawArtFinish,\r\n                drawArtOverlayFinish,\r\n                drawArtBorderFinish,\r\n                drawPendulumArtBorderFinish,\r\n                drawFrameFinish,\r\n                drawFrameBackgroundFinish,\r\n                drawOverlayFinish,\r\n                drawCardBorderFinish,\r\n\r\n                calculateCardArtRedrawCoordination,\r\n            } = getLayoutDrawFunction({\r\n                ctx,\r\n                artworkCanvas, backgroundCanvas,\r\n                format,\r\n                frame, bottomFrame,\r\n                hasBackground,\r\n                backgroundType,\r\n                attribute,\r\n                cardIcon, star,\r\n                foil,\r\n                pendulumSize,\r\n                opacity: normalizedOpacity,\r\n                isLink, isSpeedSkill, isXyz,\r\n                isPendulum,\r\n                loopFinish,\r\n                loopArtFinish,\r\n            });\r\n\r\n            /** Start with artwork at the bottom, then main frame, then outer card border. */\r\n            if (backgroundCanvas && ctx) drawBackground();\r\n            if (artworkCanvas && ctx && !boundless) drawCardArt();\r\n            await drawFrame();\r\n            await drawCardBorder();\r\n            await drawCardBorderFinish();\r\n\r\n            /** @summary Draw NON-PENDULUM card layout */\r\n            if (!isPendulum) {\r\n                if (!boundless) {\r\n                    await drawNameBackground();\r\n                    await drawEffectBackground();\r\n                    await drawEffectBorder();\r\n                    /** Foil DOES NOT contains shadow, so it relies on the shadow of the border below. */\r\n                    await drawEffectBorderFoil();\r\n                }\r\n                await drawArtBorder();\r\n                await drawArtBorderFoil();\r\n                await drawArtBorderFinish();\r\n            }\r\n\r\n            /** @summary Draw PENDULUM-LIKE card layout. Does not apply to Link frame since it contains link arrows. */\r\n            if (isPendulum && !isLink && !boundless) {\r\n                /** Since pendulum art boundary is wider, we cannot relies on the artwork under frame, instead we must draw the artwork again, this time with different size. */\r\n                if (artworkCanvas && ctx && artworkCanvas.height > 0) {\r\n                    const { width: artWidth, height: artHeight } = artworkCanvas;\r\n                    const {\r\n                        sourceOffsetX, sourceOffsetY,\r\n                        offsetHeight,\r\n                        destinationX, destinationY,\r\n                        destinationWidth, destinationHeight,\r\n                    } = calculateCardArtRedrawCoordination(artworkCanvas);\r\n\r\n                    /** To avoid stacking transprency, we clear the area before redrawing */\r\n                    fillBaseColor(\r\n                        destinationX, destinationY,\r\n                        destinationWidth, destinationHeight,\r\n                    );\r\n\r\n                    drawBackground('pendulum');\r\n                    ctx.drawImage(\r\n                        artworkCanvas,\r\n                        sourceOffsetX, sourceOffsetY,\r\n                        artWidth - sourceOffsetX * 2, artHeight - offsetHeight,\r\n                        destinationX, destinationY,\r\n                        destinationWidth, destinationHeight,\r\n                    );\r\n                }\r\n\r\n                await drawNameBackground();\r\n                await drawEffectBackground(true);\r\n            }\r\n\r\n            /** We must draw art finish first because pendulum's border have those little corners that spread into the artwork. */\r\n            await drawArtFinish();\r\n            await drawArtOverlayFinish();\r\n\r\n            /** Scale and pendulum border frame, these will be covered by extended artwork so we doesn't draw them if the artwork is boundless */\r\n            if (isPendulum && !isLink && !boundless) {\r\n                await drawPendulumScaleIcon();\r\n                /** Draw normal border first so we got the shadow ready. Again foiled border DOES NOT have shadow by their own. */\r\n                await drawPendulumBorder(hasArtBorder, 'normal');\r\n                await drawPendulumBorder(hasArtBorder, foil);\r\n                await drawPendulumArtBorderFinish();\r\n                if (hasArtBorder) await drawBorderPendulumFinish();\r\n            }\r\n\r\n            if (!boundless) {\r\n                await drawFrameFinish();\r\n                await drawNameFinish();\r\n            }\r\n            if (hasArtBorder) await drawFrameBackgroundFinish();\r\n\r\n            /** Boundless art behavior here. If rigid frame is off, card image will extends beyond the current art border (on top of it). The extended card image is still below name, level, attribute, effect (both card and pendulum) and other predefined texts. */\r\n            if (boundless) {\r\n                if (isLink) {\r\n                    /** For link layout, the artwork is above the art border, but still below the link arrows */\r\n                    await drawArtBorderFinish();\r\n                } else if (isPendulum) {\r\n                    /** We want to fill the area inside pendulum border only, so that the outside frame remains intact. */\r\n                    const extraHeightRatio = CardArtCanvasCoordinateMap.fullCard.ratio\r\n                        / CardArtCanvasCoordinateMap.extendedPendulum.ratio;\r\n                    /** Fill area with base color before start draw overlay artwork. In this case we do not want to fill everywhere, we just need to fill exactly the area contains inside pendulum border frame. */\r\n                    if (artworkCanvas && ctx && artworkCanvas.height > 0) {\r\n                        const {\r\n                            destinationX, destinationY,\r\n                            destinationWidth, destinationHeight,\r\n                        } = calculateCardArtRedrawCoordination(\r\n                            artworkCanvas,\r\n                            { ...getDefaultCardOpacity(), ...opacity, body: 100, boundless: false },\r\n                            extraHeightRatio,\r\n                        );\r\n    \r\n                        fillBaseColor(\r\n                            destinationX, destinationY,\r\n                            destinationWidth, destinationHeight,\r\n                        );\r\n                        drawBackground('pendulum');\r\n                    }\r\n                    if (hasArtBorder) {\r\n                        await drawPendulumBorder(hasArtBorder, 'normal');\r\n                        await drawPendulumBorder(hasArtBorder, foil);\r\n                    }\r\n                    await drawPendulumArtBorderFinish();\r\n                }\r\n                await drawNameBackground();\r\n                await drawNameFinish();\r\n                await drawNameBorder();\r\n                if (artworkCanvas && ctx) drawCardArt();\r\n                await drawArtOverlayFinish();\r\n\r\n                /** Redraw various part here because the extended artwork may overlap with those */\r\n                if (isPendulum && !isLink) {\r\n                    await drawEffectBackground(true);\r\n                    await drawPendulumScaleIcon();\r\n                    await drawPendulumBorder(false, 'normal');\r\n                    await drawPendulumBorder(false, foil);\r\n                    await drawBorderPendulumFinish();\r\n                } else {\r\n                    await drawEffectBackground();\r\n                    await drawEffectBorder();\r\n                    await drawEffectBorderFoil();\r\n                }\r\n                await drawFrameFinish();\r\n            }\r\n\r\n            if (statInEffect) await drawAsset(ctx, 'frame/frame-stat-border.png', 0, 1070);\r\n\r\n            /** Individual arrows has two state (active/inactive) and two different parts (base and core) */\r\n            if (!isPendulum && isLink) {\r\n                await drawLinkArrowMap(linkMap);\r\n                await drawLinkMapFoil(false);\r\n                await drawLinkRatingText(ctx, linkMap);\r\n            }\r\n\r\n            await drawAttribute();\r\n            await drawAttributeFinish();\r\n            if (!isLink) await drawStar();\r\n            if (!boundless) await drawNameBorder();\r\n            await drawFrameBorder();\r\n            await drawPredefinedMark({\r\n                ctx,\r\n                type: (lightFooter && !isPendulum) ? 'white' : 'black',\r\n                bordered: (opacityBody < 50 || boundless) && !isPendulum,\r\n                isDuelTerminalCard, isSpeedCard,\r\n                isLink, isPendulum,\r\n            });\r\n            await drawOverlayFinish();\r\n        };\r\n    }, [\r\n        readyToDraw,\r\n        artworkCanvasRef,\r\n        backgroundCanvasRef,\r\n        frameCanvasRef,\r\n        frame,\r\n        format,\r\n        hasBackground,\r\n        backgroundType,\r\n        attribute,\r\n        bottomFrame,\r\n        foil,\r\n        star,\r\n        cardIcon,\r\n        isDuelTerminalCard,\r\n        isLink,\r\n        isPendulum,\r\n        isSpeedCard,\r\n        isSpeedSkill,\r\n        isXyz,\r\n        lightFooter,\r\n        linkMap,\r\n        loopArtFinish,\r\n        loopFinish,\r\n        opacity,\r\n        pendulumSize,\r\n        statInEffect,\r\n        imageChangeCount, // Special dependency, do not remove even though it is not used in the effect itself\r\n    ]);\r\n\r\n    /** DRAW SCALE */\r\n    useEffect(() => {\r\n        if (!readyToDraw) return;\r\n        const ctx = pendulumScaleCanvasRef.current?.getContext('2d');\r\n\r\n        if (!clearCanvas(ctx)) return;\r\n        if (isPendulum) {\r\n            drawScale(ctx, pendulumScaleBlue ?? 0, 84.4, 790);\r\n            drawScale(ctx, pendulumScaleRed ?? 0, 728.0, 790);\r\n        }\r\n    }, [readyToDraw, isPendulum, pendulumScaleBlue, pendulumScaleRed, pendulumScaleCanvasRef]);\r\n\r\n    /** DRAW NAME */\r\n    useEffect(() => {\r\n        if (!readyToDraw) return;\r\n        drawingPipeline.current.name.rerun += 1;\r\n        drawingPipeline.current.name.instructor = async () => {\r\n            const ctx = nameCanvasRef.current?.getContext('2d');\r\n            const cloneNode = nameCanvasRef.current?.cloneNode() as HTMLCanvasElement | undefined;\r\n\r\n            if (!clearCanvas(ctx) || !cloneNode) return;\r\n\r\n            await drawName(\r\n                ctx,\r\n                name,\r\n                format === 'tcg' ? 60 : 68, 115.5375,\r\n                attribute === NO_ATTRIBUTE\r\n                    ? (format === 'tcg' ? 688 : 674)\r\n                    : (format === 'tcg' ? 608 : 598),\r\n                resolveNameStyle({ format, frame, nameStyle, nameStyleType, foil }),\r\n                { isSpeedSkill, format, cloneNode, frame, furiganaHelper },\r\n            );\r\n        };\r\n    }, [\r\n        readyToDraw,\r\n        attribute,\r\n        foil,\r\n        format,\r\n        frame,\r\n        furiganaHelper,\r\n        isSpeedSkill,\r\n        name,\r\n        nameCanvasRef,\r\n        nameStyle,\r\n        nameStyleType,\r\n    ]);\r\n\r\n    /** DRAW STAT (ATK / DEF) */\r\n    useEffect(() => {\r\n        if (!readyToDraw) return;\r\n        const ctx = statCanvasRef.current?.getContext('2d');\r\n\r\n        if (!clearCanvas(ctx) || !statInEffect) return;\r\n\r\n        drawStatText(ctx, 'ATK', 432.10, 1106.494);\r\n        drawStat(ctx, atk, 508.824, 1106.494);\r\n        if (!isLink) {\r\n            drawStatText(ctx, 'DEF', 600.85, 1106.494);\r\n            drawStat(ctx, def, 673.865, 1106.494);\r\n        }\r\n    }, [readyToDraw, atk, def, isLink, isMonster, statCanvasRef, statInEffect]);\r\n\r\n    /** DRAW SET ID */\r\n    useEffect(() => {\r\n        if (!readyToDraw) return;\r\n        const ctx = setIdCanvasRef.current?.getContext('2d');\r\n\r\n        if (!clearCanvas(ctx)) return;\r\n\r\n        drawSetId(\r\n            ctx,\r\n            setId,\r\n            {\r\n                isLink, isPendulum,\r\n                withShadow: requireShadow && !isPendulum,\r\n                format,\r\n                lightFooter,\r\n            }\r\n        );\r\n    }, [readyToDraw, format, isLink, isPendulum, lightFooter, setIdCanvasRef, setId, isSpeedSkill, bottomFrame, requireShadow]);\r\n\r\n    /** DRAW FIRST EDITION NOTICE AND PASSWORD */\r\n    useEffect(() => {\r\n        if (!readyToDraw) return;\r\n        const ctx = passwordCanvasRef.current?.getContext('2d');\r\n        if (!clearCanvas(ctx)) return;\r\n\r\n        const endOfPassword = drawPassword({\r\n            ctx,\r\n            password,\r\n            lightFooter,\r\n            withShadow: bottomFrame === 'zarc' || requireShadow,\r\n        });\r\n        if (isFirstEdition && !isDuelTerminalCard) {\r\n            ctx.fillStyle = lightFooter ? '#ffffff' : '#000000';\r\n\r\n            draw1stEdition(\r\n                ctx,\r\n                Math.max(endOfPassword + 14.813, 142.2) - (format === 'ocg' ? 10 : 0),\r\n                isSpeedSkill ? -2 : 0,\r\n            );\r\n        }\r\n    }, [\r\n        readyToDraw,\r\n        isDuelTerminalCard,\r\n        isFirstEdition,\r\n        password,\r\n        passwordCanvasRef,\r\n        lightFooter,\r\n        format,\r\n        requireShadow,\r\n        isSpeedSkill,\r\n        bottomFrame,\r\n    ]);\r\n\r\n    /** DRAW CREATOR TEXT */\r\n    useEffect(() => {\r\n        if (!readyToDraw) return;\r\n\r\n        drawCreatorText({\r\n            ctx: creatorCanvasRef.current?.getContext('2d'),\r\n            format,\r\n            value: creator,\r\n            alignment: 'right',\r\n            baselineOffset: isSpeedSkill ? -2 : 0,\r\n            hasShadow: requireShadow,\r\n            lightFooter,\r\n        });\r\n    }, [readyToDraw, isPendulum, lightFooter, creator, creatorCanvasRef, format, requireShadow, isSpeedSkill]);\r\n\r\n    /** DRAW STICKER */\r\n    useEffect(() => {\r\n        if (!readyToDraw) return;\r\n\r\n        drawingPipeline.current.sticker.rerun += 1;\r\n        drawingPipeline.current.sticker.instructor = async () => {\r\n            return await drawSticker({\r\n                ctx: stickerCanvasRef.current?.getContext('2d'),\r\n                sticker,\r\n            });\r\n        };\r\n    }, [readyToDraw, sticker, stickerCanvasRef]);\r\n\r\n    /** DRAW CARD EFFECT + TYPE ABILITY */\r\n    useEffect(() => {\r\n        if (!readyToDraw) return;\r\n\r\n        const ctx = effectCanvasRef.current?.getContext('2d');\r\n        const typeCtx = typeCanvasRef.current?.getContext('2d');\r\n\r\n        drawingPipeline.current.typeAbility.rerun += 1;\r\n        drawingPipeline.current.typeAbility.instructor = async () => {\r\n            if (!clearCanvas(ctx) || !clearCanvas(typeCtx)) return;\r\n\r\n            const effectIndexSize = drawEffect({\r\n                ctx,\r\n                content: effect,\r\n                isNormal,\r\n                condenseTolerant,\r\n                format,\r\n                furiganaHelper,\r\n                ...getEffectSizeAndCoordinate({\r\n                    format,\r\n                    statInEffect,\r\n                    typeInEffect,\r\n                    isNormal,\r\n                }),\r\n            });\r\n            await drawTypeAbility({\r\n                ctx: typeCtx,\r\n                format,\r\n                frame,\r\n                furiganaHelper,\r\n                isMonster,\r\n                size: !typeInEffect\r\n                    ? 'large'\r\n                    : effectIndexSize === 0 ? 'medium' : 'small',\r\n                subFamily: normalizedSubFamily,\r\n                typeAbility: normalizedTypeAbility,\r\n            });\r\n        };\r\n    }, [\r\n        readyToDraw,\r\n        typeInEffect,\r\n        statInEffect,\r\n        condenseTolerant,\r\n        effect,\r\n        effectCanvasRef,\r\n        format,\r\n        frame,\r\n        furiganaHelper,\r\n        isMonster,\r\n        isNormal,\r\n        normalizedSubFamily,\r\n        normalizedTypeAbility,\r\n        typeCanvasRef,\r\n    ]);\r\n\r\n    /** DRAW PENDULUM EFFECT */\r\n    useEffect(() => {\r\n        if (!readyToDraw) return;\r\n        const ctx = pendulumEffectCanvasRef.current?.getContext('2d');\r\n\r\n        if (!clearCanvas(ctx)) return;\r\n        if (isPendulum) {\r\n            drawEffect({\r\n                ctx,\r\n                content: pendulumEffect,\r\n                isNormal: false,\r\n                fontData: PendulumEffectFontData[format],\r\n                sizeList: PendulumEffectCoordinate,\r\n                condenseTolerant,\r\n                format,\r\n                furiganaHelper,\r\n            });\r\n        }\r\n    }, [readyToDraw, condenseTolerant, format, isPendulum, pendulumEffectCanvasRef, pendulumEffect, furiganaHelper]);\r\n\r\n    /** DRAW TOTAL OVERLAY */\r\n    useEffect(() => {\r\n        if (!readyToDraw) return;\r\n        const ctx = finishCanvasRef.current?.getContext('2d');\r\n\r\n        drawingPipeline.current.overlay.rerun += 1;\r\n        drawingPipeline.current.overlay.instructor = async () => {\r\n            if (!clearCanvas(ctx)) return;\r\n            await loopFinish(\r\n                ctx,\r\n                'total-overlay',\r\n                overlayType => drawAsset(ctx, `finish/finish-${overlayType}-total-overlay.png`, 0, 0),\r\n            );\r\n        };\r\n    }, [readyToDraw, finishCanvasRef, loopFinish, name]);\r\n\r\n    const drawHistory = useRef<Record<string, number>>({});\r\n    const onExport = useCallback(async (exportProps: {\r\n        isPendulum: boolean,\r\n        opacity: Partial<CardOpacity>,\r\n        // isRelevant: () => boolean,\r\n    }) => {\r\n        const {\r\n            // isRelevant,\r\n            isPendulum = false,\r\n            opacity,\r\n        } = exportProps;\r\n        const canvasRef = drawCanvasRef.current;\r\n        const exportCtx = canvasRef?.getContext('2d');\r\n        /** Delay queue and relevant checker is used for potential performance improvement, but currently performance is not a making a hard impact to the app. */\r\n        const generateLayer = (\r\n            canvasLayer: React.RefObject<HTMLCanvasElement>,\r\n            ctx: CanvasRenderingContext2D | null | undefined,\r\n            delayQueue: number = 0,\r\n        ) => {\r\n            return new Promise<boolean>(resolve => {\r\n                setTimeout(() => {\r\n                    if (canvasLayer.current && ctx) {\r\n                        try {\r\n                            canvasLayer.current.toBlob(blob => {\r\n                                if (blob) {\r\n                                    const url = URL.createObjectURL(blob);\r\n                                    if (url) {\r\n                                        var layer = new Image();\r\n                                        layer.src = url;\r\n                                        layer.onload = () => {\r\n                                            ctx.drawImage(layer, 0, 0);\r\n                                            URL.revokeObjectURL(url);\r\n                                            resolve(true);\r\n                                        };\r\n                                        layer.onerror = () => {\r\n                                            URL.revokeObjectURL(url);\r\n                                            resolve(false);\r\n                                        };\r\n                                    } else resolve(true);\r\n                                }\r\n                                resolve(false);\r\n                            });\r\n                        } catch (e) {\r\n                            console.error(e);\r\n                            resolve(false);\r\n                        }\r\n                    } else resolve(false);\r\n                }, delayQueue * 25);\r\n            });\r\n        };\r\n\r\n        if (canvasRef && exportCtx) {\r\n            exportCtx.clearRect(0, 0, CanvasConst.width, CanvasConst.height);\r\n            await Promise.all(Object\r\n                .values(drawingPipeline.current)\r\n                .sort((l, r) => l.order - r.order)\r\n                .map(({ instructor, rerun, name }) => {\r\n                    if (\r\n                        (rerun !== 0 && drawHistory.current[name] !== rerun)\r\n                        || !drawHistory.current[name]\r\n                    ) {\r\n                        drawHistory.current[name] = rerun;\r\n\r\n                        return instructor();\r\n                    }\r\n                    return Promise.resolve();\r\n                }));\r\n            // await generateLayer(frameCanvas, exportCtx);\r\n            const artworkCanvas = artworkCanvasRef.current;\r\n            if (artworkCanvas && exportCtx) {\r\n                const { artX, artY, artWidth } = getArtCanvasCoordinate(isPendulum, opacity);\r\n                const { width: imageWidth, height: imageHeight } = artworkCanvas;\r\n\r\n                if (imageHeight > 0) {\r\n                    exportCtx.drawImage(\r\n                        artworkCanvas,\r\n                        0, 0,\r\n                        imageWidth, imageHeight,\r\n                        artX, artY,\r\n                        artWidth, artWidth / (imageWidth / imageHeight),\r\n                    );\r\n                }\r\n            }\r\n            /** It is not worth to use promise all here, just let them go sequentially to avoid too much blob generating call. */\r\n            await generateLayer(frameCanvasRef, exportCtx, 0);\r\n            await generateLayer(nameCanvasRef, exportCtx, 0);\r\n            await generateLayer(cardIconCanvasRef, exportCtx, 0);\r\n            await generateLayer(pendulumScaleCanvasRef, exportCtx, 0);\r\n            await generateLayer(pendulumEffectCanvasRef, exportCtx, 0);\r\n            await generateLayer(typeCanvasRef, exportCtx, 0);\r\n            await generateLayer(effectCanvasRef, exportCtx, 0);\r\n            await generateLayer(statCanvasRef, exportCtx, 0);\r\n            await generateLayer(setIdCanvasRef, exportCtx, 0);\r\n            await generateLayer(passwordCanvasRef, exportCtx, 0);\r\n            await generateLayer(creatorCanvasRef, exportCtx, 0);\r\n            await generateLayer(stickerCanvasRef, exportCtx, 0);\r\n            await generateLayer(finishCanvasRef, exportCtx, 0);\r\n\r\n            lightboxCanvasRef.current?.getContext('2d')?.drawImage(canvasRef, 0, 0);\r\n        }\r\n    }, [\r\n        artworkCanvasRef, \r\n        cardIconCanvasRef, \r\n        creatorCanvasRef, \r\n        drawCanvasRef, \r\n        effectCanvasRef, \r\n        finishCanvasRef, \r\n        lightboxCanvasRef, \r\n        nameCanvasRef, \r\n        passwordCanvasRef, \r\n        pendulumEffectCanvasRef, \r\n        pendulumScaleCanvasRef, \r\n        setIdCanvasRef, \r\n        frameCanvasRef, \r\n        statCanvasRef, \r\n        stickerCanvasRef, \r\n        typeCanvasRef,\r\n    ]);\r\n\r\n    return {\r\n        drawingPipeline,\r\n        onExport,\r\n    };\r\n};\r\n","import { CreatorFontData, CreatorCoordinateMap, DefaultFontSizeData } from 'src/model';\r\nimport { condense, createFontGetter } from 'src/util';\r\nimport { tokenizeText } from '../text-util';\r\nimport { drawLine } from '../text';\r\nimport { createLineList } from '../line';\r\nimport { normalizeCardText } from '../text-normalize';\r\nimport { clearCanvas } from '../canvas-util';\r\n\r\nexport const drawCreatorText = ({\r\n    ctx,\r\n    value,\r\n    format,\r\n    alignment,\r\n    baselineOffset = 0,\r\n    lightFooter,\r\n    hasShadow,\r\n}: {\r\n    ctx?: CanvasRenderingContext2D | null,\r\n    value: string,\r\n    format: string,\r\n    alignment: 'left' | 'right',\r\n    baselineOffset?: number,\r\n    lightFooter: boolean,\r\n    hasShadow?: boolean,\r\n}) => {\r\n    if (!clearCanvas(ctx)) return;\r\n\r\n    ctx.fillStyle = lightFooter ? '#ffffff' : '#000000';\r\n    ctx.shadowColor = hasShadow\r\n        ? lightFooter ? '#000000' : '#ffffff'\r\n        : '#000000';\r\n    ctx.shadowOffsetY = 0;\r\n    ctx.shadowOffsetX = 0;\r\n    ctx.shadowBlur = hasShadow ? 3 : 0;\r\n\r\n    const { trueEdge, trueBaseline, trueWidth: width } = CreatorCoordinateMap[format] ?? CreatorCoordinateMap['tcg'];\r\n    const fontData = CreatorFontData[format];\r\n    const { font } = fontData;\r\n    const normalizedText = normalizeCardText(value, format, { multiline: false, furiganaHelper: false });\r\n\r\n    /** Calculation */\r\n    let textData = {\r\n        fontLevel: 0,\r\n        fontData,\r\n        currentFont: createFontGetter(),\r\n    };\r\n    let actualLineWidth = 0;\r\n    let internalEffectiveMedian = 1000;\r\n    let fontSizeData = fontData.fontList[0];\r\n    for (let fontLevel = 0; fontLevel < fontData.fontList.length; fontLevel++) {\r\n        fontSizeData = fontData.fontList[fontLevel];\r\n        const fontGetter = createFontGetter({\r\n            defaultFamily: font,\r\n            defaultSize: `${fontSizeData.fontSize}px`,\r\n            defaultWeight: format === 'ocg' || hasShadow ? 'bold' : '',\r\n        });\r\n        let internalTextData = {\r\n            fontLevel,\r\n            fontData,\r\n            currentFont: fontGetter,\r\n        };\r\n        let internalTrueWidth = 0;\r\n        ctx.font = fontGetter.getFont();\r\n        ctx.textAlign = 'left';\r\n        internalEffectiveMedian = condense(\r\n            median => {\r\n                const { currentLineCount, currentLineList } = createLineList({\r\n                    ctx,\r\n                    median,\r\n                    paragraphList: [normalizedText],\r\n                    format, textData: internalTextData,\r\n                    width,\r\n                });\r\n        \r\n                if (currentLineCount > 1) return false;\r\n                internalTrueWidth = currentLineList[0].actualLineWidth;\r\n                return true;\r\n            },\r\n        );\r\n\r\n        actualLineWidth = internalTrueWidth;\r\n        textData = internalTextData;\r\n        if (internalEffectiveMedian >= 1000) break;\r\n    }\r\n\r\n    /** Drawing */\r\n    const xRatio = internalEffectiveMedian / 1000;\r\n    const yRatio = 1;\r\n    ctx.scale(xRatio, yRatio);\r\n    const result = drawLine({\r\n        ctx,\r\n        tokenList: tokenizeText(normalizedText),\r\n        xRatio, yRatio,\r\n        trueEdge: alignment === 'left' ? trueEdge : (trueEdge - actualLineWidth * xRatio),\r\n        trueBaseline: trueBaseline + (fontSizeData.offsetY ?? DefaultFontSizeData.offsetY) + baselineOffset,\r\n        textData,\r\n        format,\r\n        textDrawer: ({ ctx, letter, scaledEdge, scaledBaseline }) => {\r\n            ctx.fillText(letter, scaledEdge, scaledBaseline);\r\n        },\r\n    });\r\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\r\n\r\n    return result;\r\n};","import { useSetting } from 'src/service';\r\nimport { SettingFilled } from '@ant-design/icons';\r\nimport styled, { css, keyframes } from 'styled-components';\r\nimport { Checkbox, Popover, Tooltip } from 'antd';\r\n\r\nconst rotate = keyframes`\r\n    to {\r\n        transform: rotate(360deg);\r\n    }\r\n`;\r\nconst StyledSettingPanel = styled.div`\r\n    display: grid;\r\n    grid-template-columns: 1fr;\r\n    gap: var(--spacing-sm);\r\n    background-color: var(--main-level-3);\r\n    padding: var(--spacing-sm);\r\n    border: var(--bw) solid var(--sub-level-1);\r\n    border-radius: var(--br-lg);\r\n    color: var(--color);\r\n`;\r\nconst StyledSettingButtonContainer = styled.div<{ $softMode?: boolean }>`\r\n    cursor: pointer;\r\n    .setting-button-label {\r\n        display: grid;\r\n        label {\r\n            cursor: pointer;\r\n            line-height: 1;\r\n            font-size: var(--fs-xs);\r\n            margin-top: var(--spacing-xs);\r\n        }\r\n    }\r\n    .anticon-setting {\r\n        font-size: var(--fs-xl);\r\n        justify-self: center;\r\n        > svg {\r\n            ${({ $softMode }) => $softMode ? '' : css`animation: ${rotate} 12s linear infinite;`}\r\n        }\r\n    }\r\n    &:hover {\r\n        color: var(--main-active);\r\n        .anticon-setting {\r\n            color: var(--sub-active);\r\n        }\r\n    }\r\n`;\r\nexport const SettingButton = () => {\r\n    const {\r\n        setting,\r\n        updateSetting,\r\n    } = useSetting(({ setting, updateSetting }) => ({ setting, updateSetting }));\r\n    const {\r\n        allowHotkey,\r\n        reduceMotionColor,\r\n        showCreativeOption,\r\n        showExtraDecorativeOption,\r\n    } = setting;\r\n\r\n    return <StyledSettingButtonContainer className=\"setting-button\" $softMode={reduceMotionColor}>\r\n        <Popover\r\n            trigger={['click']}\r\n            overlayClassName=\"setting-button-overlay\"\r\n            content={<StyledSettingPanel>\r\n                <div>\r\n                    <Checkbox\r\n                        checked={reduceMotionColor}\r\n                        onChange={e => updateSetting({ reduceMotionColor: e.target.checked })}\r\n                    >Reduce Color and Motion</Checkbox>\r\n                </div>\r\n                <div>\r\n                    <Checkbox\r\n                        checked={showExtraDecorativeOption}\r\n                        onChange={e => updateSetting({ showExtraDecorativeOption: e.target.checked })}\r\n                    >Show Extra Decorative Options</Checkbox>\r\n                </div>\r\n                <div>\r\n                    <Checkbox\r\n                        checked={showCreativeOption}\r\n                        onChange={e => updateSetting({ showCreativeOption: e.target.checked })}\r\n                    >Show Creative Options</Checkbox>\r\n                </div>\r\n                <div>\r\n                    <Tooltip title=\"Warning: Using hotkey may affect undo / redo feature.\" placement=\"left\">\r\n                        <Checkbox\r\n                            checked={allowHotkey}\r\n                            onChange={e => updateSetting({ allowHotkey: e.target.checked })}\r\n                        >Allow hotkey</Checkbox>\r\n                    </Tooltip>\r\n                </div>\r\n                <div>\r\n                    <small>Settings are saved locally</small>\r\n                </div>\r\n            </StyledSettingPanel>}\r\n        >\r\n            <div className=\"setting-button-label\">\r\n                <SettingFilled />\r\n                <label>Setting</label>\r\n            </div>\r\n        </Popover>\r\n    </StyledSettingButtonContainer>;\r\n};","import { GithubFilled } from '@ant-design/icons';\r\nimport styled from 'styled-components';\r\nimport { Explanation } from '../explanation';\r\nimport { SettingButton } from '../setting';\r\nimport './app-header.scss';\r\n\r\nexport const Affiliation = () => {\r\n    return <div className=\"affiliation\">\r\n        <span className=\"version\">v{process.env.REACT_APP_VERSION ?? 'unknown'}</span>\r\n        <div className=\"affiliation-link\">\r\n            <a href=\"https://github.com/lauqerm/ygocarder\" target=\"_blank\" rel=\"noreferrer\">\r\n                <GithubFilled />\r\n            </a>\r\n        </div>\r\n    </div>;\r\n};\r\n\r\nconst StyledAppSettingContainer = styled.div`\r\n    align-content: center;\r\n    border-left: var(--bw) dashed #b1b1b1;\r\n    padding-left: var(--spacing);\r\n    margin-left: var(--spacing);\r\n`;\r\n/** @summary If possible, please don't remove this credit box. Show these artists the appreciation they deserve for their hard works. */\r\nexport const AppHeader = () => {\r\n    return <div className=\"app-header\">\r\n        <img alt=\"app-logo\" src={`${process.env.PUBLIC_URL}/logo192.png`} width={35} />\r\n        <div className=\"app-description\">\r\n            <h1>Yugioh Carder</h1>\r\n            <div className=\"app-contribution\">\r\n                <span className=\"app-creator\">\r\n                    GUI: <a\r\n                            href=\"https://github.com/lauqerm/ygocarder\"\r\n                            target=\"_blank\"\r\n                            rel=\"noreferrer\"\r\n                        >\r\n                            <b>Lauqerm</b>\r\n                        </a> <Explanation\r\n                        content={<div className=\"disclaimer\">\r\n                            <h2>Disclaimer</h2>\r\n                            <ul>\r\n                                <li>This is a personal project, not an \"official\" card maker. I do not have any affiliations with any other card makers, be it website, desktop app or mobile app. And <a href=\"https://lauqerm.github.io/ygocarder\">lauqerm.github.io/ygocarder</a> is the only site that directly maintained by me.</li>\r\n                                <li>The code of my site is provided as-is. I hold no liability for any other parties that may use or modify the code of my app on their own sites.</li>\r\n                                <li>I hold no liability for cards created by this app, including pictures, card text and any product related to it.</li>\r\n                                <li>I do not own any of Yu-Gi-Oh card layers and fonts use in this project. They belong to their respective creators.</li>\r\n                                <li>If you want to modify card layers, or use it in any public project, please contact <a\r\n                                    href=\"https://www.deviantart.com/grezar\"\r\n                                    target=\"_blank\"\r\n                                    rel=\"noreferrer\">Grezar</a> or <a\r\n                                    href=\"https://www.deviantart.com/9558able\"\r\n                                    target=\"_blank\"\r\n                                    rel=\"noreferrer\">9558able</a> directly.\r\n                                </li>\r\n                                <li>This app is completely free to use, I do not charge any kind of fee, require donation or serve any ads in this site.</li>\r\n                            </ul>\r\n                        </div>}\r\n                    />\r\n                </span>\r\n                <span className=\"template-creator\">\r\n                    Template: <a\r\n                        href=\"https://www.deviantart.com/grezar/art/SKILL-UPDATE-Series-10-Card-Proxy-Template-686736691\"\r\n                        target=\"_blank\"\r\n                        rel=\"noreferrer\"><b>Grezar</b></a>, <a\r\n                        href=\"https://www.deviantart.com/9558able/art/Yugioh-Series-10-Proxy-Template-DELUXE-EDITION-843282421\"\r\n                        target=\"_blank\"\r\n                        rel=\"noreferrer\"><b>9558able</b></a>, <a\r\n                        href=\"https://www.deviantart.com/slackermagician\"\r\n                        target=\"_blank\"\r\n                        rel=\"noreferrer\"><b>SlackerMagician</b></a>, <a\r\n                        href=\"https://www.deviantart.com/icycatelf\"\r\n                        target=\"_blank\"\r\n                        rel=\"noreferrer\"><b>icycatelf</b></a> and others\r\n                </span>\r\n            </div>\r\n        </div>\r\n        <StyledAppSettingContainer className=\"app-setting\">\r\n            <SettingButton />\r\n        </StyledAppSettingContainer>\r\n    </div>;\r\n};\r\n\r\nexport const TaintedCanvasWarning = <Explanation\r\n    overlayClassName=\"disclaimer-overlay\"\r\n    style={{ display: 'inline-block' }}\r\n    content={<div className=\"disclaimer\">\r\n        <h2>What is happening?</h2>\r\n        <p>\r\n            You are using an image host that does not get the \"approval\" needed for the app to use it. Browsers see it as a potential security risk (even if it is not the case), and mark the card as \"tainted\".\r\n        </p>\r\n        <h2>How does it affect me?</h2>\r\n        <p>\r\n            A \"tainted card\" prevents all sort of automatic save. From then on you must save the card manually by right click it → \"Save image as...\". It is implying that this action is fully of your consent.\r\n        </p>\r\n        <h2>How do I fix it?</h2>\r\n        <p>\r\n            Change to other safe and popular image host (\"imgur\" for example) will likely fix the issue. You may try to refresh the page if the issue persists.<br />\r\n            If you cannot afford to switch to other image hosts, the app will also work mostly just fine, you only need to manually save the card (and keep cautious for potential malicious links).\r\n        </p>\r\n    </div>}\r\n/>;","import styled from 'styled-components';\r\n\r\nexport const StandaloneLabel = styled.div`\r\n    font-weight: 500;\r\n    border-color: transparent;\r\n    background-color: transparent;\r\n    color: var(--color-vendor);\r\n    text-shadow: var(--ts);\r\n    user-select: none;\r\n    display: inline-block;\r\n    height: 32px;\r\n    width: var(--width-label);\r\n    line-height: 30px;\r\n    position: relative;\r\n    min-width: var(--width-label);\r\n    text-align: right;\r\n    padding-right: var(--spacing-antd);\r\n`;\r\n\r\nexport const StyledDropdownOption = styled.div`\r\n    padding: var(--spacing-xs) var(--spacing);\r\n    cursor: pointer;\r\n    &:hover {\r\n        background-color: var(--sub-active);\r\n    }\r\n    &.menu-active {\r\n        background-color: var(--main-active);\r\n        &:hover {\r\n            background-color: var(--sub-active);\r\n        }\r\n    }\r\n`;\r\nexport const StyledDropdownContainer = styled.div`\r\n    border: var(--bw) solid var(--sub-level-1);\r\n    border-radius: var(--br-lg);\r\n    background-color: var(--main-level-3);\r\n    box-shadow: 0 3px 6px -4px rgba(0, 0, 0, 0.12), 0 6px 16px 0 rgba(0, 0, 0, 0.08), 0 9px 28px 8px rgba(0, 0, 0, 0.05); // Mimic antd\r\n    padding: var(--spacing-xs) 0;\r\n    color: var(--color);\r\n`;\r\nexport const StyledDropdown = {\r\n    Container: StyledDropdownContainer,\r\n    Option: StyledDropdownOption,\r\n};\r\n\r\nexport { ImageCropper } from './image-cropper';\r\nexport type { ImageCropperRef } from './image-cropper';\r\nexport { LinkMarkChooser } from './link-marker';\r\nexport { Loading } from './loading';\r\nexport * from './explanation';\r\nexport * from './formatting-guide';\r\nexport * from './frame-info-block';\r\nexport * from './icon-button';\r\nexport * from './setting';\r\nexport * from './app-header';","import {\r\n    frameList,\r\n    IconList,\r\n    AttributeList,\r\n    StickerList,\r\n    FoilList,\r\n    CondenseTolerantLabelMap,\r\n    NameFontDataMap,\r\n    NO_ATTRIBUTE,\r\n    NO_ICON,\r\n} from '../../model';\r\nimport { ArtFinishMap, FinishMap } from 'src/model/foil-finish';\r\nimport { FrameInfoBlock } from 'src/component';\r\nimport { CloseCircleOutlined } from '@ant-design/icons';\r\nimport { Tooltip } from 'antd';\r\n\r\nexport const FormatButtonList = [\r\n    {\r\n        label: 'OCG',\r\n        value: 'ocg',\r\n        props: {\r\n            className: 'ocg-button',\r\n            style: { fontWeight: 'bold' } as React.CSSProperties\r\n        },\r\n    },\r\n    {\r\n        label: 'TCG',\r\n        value: 'tcg',\r\n        props: {\r\n            className: 'tcg-button',\r\n            style: { fontWeight: 'bold' } as React.CSSProperties\r\n        },\r\n    },\r\n];\r\n\r\nexport const FoilButtonList = FoilList.map(({ color, name, label }) => ({\r\n    label,\r\n    value: name,\r\n    props: {\r\n        style: {\r\n            color,\r\n            fontWeight: 'bold',\r\n        } as React.CSSProperties,\r\n    }\r\n}));\r\n\r\nexport const FinishButtonList = Object.values(FinishMap).map(({ value, label }) => ({\r\n    label,\r\n    value,\r\n}));\r\n\r\nexport const NameFontOptionList = Object.values(NameFontDataMap).map(({ value, label }) => ({\r\n    label,\r\n    value,\r\n}));\r\n\r\nexport const ArtFinishButtonList = [\r\n    { value: 'normal', label: <CloseCircleOutlined /> },\r\n    ...Object.values(ArtFinishMap).map(({ value, label }) => ({\r\n        label,\r\n        value,\r\n    })),\r\n];\r\n\r\nexport const getFrameButtonList = () => frameList.map(({ name, labelBackgroundColor, labelBackgroundColorList, edition }) => ({\r\n    label: <FrameInfoBlock\r\n        labelBackgroundColor={labelBackgroundColor}\r\n        labelBackgroundColorList={labelBackgroundColorList}\r\n        name={name}\r\n    />,\r\n    value: name,\r\n    edition,\r\n}));\r\n\r\nexport const getAttributeList = (format: string) => AttributeList.map(({ label, name }) => ({\r\n    label: name === NO_ATTRIBUTE\r\n        ? <CloseCircleOutlined />\r\n        : <Tooltip overlay={label}>\r\n            <img alt={label} src={`${process.env.PUBLIC_URL}/asset/image/attribute/attr-${format}-${name.toLowerCase()}.png`} />\r\n            </Tooltip>,\r\n    value: name,\r\n}));\r\n\r\nexport const STIconButtonList = IconList.map(({ label, value }) => ({\r\n    label: value === NO_ICON\r\n        ? <CloseCircleOutlined />\r\n        : <Tooltip overlay={label}>\r\n            <img alt={`${label}`} src={`${process.env.PUBLIC_URL}/asset/image/subfamily/subfamily-${value.toLowerCase()}.png`} />\r\n        </Tooltip>,\r\n    value,\r\n}));\r\n\r\nexport const StarButtonList = [...Array(14)].map((e, index) => ({ label: index, value: index }));\r\nexport const IconTypeMap: Record<string, { value: string, label: React.ReactNode, fullLabel: React.ReactNode }> = {\r\n    'auto': {\r\n        value: 'auto',\r\n        label: 'Auto',\r\n        fullLabel: 'Auto',\r\n    },\r\n    'st': {\r\n        value: 'st',\r\n        label: 'Icon',\r\n        fullLabel: <>\r\n            Spell/Trap Icon\r\n            <img alt=\"s/t-icon\" src={`${process.env.PUBLIC_URL}/asset/image/subfamily/subfamily-continuous.png`} />\r\n        </>,\r\n    },\r\n    'level': {\r\n        value: 'level',\r\n        label: 'Level',\r\n        fullLabel: 'Level',\r\n    },\r\n    'negative-level': {\r\n        value: 'negative-level',\r\n        label: 'Neg. Level',\r\n        fullLabel: 'Negative Level',\r\n    },\r\n    'rank': {\r\n        value: 'rank',\r\n        label: 'Rank',\r\n        fullLabel: 'Rank',\r\n    },\r\n};\r\nexport const IconTypeList = Object.values(IconTypeMap);\r\n\r\nexport const StickerButtonList = StickerList.map(name => ({\r\n    label: name === 'no-sticker'\r\n        ? <CloseCircleOutlined />\r\n        : <img alt={name} src={`${process.env.PUBLIC_URL}/asset/image/sticker/sticker-${name.toLowerCase()}.png`} />,\r\n    value: name,\r\n}));\r\n\r\nexport const CondenseThresholdButtonList = Object\r\n    .entries(CondenseTolerantLabelMap)\r\n    .map(([key, { label, order }]) => {\r\n        return {\r\n            label,\r\n            value: key,\r\n            order\r\n        };\r\n    })\r\n    .sort((l, r) => l.order - r.order);","// import { useCallback, useEffect, useState } from 'react';\r\n// import Moveable from 'react-moveable';\r\n// import { EllipsisOutlined } from '@ant-design/icons';\r\nimport { Explanation } from 'src/component';\r\nimport styled from 'styled-components';\r\n\r\nexport function insertAtCursor(target: HTMLTextAreaElement, myValue: string) {\r\n    //IE support\r\n    if ((document as any).selection) {\r\n        target.focus();\r\n        const sel = (document as any).selection.createRange();\r\n        sel.text = myValue;\r\n\r\n        return {\r\n            value: target.value,\r\n            position: 0,\r\n        };\r\n    }\r\n    //MOZILLA and others\r\n    else if (target.selectionStart || target.selectionStart === 0) {\r\n        const startPos = target.selectionStart;\r\n        const endPos = target.selectionEnd;\r\n        target.value = target.value.substring(0, startPos)\r\n            + myValue\r\n            + target.value.substring(endPos, target.value.length);\r\n        target.selectionStart = startPos + myValue.length;\r\n        target.selectionEnd = startPos + myValue.length;\r\n        target.focus();\r\n\r\n        return {\r\n            value: target.value,\r\n            position: startPos + myValue.length,\r\n        };\r\n    } else {\r\n        target.value += myValue;\r\n\r\n        return {\r\n            value: target.value,\r\n            position: 0,\r\n        };\r\n    }\r\n}\r\n\r\nconst StyledCharPickerContainer = styled.div`\r\n    z-index: 10;\r\n    display: inline-grid;\r\n    grid-template-columns: 1fr max-content;\r\n    align-items: center;\r\n    column-gap: var(--spacing-sm);\r\n    .char-picker-guideline {\r\n\r\n    }\r\n    .char-picker {\r\n        z-index: 1;\r\n        display: grid;\r\n        grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));\r\n        .handler,\r\n        .ant-btn {\r\n            background-color: var(--main-level-1);\r\n            color: var(--color-heavy);\r\n            text-shadow: var(--ts);\r\n            font-family: Segoe UI Symbol, sans-serif;\r\n            border: 1px solid var(--sub-level-1);\r\n            border-radius: 0;\r\n            padding: 0 var(--spacing);\r\n            + .ant-btn {\r\n                border-left-width: 0;\r\n            }\r\n            &:hover {\r\n                color: var(--main-active);\r\n            }\r\n            &:first-child {\r\n                border-radius: var(--br) 0 0 var(--br);\r\n            }\r\n            &:last-child {\r\n                border-radius: 0 var(--br) var(--br) 0;\r\n            }\r\n        }\r\n        /** Currently char picker no longer movable */\r\n        /* .handler {\r\n            cursor: grabbing;\r\n            background-color: var(--main-level-2);\r\n            height: unset;\r\n            font-size: var(--fs-xl);\r\n            height: var(--fs-xl);\r\n            line-height: 1;\r\n            padding: 0;\r\n            text-align: center;\r\n        } */\r\n    }\r\n    .moveable-control-box {\r\n        .moveable-control.moveable-origin,\r\n        .moveable-line.moveable-direction {\r\n            border-color: transparent;\r\n            background: none;\r\n        }\r\n    }\r\n`;\r\n\r\n/** The dragging experience is not good. Currently turn it off for now and glue it into effect's textarea. */\r\nexport type CharPicker = {\r\n    targetId: string,\r\n    onPick?: (value: string, letter: string) => void,\r\n}\r\nexport const CharPicker = ({\r\n    targetId = '',\r\n    onPick = () => {},\r\n}: CharPicker) => {\r\n    // const [target, setTarget] = useState<HTMLElement | null>(null);\r\n    const internalOnPick = (letter: string) => {\r\n        const inputTarget = document.getElementById(targetId) as HTMLTextAreaElement;\r\n        if (inputTarget) {\r\n            const { value } = insertAtCursor(inputTarget, letter);\r\n\r\n            onPick(value, letter);\r\n        }\r\n    };\r\n\r\n    // useEffect(() => {\r\n    //     setTarget(document.getElementById('char-picker'));\r\n    // }, []);\r\n\r\n    // const onDrag = useCallback(({\r\n    //     target,\r\n    //     left, top,\r\n    //     transform,\r\n    // }) => {\r\n    //     target!.style.left = `${left}px`;\r\n    //     target!.style.top = `${top}px`;\r\n    //     target!.style.transform = transform;\r\n    // }, []);\r\n\r\n    /** No tabIndex here because this is not an essential input, but rather a QoL component */\r\n    return <StyledCharPickerContainer tabIndex={-1} className=\"char-picker-container\">\r\n        {<div id={'char-picker'} className=\"char-picker\">\r\n            {/* <div className=\"handler\">\r\n                <EllipsisOutlined />\r\n            </div> */}\r\n            {[\r\n                '∞',\r\n                '☆',\r\n                '●',\r\n                '©',\r\n                '™',\r\n                'Ɐ',\r\n                'Я',\r\n            ].map(entry => {\r\n                return <button key={entry}\r\n                    tabIndex={-1}\r\n                    className=\"ant-btn\"\r\n                    onClick={() => internalOnPick(entry)}\r\n                >{entry}</button>;\r\n            })}\r\n        </div>}\r\n        <div className=\"char-picker-guideline\">\r\n            <Explanation\r\n                content={<>\r\n                    How to use:\r\n                    <ul>\r\n                        <li>At any text field, click at the position you want to insert.</li>\r\n                        <li>Click the letter.</li>\r\n                    </ul>\r\n                </>}\r\n            />\r\n        </div>\r\n        {/* <Moveable\r\n            target={target}\r\n            container={null}\r\n            edge={false}\r\n            draggable={true}\r\n            throttleDrag={0}\r\n            onDrag={onDrag}\r\n        /> */}\r\n    </StyledCharPickerContainer>;\r\n};","import { Button, InputNumber } from 'antd';\r\nimport { ForwardedRef, forwardRef, useCallback, useEffect, useImperativeHandle, useRef, useState } from 'react';\r\nimport { ChromePicker } from 'react-color';\r\nimport { AnglePicker, ColorPoint, GradientPicker } from 'react-linear-gradient-picker';\r\nimport { getDefaultGradientPalette, parsePalette, stringifyPalette } from 'src/util';\r\nimport debounce from 'lodash.debounce';\r\nimport 'react-linear-gradient-picker/dist/index.css';\r\nimport './gradient-picker.scss';\r\n\r\ntype WrappedColorPicker = {\r\n    color?: string,\r\n    onSelect?: (color: string, opacity?: number) => void,\r\n    onOffsetChange?: (id: number, offset: string) => void,\r\n    onRemove?: (id: number) => void,\r\n    opacity?: number,\r\n};\r\ntype WrappedColorPickerRef = {\r\n    setColor: (stopColor: ColorPoint) => void,\r\n    setCurrentOffset: (id: number, offset: string) => void,\r\n}\r\nconst WrappedColorPicker = forwardRef(({\r\n    color,\r\n    onSelect,\r\n    onOffsetChange,\r\n    onRemove,\r\n}: WrappedColorPicker, ref: ForwardedRef<WrappedColorPickerRef>) => {\r\n    const [internalColor, setInternalColor] = useState(color);\r\n    const [internalOffset, setInternalOffset] = useState(0);\r\n    const [internalId, setInternalId] = useState(-1);\r\n    const debouncedOnChange = useRef(debounce(setInternalOffset, 250)).current;\r\n\r\n    useImperativeHandle(ref, () => ({\r\n        setColor: ({ color, offset, id }) => {\r\n            const { min, max, round } = Math;\r\n\r\n            setInternalColor(color);\r\n            setInternalOffset(max(0, min(100, round(parseFloat(offset) * 100))));\r\n            setInternalId(id);\r\n        },\r\n        setCurrentOffset: (id, offset) => {\r\n            const { min, max, round } = Math;\r\n\r\n            if (id === internalId) setInternalOffset(max(0, min(100, round(parseFloat(offset) * 100))));\r\n        }\r\n    }));\r\n\r\n    useEffect(() => {\r\n        if (internalId > 0) onOffsetChange?.(internalId, `${internalOffset / 100}`);\r\n    }, [internalId, internalOffset, onOffsetChange]);\r\n\r\n    return <div className=\"stop-point-control-panel\">\r\n        <div className=\"stop-point-offset-input\">\r\n            Stop At: <InputNumber\r\n                value={internalOffset}\r\n                size=\"small\"\r\n                max={100} min={0}\r\n                onChange={value => debouncedOnChange(typeof value === 'string' ? parseInt(value) : value ?? 0)}\r\n            />&nbsp;%&nbsp;\r\n            <Button className=\"remove-stop-color\" size=\"small\" onClick={() => onRemove?.(internalId)}>Remove</Button>\r\n        </div>\r\n        <ChromePicker\r\n            styles={{\r\n                default: {\r\n                    picker: {\r\n                        color: '#000000',\r\n                        background: 'var(--main-level-3)',\r\n                        boxShadow: 'none',\r\n                    },\r\n                    body: {\r\n                        padding: 'var(--spacing) var(--spacing)',\r\n                    }\r\n                },\r\n            }}\r\n            disableAlpha={true}\r\n            color={internalColor}\r\n            onChange={color => setInternalColor(color.hex)}\r\n            onChangeComplete={color => {\r\n                setInternalColor(color.hex);\r\n                onSelect?.(color.hex);\r\n            }}\r\n        />\r\n    </div>;\r\n});\r\n\r\nconst MAX_STOP_POINT = 20;\r\nconst getPaletteInfo = (newColorList: ColorPoint[]) => {\r\n    return {\r\n        colorList: newColorList,\r\n        raw: stringifyPalette(newColorList),\r\n    };\r\n};\r\nexport type TextGradientPicker = {\r\n    palette?: string,\r\n    angle?: number,\r\n    memoizedOnChange: (palette: ColorPoint[], angle: number) => void,\r\n};\r\nexport const TextGradientPicker = ({\r\n    palette: externalPalette = stringifyPalette(getDefaultGradientPalette()),\r\n    angle: externalAngle = 180,\r\n    memoizedOnChange,\r\n}: TextGradientPicker) => {\r\n    const pickerRef = useRef<WrappedColorPickerRef>(null);\r\n    const [angle, setAngle] = useState(externalAngle);\r\n    const [palette, setPalette] = useState(() => {\r\n        const intialPalette = parsePalette(externalPalette);\r\n\r\n        return {\r\n            raw: externalPalette,\r\n            colorList: intialPalette,\r\n            currentControlId: intialPalette[0]?.id ?? -1,\r\n        };\r\n    });\r\n\r\n    const changePalette = useCallback((id: number, offset: string) => setPalette(cur => {\r\n        const nextColorList = cur.colorList.map(entry => entry.id === id ? { ...entry, offset } : entry);\r\n\r\n        return { ...cur, ...getPaletteInfo(nextColorList) };\r\n    }), []);\r\n\r\n    useEffect(() => {\r\n        setAngle(externalAngle);\r\n    }, [externalAngle]);\r\n\r\n    useEffect(() => {\r\n        const newPalette = parsePalette(externalPalette);\r\n\r\n        setPalette({\r\n            raw: externalPalette,\r\n            colorList: newPalette,\r\n            currentControlId: newPalette[0]?.id ?? -1,\r\n        });\r\n    }, [externalPalette]);\r\n\r\n    const setPickerOnMount = useRef(false);\r\n    useEffect(() => {\r\n        if (palette.colorList[0] && setPickerOnMount.current) {\r\n            setPickerOnMount.current = true;\r\n            pickerRef.current?.setColor(palette.colorList[0]);\r\n        }\r\n    }, [palette.colorList]);\r\n\r\n    useEffect(() => {\r\n        let relevant = true;\r\n        setTimeout(() => {\r\n            const { colorList, currentControlId } = palette;\r\n            if (relevant && currentControlId >= 0) {\r\n                const targetColor = colorList.find(entry => entry.id === currentControlId);\r\n\r\n                if (targetColor) pickerRef.current?.setCurrentOffset(currentControlId, targetColor.offset);\r\n            }\r\n        }, 100);\r\n\r\n        return () => {\r\n            relevant = false;\r\n        };\r\n    }, [palette]);\r\n\r\n    /** @todo REMEMBER to memorize the callback before passing into this component */\r\n    useEffect(() => {\r\n        let relevant = true;\r\n        setTimeout(() => {\r\n            if (relevant) {\r\n                memoizedOnChange(palette.colorList, angle);\r\n            }\r\n        }, 200);\r\n\r\n        return () => {\r\n            relevant = false;\r\n        };\r\n    }, [palette, angle, memoizedOnChange]);\r\n\r\n    return <div className=\"controls-wrapper gradient-picker-container\">\r\n        <div className=\"gradient-angle-control\">\r\n            <h2>\r\n                Color Points\r\n            </h2>\r\n            <Button\r\n                size=\"small\"\r\n                className=\"add-stop-color\"\r\n                disabled={(palette.colorList?.length ?? 10000) > MAX_STOP_POINT}\r\n                onClick={() => {\r\n                    setPalette(cur => {\r\n                        const nextColorList = [\r\n                            ...cur.colorList,\r\n                            { offset: '0.5', color: '#ffffff', id: cur.colorList.length + 1 },\r\n                        ].sort((l, r) => Number(l.offset) - Number(r.offset));\r\n\r\n                        return {\r\n                            ...cur,\r\n                            ...getPaletteInfo(nextColorList)\r\n                        };\r\n                    });\r\n                }}\r\n            >Add Point ({palette.colorList.length}/{MAX_STOP_POINT})</Button>\r\n            <div className=\"angle-picker-container\">\r\n                <h2>Gradient Direction</h2>\r\n                <AnglePicker angle={angle} size={120} setAngle={setAngle} />\r\n            </div>\r\n        </div>\r\n        <div className=\"stop-color-picker-container\">\r\n            <GradientPicker {...{\r\n                width: 370,\r\n                paletteHeight: 32,\r\n                maxStops: MAX_STOP_POINT,\r\n                minStops: 2,\r\n                stopRemovalDrop: 99999,\r\n                palette: palette.colorList,\r\n                onPaletteChange: colorList => setPalette(cur => ({ ...cur, ...getPaletteInfo(colorList) })),\r\n                onColorStopSelect: stopColor => {\r\n                    setPalette(cur => ({ ...cur, currentControlId: stopColor.id }));\r\n                    pickerRef.current?.setColor(stopColor);\r\n                },\r\n            }}>\r\n                {/** Under the hood this children will be cloned with pre-populate props, so it seemingly work even though we do not pass anything here. */}\r\n                <WrappedColorPicker ref={pickerRef}\r\n                    onOffsetChange={changePalette}\r\n                    onRemove={id => {\r\n                        setPalette(cur => {\r\n                            const nextColorList = cur.colorList.filter(entry => entry.id !== id);\r\n                            const nextId = nextColorList?.[0].id ?? -1;\r\n                            if (nextId > 0) pickerRef.current?.setColor(palette.colorList[nextId]);\r\n\r\n                            return {\r\n                                ...getPaletteInfo(nextColorList),\r\n                                currentControlId: nextId,\r\n                            };\r\n                        });\r\n                    }}\r\n                />\r\n            </GradientPicker>\r\n        </div>\r\n    </div>;\r\n};","import { StyledDropdown } from 'src/component';\r\nimport styled from 'styled-components';\r\n\r\nexport const StyledPickerButton = styled.div<{ $active?: boolean, $softMode: boolean }>`\r\n    background-color: var(--main-level-4);\r\n    ${({ $active }) => $active ? 'border: var(--bw) solid var(--main-active);' : 'border: var(--bw) solid var(--sub-level-1);'}\r\n    padding: var(--spacing-xxs) var(--spacing-xs);\r\n    margin: calc(-1 * var(--spacing-xxs)) 0;\r\n    border-radius: var(--br-lg);\r\n    box-shadow: var(--bs-button);\r\n    color: var(--color-heavy);\r\n    cursor: pointer;\r\n    ${({ $softMode, $active }) => {\r\n        return $softMode\r\n            ? `\r\n                border: var(--bw) solid var(--main-level-4);\r\n                ${$active ? 'outline: var(--bw) solid var(--main-active);' : ''}\r\n            `\r\n            : '';\r\n    }}\r\n    &:hover {\r\n        background-color: var(--sub-level-4);\r\n    }\r\n`;\r\n\r\nexport const StyledPatternContainer = styled(StyledDropdown.Container)`\r\n    display: grid;\r\n    grid-template-columns: repeat(2, 200px);\r\n    gap: var(--spacing-sm);\r\n    padding: var(--spacing-xs);\r\n    .alert {\r\n        grid-column: span 2;\r\n        font-size: var(--fs-sm);\r\n        text-align: center;\r\n    }\r\n`;\r\nexport const StyledPatternOption = styled.div`\r\n    line-height: 0;\r\n    cursor: pointer;\r\n    align-self: center;\r\n    text-align: center;\r\n    &:not(.menu-off) {\r\n        min-height: 23.2px;\r\n        &.menu-active {\r\n            outline: var(--bw-lg) solid var(--main-active);\r\n            &:hover {\r\n                outline: var(--bw-lg) solid var(--sub-active);\r\n            }\r\n        }\r\n        :hover {\r\n            outline: var(--bw-lg) solid var(--sub-active);\r\n        }\r\n    }\r\n    &.menu-off {\r\n        &:hover {\r\n            color: var(--main-link);\r\n            .anticon {\r\n                color: var(--main-link);\r\n            }\r\n        }\r\n    }\r\n    img {\r\n        max-width: 100%;\r\n        border: var(--bw) solid var(--sub-level-1);\r\n    }\r\n`;\r\n\r\nexport const StyledPredefinedContainer = styled(StyledDropdown.Container)`\r\n    display: grid;\r\n    grid-template-columns: repeat(4, 120px);\r\n    gap: var(--spacing-sm);\r\n    padding: var(--spacing-xs);\r\n    &:focus-visible {\r\n        outline: none;\r\n        box-shadow: 0 0 0 2px var(--focus) inset;\r\n    }\r\n`;\r\nexport const StyledPredefinedOption = styled.div`\r\n    line-height: 0;\r\n    cursor: pointer;\r\n    min-height: 26.13px;\r\n    &.menu-active {\r\n        outline: var(--bw-lg) solid var(--main-active);\r\n        &:hover {\r\n            outline: var(--bw-lg) solid var(--sub-active);\r\n        }\r\n    }\r\n    &.preset-item-focused {\r\n        outline: var(--bw-lg) solid var(--sub-active);\r\n    }\r\n    :hover {\r\n        outline: var(--bw-lg) solid var(--sub-active);\r\n    }\r\n    img {\r\n        max-width: 100%;\r\n    }\r\n`;","import { InputNumber, Slider } from 'antd';\r\nimport { forwardRef, useEffect, useImperativeHandle, useState } from 'react';\r\nimport { CompactPicker } from 'react-color';\r\nimport PowerSlider from 'react-input-slider';\r\nimport { NameStyle } from 'src/model';\r\n\r\nexport type GridSliderInputRef = {\r\n    setValue: (value: Partial<{\r\n        x: number;\r\n        y: number;\r\n        width: number;\r\n        color: string;\r\n    }>) => void,\r\n};\r\nexport type GridSliderInput = {\r\n    className: string,\r\n    defaultValue: Partial<NameStyle>,\r\n    fieldMap: {\r\n        x: keyof NameStyle,\r\n        y: keyof NameStyle,\r\n        width: keyof NameStyle,\r\n        color: keyof NameStyle,\r\n    },\r\n    labelMap: Partial<Record<keyof NameStyle, React.ReactNode>>,\r\n    onChange: (value: {\r\n        x: number;\r\n        y: number;\r\n        width: number;\r\n        color: string;\r\n    }) => void,\r\n}\r\nexport const GridSliderInput = forwardRef<GridSliderInputRef, GridSliderInput>(({\r\n    className,\r\n    defaultValue,\r\n    fieldMap,\r\n    labelMap,\r\n    onChange,\r\n}, ref) => {\r\n    const {\r\n        x: xField,\r\n        y: yField,\r\n        color: colorField,\r\n        width: widthField,\r\n    } = fieldMap;\r\n    const [value, setValue] = useState(() => {\r\n        const xValue = defaultValue[xField] as number;\r\n        const yValue = defaultValue[yField] as number;\r\n        const colorValue = defaultValue[colorField] as string;\r\n        const widthValue = defaultValue[widthField] as number;\r\n\r\n        return {\r\n            x: xValue ?? 0,\r\n            y: yValue ?? 0,\r\n            width: widthValue ?? 0,\r\n            color: colorValue,\r\n        };\r\n    });\r\n    const {\r\n        x,\r\n        y,\r\n        color,\r\n        width,\r\n    } = value;\r\n    const widthLabel = labelMap[widthField];\r\n\r\n    useEffect(() => {\r\n        let relevant = true;\r\n        setTimeout(() => {\r\n            if (relevant) {\r\n                onChange(value);\r\n            }\r\n        }, 500);\r\n\r\n        return () => {\r\n            relevant = false;\r\n        };\r\n    /** No need to depend on handler */\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [value]);\r\n\r\n    useImperativeHandle(ref, () => ({\r\n        setValue: nextValue => {\r\n            const keyList = Object.keys(nextValue) as (keyof typeof value)[];\r\n\r\n            for (const key in keyList) {\r\n                if (nextValue[key as keyof typeof value] !== value[key as keyof typeof value]) {\r\n                    setValue(cur => ({ ...cur, ...nextValue }));\r\n                    return;\r\n                }\r\n            }\r\n        },\r\n    }));\r\n\r\n    return <div className={className}>\r\n        <h2>Position</h2>\r\n        <div className=\"line-position\">\r\n            <PowerSlider axis=\"xy\"\r\n                styles={{\r\n                    track: {\r\n                        backgroundColor: 'var(--main-slider)',\r\n                        width: 100,\r\n                        height: 100,\r\n                        gridRow: 'span 3',\r\n                        position: 'relative',\r\n                    },\r\n                    thumb: {\r\n                        backgroundColor: 'var(--sub-slider)',\r\n                        zIndex: 10,\r\n                    },\r\n                }}\r\n                xmax={5} xmin={-5}\r\n                ymax={5} ymin={-5}\r\n                x={x ?? 0}\r\n                y={y ?? 0}\r\n                onChange={({ x, y }) => setValue(cur => ({ ...cur, x, y }))} />\r\n            <div className=\"single-slider\">\r\n                X Offset: <InputNumber\r\n                    size=\"small\"\r\n                    value={x}\r\n                    onChange={value => setValue(cur => ({ ...cur, x: typeof value === 'number' ? value : parseInt(value ?? '0') }))}\r\n                />\r\n            </div>\r\n            <div className=\"single-slider\">\r\n                Y Offset: <InputNumber\r\n                    size=\"small\"\r\n                    value={y}\r\n                    onChange={value => setValue(cur => ({ ...cur, y: typeof value === 'number' ? value : parseInt(value ?? '0') }))}\r\n                />\r\n            </div>\r\n            <div className=\"single-slider\">\r\n                {widthLabel}: <Slider\r\n                    value={width}\r\n                    min={1}\r\n                    max={10}\r\n                    onChange={value => {\r\n                        if (typeof value === 'number') {\r\n                            setValue(cur => ({ ...cur, width: value }));\r\n                        }\r\n                    }}\r\n                />\r\n            </div>\r\n        </div>\r\n        <h2>Color</h2>\r\n        <CompactPicker color={color} onChangeComplete={color => setValue(cur => ({ ...cur, color: color.hex }))} />\r\n    </div>;\r\n});","import { forwardRef, useImperativeHandle, useRef, useState } from 'react';\r\nimport { StyledPredefinedContainer, StyledPredefinedOption } from './style-picker.styled';\r\nimport { NameStyle, PresetNameStyle, PresetNameStyleList } from 'src/model';\r\nimport { getNavigationProps, mergeClass } from 'src/util';\r\n\r\nexport type PredefinedOptionGridRef = {\r\n    focus: () => void,\r\n};\r\nexport type PredefinedOptionGrid = {\r\n    active: boolean,\r\n    value: Partial<NameStyle>,\r\n    onClick: (value: {\r\n        key: PresetNameStyle,\r\n        label: string,\r\n        image: string,\r\n        value: Partial<NameStyle>,\r\n    }) => void,\r\n    onCancel?: () => void,\r\n};\r\nexport const PredefinedOptionGrid = forwardRef<PredefinedOptionGridRef, PredefinedOptionGrid>(({\r\n    active,\r\n    value,\r\n    onClick,\r\n    onCancel,\r\n}, ref) => {\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n    const [focus, setFocus] = useState(0);\r\n\r\n    useImperativeHandle(ref, () => ({\r\n        focus: () => containerRef.current?.focus(),\r\n    }));\r\n\r\n    return <StyledPredefinedContainer ref={containerRef}\r\n        {...getNavigationProps({\r\n            stopPropagation: true,\r\n            optionLength: PresetNameStyleList.length,\r\n            setFocus,\r\n            onTrigger: () => {\r\n                if (focus >= 0) onClick(PresetNameStyleList[focus]);\r\n            },\r\n            onCancel: () => {\r\n                onCancel?.();\r\n            }\r\n        })}\r\n    >\r\n        {PresetNameStyleList.map((entry, index) => {\r\n            const { key, image, label } = entry;\r\n\r\n            return <StyledPredefinedOption key={key}\r\n                className={mergeClass(\r\n                    'preset-item',\r\n                    value.preset === key && active ? 'menu-active' : '',\r\n                    focus === index ? 'preset-item-focused' : '',\r\n                )}\r\n                onClick={e => {\r\n                    e.stopPropagation();\r\n                    onClick(entry);\r\n                }}\r\n            >\r\n                {/** Tooltip currently is not really helpful, and gives poor UX */}\r\n                {/* <Tooltip title={label} placement=\"right\"> */}\r\n                <img\r\n                    className=\"preset-preview\"\r\n                    src={`${process.env.PUBLIC_URL}/${image}`}\r\n                    alt={label}\r\n                />\r\n                {/* </Tooltip> */}\r\n            </StyledPredefinedOption>;\r\n        })}\r\n    </StyledPredefinedContainer>;\r\n});","import { Checkbox, Popover } from 'antd';\r\nimport { useCallback, useEffect, useRef, useState, forwardRef, useImperativeHandle, ForwardedRef } from 'react';\r\nimport { CompactPicker } from 'react-color';\r\nimport { CaretDownOutlined, CloseCircleOutlined } from '@ant-design/icons';\r\nimport {\r\n    PresetNameStyleMap,\r\n    NameStyle,\r\n    NameStyleType,\r\n    PatternList,\r\n    FrameInfo,\r\n} from '../../../model';\r\nimport debounce from 'lodash.debounce';\r\nimport { getNavigationProps, mergeClass, stringifyPalette, useRefresh } from 'src/util';\r\nimport { TextGradientPicker } from './gradient-picker';\r\nimport { NameFontOptionList } from '../const';\r\nimport { StyledDropdown } from 'src/component';\r\nimport {\r\n    StyledPatternContainer,\r\n    StyledPatternOption,\r\n    StyledPickerButton,\r\n} from './style-picker.styled';\r\nimport { useSetting } from 'src/service';\r\nimport { GridSliderInput, GridSliderInputRef } from './grid-slider-input';\r\nimport { PredefinedOptionGrid, PredefinedOptionGridRef } from './predefined-option-grid';\r\nimport './style-picker.scss';\r\n\r\nexport type TextStylePickerRef = {\r\n    setValue: (value: Partial<NameStyle>) => void,\r\n};\r\nexport type TextStylePicker = {\r\n    frameInfo?: FrameInfo,\r\n    defaultType: NameStyleType,\r\n    defaultValue: Partial<NameStyle>,\r\n    showExtraDecorativeOption: boolean,\r\n    onChange: (type: NameStyleType, style: Partial<NameStyle>) => void,\r\n};\r\nexport const TextStylePicker = forwardRef(({\r\n    frameInfo,\r\n    defaultType,\r\n    defaultValue,\r\n    showExtraDecorativeOption,\r\n    onChange: undebouncedOnChange,\r\n}: TextStylePicker, ref: ForwardedRef<TextStylePickerRef>) => {\r\n    const optionGridRef = useRef<PredefinedOptionGridRef>(null);\r\n    const [focus, setFocus] = useState(-1);\r\n    const [predefinedDropdownVisible, setPredefinedDropdownVisible] = useState(false);\r\n    const [type, setType] = useState(defaultType);\r\n    const [value, setValue] = useState(defaultValue);\r\n    const [customStyleSignal, sendCustomStyleSignal] = useRefresh();\r\n    const onChange = useRef(debounce(undebouncedOnChange, 250)).current;\r\n    const memoizedOnGradientChange = useCallback((palette, gradientAngle) => {\r\n        setValue(cur => ({ ...cur, gradientAngle, gradientColor: stringifyPalette(palette) }));\r\n        customStyleSignal();\r\n    }, [customStyleSignal]);\r\n    const reduceColorMotion = useSetting(state => state.setting.reduceMotionColor);\r\n\r\n    useEffect(() => {\r\n        if (sendCustomStyleSignal !== 0) {\r\n            setType('custom');\r\n            onChange('custom', value);\r\n        }\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [sendCustomStyleSignal]);\r\n\r\n    const shadowPickeRef = useRef<GridSliderInputRef>(null);\r\n    const outlinePickeRef = useRef<GridSliderInputRef>(null);\r\n\r\n    useImperativeHandle(ref, () => ({\r\n        setValue: nextValue => {\r\n            setValue(currentValue => ({ ...currentValue, ...nextValue }));\r\n\r\n            const {\r\n                lineColor, lineWidth, lineOffsetX, lineOffsetY,\r\n                shadowBlur, shadowColor, shadowOffsetX, shadowOffsetY,\r\n            } = nextValue;\r\n            shadowPickeRef.current?.setValue({\r\n                x: shadowOffsetX, y: shadowOffsetY,\r\n                width: shadowBlur, color: shadowColor,\r\n            });\r\n            outlinePickeRef.current?.setValue({\r\n                x: lineOffsetX, y: lineOffsetY,\r\n                width: lineWidth, color: lineColor,\r\n            });\r\n        },\r\n    }));\r\n    const {\r\n        fillStyle,\r\n        headTextFillStyle,\r\n        hasOutline,\r\n        hasShadow,\r\n        hasGradient, gradientColor, gradientAngle,\r\n        pattern,\r\n        font,\r\n    } = value;\r\n    const { labelBackgroundColor, labelBackgroundImage } = frameInfo ?? {};\r\n    const patternStyle = {\r\n        background: labelBackgroundColor,\r\n        backgroundImage: labelBackgroundImage,\r\n    };\r\n    const isStyleCustom = type === 'custom';\r\n    const isStylePredefined = type === 'predefined';\r\n    const optionInputContainerId = 'name-style-option-input-container';\r\n    const applyAutoStyle = () => {\r\n        setType('auto');\r\n        if (type !== 'auto') onChange('auto', value);\r\n    };\r\n    const applyPredefinedStyle = () => {\r\n        const presetValue = value.preset\r\n            ? PresetNameStyleMap[value.preset]?.value\r\n            : {};\r\n        setType('predefined');\r\n        setValue(cur => ({ ...cur, ...presetValue }));\r\n        onChange('predefined', { ...value, ...presetValue });\r\n    };\r\n    const applyCustomStyle = () => {\r\n        setType('custom');\r\n        if (type !== 'custom') onChange('custom', value);\r\n    };\r\n    return <div className=\"ant-input-group-wrapper text-style-input\">\r\n        <span className=\"ant-input-wrapper ant-input-group\">\r\n            <span className=\"ant-input-group-addon\">Name Style</span>\r\n            <span className=\"name-style-input-container\">\r\n                <div\r\n                    id={optionInputContainerId}\r\n                    className=\"ant-radio-group ant-radio-group-outline name-style-option-input-container\"\r\n                    {...getNavigationProps({\r\n                        setFocus,\r\n                        optionLength: 3,\r\n                        onKeyPress: e => {\r\n                            if (focus === 1 && (e.key === 'ArrowDown' || e.key === 'Enter' || e.key === '  ')) {\r\n                                e.preventDefault();\r\n                                setFocus(1);\r\n                                setPredefinedDropdownVisible(true);\r\n                                /** Popover takes time to mount / become visible */\r\n                                setTimeout(() => {\r\n                                    if (focus === 1) optionGridRef.current?.focus();\r\n                                }, 200);\r\n\r\n                                return false;\r\n                            }\r\n                        },\r\n                        onTrigger() {\r\n                            if (focus === 0) applyAutoStyle();\r\n                            if (focus === 1) applyPredefinedStyle();\r\n                            if (focus === 2) applyCustomStyle();\r\n                        },\r\n                    })}\r\n                >\r\n                    <label\r\n                        className={mergeClass(\r\n                            'ant-radio-wrapper',\r\n                            type === 'auto' && 'ant-radio-wrapper-checked',\r\n                            focus === 0 && 'ant-radio-focused',\r\n                        )}\r\n                        onClick={() => applyAutoStyle()}\r\n                    >\r\n                        <span className={`ant-radio ${type === 'auto' ? 'ant-radio-checked' : ''}`}>\r\n                            <input tabIndex={-1} type=\"radio\" className=\"ant-radio-input\" value=\"auto\" />\r\n                            <span className=\"ant-radio-inner\" />\r\n                        </span>\r\n                        <span className=\"ant-radio-label\">Auto</span>\r\n                    </label>\r\n                    <span className=\"name-style-option-break\" />\r\n                    <label\r\n                        className={mergeClass(\r\n                            'ant-radio-wrapper',\r\n                            isStylePredefined && 'ant-radio-wrapper-checked',\r\n                            focus === 1 && 'ant-radio-focused',\r\n                        )}\r\n                        onClick={() => applyPredefinedStyle()}\r\n                    >\r\n                        <Popover\r\n                            visible={predefinedDropdownVisible}\r\n                            onVisibleChange={setPredefinedDropdownVisible}\r\n                            trigger={['hover', 'click']}\r\n                            placement=\"bottomLeft\"\r\n                            overlayClassName=\"predefined-picker-overlay\"\r\n                            content={<div className=\"overlay-event-absorber\">\r\n                                <PredefinedOptionGrid ref={optionGridRef}\r\n                                    active={isStylePredefined}\r\n                                    value={value}\r\n                                    onCancel={() => {\r\n                                        setPredefinedDropdownVisible(false);\r\n                                        document.getElementById(optionInputContainerId)?.focus();\r\n                                    }}\r\n                                    onClick={({ key }) => {\r\n                                        const presetValue = key\r\n                                            ? PresetNameStyleMap[key]?.value\r\n                                            : {};\r\n                                        setType('predefined');\r\n                                        setValue(cur => ({ ...cur, ...presetValue }));\r\n                                        onChange('predefined', { ...value, ...presetValue });\r\n                                    }}\r\n                                />\r\n                            </div>}\r\n                        >\r\n                            <span className=\"name-style-option-label\">\r\n                                <span className={`ant-radio ${isStylePredefined ? 'ant-radio-checked' : ''}`}>\r\n                                    <input tabIndex={-1} type=\"radio\" className=\"ant-radio-input\" value=\"predefined\" />\r\n                                    <span className=\"ant-radio-inner\" />\r\n                                </span>\r\n                                <span className=\"ant-radio-label\">Predefined</span>\r\n                            </span>\r\n                        </Popover>\r\n                    </label>\r\n                    <span className=\"name-style-option-break\" />\r\n                    <label\r\n                        className={mergeClass(\r\n                            'ant-radio-wrapper',\r\n                            isStyleCustom && 'ant-radio-wrapper-checked',\r\n                            focus === 2 && 'ant-radio-focused',\r\n                        )}\r\n                        onClick={() => applyCustomStyle()}\r\n                    >\r\n                        <span>\r\n                            <span className={`ant-radio ${isStyleCustom ? 'ant-radio-checked' : ''}`}>\r\n                                <input tabIndex={-1} type=\"radio\" className=\"ant-radio-input\" value=\"custom\" />\r\n                                <span className=\"ant-radio-inner\" />\r\n                            </span>\r\n                            <span className=\"ant-radio-label ant-radio-label-custom\">Custom</span>\r\n                        </span>\r\n                    </label>\r\n                </div>\r\n                <div className=\"style-picker\">\r\n                    <Popover key=\"color-picker\"\r\n                        trigger={['click']}\r\n                        overlayClassName=\"input-overlay style-picker-overlay\"\r\n                        content={<div className=\"overlay-event-absorber\">\r\n                            <div className={'custom-style-picker'}>\r\n                                <div className=\"custom-style-text\">\r\n                                    <h3>Text Color</h3>\r\n                                    <CompactPicker color={fillStyle} onChangeComplete={color => {\r\n                                        setType('custom');\r\n                                        setValue(cur => ({ ...cur, fillStyle: color.hex }));\r\n                                        customStyleSignal();\r\n                                    }} />\r\n                                </div>\r\n                                <hr />\r\n                                <div className=\"custom-style-text\">\r\n                                    <h3>Ruby Color (<small>Japanese Furigana</small>)</h3>\r\n                                    <CompactPicker color={headTextFillStyle} onChangeComplete={color => {\r\n                                        setType('custom');\r\n                                        setValue(cur => ({ ...cur, headTextFillStyle: color.hex }));\r\n                                        customStyleSignal();\r\n                                    }} />\r\n                                </div>\r\n                            </div>\r\n                        </div>}\r\n                        placement=\"bottom\"\r\n                    >\r\n                        <StyledPickerButton $softMode={reduceColorMotion} className=\"picker-dropdown color-picker-dropdown\">\r\n                            Color <CaretDownOutlined />\r\n                        </StyledPickerButton>\r\n                    </Popover>\r\n                    {showExtraDecorativeOption && <Popover key=\"shadow-picker\"\r\n                        trigger={['click']}\r\n                        overlayClassName=\"input-overlay style-picker-overlay\"\r\n                        content={<div className=\"overlay-event-absorber\">\r\n                            <div className={'custom-style-picker'}>\r\n                                <h3 className=\"custom-style-expand\">\r\n                                    <Checkbox value={'has-shadow'} checked={hasShadow} onChange={() => {\r\n                                        setType('custom');\r\n                                        setValue(cur => ({ ...cur, hasShadow: !cur.hasShadow }));\r\n                                        customStyleSignal();\r\n                                    }}>Has Shadow?</Checkbox>\r\n                                </h3>\r\n                                {hasShadow && <GridSliderInput ref={shadowPickeRef}\r\n                                    className=\"custom-style-shadow\"\r\n                                    fieldMap={{\r\n                                        color: 'shadowColor',\r\n                                        width: 'shadowBlur',\r\n                                        x: 'shadowOffsetX',\r\n                                        y: 'shadowOffsetY',\r\n                                    }}\r\n                                    labelMap={{\r\n                                        shadowBlur: 'Blur',\r\n                                    }}\r\n                                    defaultValue={value}\r\n                                    onChange={({ color, width, x, y }) => {\r\n                                        setValue(cur => ({\r\n                                            ...cur,\r\n                                            shadowBlur: width,\r\n                                            shadowColor: color,\r\n                                            shadowOffsetX: x,\r\n                                            shadowOffsetY: y,\r\n                                        }));\r\n                                        customStyleSignal();\r\n                                    }}\r\n                                />}\r\n                            </div>\r\n                        </div>}\r\n                        placement=\"bottom\"\r\n                    >\r\n                        <StyledPickerButton\r\n                            $softMode={reduceColorMotion}\r\n                            $active={isStyleCustom && hasShadow}\r\n                            className=\"picker-dropdown shadow-picker-dropdown\"\r\n                        >\r\n                            Shadow <CaretDownOutlined />\r\n                        </StyledPickerButton>\r\n                    </Popover>}\r\n                    <Popover key=\"outline-picker\"\r\n                        trigger={['click']}\r\n                        overlayClassName=\"input-overlay style-picker-overlay\"\r\n                        content={<div className=\"overlay-event-absorber\">\r\n                            <div className={'custom-style-picker'}>\r\n                                <h3 className=\"custom-style-expand\">\r\n                                    <Checkbox value={'has-line'} checked={hasOutline} onChange={() => {\r\n                                        setType('custom');\r\n                                        setValue(cur => ({ ...cur, hasOutline: !cur.hasOutline }));\r\n                                        customStyleSignal();\r\n                                    }}>Has outline?</Checkbox>\r\n                                </h3>\r\n                                {hasOutline && <GridSliderInput ref={outlinePickeRef}\r\n                                    className=\"custom-style-line\"\r\n                                    fieldMap={{\r\n                                        color: 'lineColor',\r\n                                        width: 'lineWidth',\r\n                                        x: 'lineOffsetX',\r\n                                        y: 'lineOffsetY',\r\n                                    }}\r\n                                    labelMap={{\r\n                                        lineWidth: 'Thickness',\r\n                                    }}\r\n                                    defaultValue={value}\r\n                                    onChange={({ color, width, x, y }) => {\r\n                                        setValue(cur => ({\r\n                                            ...cur,\r\n                                            lineWidth: width,\r\n                                            lineColor: color,\r\n                                            lineOffsetX: x,\r\n                                            lineOffsetY: y,\r\n                                        }));\r\n                                        customStyleSignal();\r\n                                    }}\r\n                                />}\r\n                            </div>\r\n                        </div>}\r\n                        placement=\"bottom\"\r\n                    >\r\n                        <StyledPickerButton\r\n                            $softMode={reduceColorMotion}\r\n                            $active={isStyleCustom && hasOutline}\r\n                            className=\"picker-dropdown outline-picker-dropdown\"\r\n                        >\r\n                            Outline <CaretDownOutlined />\r\n                        </StyledPickerButton>\r\n                    </Popover>\r\n                    {showExtraDecorativeOption && <Popover key=\"gradient-picker\"\r\n                        trigger={['click']}\r\n                        overlayClassName=\"input-overlay style-picker-overlay\"\r\n                        content={<div className=\"overlay-event-absorber\">\r\n                            <div className={'custom-style-picker'}>\r\n                                <h3 className=\"custom-style-expand\">\r\n                                    <Checkbox value={'has-gradient'} checked={hasGradient} onChange={() => {\r\n                                        setType('custom');\r\n                                        setValue(cur => ({ ...cur, hasGradient: !cur.hasGradient }));\r\n                                        customStyleSignal();\r\n                                    }}>Has gradient?</Checkbox>\r\n                                </h3>\r\n                                {hasGradient && <div className=\"custom-style-gradient\">\r\n                                    <TextGradientPicker\r\n                                        angle={gradientAngle}\r\n                                        palette={gradientColor}\r\n                                        memoizedOnChange={memoizedOnGradientChange}\r\n                                    />\r\n                                </div>}\r\n                            </div>\r\n                        </div>}\r\n                        placement=\"bottom\"\r\n                    >\r\n                        <StyledPickerButton\r\n                            $softMode={reduceColorMotion}\r\n                            $active={isStyleCustom && hasGradient}\r\n                            className=\"picker-dropdown gradient-picker-dropdown\"\r\n                        >\r\n                            Gradient <CaretDownOutlined />\r\n                        </StyledPickerButton>\r\n                    </Popover>}\r\n                    {showExtraDecorativeOption && <Popover key=\"pattern-picker\"\r\n                        trigger={['click']}\r\n                        overlayClassName=\"input-overlay pattern-picker-overlay\"\r\n                        content={<div className=\"overlay-event-absorber\">\r\n                            <StyledPatternContainer onClick={e => e.stopPropagation()}>\r\n                                <div className=\"alert\">Pattern will disable shadow and gradient</div>\r\n                                {PatternList.map(({ key, patternImage }) => {\r\n                                    return <StyledPatternOption key={key}\r\n                                        className={[\r\n                                            'pattern-option',\r\n                                            value.pattern === key ? 'menu-active' : '',\r\n                                            patternImage ? '' : 'menu-off',\r\n                                        ].join(' ')}\r\n                                        onClick={() => {\r\n                                            setValue(cur => ({ ...cur, pattern: key }));\r\n                                            customStyleSignal();\r\n                                        }}\r\n                                    >\r\n                                        {patternImage\r\n                                            ? <img\r\n                                                style={patternImage ? patternStyle : {}}\r\n                                                className=\"pattern-image\"\r\n                                                src={`${process.env.PUBLIC_URL}/asset/image/finish-name/${patternImage}.png`}\r\n                                                alt={key}\r\n                                            />\r\n                                            : <>\r\n                                                <CloseCircleOutlined /> No Pattern\r\n                                            </>}\r\n                                    </StyledPatternOption>;\r\n                                })}\r\n                            </StyledPatternContainer>\r\n                        </div>}\r\n                        placement=\"bottomLeft\"\r\n                    >\r\n                        <StyledPickerButton\r\n                            $softMode={reduceColorMotion}\r\n                            $active={isStyleCustom && typeof pattern === 'string' && pattern !== 'none'}\r\n                            className=\"picker-dropdown pattern-picker-dropdown\"\r\n                        >\r\n                            Pattern\r\n                        </StyledPickerButton>\r\n                    </Popover>}\r\n                    <Popover key=\"font-picker\"\r\n                        trigger={['click']}\r\n                        overlayClassName=\"input-overlay font-picker-overlay\"\r\n                        content={<div className=\"overlay-event-absorber\">\r\n                            <StyledDropdown.Container>\r\n                                {NameFontOptionList.map(({ value: fontValue, label }) => {\r\n                                    return <StyledDropdown.Option key={fontValue}\r\n                                        className={font === fontValue ? 'menu-active' : ''}\r\n                                        onClick={() => {\r\n                                            setValue(cur => ({ ...cur, font: fontValue }));\r\n                                            customStyleSignal();\r\n                                        }}\r\n                                    >\r\n                                        {label}\r\n                                    </StyledDropdown.Option>;\r\n                                })}\r\n                            </StyledDropdown.Container>\r\n                        </div>}\r\n                        placement=\"bottomLeft\"\r\n                    >\r\n                        <StyledPickerButton $softMode={reduceColorMotion} className=\"picker-dropdown font-picker-dropdown\">\r\n                            Font\r\n                        </StyledPickerButton>\r\n                    </Popover>\r\n                </div>\r\n            </span>\r\n        </span>\r\n    </div>;\r\n});\r\n","import { useCallback, useState } from 'react';\r\n\r\nexport const useRefresh = (): [() => void, number] => {\r\n    const [cnt, setCnt] = useState(0);\r\n    const refresh = useCallback(() => {\r\n        setCnt(cur => cur + 1);\r\n    }, []);\r\n\r\n    return [refresh, cnt];\r\n};","import { css } from 'styled-components';\r\n\r\nexport const InputTrainStyle = css`\r\n    display: flex;\r\n    .checkbox-train-input-group,\r\n    .radio-train-input-group {\r\n        display: flex;\r\n        flex: 1 1 auto;\r\n\t\t&:focus-visible {\r\n\t\t\t.radio-train-focused,\r\n\t\t\t.checkbox-train-focused {\r\n\t\t\t\tbackground-color: var(--main-level-3);\r\n\t\t\t}\r\n\t\t}\r\n    }\r\n    .ant-radio-button-wrapper {\r\n        user-select: none;\r\n    }\r\n    .ant-radio-button-wrapper:first-child,\r\n    .ant-radio-button-wrapper:last-child {\r\n        border-radius: 0;\r\n    }\r\n    .ant-radio-button-wrapper:not(.ant-radio-button-wrapper-checked):first-child {\r\n        border-left-color: var(--sub-level-1);\r\n    }\r\n`;\r\n\r\nexport const TrainGridStyle = css`\r\n    .checkbox-train-input-group,\r\n    .radio-train-input-group {\r\n\t\tdisplay: flex;\r\n\t\tflex-wrap: wrap;\r\n\t\tcolumn-gap: var(--spacing-xs);\r\n\t\trow-gap: var(--spacing-xs);\r\n\t\tbox-shadow: none;\r\n\t\tborder-radius: 0;\r\n\t\t&:focus-visible {\r\n\t\t\toutline: 3px solid var(--focus); // +1 width size to account for shadow\r\n\t\t}\r\n\t\t.ant-radio-button-wrapper:first-child,\r\n\t\t.ant-radio-button-wrapper:last-child {\r\n\t\t\tborder-radius: 0;\r\n\t\t}\r\n\t\t.ant-radio-button-wrapper {\r\n\t\t\tflex: 1;\r\n\t\t\ttext-transform: capitalize;\r\n\t\t\twhite-space: nowrap;\r\n\t\t\tborder: none;\r\n\t\t\tbox-shadow: var(--bs-1);\r\n\t\t\tpadding: 0;\r\n\t\t\tmin-width: 90px;\r\n\t\t\theight: 28px;\r\n\t\t\tline-height: 28px;\r\n\t\t\ttext-align: center;\r\n\t\t\ttext-shadow: none;\r\n\t\t\tfont-size: var(--fs-sm);\r\n\t\t\t&:hover {\r\n\t\t\t\toutline: var(--bw) solid var(--main-active);\r\n\t\t\t\toutline-offset: var(--bw);\r\n\t\t\t}\r\n\t\t\t&::before {\r\n\t\t\t\tdisplay: none;\r\n\t\t\t}\r\n\t\t}\r\n\t\t.ant-radio-button-wrapper-checked {\r\n\t\t\toutline: var(--bw) solid var(--main-active);\r\n\t\t\toutline-offset: var(--bw);\r\n\t\t}\r\n\t}\r\n`;","import styled from 'styled-components';\r\nimport { InputTrainStyle } from './input-train.styled';\r\nimport { forwardRef, useImperativeHandle, useRef, useState } from 'react';\r\nimport { getNavigationProps } from 'src/util';\r\n\r\nconst StyledRadioTrainContainer = styled.div`\r\n    ${InputTrainStyle}\r\n`;\r\nexport type RadioTrainRef = {\r\n    focus: () => void,\r\n}\r\nexport type RadioTrain = {\r\n    className?: string,\r\n    value: string,\r\n    optionList: { label: React.ReactNode, value: string | number, props?: React.LabelHTMLAttributes<HTMLLabelElement> }[],\r\n    onChange: (value: string | number) => void,\r\n    children?: React.ReactNode,\r\n}\r\nexport const RadioTrain = forwardRef<RadioTrainRef, RadioTrain>(({\r\n    onChange,\r\n    value: activeValue,\r\n    optionList,\r\n    children,\r\n    className,\r\n}, ref) => {\r\n    const [focus, setFocus] = useState(-1);\r\n    const internalRef = useRef<HTMLDivElement>(null);\r\n    const optionLength = optionList.length;\r\n\r\n    useImperativeHandle(ref, () => ({\r\n        focus: () => internalRef.current?.focus(),\r\n    }));\r\n\r\n    return <StyledRadioTrainContainer\r\n        className={['ant-radio-group ant-radio-group-outline radio-train', className].join(' ')}\r\n    >\r\n        {children && <label className=\"standalone-addon ant-input-group-addon\">{children}</label>}\r\n        <div ref={internalRef}\r\n            className=\"radio-train-input-group\"\r\n            {...getNavigationProps({\r\n                setFocus,\r\n                optionLength,\r\n                onTrigger: () => {\r\n                    const target = optionList[focus];\r\n                    if (target) {\r\n                        onChange(target.value);\r\n                    }\r\n                },\r\n            })}\r\n        >\r\n            {optionList.map(({ value, props, label }, index) => {\r\n                const { className } = props ?? {};\r\n                const isChecked = `${value}` === `${activeValue}`;\r\n\r\n                return <label key={value}\r\n                    {...props}\r\n                    className={[\r\n                        'ant-radio-button-wrapper',\r\n                        isChecked ? 'ant-radio-button-wrapper-checked' : '',\r\n                        className ?? '',\r\n                        focus === index ? 'radio-train-focused' : '',\r\n                    ].join(' ')}\r\n                    onClick={() => onChange(value)}\r\n                >\r\n                    <span className={`ant-radio-button ${isChecked ? 'ant-radio-button-checked' : ''}`}>\r\n                        <span className=\"ant-radio-button-inner\"></span>\r\n                    </span>\r\n                    <span className=\"label\">{label}</span>\r\n                </label>;\r\n            })}\r\n        </div>\r\n    </StyledRadioTrainContainer>;\r\n});","import { useCard, useSetting } from 'src/service';\r\nimport { RadioTrain } from './radio-train';\r\nimport { useCallback, useMemo } from 'react';\r\nimport { getFrameButtonList } from '../const';\r\nimport styled from 'styled-components';\r\nimport { useShallow } from 'zustand/react/shallow';\r\nimport { tcgToOCGTermMap } from 'src/model';\r\nimport { TrainGridStyle } from './input-train.styled';\r\n\r\nconst StyledFrameTrain = styled(RadioTrain)`\r\n\t${TrainGridStyle}\r\n`;\r\n\r\nexport type FrameTrain = {\r\n    onSTFrameChange: (value: string[]) => void,\r\n};\r\nexport const FrameTrain = ({\r\n    onSTFrameChange,\r\n}: FrameTrain) => {\r\n    const {\r\n        setting,\r\n    } = useSetting();\r\n    const { showExtraDecorativeOption } = setting;\r\n    const frameList = useMemo(() => getFrameButtonList()\r\n        .filter(entry => {\r\n            return showExtraDecorativeOption || entry.edition === 'normal';\r\n        }),\r\n        [showExtraDecorativeOption],\r\n    );\r\n\r\n    const {\r\n        frame,\r\n        setCard,\r\n    } = useCard(useShallow(({\r\n        card,\r\n        setCard,\r\n    }) => ({\r\n        frame: card.frame,\r\n        setCard,\r\n    })));\r\n    const changeFrame = useCallback((frameValue: number | string) => {\r\n        setCard(currentCard => {\r\n            const {\r\n                typeAbility,\r\n                isPendulum,\r\n                attribute,\r\n                format,\r\n            } = currentCard;\r\n            const nextFrame = `${frameValue}`;\r\n            const isST = nextFrame === 'spell' || nextFrame === 'trap';\r\n            const termMap = format === 'tcg'\r\n                ? {\r\n                    'Spell Card': 'Spell Card',\r\n                    'Trap Card': 'Trap Card',\r\n                }\r\n                : tcgToOCGTermMap;\r\n            const newTypeAbility = nextFrame === 'spell'\r\n                ? [termMap['Spell Card']]\r\n                : nextFrame === 'trap' ? [termMap['Trap Card']] : typeAbility;\r\n            if (isST) onSTFrameChange(newTypeAbility);\r\n\r\n            return {\r\n                ...currentCard,\r\n                frame: nextFrame,\r\n                isPendulum: nextFrame === 'link' ? false : isPendulum,\r\n                attribute: isST\r\n                    ? `${nextFrame}`.toUpperCase()\r\n                    : attribute,\r\n                typeAbility: newTypeAbility,\r\n            };\r\n        });\r\n    }, [setCard, onSTFrameChange]);\r\n\r\n    return <StyledFrameTrain className=\"frame-radio\" value={frame} onChange={changeFrame} optionList={frameList} />;\r\n};","import styled from 'styled-components';\r\nimport { InputTrainStyle } from './input-train.styled';\r\nimport { useState } from 'react';\r\nimport { getNavigationProps } from 'src/util';\r\n\r\nconst StyledCheckboxTrainContainer = styled.div`\r\n    ${InputTrainStyle}\r\n`;\r\nexport type CheckboxTrain = {\r\n    className?: string,\r\n    value: string[],\r\n    optionList: { label: React.ReactNode, value: string | number, props?: React.LabelHTMLAttributes<HTMLLabelElement> }[],\r\n    onChange: (value: (string | number)[]) => void,\r\n    children?: React.ReactNode,\r\n}\r\nexport const CheckboxTrain = ({\r\n    onChange,\r\n    value: activeValue,\r\n    optionList,\r\n    children,\r\n    className,\r\n}: CheckboxTrain) => {\r\n    const [focus, setFocus] = useState(-1);\r\n    const optionLength = optionList.length;\r\n\r\n    return <StyledCheckboxTrainContainer\r\n        className={['ant-radio-group ant-radio-group-outline checkbox-train', className].join(' ')}\r\n    >\r\n        {children && <label className=\"standalone-addon ant-input-group-addon\">{children}</label>}\r\n        <div\r\n            className=\"checkbox-train-input-group\"\r\n            {...getNavigationProps({\r\n                setFocus,\r\n                optionLength,\r\n                onTrigger: () => {\r\n                    const target = optionList[focus];\r\n                    if (target) {\r\n                        const isChecked = Array.isArray(activeValue) ? activeValue.includes(`${target.value}`) : false;\r\n                        onChange(isChecked\r\n                            ? activeValue.filter(currentValue => `${target.value}` !== currentValue)\r\n                            : [...activeValue, `${target.value}`]);\r\n                    }\r\n                },\r\n            })}\r\n        >\r\n            {optionList.map((entry, index) => {\r\n                const { label, value, props } = entry;\r\n                const isChecked = Array.isArray(activeValue) ? activeValue.includes(`${value}`) : false;\r\n\r\n                return <label key={value}\r\n                    {...props}\r\n                    className={[\r\n                        'ant-radio-button-wrapper',\r\n                        isChecked ? 'ant-radio-button-wrapper-checked' : '',\r\n                        focus === index ? 'checkbox-train-focused' : '',\r\n                    ].join(' ')}\r\n                    onClick={() => {\r\n                        onChange(isChecked\r\n                            ? activeValue.filter(currentValue => `${value}` !== currentValue)\r\n                            : [...activeValue, `${value}`]);\r\n                    }}\r\n                >\r\n                    <span className={`ant-radio-button ${isChecked ? 'ant-radio-button-checked' : ''}`}>\r\n                        <span className=\"ant-radio-button-inner\"></span>\r\n                    </span>\r\n                    <span className=\"label\">{label}</span>\r\n                </label>;\r\n            })}\r\n        </div>\r\n    </StyledCheckboxTrainContainer>;\r\n};","import { forwardRef, useCallback, useEffect, useImperativeHandle, useMemo, useRef } from 'react';\r\nimport { useCard } from 'src/service';\r\nimport { ImageCropper, ImageCropperRef } from 'src/component';\r\nimport { useShallow } from 'zustand/react/shallow';\r\nimport { getArtCanvasCoordinate } from 'src/model';\r\nimport styled from 'styled-components';\r\n\r\nconst StyledImageCropper = styled(ImageCropper)`\r\n    display: grid;\r\n    grid-template-columns: max-content max-content;\r\n    align-items: start;\r\n    gap: 0;\r\n    .card-image-source-input {\r\n        display: flex;\r\n        flex-direction: column-reverse;\r\n        .online-image-tip {\r\n            text-align: center;\r\n        }\r\n    }\r\n    .card-cropper {\r\n        width: 375px;\r\n        text-align: center;\r\n    }\r\n`;\r\n\r\nexport type BackgroundInputGroupRef = {\r\n    setValue: (value: { background?: string, backgroundCrop?: Partial<ReactCrop.Crop> }) => void,\r\n};\r\nexport type BackgroundInputGroup = {\r\n    children?: React.ReactNode,\r\n    onCropChange?: (cropInfo: Partial<ReactCrop.Crop>, sourceType: 'internal' | 'external') => void,\r\n} & Pick<ImageCropper, 'backgroundColor' | 'receivingCanvas' | 'onTainted' | 'onSourceLoaded'>;\r\nexport const BackgroundInputGroup = forwardRef<BackgroundInputGroupRef, BackgroundInputGroup>(({\r\n    backgroundColor,\r\n    children,\r\n    receivingCanvas,\r\n    onSourceLoaded,\r\n    onTainted,\r\n    onCropChange,\r\n}, ref) => {\r\n    const {\r\n        background, backgroundCrop, backgroundType,\r\n        isPendulum,\r\n        opacity,\r\n        getUpdater,\r\n        setCard,\r\n    } = useCard(useShallow(({\r\n        card: {\r\n            background, backgroundCrop, backgroundType,\r\n            isPendulum,\r\n            opacity,\r\n        },\r\n        getUpdater,\r\n        setCard,\r\n    }) => ({\r\n        background, backgroundCrop, backgroundType,\r\n        isPendulum,\r\n        opacity,\r\n        getUpdater,\r\n        setCard,\r\n    })));\r\n    const imageCropperRef = useRef<ImageCropperRef>(null);\r\n\r\n    const changeBackground = useMemo(() => getUpdater('background'), [getUpdater]);\r\n    const changeBackgroundCrop = useCallback((cropInfo: Partial<ReactCrop.Crop>, sourceType: 'internal' | 'external') => {\r\n        onCropChange?.(cropInfo, sourceType);\r\n        if (cropInfo) setCard(curr => ({\r\n            ...curr,\r\n            backgroundCrop: cropInfo,\r\n        }));\r\n    }, [onCropChange, setCard]);\r\n\r\n    useEffect(() => {\r\n        imageCropperRef.current?.setRatio(getArtCanvasCoordinate(isPendulum, opacity, backgroundType).ratio);\r\n    }, [backgroundType, opacity, isPendulum]);\r\n\r\n    useImperativeHandle(ref, () => ({\r\n        setValue: ({ background, backgroundCrop }) => {\r\n            if (typeof background === 'string' && backgroundCrop) {\r\n                imageCropperRef.current?.forceExternalSource(background, backgroundCrop);\r\n            }\r\n        }\r\n    }));\r\n\r\n    return <StyledImageCropper\r\n        ref={imageCropperRef}\r\n        title=\"Image\"\r\n        backgroundColor={backgroundColor}\r\n        defaultExternalSource={background}\r\n        defaultCropInfo={backgroundCrop}\r\n        receivingCanvas={receivingCanvas}\r\n        onSourceChange={changeBackground}\r\n        onCropChange={changeBackgroundCrop}\r\n        onTainted={onTainted}\r\n        onSourceLoaded={onSourceLoaded}\r\n        ratio={getArtCanvasCoordinate(isPendulum, opacity, backgroundType).ratio}\r\n        beforeCropper={null}\r\n    >\r\n        {children}\r\n    </StyledImageCropper>;\r\n});","import { Checkbox, InputNumber, Popover, Slider, Tooltip } from 'antd';\r\nimport { forwardRef, useCallback, useEffect, useImperativeHandle, useMemo, useRef, useState } from 'react';\r\nimport { CompactPicker } from 'react-color';\r\nimport { BackgroundType, BackgroundTypeList, CardOpacity, DEFAULT_BASE_FILL_COLOR, OpacityList, getDefaultCardOpacity } from 'src/model';\r\nimport styled from 'styled-components';\r\nimport { BackgroundInputGroup, BackgroundInputGroupRef } from './background-input-group';\r\nimport { ImageCropper } from 'src/component';\r\nimport { RadioTrain } from '../input-train';\r\nimport { useCard } from 'src/service';\r\nimport { useShallow } from 'zustand/react/shallow';\r\nimport { BorderOuterOutlined } from '@ant-design/icons';\r\nimport './layout-picker.scss';\r\n\r\nconst StyledLayoutPickerContainer = styled.div`\r\n    display: flex;\r\n    flex-direction: row;\r\n    flex-wrap: wrap;\r\n    column-gap: var(--spacing-sm);\r\n    row-gap: var(--spacing-sm);\r\n    padding: 2px 0;\r\n    align-items: center;\r\n    .slider-label,\r\n    .ant-slider,\r\n    .slider-padding {\r\n        border: var(--bw) solid var(--sub-level-1);\r\n        background-color: var(--main-level-4);\r\n    }\r\n    .slider-label {\r\n        display: inline-flex;\r\n        column-gap: var(--spacing-xs);\r\n        border-right: none;\r\n        padding: var(--spacing-xxs) var(--spacing-xs);\r\n        border-radius: var(--br) 0 0 var(--br);\r\n        box-shadow: var(--bs-input);\r\n    }\r\n    .ant-slider {\r\n        margin: 0;\r\n        border-left: none;\r\n        border-right: none;\r\n        height: 28px; // Alignment\r\n        padding-top: 11px; // Alignment\r\n    }\r\n    .slider-padding {\r\n        border-left: none;\r\n        border-radius: 0 var(--br) var(--br) 0;\r\n    }\r\n    .ant-slider-rail,\r\n    .ant-slider-track {\r\n        border-radius: 0 var(--br) var(--br) 0;\r\n    }\r\n    .card-opacity-slider {\r\n        flex: 0 1 auto;\r\n        display: grid;\r\n        grid-template-columns: max-content 60px 45px 12px;\r\n        &.inactive {\r\n            .slider-label,\r\n            .ant-slider,\r\n            .slider-padding {\r\n                background-color: var(--main-level-3);\r\n            }\r\n        }\r\n    }\r\n    .ant-input-number.ant-input-number-sm {\r\n        height: 28px; // Alignment\r\n        width: unset;\r\n        border-radius: 0;\r\n        box-shadow: var(--bs-input);\r\n        .ant-input-number-input {\r\n            height: 26px; // Alignment\r\n        }\r\n    }\r\n    .background-preview {\r\n        display: inline-block;\r\n        line-height: 0;\r\n        width: 17px;\r\n        height: 17px; // Alignment\r\n        align-self: center;\r\n        border: 1px solid #333333;\r\n        cursor: pointer;\r\n        text-align: center;\r\n        user-select: none;\r\n        &:hover {\r\n            box-shadow: 0 0 2px 0 #222222;\r\n        }\r\n        .background-image-preview {\r\n            max-width: 15px;\r\n            max-height: 15px;\r\n        }\r\n        .no-background-icon {\r\n            font-size: 15px; // Alignment\r\n        }\r\n    }\r\n`;\r\nconst StyledBaseFillPickerContainer = styled.div`\r\n    &.overlay-no-background-image {\r\n        .card-image-cropper {\r\n            grid-template-columns: 1fr;\r\n        }\r\n        .card-cropper {\r\n            min-height: 0;\r\n            line-height: 0;\r\n            width: 0;\r\n            visibility: hidden;\r\n        }\r\n        .card-image-source-input {\r\n            padding-right: 0;\r\n            margin-right: 0;\r\n            border-right: none;\r\n        }\r\n        i {\r\n            max-width: 247px; // Alignment\r\n        }\r\n    }\r\n    i {\r\n        display: inline-block;\r\n        font-size: var(--fs-sm);\r\n        color: var(--color);\r\n        font-weight: normal;\r\n    }\r\n    .background-picker {\r\n        padding: var(--spacing-xs);\r\n        /** No display none here, again we want to keep card cropper painted, just not visible */\r\n        &.overlay-no-background {\r\n            visibility: hidden;\r\n            height: 0;\r\n            width: 0;\r\n            padding: 0;\r\n        }\r\n    }\r\n    .card-image-source-input {\r\n        padding-right: var(--spacing-xs);\r\n        margin-right: var(--spacing-xs);\r\n        border-right: var(--bw) solid var(--sub-level-4);\r\n        .type-section h2 {\r\n            margin-top: var(--spacing-xs);\r\n        }\r\n        .color-section h2 {\r\n            padding-top: 0;\r\n        }\r\n    }\r\n    .color-section {\r\n        > h2 + div {\r\n            > div:first-child {\r\n                box-shadow: none !important;\r\n            }\r\n            > div:nth-child(2) {\r\n                border: var(--bw) solid var(--main-level-1);\r\n            }\r\n        }\r\n    }\r\n`;\r\n\r\nexport type LayoutPicker = {\r\n    defaultValue: Partial<CardOpacity>,\r\n    onChange: (opacity: CardOpacity) => void,\r\n} & Pick<ImageCropper, 'receivingCanvas' | 'onTainted' | 'onCropChange' | 'onSourceLoaded'>;\r\nexport type OpacityPickerRef = {\r\n    setValue: (opacity: Partial<CardOpacity> & {\r\n        background?: string,\r\n        backgroundCrop?: Partial<ReactCrop.Crop>,\r\n        backgroundType?: BackgroundType,\r\n    }) => void,\r\n};\r\nexport const LayoutPicker = forwardRef<OpacityPickerRef, LayoutPicker>(({\r\n    receivingCanvas,\r\n    defaultValue,\r\n    onTainted,\r\n    onChange,\r\n    onSourceLoaded,\r\n    onCropChange,\r\n}, ref) => {\r\n    const {\r\n        hasBackground,\r\n        backgroundType,\r\n        isPendulum,\r\n        background,\r\n        setCard,\r\n        getUpdater,\r\n    } = useCard(useShallow(({\r\n        card: {\r\n            isPendulum,\r\n            hasBackground,\r\n            backgroundType,\r\n            background,\r\n        },\r\n        setCard,\r\n        getUpdater,\r\n    }) => ({\r\n        hasBackground,\r\n        backgroundType,\r\n        isPendulum,\r\n        background,\r\n        setCard,\r\n        getUpdater,\r\n    })));\r\n    const [backgroundInputVisible, setBackgroundInputVisible] = useState(true);\r\n    const [backgroundInputHidden, setBackgroundInputHidden] = useState(true);\r\n    const [opacity, setOpacity] = useState({ ...getDefaultCardOpacity(), ...defaultValue });\r\n    const backgroundInputRef = useRef<BackgroundInputGroupRef>(null);\r\n\r\n    const changeBackgroundType = useMemo(() => getUpdater('backgroundType'), [getUpdater]);\r\n    const changeHasBackground = useCallback((e: any) => setCard(currentCard => {\r\n        const nextValue = e.target.checked;\r\n\r\n        return { ...currentCard, hasBackground: nextValue };\r\n    }), [setCard]);\r\n\r\n    useEffect(() => {\r\n        let relevant = true;\r\n        setTimeout(() => {\r\n            if (relevant) {\r\n                onChange(opacity);\r\n            }\r\n        }, 500);\r\n\r\n        return () => {\r\n            relevant = false;\r\n        };\r\n    /** No need to depend on callback */\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [opacity]);\r\n\r\n    useEffect(() => {\r\n        /** Force render, otherwise we will miss the image */\r\n        setBackgroundInputVisible(false);\r\n        /** Avoid consecutive render here, so the popover does not \"flashing\" when close */\r\n        setTimeout(() => {\r\n            setBackgroundInputHidden(false);\r\n        }, 250);\r\n    }, []);\r\n\r\n    useImperativeHandle(ref, () => ({\r\n        setValue: ({ background, backgroundCrop, ...newValue }) => {\r\n            if (typeof background === 'string' && backgroundCrop) {\r\n                backgroundInputRef.current?.setValue({ background, backgroundCrop });\r\n            }\r\n            for (const key in newValue) {\r\n                if (newValue[key as keyof CardOpacity] !== opacity[key as keyof CardOpacity]) {\r\n                    setOpacity(cur => ({ ...cur, ...newValue }));\r\n                }\r\n            }\r\n        }\r\n    }));\r\n\r\n    const noBackground = (background ?? '').length === 0;\r\n    return <StyledLayoutPickerContainer className=\"card-opacity-slider-container\">\r\n        <Tooltip\r\n            overlayClassName=\"long-tooltip-overlay\"\r\n            title={<>\r\n                Allow the artwork to extend beyond its border.\r\n                <br />\r\n                Art finish will not apply to boundless artwork.\r\n            </>}\r\n        >\r\n            <Checkbox\r\n                className=\"art-frame\"\r\n                onChange={value => setOpacity(cur => ({ ...cur, boundless: value.target.checked }))}\r\n                checked={opacity.boundless}\r\n            >\r\n                {'Boundless'}\r\n            </Checkbox>\r\n        </Tooltip>\r\n        {OpacityList.map(({ label, type, subType, tooltip }) => {\r\n            if (type === 'pendulum' && !isPendulum) return null;\r\n            const activable = !!subType;\r\n            const isActive = subType && opacity[subType];\r\n            return <div key={type}\r\n                className={[\r\n                    'card-opacity-slider', \r\n                    isActive ? '' : 'inactive',\r\n                ].join(' ')}\r\n            >\r\n                <div className=\"slider-label\">\r\n                    {type === 'body' && <Popover\r\n                        visible={backgroundInputVisible}\r\n                        destroyTooltipOnHide={false}\r\n                        trigger={['click']}\r\n                        onVisibleChange={setBackgroundInputVisible}\r\n                        overlayClassName={[\r\n                            'input-overlay style-picker-overlay layout-picker-overlay',\r\n                            backgroundInputVisible ? 'picker-visible' : '',\r\n                            backgroundInputHidden ? 'picker-hidden' : '',\r\n                        ].join(' ')}\r\n                        content={<div className=\"overlay-event-absorber\">\r\n                            <StyledBaseFillPickerContainer\r\n                                className={[\r\n                                    'custom-style-picker',\r\n                                    noBackground ? 'overlay-no-background-image' : ''\r\n                                ].join(' ')}\r\n                            >\r\n                                <h3 className={`custom-style-expand ${hasBackground ? '' : 'inactive'}`}>\r\n                                    <Checkbox\r\n                                        checked={hasBackground}\r\n                                        onChange={e => {\r\n                                            changeHasBackground(e);\r\n                                            const activateBackground = e.target.checked;\r\n\r\n                                            if (activateBackground) {\r\n\r\n                                            }\r\n                                        }}\r\n                                    >Has Background?</Checkbox>\r\n                                    <br />\r\n                                    <i>Define the color and background of the card if you use transparent artwork.</i>\r\n                                </h3>\r\n                                <div className={`background-picker ${hasBackground ? '' : 'overlay-no-background'}`}>\r\n                                    <BackgroundInputGroup\r\n                                        ref={backgroundInputRef}\r\n                                        receivingCanvas={receivingCanvas}\r\n                                        onSourceLoaded={onSourceLoaded}\r\n                                        onTainted={onTainted}\r\n                                        onCropChange={onCropChange}\r\n                                        backgroundColor={opacity.baseFill}\r\n                                    >\r\n                                        <div className=\"layout-picker-panel\">\r\n                                            <div className=\"layout-picker-subpanel color-section\">\r\n                                                <h2>Color</h2>\r\n                                                <CompactPicker\r\n                                                    color={opacity.baseFill}\r\n                                                    onChangeComplete={color => {\r\n                                                        setOpacity(cur => ({ ...cur, baseFill: color.hex }));\r\n                                                    }}\r\n                                                />\r\n                                            </div>\r\n                                            {!noBackground && <div className=\"layout-picker-subpanel type-section\">\r\n                                                <h2>Type</h2>\r\n                                                <RadioTrain\r\n                                                    onChange={changeBackgroundType}\r\n                                                    optionList={BackgroundTypeList}\r\n                                                    value={backgroundType}\r\n                                                />\r\n                                            </div>}\r\n                                        </div>\r\n                                    </BackgroundInputGroup>\r\n                                </div>\r\n                            </StyledBaseFillPickerContainer>\r\n                        </div>}\r\n                        placement=\"bottom\"\r\n                    >\r\n                        <div className=\"background-preview\" style={{ backgroundColor: hasBackground ? opacity.baseFill : DEFAULT_BASE_FILL_COLOR }}>\r\n                            {hasBackground\r\n                                ? background\r\n                                    ? <img className=\"background-image-preview\" src={background} alt=\"Background\" />\r\n                                    : null\r\n                                : <BorderOuterOutlined className=\"no-background-icon\" />}\r\n                        </div>\r\n                    </Popover>}\r\n                    {activable && <Tooltip title={tooltip} overlayClassName=\"long-tooltip-overlay\">\r\n                        <Checkbox\r\n                            checked={isActive}\r\n                            onChange={e => subType && setOpacity(cur => ({ ...cur, [subType]: e.target.checked }))}\r\n                        />\r\n                    </Tooltip>}\r\n                    {label}\r\n                </div>\r\n                <InputNumber\r\n                    size=\"small\"\r\n                    min={0}\r\n                    max={100}\r\n                    onChange={value => setOpacity(cur => ({ ...cur, [type]: typeof value === 'number' ? value : 100 }))}\r\n                    value={opacity[type] ?? 100}\r\n                />\r\n                <Slider\r\n                    min={0}\r\n                    max={100}\r\n                    step={5}\r\n                    onChange={value => setOpacity(cur => ({ ...cur, [type]: value }))}\r\n                    value={opacity[type] ?? 100}\r\n                />\r\n                <div className=\"slider-padding\" />\r\n            </div>;\r\n        })}\r\n    </StyledLayoutPickerContainer>;\r\n});","import { Popover } from 'antd';\r\nimport { RadioTrain } from '../input-train';\r\nimport { StyledDropdown } from 'src/component';\r\nimport { useCard } from 'src/service';\r\nimport { useShallow } from 'zustand/react/shallow';\r\nimport { forwardRef, useImperativeHandle, useMemo } from 'react';\r\nimport { CaretDownOutlined } from '@ant-design/icons';\r\nimport { IconTypeList, IconTypeMap, StarButtonList, STIconButtonList } from '../const';\r\nimport { checkDarkSynchro, checkXyz } from 'src/util';\r\n\r\nexport type CardIconInputGroupRef = {}\r\nexport type CardIconInputGroup = {\r\n    isLink: boolean,\r\n    isMonster: boolean,\r\n    showCreativeOption: boolean,\r\n};\r\nexport const CardIconInputGroup = forwardRef<CardIconInputGroupRef, CardIconInputGroup>(({\r\n    isLink,\r\n    isMonster,\r\n    showCreativeOption,\r\n}, ref) => {\r\n    const {\r\n        frame,\r\n        subFamily,\r\n        cardIcon,\r\n        star,\r\n        getUpdater,\r\n    } = useCard(useShallow(({\r\n        card: {\r\n            frame,\r\n            subFamily,\r\n            cardIcon,\r\n            star,\r\n        },\r\n        getUpdater,\r\n    }) => ({\r\n        frame,\r\n        subFamily,\r\n        cardIcon,\r\n        star,\r\n        getUpdater,\r\n    })));\r\n    const isDarkSynchro = checkDarkSynchro({ frame });\r\n    const isXyz = checkXyz({ frame });\r\n\r\n    const changeCardIcon = useMemo(() => getUpdater('cardIcon'), [getUpdater]);\r\n    const changeSubFamily = useMemo(() => getUpdater('subFamily'), [getUpdater]);\r\n    const changeStar = useMemo(() => getUpdater('star'), [getUpdater]);\r\n\r\n    useImperativeHandle(ref, () => ({}));\r\n\r\n    const iconTypeData = cardIcon === 'auto'\r\n        ? IconTypeMap[isMonster\r\n            ? isXyz ? 'rank' : isDarkSynchro ? 'negative-level' : 'level'\r\n            : 'st'\r\n        ]\r\n        : IconTypeMap[cardIcon];\r\n    const IconDropdownLabel = showCreativeOption\r\n        ? <>{iconTypeData.label} <CaretDownOutlined /></>\r\n        : iconTypeData.label;\r\n    const IconDropdown = <Popover key=\"icon-type-picker\"\r\n        trigger={['click']}\r\n        overlayClassName=\"input-overlay pattern-picker-overlay\"\r\n        content={<div className=\"overlay-event-absorber\">\r\n            <StyledDropdown.Container>\r\n                {IconTypeList.map(({ fullLabel, value }) => {\r\n                    return <StyledDropdown.Option key={value}\r\n                        className={value === cardIcon ? 'menu-active' : ''}\r\n                        onClick={() => changeCardIcon(value)}\r\n                    >\r\n                        {fullLabel}\r\n                    </StyledDropdown.Option>;\r\n                })}\r\n            </StyledDropdown.Container>\r\n        </div>}\r\n        placement=\"bottomRight\"\r\n    >\r\n        <span\r\n            className={`card-icon-dropdown ${cardIcon === 'auto' ? '' : 'active'} ${showCreativeOption ? '' : 'disabled'}`}\r\n        >\r\n            {IconDropdownLabel}\r\n        </span>\r\n    </Popover>;\r\n    const DropdownChildren = showCreativeOption\r\n        ? IconDropdown\r\n        : IconDropdownLabel;\r\n    return !isLink\r\n        ? iconTypeData.value === 'st'\r\n            ? <RadioTrain className=\"fill-input-train\" value={subFamily} onChange={changeSubFamily} optionList={STIconButtonList}>\r\n                {DropdownChildren}\r\n            </RadioTrain>\r\n            : <RadioTrain className=\"checkbox-star-train\" value={`${star}`} onChange={changeStar} optionList={StarButtonList}>\r\n                {DropdownChildren}\r\n            </RadioTrain>\r\n        : null;\r\n});","export const availableCommand = new Set(['1', '2', '3', '4', '5']);\r\nexport const resolveHotkey = (\r\n    value: string,\r\n    key: string,\r\n    selectionStart: number,\r\n    selectionEnd: number,\r\n    allowNewLine: boolean,\r\n    onResult: (joinedText: string, newCursorPlacement: number) => void,\r\n) => {\r\n    const selectedText = value.substring(selectionStart, selectionEnd);\r\n    const nextLetter = value[selectionEnd];\r\n    const keepInline = nextLetter === '\\n' || !allowNewLine;\r\n    let wrappedText = selectedText;\r\n    let cursorOffset = 2;\r\n    switch (key) {\r\n        case '1': wrappedText = `[${selectedText}]${keepInline ? '' : '\\n'}`;\r\n            cursorOffset = keepInline ? 2 : 3;\r\n            break;\r\n        case '2': wrappedText = `{${selectedText}}`; break;\r\n        case '3': wrappedText = `{${selectedText}|}`; break;\r\n        case '4': wrappedText = `{${selectedText}||}`; cursorOffset = 3; break;\r\n        case '5': wrappedText = `{{${selectedText}}}`; cursorOffset = 4; break;\r\n    }\r\n    const joinedText = value.substring(0, selectionStart)\r\n        + `${wrappedText}`\r\n        + value.substring(selectionEnd, value.length);\r\n\r\n    onResult(joinedText, selectionEnd + cursorOffset);\r\n};\r\n\r\nexport const placeCursorInInput = ({\r\n    id,\r\n    placement,\r\n}: {\r\n    id: string;\r\n    placement: number;\r\n}) => {\r\n    if (id && placement >= 0) {\r\n        const target = document.querySelector(`#${id}`) as HTMLInputElement | null;\r\n\r\n        if (target && (target.selectionEnd ?? -1) >= 0) {\r\n            target.selectionEnd = placement;\r\n        }\r\n    }\r\n};","import { availableCommand, placeCursorInInput, resolveHotkey } from './util';\r\nimport { Input } from 'antd';\r\nimport { forwardRef, useCallback, useEffect, useImperativeHandle, useRef, useState } from 'react';\r\nimport { TextAreaProps } from 'antd/lib/input';\r\n\r\nconst { TextArea } = Input;\r\nexport type CardTextAreaRef = {\r\n    setValue: (nextValue: string) => void,\r\n    getPickerRef: () => null | {\r\n        id: string, \r\n        setValue: (nextValue: string) => void;\r\n    },\r\n};\r\nexport type CardTextArea = {\r\n    allowHotkey?: boolean,\r\n    defaultValue: string,\r\n    onTakePicker?: (ref: {\r\n        id: string, \r\n        setValue: (nextValue: string) => void;\r\n    }) => void,\r\n    onChange: (e: { target: { value: string } }) => void,\r\n} & Partial<TextAreaProps>;\r\nexport const CardTextArea = forwardRef<CardTextAreaRef, CardTextArea>(({\r\n    id,\r\n    allowHotkey,\r\n    defaultValue,\r\n    onTakePicker,\r\n    onChange,\r\n    onKeyDown,\r\n    className,\r\n    ...rest\r\n}, ref) => {\r\n    const immediateValue = useRef(defaultValue);\r\n    const [value, setValue] = useState(defaultValue);\r\n    const [cursorData, setCursorData] = useState({ id: '', placement: -1 });\r\n    const internalOnChange = useCallback((eventOrValue: string | { target: { value: string }}) => {\r\n        const normalizedValue = typeof eventOrValue === 'string' ? eventOrValue : eventOrValue.target.value;\r\n        immediateValue.current = normalizedValue;\r\n        setValue(normalizedValue);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        placeCursorInInput(cursorData);\r\n    }, [cursorData]);\r\n\r\n    useEffect(() => {\r\n        onChange({ target: { value } });\r\n    /** No need to depend on callback */\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [value]);\r\n\r\n    const externalSetValue = (nextValue: string) => {\r\n        if (nextValue !== immediateValue.current) {\r\n            internalOnChange(nextValue);\r\n        }\r\n    };\r\n    useImperativeHandle(ref, () => ({\r\n        setValue: externalSetValue,\r\n        getPickerRef: () => id ? ({ id, setValue: externalSetValue }) : null,\r\n    }));\r\n\r\n    return <TextArea\r\n        id={id}\r\n        autoComplete=\"off\"\r\n        onFocus={() => id && onTakePicker?.({ id, setValue: externalSetValue })}\r\n        allowClear\r\n        spellCheck={false}\r\n        className={`${id}-input ${className}`}\r\n        value={value}\r\n        onKeyDown={ev => {\r\n            onKeyDown?.(ev);\r\n            if (!allowHotkey) return;\r\n            const { ctrlKey, key, metaKey } = ev;\r\n            const selectionStart = ev.currentTarget.selectionStart ?? -1;\r\n            const selectionEnd = ev.currentTarget.selectionEnd ?? -1;\r\n            if ((ctrlKey || metaKey) && id && selectionEnd !== selectionStart && availableCommand.has(key)) {\r\n                ev.preventDefault();\r\n                resolveHotkey(\r\n                    ev.currentTarget.value, key,\r\n                    selectionStart, selectionEnd,\r\n                    true,\r\n                    (joinedText, placement) => {\r\n                        internalOnChange(joinedText);\r\n                        setCursorData({ id, placement });\r\n                    }\r\n                );\r\n            }\r\n        }}\r\n        onChange={internalOnChange}\r\n        {...rest}\r\n    />;\r\n});","import { availableCommand, placeCursorInInput, resolveHotkey } from './util';\r\nimport { Input } from 'antd';\r\nimport { forwardRef, useCallback, useEffect, useImperativeHandle, useRef, useState } from 'react';\r\nimport { InputProps } from 'antd/lib/input';\r\nimport { useSetting } from 'src/service';\r\n\r\nexport type CardTextInputRef = {\r\n    setValue: (nextValue: string) => void,\r\n};\r\nexport type CardTextInput = {\r\n    defaultValue: string,\r\n    onTakePicker?: (ref: {\r\n        id: string, \r\n        setValue: (nextValue: string) => void;\r\n    }) => void,\r\n    onChange: (e: {target: { value: string }}) => void,\r\n} & Partial<InputProps>;\r\nexport const CardTextInput = forwardRef<CardTextInputRef, CardTextInput>(({\r\n    id,\r\n    defaultValue,\r\n    onTakePicker,\r\n    onChange,\r\n    onKeyDown,\r\n    className,\r\n    ...rest\r\n}, ref) => {\r\n    const { setting } = useSetting();\r\n    const { allowHotkey } = setting;\r\n    const immediateValue = useRef(defaultValue);\r\n    const [value, setValue] = useState(defaultValue);\r\n    const [cursorData, setCursorData] = useState({ id: '', placement: -1 });\r\n    const internalOnChange = useCallback((eventOrValue: string | { target: { value: string }}) => {\r\n        const normalizedValue = typeof eventOrValue === 'string' ? eventOrValue : eventOrValue.target.value;\r\n        immediateValue.current = normalizedValue;\r\n        setValue(normalizedValue);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        placeCursorInInput(cursorData);\r\n    }, [cursorData]);\r\n\r\n    useEffect(() => {\r\n        onChange({ target: { value } });\r\n    /** No need to depend on callback */\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [value]);\r\n\r\n    const externalSetValue = (nextValue: string) => {\r\n        if (nextValue !== value) {\r\n            internalOnChange(nextValue);\r\n        }\r\n    };\r\n    useImperativeHandle(ref, () => ({\r\n        setValue: externalSetValue,\r\n    }));\r\n\r\n    return <Input\r\n        id={id}\r\n        autoComplete=\"off\"\r\n        onFocus={() => id && onTakePicker?.({ id, setValue: externalSetValue })}\r\n        allowClear\r\n        className={`${id}-input ${className}`}\r\n        value={value}\r\n        onKeyDown={ev => {\r\n            onKeyDown?.(ev);\r\n            if (!allowHotkey) return;\r\n            const { ctrlKey, key, metaKey } = ev;\r\n            const selectionStart = ev.currentTarget.selectionStart ?? -1;\r\n            const selectionEnd = ev.currentTarget.selectionEnd ?? -1;\r\n            if ((ctrlKey || metaKey) && id && selectionEnd !== selectionStart && availableCommand.has(key)) {\r\n                ev.preventDefault();\r\n                resolveHotkey(\r\n                    ev.currentTarget.value, key,\r\n                    selectionStart, selectionEnd,\r\n                    false,\r\n                    (joinedText, placement) => {\r\n                        internalOnChange(joinedText);\r\n                        setCursorData({ id, placement });\r\n                    }\r\n                );\r\n            }\r\n        }}\r\n        onChange={ev => internalOnChange(ev.target.value)}\r\n        {...rest}\r\n    />;\r\n});","import { forwardRef, useEffect, useImperativeHandle, useMemo, useRef } from 'react';\r\nimport { CardTextArea, CardTextAreaRef } from '../input-text';\r\nimport { useCard } from 'src/service';\r\n\r\nexport type EffectInputGroupRef = {\r\n    setValue: (value: string) => void,\r\n};\r\nexport type EffectInputGroup = {} & Pick<CardTextArea, 'onTakePicker'>;\r\nexport const EffectInputGroup = forwardRef<EffectInputGroupRef, EffectInputGroup>(({\r\n    onTakePicker,\r\n}, ref) => {\r\n    const getUpdater = useCard(state => state.getUpdater);\r\n    const effectInputRef = useRef<CardTextAreaRef>(null);\r\n\r\n    const changeEffect = useMemo(() => getUpdater('effect', undefined, 'debounce'), [getUpdater]);\r\n\r\n    useEffect(() => {\r\n        const pickerRef = effectInputRef.current?.getPickerRef();\r\n\r\n        if (pickerRef) onTakePicker?.(pickerRef);\r\n    /** No need to depend on handler */\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, []);\r\n\r\n    useImperativeHandle(ref, () => ({\r\n        setValue: (value) => {\r\n            effectInputRef.current?.setValue(value);\r\n        }\r\n    }));\r\n\r\n    return <CardTextArea ref={effectInputRef}\r\n        id=\"effect\"\r\n        allowHotkey\r\n        defaultValue={useCard.getState().card.effect}\r\n        onChange={changeEffect}\r\n        onTakePicker={onTakePicker}\r\n        rows={9}\r\n    />;\r\n});","import { useCallback } from 'react';\r\nimport { Checkbox, Tooltip } from 'antd';\r\nimport { useCard } from '../../service';\r\nimport styled from 'styled-components';\r\nimport { useShallow } from 'zustand/react/shallow';\r\n\r\nconst StyledCheckboxGroup = styled.div`\r\n    align-self: center;\r\n    text-align: right;\r\n    .ant-checkbox + span {\r\n        user-select: none;\r\n    }\r\n`;\r\n\r\nexport type CardCheckboxGroup = {};\r\nexport const CardCheckboxGroup = (_: CardCheckboxGroup) => {\r\n    const {\r\n        isDuelTerminalCard,\r\n        isFirstEdition,\r\n        isSpeedCard,\r\n        setCard,\r\n    } = useCard(useShallow(({\r\n        card,\r\n        setCard,\r\n    }) => ({\r\n        isSpeedCard: card.isSpeedCard,\r\n        isDuelTerminalCard: card.isDuelTerminalCard,\r\n        isFirstEdition: card.isFirstEdition,\r\n        setCard,\r\n    })));\r\n\r\n    const onFirstEditionChange = useCallback((e: any) => setCard(currentCard => {\r\n        const nextValue = e.target.checked;\r\n\r\n        return { ...currentCard, isFirstEdition: nextValue };\r\n    }), [setCard]);\r\n    const onDuelTerminalCardChange = useCallback((e: any) => setCard(currentCard => {\r\n        const nextValue = e.target.checked;\r\n\r\n        return {\r\n            ...currentCard,\r\n            isDuelTerminalCard: nextValue,\r\n            isSpeedCard: nextValue ? false : currentCard.isSpeedCard,\r\n        };\r\n    }), [setCard]);\r\n    const onSpeedCardChange = useCallback((e: any) => setCard(currentCard => {\r\n        const nextValue = e.target.checked;\r\n\r\n        return {\r\n            ...currentCard,\r\n            isSpeedCard: e.target.checked,\r\n            isDuelTerminalCard: nextValue ? false : currentCard.isDuelTerminalCard,\r\n        };\r\n    }), [setCard]);\r\n\r\n    return <StyledCheckboxGroup className=\"checkbox-input\">\r\n        <Checkbox\r\n            className=\"input-1st\"\r\n            onChange={onFirstEditionChange}\r\n            checked={isFirstEdition}\r\n            tabIndex={0}\r\n        >\r\n            {'1st Edition'}\r\n        </Checkbox>\r\n        <Tooltip overlayClassName=\"long-tooltip-overlay\" overlay=\"Will turn off Duel Terminal mark.\">\r\n            <Checkbox\r\n                className=\"input-speed\"\r\n                onChange={onSpeedCardChange}\r\n                checked={isSpeedCard}\r\n                tabIndex={0}\r\n            >\r\n                {'Speed'}\r\n            </Checkbox>\r\n        </Tooltip>\r\n        <Tooltip overlayClassName=\"long-tooltip-overlay\" overlay=\"Will turn off Speed Duel mark.\">\r\n            <Checkbox\r\n                className=\"input-terminal\"\r\n                onChange={onDuelTerminalCardChange}\r\n                checked={isDuelTerminalCard}\r\n                tabIndex={0}\r\n            >\r\n                {'Duel Terminal'}\r\n            </Checkbox>\r\n        </Tooltip>\r\n    </StyledCheckboxGroup>;\r\n};","import { StyledDropdown } from 'src/component';\r\nimport styled from 'styled-components';\r\nimport { RadioTrain, TrainGridStyle } from './input-train';\r\n\r\nexport const StyledPendulumFrameContainer = styled(StyledDropdown.Container)`\r\n    padding: var(--spacing-xs);\r\n    .radio-train {\r\n        display: flex;\r\n        flex-wrap: wrap;\r\n        max-width: 500px;\r\n        .radio-train-input-group {\r\n            gap: var(--spacing);\r\n        }\r\n    }\r\n    .ant-checkbox-wrapper {\r\n        color: var(--color-heavy);\r\n    }\r\n    .frame-auto-checkbox {\r\n        margin-bottom: var(--spacing-xs);\r\n    }\r\n    ${TrainGridStyle}\r\n`;\r\n\r\nexport const StyledInputLabelWithButton = styled.div`\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\t.input-label {\r\n\t\tflex: 1;\r\n\t}\r\n`;\r\n\r\nexport const StyledNameSetIdInputContainer = styled.div`\r\n    display: flex;\r\n    align-items: center;\r\n    margin-top: var(--spacing-sm);\r\n    flex-wrap: wrap;\r\n    row-gap: var(--spacing-sm);\r\n`;\r\n\r\nexport const StyledFormatRadioTrain = styled(RadioTrain)`\r\n    &.radio-train {\r\n        .ant-radio-button-wrapper-checked {\r\n            &.ocg-button {\r\n                background-color: var(--main-red-scale);\r\n                border-color: var(--sub-red-scale);\r\n                &:not([class*=\" ant-radio-button-wrapper-disabled\"]).ant-radio-button-wrapper:first-child {\r\n                    border-right-color: var(--sub-red-scale);\r\n                }\r\n                &:not(.ant-radio-button-wrapper-disabled):first-child {\r\n                    border-color: var(--sub-red-scale);\r\n                }\r\n                &:hover {\r\n                    background-color: var(--sub-red-scale);\r\n                    color: var(--color-heavy);\r\n                }\r\n            }\r\n            &.tcg-button {\r\n                background-color: var(--main-blue-scale);\r\n                border-color: var(--sub-blue-scale);\r\n                &:hover {\r\n                    background-color: var(--sub-blue-scale);\r\n                    color: var(--color-heavy);\r\n                }\r\n            }\r\n        }\r\n        .ocg-button {\r\n            color: var(--color-heavy);\r\n            &:hover {\r\n                color: var(--sub-red-scale);\r\n            }\r\n        }\r\n        .tcg-button {\r\n            color: var(--color-heavy);\r\n            &:hover {\r\n                color: var(--sub-blue-scale);\r\n            }\r\n        }\r\n    }\r\n`;","import { forwardRef, useImperativeHandle, useMemo, useRef } from 'react';\r\nimport { CardTextInput, CardTextInputRef } from '../input-text';\r\nimport { useCard } from 'src/service';\r\nimport { IconButton } from 'src/component';\r\nimport { RadioTrain } from '../input-train';\r\nimport { CardCheckboxGroup } from '../input-checkbox-group';\r\nimport { randomPassword } from 'src/util';\r\nimport { SyncOutlined } from '@ant-design/icons';\r\nimport { useShallow } from 'zustand/react/shallow';\r\nimport { StickerButtonList } from '../const';\r\nimport styled from 'styled-components';\r\nimport { StyledInputLabelWithButton } from '../input-panel.styled';\r\n\r\nconst StyledFooterInputContainer = styled.div`\r\n    display: grid;\r\n    grid-template-columns: 1fr 1fr;\r\n    gap: var(--spacing-sm);\r\n    .checkbox-input {\r\n        align-self: center;\r\n        .ant-checkbox + span {\r\n            user-select: none;\r\n        }\r\n    }\r\n    .sticker-input,\r\n    .creator-input {\r\n        grid-column: span 2;\r\n    }\r\n    .sticker-input .ant-radio-button-wrapper {\r\n        padding-left: var(--spacing-sm);\r\n        padding-right: var(--spacing-sm);\r\n    }\r\n`;\r\n\r\nexport type FooterInputGroupRef = {\r\n    setValue: (value: { password?: string, creator?: string, atk?: string, def?: string }) => void,\r\n};\r\nexport type FooterInputGroup = {\r\n    isMonster: boolean,\r\n    showCreativeOption: boolean,\r\n} & Pick<CardTextInput, 'onTakePicker'>;\r\nexport const FooterInputGroup = forwardRef<FooterInputGroupRef, FooterInputGroup>(({\r\n    isMonster,\r\n    showCreativeOption,\r\n    onTakePicker,\r\n}, ref) => {\r\n    const {\r\n        sticker,\r\n        getUpdater,\r\n    } = useCard(useShallow(({\r\n        card: { sticker },\r\n        getUpdater,\r\n    }) => ({\r\n        sticker,\r\n        getUpdater,\r\n    })));\r\n    const passwordInputRef = useRef<CardTextInputRef>(null);\r\n    const creatorInputRef = useRef<CardTextInputRef>(null);\r\n    const atkInputRef = useRef<CardTextInputRef>(null);\r\n    const defInputRef = useRef<CardTextInputRef>(null);\r\n\r\n    const changeATK = useMemo(() => getUpdater('atk', value => typeof value === 'string' ? value.trim() : value), [getUpdater]);\r\n    const changeDEF = useMemo(() => getUpdater('def', value => typeof value === 'string' ? value.trim() : value), [getUpdater]);\r\n    const changePassword = useMemo(() => getUpdater('password', undefined, 'debounce'), [getUpdater]);\r\n    const onStickerChange = useMemo(() => getUpdater('sticker'), [getUpdater]);\r\n    const changeCreator = useMemo(() => getUpdater('creator', undefined, 'debounce'), [getUpdater]);\r\n\r\n    useImperativeHandle(ref, () => ({\r\n        setValue: ({ password, creator, atk, def }) => {\r\n            if (typeof atk === 'string') atkInputRef.current?.setValue(atk);\r\n            if (typeof def === 'string') defInputRef.current?.setValue(def);\r\n            if (typeof password === 'string') passwordInputRef.current?.setValue(password);\r\n            if (typeof creator === 'string') creatorInputRef.current?.setValue(creator);\r\n        }\r\n    }));\r\n\r\n    return <StyledFooterInputContainer className=\"card-footer-input\">\r\n        {(isMonster || showCreativeOption) && <>\r\n            <CardTextInput ref={atkInputRef}\r\n                id=\"atk\"\r\n                addonBefore=\"ATK\"\r\n                defaultValue={useCard.getState().card.atk}\r\n                onChange={changeATK}\r\n                onTakePicker={onTakePicker}\r\n            />\r\n            <CardTextInput ref={defInputRef}\r\n                id=\"def\"\r\n                addonBefore=\"DEF\"\r\n                defaultValue={useCard.getState().card.def}\r\n                onChange={changeDEF}\r\n                onTakePicker={onTakePicker}\r\n            />\r\n        </>}\r\n        <CardTextInput ref={passwordInputRef}\r\n            id=\"password\"\r\n            addonBefore={<StyledInputLabelWithButton className=\"input-label-with-button\">\r\n                <div className=\"input-label\">Password</div>\r\n                <IconButton\r\n                    onClick={() => passwordInputRef.current?.setValue(randomPassword())}\r\n                    Icon={SyncOutlined}\r\n                    tooltipProps={{ overlay: 'Randomize' }}\r\n                />\r\n            </StyledInputLabelWithButton>}\r\n            defaultValue={useCard.getState().card.password}\r\n            onChange={changePassword}\r\n            onTakePicker={onTakePicker}\r\n        />\r\n        <CardCheckboxGroup />\r\n        <CardTextInput ref={creatorInputRef}\r\n            id=\"creator\"\r\n            addonBefore=\"Creator Text\"\r\n            defaultValue={useCard.getState().card.creator}\r\n            onChange={changeCreator}\r\n            onTakePicker={onTakePicker}\r\n        />\r\n        <RadioTrain\r\n            className=\"sticker-input fill-input-train\"\r\n            value={sticker}\r\n            onChange={onStickerChange}\r\n            optionList={StickerButtonList}\r\n        >\r\n            <span>Sticker</span>\r\n        </RadioTrain>\r\n    </StyledFooterInputContainer>;\r\n});","import { forwardRef, useCallback, useEffect, useImperativeHandle, useMemo, useRef } from 'react';\r\nimport { useCard } from 'src/service';\r\nimport { ImageCropper, ImageCropperRef, LinkMarkChooser } from 'src/component';\r\nimport { RadioTrain } from '../input-train';\r\nimport { useShallow } from 'zustand/react/shallow';\r\nimport { ArtFinishButtonList } from '../const';\r\nimport { getArtCanvasCoordinate } from 'src/model';\r\nimport styled from 'styled-components';\r\n\r\nconst StyledImageRadioTrain = styled(RadioTrain)`\r\n    .ant-input-group-addon {\r\n        padding-left: 0;\r\n    }\r\n    .radio-train-input-group .ant-radio-button-wrapper {\r\n        min-width: unset;\r\n    }\r\n`;\r\n\r\nexport type ImageInputGroupRef = {\r\n    setValue: (value: { art?: string, artCrop?: Partial<ReactCrop.Crop> }) => void,\r\n};\r\nexport type ImageInputGroup = {\r\n    isLink: boolean,\r\n    showExtraDecorativeOption: boolean,\r\n    receivingCanvas: HTMLCanvasElement | null,\r\n    onCropChange?: (cropInfo: Partial<ReactCrop.Crop>, sourceType: 'internal' | 'external') => void,\r\n    onTainted: ImageCropper['onTainted'],\r\n    onSourceLoaded: ImageCropper['onSourceLoaded'],\r\n};\r\nexport const ImageInputGroup = forwardRef<ImageInputGroupRef, ImageInputGroup>(({\r\n    isLink,\r\n    showExtraDecorativeOption,\r\n    receivingCanvas,\r\n    onSourceLoaded,\r\n    onTainted,\r\n    onCropChange,\r\n}, ref) => {\r\n    const {\r\n        opacity,\r\n        artFinish,\r\n        linkMap,\r\n        isPendulum,\r\n        art, artCrop,\r\n        getUpdater,\r\n        setCard,\r\n    } = useCard(useShallow(({\r\n        card: {\r\n            opacity,\r\n            artFinish,\r\n            linkMap,\r\n            isPendulum,\r\n            art, artCrop,\r\n        },\r\n        getUpdater,\r\n        setCard,\r\n    }) => ({\r\n        opacity,\r\n        artFinish,\r\n        linkMap,\r\n        isPendulum,\r\n        art, artCrop,\r\n        getUpdater,\r\n        setCard,\r\n    })));\r\n    const imageCropperRef = useRef<ImageCropperRef>(null);\r\n\r\n    const changeLinkMap = useMemo(() => getUpdater('linkMap'), [getUpdater]);\r\n    const changePicture = useMemo(() => getUpdater('art'), [getUpdater]);\r\n    const changeArtFinish = useMemo(() => getUpdater('artFinish'), [getUpdater]);\r\n    const changeImageCrop = useCallback((cropInfo: Partial<ReactCrop.Crop>, sourceType: 'internal' | 'external') => {\r\n        onCropChange?.(cropInfo, sourceType);\r\n        if (cropInfo) setCard(curr => ({\r\n            ...curr,\r\n            artCrop: cropInfo,\r\n        }));\r\n    }, [onCropChange, setCard]);\r\n\r\n    useEffect(() => {\r\n            imageCropperRef.current?.setRatio(getArtCanvasCoordinate(isPendulum, opacity).ratio);\r\n    }, [opacity, isPendulum]);\r\n\r\n    useImperativeHandle(ref, () => ({\r\n        setValue: ({ art, artCrop }) => {\r\n            if (typeof art === 'string' && artCrop) {\r\n                imageCropperRef.current?.forceExternalSource(art, artCrop);\r\n            }\r\n        }\r\n    }));\r\n\r\n    return <ImageCropper\r\n        ref={imageCropperRef}\r\n        defaultExternalSource={art}\r\n        defaultCropInfo={artCrop}\r\n        receivingCanvas={receivingCanvas}\r\n        onSourceChange={changePicture}\r\n        onCropChange={changeImageCrop}\r\n        onTainted={onTainted}\r\n        onSourceLoaded={onSourceLoaded}\r\n        ratio={getArtCanvasCoordinate(isPendulum, opacity).ratio}\r\n        beforeCropper={showExtraDecorativeOption\r\n            ? <StyledImageRadioTrain\r\n                className=\"art-finish-checkbox fill-input-train\"\r\n                value={artFinish}\r\n                onChange={changeArtFinish}\r\n                optionList={ArtFinishButtonList}\r\n            >\r\n                <span className=\"field-title\">Art Finish</span>\r\n            </StyledImageRadioTrain>\r\n            : null\r\n        }\r\n    >\r\n        {isLink\r\n            ? <LinkMarkChooser defaultValue={linkMap} onChange={changeLinkMap} />\r\n            : <div />}\r\n    </ImageCropper>;\r\n});","import { Tooltip } from 'antd';\r\nimport { IconButton } from 'src/component';\r\nimport { CardTextInput, CardTextInputRef } from '../input-text';\r\nimport { useCard } from 'src/service';\r\nimport { useShallow } from 'zustand/react/shallow';\r\nimport { forwardRef, useImperativeHandle, useMemo, useRef } from 'react';\r\nimport { SyncOutlined } from '@ant-design/icons';\r\nimport { normalizedCardName, randomSetID } from 'src/util';\r\nimport { StyledInputLabelWithButton } from '../input-panel.styled';\r\nimport styled from 'styled-components';\r\n\r\nconst StyledNameInputContainer = styled.div`\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    gap: var(--spacing-sm);\r\n    width: 100%;\r\n    .name-input {\r\n        flex: 3;\r\n        min-width: 400px;\r\n    }\r\n    .set-id-input {\r\n        flex: 1;\r\n        min-width: 250px;\r\n    }\r\n`;\r\n\r\nexport type NameSetInputGroupRef = {\r\n    setValue: (value: { name?: string, setId?: string }) => void,\r\n}\r\nexport type NameSetInputGroup = {} & Pick<CardTextInput, 'onTakePicker'>;\r\nexport const NameSetInputGroup = forwardRef<NameSetInputGroupRef, NameSetInputGroup>(({\r\n    onTakePicker,\r\n}, ref) => {\r\n    const {\r\n        name,\r\n        format,\r\n        getUpdater,\r\n    } = useCard(useShallow(({\r\n        card: {\r\n            name,\r\n            format,\r\n        },\r\n        getUpdater,\r\n    }) => ({\r\n        name,\r\n        format,\r\n        getUpdater,\r\n    })));\r\n    const nameInputRef = useRef<CardTextInputRef>(null);\r\n    const setIdInputRef = useRef<CardTextInputRef>(null);\r\n\r\n    const changeSetId = useMemo(() => getUpdater('setId'), [getUpdater]);\r\n    const changeName = useMemo(() => getUpdater('name', undefined, 'debounce'), [getUpdater]);\r\n\r\n    useImperativeHandle(ref, () => ({\r\n        setValue: ({ name, setId }) => {\r\n            if (typeof name === 'string') nameInputRef.current?.setValue(name);\r\n            if (typeof setId === 'string') setIdInputRef.current?.setValue(setId);\r\n        }\r\n    }));\r\n\r\n    return <StyledNameInputContainer className=\"name-id-input\">\r\n        <CardTextInput ref={nameInputRef}\r\n            id=\"name\"\r\n            defaultValue={name}\r\n            addonBefore={<Tooltip title=\"Copy\">\r\n                <span style={{ cursor: 'pointer' }} onClick={() => {\r\n                    navigator.clipboard.writeText(normalizedCardName(name));\r\n                }}>\r\n                    Name\r\n                </span>\r\n            </Tooltip>}\r\n            onChange={changeName}\r\n            onTakePicker={onTakePicker}\r\n        />\r\n        <CardTextInput ref={setIdInputRef}\r\n            id=\"set-id\"\r\n            defaultValue={useCard.getState().card.setId}\r\n            addonBefore={<StyledInputLabelWithButton className=\"input-label-with-button\">\r\n                <div className=\"input-label\">Set ID</div>\r\n                <IconButton\r\n                    onClick={() => setIdInputRef.current?.setValue(randomSetID(format))}\r\n                    Icon={SyncOutlined}\r\n                    tooltipProps={{ overlay: 'Randomize' }}\r\n                />\r\n            </StyledInputLabelWithButton>}\r\n            onChange={changeSetId}\r\n            onTakePicker={onTakePicker}\r\n        />\r\n    </StyledNameInputContainer>;\r\n});","import { Checkbox, Input, Popover } from 'antd';\r\nimport { StyledPendulumFrameContainer } from '../input-panel.styled';\r\nimport { RadioTrain } from '../input-train';\r\nimport { FrameInfoBlock } from 'src/component';\r\nimport { CardTextArea, CardTextAreaRef, CardTextInput } from '../input-text';\r\nimport { useCard } from 'src/service';\r\nimport { useShallow } from 'zustand/react/shallow';\r\nimport { forwardRef, useImperativeHandle, useMemo, useRef, useState } from 'react';\r\nimport { FrameInfoMap } from 'src/model';\r\nimport { CaretDownOutlined } from '@ant-design/icons';\r\nimport { getFrameButtonList } from '../const';\r\nimport styled from 'styled-components';\r\nimport { getNavigationProps } from 'src/util';\r\n\r\ntype BottomFrameOptionGridRef = {\r\n    focus: () => void,\r\n};\r\ntype BottomFrameOptionGrid = {\r\n    pendulumFrame: string,\r\n    frameList: ReturnType<typeof getFrameButtonList>,\r\n    onChange: (value: string | number) => void,\r\n    onCancel: () => void,\r\n};\r\nconst BottomFrameOptionGrid = forwardRef<BottomFrameOptionGridRef, BottomFrameOptionGrid>(({\r\n    frameList,\r\n    pendulumFrame,\r\n    onChange,\r\n    onCancel,\r\n}, ref) => {\r\n    const recentCustomPendulumFrame = useRef(pendulumFrame === 'auto' ? 'spell' : pendulumFrame);\r\n    const inputRef = useRef<HTMLInputElement>(null);\r\n    const [focus, setFocus] = useState(0);\r\n\r\n    useImperativeHandle(ref, () => ({\r\n        focus: () => inputRef.current?.focus(),\r\n    }));\r\n\r\n    return <StyledPendulumFrameContainer\r\n        className=\"pendulum-frame-picker\"\r\n        {...getNavigationProps({\r\n            stopPropagation: true,\r\n            optionLength: frameList.length,\r\n            setFocus,\r\n            onTrigger: () => {\r\n                if (focus >= 0) onChange(frameList[focus].value);\r\n            },\r\n            onCancel,\r\n        })}\r\n    >\r\n        <Checkbox ref={inputRef}\r\n            className=\"frame-auto-checkbox\"\r\n            checked={pendulumFrame === 'auto'}\r\n            onChange={e => {\r\n                onChange(e.target.checked ? 'auto' : recentCustomPendulumFrame.current);\r\n            }}\r\n        >Auto</Checkbox>\r\n        <RadioTrain\r\n            className=\"frame-radio\"\r\n            value={pendulumFrame}\r\n            onChange={onChange}\r\n            optionList={frameList}\r\n        />\r\n    </StyledPendulumFrameContainer>;\r\n});\r\n\r\nconst StyledPendulumFrameInputContainer = styled.div`\r\n    display: inline-flex;\r\n    cursor: pointer;\r\n    box-shadow: var(--bs-input);\r\n    vertical-align: bottom;\r\n    box-shadow: var(--bs-button);\r\n    border-radius: var(--br-lg);\r\n    &:focus-visible {\r\n        outline: 2px solid var(--focus);\r\n    }\r\n    .pendulum-frame-info-block {\r\n        border-radius: 0 var(--br-lg) var(--br-lg) 0;\r\n        line-height: 2; // Alignment\r\n        background-color: var(--main-level-4);\r\n        min-width: 100px;\r\n        overflow: hidden;\r\n        border: var(--bw) solid var(--sub-level-1);\r\n        .frame-info-block-label {\r\n            padding: var(--spacing-px) var(--spacing-xs);\r\n        }\r\n    }\r\n    .pendulum-frame-label {\r\n        display: inline-block;\r\n        background: var(--main-level-4);\r\n        border: var(--bw) solid var(--sub-level-1);\r\n        border-right: none;\r\n        padding: var(--spacing-px) var(--spacing-xs);\r\n        border-radius: var(--br-lg) 0 0 var(--br-lg);\r\n        line-height: 2; // Alignment\r\n        &:last-child {\r\n            border-radius: var(--br-lg);\r\n            border-right: var(--bw) solid var(--sub-level-1);\r\n        }\r\n    }\r\n`;\r\nconst StyledPendulumInputContainer = styled.div`\r\n    display: grid;\r\n    grid-template-columns: 1fr 1fr;\r\n    column-gap: var(--spacing-sm);\r\n    row-gap: var(--spacing-sm);\r\n    .joined-row {\r\n        grid-column: span 2;\r\n        .standalone-label {\r\n            min-width: 0;\r\n            width: unset;\r\n            padding-left: var(--spacing-antd);\r\n        }\r\n        .pendulum-checkbox {\r\n            /** Alignment **/\r\n            width: 95px;\r\n            line-height: 32px;\r\n            text-align: right;\r\n            font-weight: 500;\r\n            > span {\r\n                padding-right: 0;\r\n            }\r\n        }\r\n        .pendulum-checkbox-placeholder {\r\n            display: inline-block;\r\n            /** Alignment **/\r\n            width: var(--width-label);\r\n        }\r\n        .pendulum-frame-input {\r\n            margin-right: var(--spacing-lg);\r\n        }\r\n        .ant-checkbox-wrapper {\r\n            margin-right: var(--spacing);\r\n        }\r\n        .ant-checkbox-wrapper + .ant-checkbox-wrapper {\r\n            margin-left: 0;\r\n        }\r\n    }\r\n`;\r\n\r\nexport type PendulumInputGroupRef = {\r\n    setValue: (value: { pendulumEffect?: string }) => void,\r\n}\r\nexport type PendulumInputGroup = {\r\n    showCreativeOption: boolean,\r\n    showExtraDecorativeOption: boolean,\r\n} & Pick<CardTextInput, 'onTakePicker'>;\r\nexport const PendulumInputGroup = forwardRef<PendulumInputGroupRef, PendulumInputGroup>(({\r\n    showCreativeOption,\r\n    showExtraDecorativeOption,\r\n    onTakePicker,\r\n}, ref) => {\r\n    const {\r\n        frame,\r\n        isPendulum,\r\n        pendulumFrame,\r\n        pendulumScaleBlue,\r\n        pendulumScaleRed,\r\n        setCard,\r\n        getUpdater,\r\n    } = useCard(useShallow(({\r\n        card: {\r\n            frame,\r\n            isPendulum,\r\n            pendulumFrame,\r\n            pendulumScaleBlue,\r\n            pendulumScaleRed,\r\n        },\r\n        setCard,\r\n        getUpdater,\r\n    }) => ({\r\n        frame,\r\n        isPendulum,\r\n        pendulumFrame,\r\n        pendulumScaleBlue,\r\n        pendulumScaleRed,\r\n        setCard,\r\n        getUpdater,\r\n    })));\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n    const bottomFrameOptionGridRef = useRef<BottomFrameOptionGridRef>(null);\r\n    const pendulumEffectInputRef = useRef<CardTextAreaRef>(null);\r\n    const [isMirrorScale, setMirrorScale] = useState(true);\r\n    const [frameDropdownVisible, setFrameDropdownVisibleVisible] = useState(false);\r\n    const recentCustomPendulumFrame = useRef(pendulumFrame === 'auto' ? 'spell' : pendulumFrame);\r\n    const changeToPendulum = (e: any) => setCard(currentCard => {\r\n        const willBecomePendulum = e.target.checked;\r\n        /** It is rather not desirable to seemingly reduce opacity of pendulum frame, even though it looks closer to real card */\r\n        // const currentOpacity = currentCard.opacity;\r\n        // const nextOpacity = willBecomePendulum && (currentOpacity.pendulum ?? 100) !== 85\r\n        //     ? { ...currentOpacity, pendulum: 85 }\r\n        //     : currentOpacity;\r\n\r\n        return {\r\n            ...currentCard,\r\n            // opacity: nextOpacity,\r\n            isPendulum: willBecomePendulum,\r\n        };\r\n    });\r\n    const changeBottomFrame = (value: string | number) => {\r\n        const normalizedValue = `${value}`;\r\n\r\n        if (normalizedValue !== 'auto') recentCustomPendulumFrame.current = normalizedValue;\r\n        setCard(currentCard => {\r\n            return { ...currentCard, pendulumFrame: normalizedValue };\r\n        });\r\n    };\r\n    const onRedScaleChange = useMemo(() => getUpdater('pendulumScaleRed'), [getUpdater]);\r\n    const onBlueScaleChange = useMemo(() => getUpdater('pendulumScaleBlue'), [getUpdater]);\r\n    const changePendulumEffect = useMemo(() => getUpdater('pendulumEffect', undefined, 'debounce'), [getUpdater]);\r\n\r\n    const frameList = useMemo(() => getFrameButtonList()\r\n        .filter(entry => {\r\n            return showExtraDecorativeOption || entry.edition === 'normal';\r\n        }),\r\n        [showExtraDecorativeOption],\r\n    );\r\n\r\n    useImperativeHandle(ref, () => ({\r\n        setValue: ({ pendulumEffect }) => {\r\n            if (pendulumEffect) pendulumEffectInputRef.current?.setValue(pendulumEffect);\r\n        }\r\n    }));\r\n\r\n    const currentPendulumFrame = FrameInfoMap[pendulumFrame];\r\n    return <StyledPendulumInputContainer\r\n        className=\"pendulum-input\"\r\n    >\r\n        <div className=\"joined-row pendulum-option\">\r\n            {frame !== 'link'\r\n                ? <Checkbox\r\n                    className=\"pendulum-checkbox\"\r\n                    onChange={changeToPendulum}\r\n                    checked={isPendulum}\r\n                >Pendulum</Checkbox>\r\n                : <div className=\"pendulum-checkbox-placeholder\" />}\r\n            {showCreativeOption && <Popover\r\n                visible={frameDropdownVisible}\r\n                onVisibleChange={setFrameDropdownVisibleVisible}\r\n                trigger={['hover', 'click']}\r\n                placement=\"bottom\"\r\n                overlayClassName=\"pendulum-frame-picker-overlay\"\r\n                content={<div className=\"overlay-event-absorber\">\r\n                    <BottomFrameOptionGrid ref={bottomFrameOptionGridRef}\r\n                        frameList={frameList}\r\n                        pendulumFrame={pendulumFrame}\r\n                        onCancel={() => {\r\n                            setFrameDropdownVisibleVisible(false);\r\n                            containerRef.current?.focus();\r\n                        }}\r\n                        onChange={changeBottomFrame}\r\n                    />\r\n                </div>}\r\n            >\r\n                <StyledPendulumFrameInputContainer ref={containerRef}\r\n                    className=\"pendulum-frame-input\"\r\n                    tabIndex={0}\r\n                    onKeyDown={e => {\r\n                        if (e.key === 'ArrowDown' || e.key === 'Enter' || e.key === '  ') {\r\n                            setFrameDropdownVisibleVisible(true);\r\n                            /** Popover takes time to mount / become visible */\r\n                            setTimeout(() => {\r\n                                bottomFrameOptionGridRef.current?.focus();\r\n                            }, 200);\r\n\r\n                            return false;\r\n                        }\r\n                    }}\r\n                >\r\n                    <span className=\"pendulum-frame-label\">Bottom Frame <CaretDownOutlined /></span>\r\n                    {currentPendulumFrame\r\n                        ? <FrameInfoBlock className=\"pendulum-frame-info-block\" {...currentPendulumFrame} />\r\n                        : <FrameInfoBlock className=\"pendulum-frame-info-block\" name=\"Auto\" />}\r\n                </StyledPendulumFrameInputContainer>\r\n            </Popover>}\r\n            {(isPendulum && showCreativeOption)\r\n                && <Checkbox onChange={e => setMirrorScale(e.target.checked)} checked={isMirrorScale}>Mirror Scale</Checkbox>}\r\n        </div>\r\n        {isPendulum && <>\r\n            <div>\r\n                <Input\r\n                    addonBefore={<span>\r\n                        <span style={{ color: 'var(--sub-blue-scale)' }}>Blue</span> Scale\r\n                    </span>}\r\n                    value={pendulumScaleBlue}\r\n                    onChange={e => {\r\n                        onBlueScaleChange(e);\r\n                        if (isMirrorScale) onRedScaleChange(e);\r\n                    }} />\r\n            </div>\r\n            <div>\r\n                <Input\r\n                    addonBefore={<span>\r\n                        <span style={{ color: 'var(--sub-red-scale)' }}>Red</span> Scale\r\n                    </span>}\r\n                    value={pendulumScaleRed}\r\n                    onChange={e => {\r\n                        if (isMirrorScale) onBlueScaleChange(e);\r\n                        onRedScaleChange(e);\r\n                    }}\r\n                />\r\n            </div>\r\n            <div className=\"joined-row\" style={{ position: 'relative' }}>\r\n                {/** Explicit label does not looks too good */}\r\n                {/* <StandaloneLabel className=\"standalone-label\">Pendulum Effect</StandaloneLabel> */}\r\n                <CardTextArea ref={pendulumEffectInputRef}\r\n                    id=\"pendulum-effect\"\r\n                    allowHotkey\r\n                    defaultValue={useCard.getState().card.pendulumEffect}\r\n                    onChange={changePendulumEffect}\r\n                    onTakePicker={onTakePicker}\r\n                    rows={5}\r\n                />\r\n            </div>\r\n        </>}\r\n    </StyledPendulumInputContainer>;\r\n});","import { Checkbox, Tooltip } from 'antd';\r\nimport { RadioTrain } from '../input-train';\r\nimport { Explanation, FormattingHelpDrawer } from 'src/component';\r\nimport { CardTextInput, CardTextInputRef } from '../input-text';\r\nimport { useCard } from 'src/service';\r\nimport { useShallow } from 'zustand/react/shallow';\r\nimport { forwardRef, useCallback, useImperativeHandle, useMemo, useRef } from 'react';\r\nimport { CondenseType } from 'src/model';\r\nimport { CondenseThresholdButtonList } from '../const';\r\nimport styled from 'styled-components';\r\n\r\nconst StyledPostPendulumInputContainer = styled.div`\r\n    display: grid;\r\n    grid-template-columns: 1fr max-content;\r\n    grid-template-areas:\r\n        \"type-input input-helper\"\r\n        \"condense-input help-button\";\r\n    gap: var(--spacing-sm);\r\n    align-items: center;\r\n    .formatting-help-button {\r\n        grid-area: help-button;\r\n        &:focus {\r\n            box-shadow: 0 0 0 2px var(--focus);\r\n        }\r\n    }\r\n    .input-kanji-helper {\r\n        grid-area: input-helper;\r\n    }\r\n    .type-ability-input {\r\n        grid-area: type-input;\r\n    }\r\n    .condense-input {\r\n        grid-area: condense-input;\r\n\t\t.standalone-addon.ant-input-group-addon {\r\n\t\t\twidth: unset;\r\n\t\t}\r\n\t\t.ant-radio-button-wrapper {\r\n\t\t\tflex: 1 1 90px;\r\n\t\t}\r\n\t}\r\n    &.variant-tcg {\r\n        .type-ability-input {\r\n            grid-column: span 2;\r\n        }\r\n    }\r\n`;\r\n\r\nexport type PostPendulumInputGroupRef = {\r\n    setValue: (value: { typeAbility?: string[] }) => void,\r\n}\r\nexport type PostPendulumInputGroup = {} & Pick<CardTextInput, 'onTakePicker'>;\r\nexport const PostPendulumInputGroup = forwardRef<PostPendulumInputGroupRef, PostPendulumInputGroup>(({\r\n    onTakePicker,\r\n}, ref) => {\r\n    const {\r\n        format,\r\n        furiganaHelper,\r\n        condenseTolerant,\r\n        setCard,\r\n        getUpdater,\r\n    } = useCard(useShallow(({\r\n        card: {\r\n            format,\r\n            furiganaHelper,\r\n            effectStyle,\r\n        },\r\n        setCard,\r\n        getUpdater,\r\n    }) => ({\r\n        format,\r\n        furiganaHelper,\r\n        condenseTolerant: effectStyle?.condenseTolerant,\r\n        setCard,\r\n        getUpdater,\r\n    })));\r\n    const typeAbilitySeparator = format === 'ocg' ? '／' : '/';\r\n    const typeAbilityInputRef = useRef<CardTextInputRef>(null);\r\n    const changeTypeAbility = useMemo(() => {\r\n        return getUpdater(\r\n            'typeAbility',\r\n            value => {\r\n                return typeof value !== 'string' ? [] : value.split(/／|\\//)\r\n                    .map(entry => `${entry}`.trim())\r\n                    .filter(entry => typeof entry === 'string' && entry.length > 0);\r\n            },\r\n            'debounce',\r\n        );\r\n    }, [getUpdater]);\r\n    const toggleFuriganaHelper = useCallback((e: any) => setCard(currentCard => {\r\n        return { ...currentCard, furiganaHelper: e.target.checked };\r\n    }), [setCard]);\r\n    const onCondenseTolerantChange = (value: CondenseType) => {\r\n        setCard(currentCard => {\r\n            return {\r\n                ...currentCard,\r\n                effectStyle: {\r\n                    ...currentCard.effectStyle,\r\n                    condenseTolerant: value,\r\n                }\r\n            };\r\n        });\r\n    };\r\n\r\n    useImperativeHandle(ref, () => ({\r\n        setValue: ({ typeAbility }) => {\r\n            if (typeAbility) typeAbilityInputRef.current?.setValue(typeAbility.join(typeAbilitySeparator));\r\n        }\r\n    }));\r\n\r\n    const isOCG = format === 'ocg';\r\n    return <StyledPostPendulumInputContainer className={`post-pendulum-input variant-${format}`}>\r\n        <CardTextInput ref={typeAbilityInputRef}\r\n            addonBefore=\"Type\"\r\n            id=\"type-ability\"\r\n            defaultValue={useCard.getState().card.typeAbility.join(typeAbilitySeparator)}\r\n            onChange={changeTypeAbility}\r\n            onTakePicker={onTakePicker}\r\n        />\r\n        {isOCG && <Tooltip\r\n            overlay=\"Automatically annotates popular kanji characters with corresponding furigana.\"\r\n            overlayClassName=\"long-tooltip-overlay\"\r\n        >\r\n            <Checkbox\r\n                className=\"input-kanji-helper\"\r\n                onChange={toggleFuriganaHelper}\r\n                checked={furiganaHelper}\r\n            >\r\n                {'Furigana Helper'}\r\n            </Checkbox>\r\n        </Tooltip>}\r\n        <RadioTrain className=\"condense-input\" value={`${condenseTolerant}`}\r\n            onChange={value => onCondenseTolerantChange(value as CondenseType)}\r\n            optionList={CondenseThresholdButtonList}\r\n        >\r\n            <span>\r\n                Condense <Explanation\r\n                    content={'Higher condense limit will prefer compressing words instead of adding new lines.'}\r\n                />\r\n            </span>\r\n        </RadioTrain>\r\n        <FormattingHelpDrawer />\r\n    </StyledPostPendulumInputContainer>;\r\n});","import React, { useCallback, useEffect, useImperativeHandle, useMemo, useRef, useState } from 'react';\r\nimport {\r\n    Card,\r\n    CardOpacity,\r\n    NameStyle,\r\n    NameStyleType,\r\n    FrameInfoMap,\r\n} from '../../model';\r\nimport {\r\n    Affiliation,\r\n    AppHeader,\r\n    StandaloneLabel,\r\n} from '../../component';\r\nimport {\r\n    checkLink,\r\n    checkMonster,\r\n} from '../../util';\r\nimport {\r\n    FoilButtonList,\r\n    getAttributeList,\r\n    FinishButtonList,\r\n    FormatButtonList,\r\n} from './const';\r\nimport { CharPicker } from './char-picker';\r\nimport { TextStylePicker, TextStylePickerRef } from './text-style-picker';\r\nimport { CheckboxTrain, FrameTrain, RadioTrain } from './input-train';\r\nimport { Explanation } from 'src/component/explanation';\r\nimport { changeCardFormat, useCard, useSetting } from '../../service';\r\nimport { LayoutPicker, OpacityPickerRef } from './layout-picker';\r\nimport {\r\n    CardIconInputGroup,\r\n    EffectInputGroup,\r\n    EffectInputGroupRef,\r\n    FooterInputGroup,\r\n    FooterInputGroupRef,\r\n    ImageInputGroup,\r\n    ImageInputGroupRef,\r\n    NameSetInputGroup,\r\n    NameSetInputGroupRef,\r\n    PendulumInputGroup,\r\n    PendulumInputGroupRef,\r\n    PostPendulumInputGroup,\r\n    PostPendulumInputGroupRef,\r\n} from './input-group';\r\nimport { useShallow } from 'zustand/react/shallow';\r\nimport {\r\n    StyledFormatRadioTrain,\r\n    StyledNameSetIdInputContainer,\r\n} from './input-panel.styled';\r\nimport './input-panel.scss';\r\n\r\nexport type CardInputPanelRef = {\r\n    forceCardData: (card: Card) => void,\r\n}\r\nexport type CardInputPanel = {\r\n    artworkCanvas: ImageInputGroup['receivingCanvas'],\r\n    backgroundCanvas: ImageInputGroup['receivingCanvas'],\r\n} & Pick<ImageInputGroup, 'onCropChange' | 'onTainted' | 'onSourceLoaded'>;\r\nexport const CardInputPanel = React.forwardRef<CardInputPanelRef, CardInputPanel>(({\r\n    artworkCanvas,\r\n    backgroundCanvas,\r\n    onCropChange,\r\n    onTainted,\r\n    onSourceLoaded,\r\n}: CardInputPanel, forwardedRef) => {\r\n    const {\r\n        format,\r\n        frame, foil, finish, opacity,\r\n        nameStyleType, nameStyle,\r\n        isPendulum,\r\n        attribute,\r\n        getUpdater,\r\n        setCard,\r\n    } = useCard(useShallow(({\r\n        card: {\r\n            format,\r\n            frame, foil, finish, opacity,\r\n            nameStyleType, nameStyle,\r\n            isPendulum,\r\n            attribute,\r\n        },\r\n        getUpdater,\r\n        setCard,\r\n    }) => ({\r\n        format,\r\n        frame, foil, finish, opacity,\r\n        nameStyleType, nameStyle,\r\n        isPendulum,\r\n        attribute,\r\n        getUpdater,\r\n        setCard,\r\n    })));\r\n    const { setting } = useSetting();\r\n    const { showCreativeOption, showExtraDecorativeOption } = setting;\r\n\r\n    const stylePickerRef = useRef<TextStylePickerRef>(null);\r\n\r\n    const isLink = checkLink({ frame });\r\n    const isMonster = checkMonster({ frame });\r\n    const [stylePickerResetCount, setStylePickerResetCount] = useState(0);\r\n\r\n    const imageInputGroupRef = useRef<ImageInputGroupRef>(null);\r\n    const layoutPickerRef = useRef<OpacityPickerRef>(null);\r\n    const nameSetIdInputGroupRef = useRef<NameSetInputGroupRef>(null);\r\n    const pendulumInputGroupRef = useRef<PendulumInputGroupRef>(null);\r\n    const effectInputGroupRef = useRef<EffectInputGroupRef>(null);\r\n    const postPendulumInputGroupRef = useRef<PostPendulumInputGroupRef>(null);\r\n    const footerInputGroupRef = useRef<FooterInputGroupRef>(null);\r\n\r\n    const [pickerTarget, setPickerTarget] = useState<{\r\n        id: string,\r\n        setValue: (nextValue: string) => void,\r\n    }>({\r\n        id: '',\r\n        setValue: () => {},\r\n    });\r\n\r\n    const changeFormat = (formatValue: string | number) => {\r\n        setCard(currentCard => {\r\n            const nextFormat = `${formatValue}`;\r\n            const formatSwappedCard = changeCardFormat(currentCard, nextFormat);\r\n            postPendulumInputGroupRef.current?.setValue({ typeAbility: formatSwappedCard.typeAbility });\r\n\r\n            const { name, setId, effect, typeAbility, creator } = formatSwappedCard;\r\n            nameSetIdInputGroupRef.current?.setValue({ name, setId });\r\n            effectInputGroupRef.current?.setValue(effect);\r\n            postPendulumInputGroupRef.current?.setValue({ typeAbility });\r\n            footerInputGroupRef.current?.setValue({ creator });\r\n\r\n            return formatSwappedCard;\r\n        });\r\n    };\r\n    const changeFoil = useMemo(() => getUpdater('foil'), [getUpdater]);\r\n    const onFinishChange = useMemo(() => getUpdater('finish'), [getUpdater]);\r\n    const changeOpacity = useCallback((opacity: CardOpacity) => setCard(curr => ({ ...curr, opacity })), [setCard]);\r\n    const changeAttribute = useMemo(() => getUpdater('attribute'), [getUpdater]);\r\n    const changeNameStyle = useCallback((type: NameStyleType, value: Partial<NameStyle>) => {\r\n        setCard(currentCard => {\r\n            return {\r\n                ...currentCard,\r\n                nameStyleType: type,\r\n                nameStyle: value,\r\n            };\r\n        });\r\n    }, [setCard]);\r\n\r\n    const attributeList = useMemo(() => getAttributeList(format), [format]);\r\n\r\n    useEffect(() => {\r\n        stylePickerRef.current?.setValue({ font: nameStyle.font });\r\n    }, [nameStyle]);\r\n\r\n    useEffect(() => {\r\n        layoutPickerRef.current?.setValue(opacity);\r\n    }, [opacity]);\r\n\r\n    useImperativeHandle(forwardedRef, () => ({\r\n        forceCardData: card => {\r\n            setStylePickerResetCount(cnt => cnt + 1);\r\n            const {\r\n                name,\r\n                art, artCrop,\r\n                background, backgroundCrop,\r\n                opacity,\r\n                setId,\r\n                pendulumEffect,\r\n                typeAbility,\r\n                effect,\r\n                atk, def,\r\n                creator, password,\r\n            } = card;\r\n\r\n            imageInputGroupRef.current?.setValue({ art, artCrop });\r\n            layoutPickerRef.current?.setValue({ ...opacity, background, backgroundCrop });\r\n            nameSetIdInputGroupRef.current?.setValue({ name, setId });\r\n            pendulumInputGroupRef.current?.setValue({ pendulumEffect });\r\n            effectInputGroupRef.current?.setValue(effect);\r\n            postPendulumInputGroupRef.current?.setValue({ typeAbility });\r\n            footerInputGroupRef.current?.setValue({ atk, def, creator, password });\r\n        }\r\n    }));\r\n\r\n    return <div\r\n        className={['card-info-panel', format === 'ocg' ? 'input-ocg' : 'input-tcg'].join(' ')}\r\n    >\r\n        <AppHeader />\r\n        <br />\r\n        <Affiliation />\r\n\r\n        <div className=\"card-overlay-input\">\r\n            <StyledFormatRadioTrain className=\"format-radio\" value={format} onChange={changeFormat} optionList={FormatButtonList}>\r\n                <span>Format</span>\r\n            </StyledFormatRadioTrain>\r\n            <RadioTrain className=\"foil-radio\" value={foil} onChange={changeFoil} optionList={FoilButtonList}>\r\n                <span>Foil</span>\r\n            </RadioTrain>\r\n            {showExtraDecorativeOption && <CheckboxTrain\r\n                className=\"finish-checkbox\"\r\n                value={finish}\r\n                onChange={onFinishChange}\r\n                optionList={FinishButtonList}\r\n            >\r\n                <span>Finish</span>\r\n            </CheckboxTrain>}\r\n        </div>\r\n\r\n        {showCreativeOption && <div className=\"card-layout-input\">\r\n            <label className=\"standalone-addon ant-input-group-addon\">\r\n                Layout <Explanation\r\n                    content={'May affect behavior of some finish types.'}\r\n                />\r\n            </label>\r\n            <LayoutPicker ref={layoutPickerRef}\r\n                defaultValue={opacity}\r\n                receivingCanvas={backgroundCanvas}\r\n                onChange={changeOpacity}\r\n                onTainted={onTainted}\r\n                onCropChange={onCropChange}\r\n                onSourceLoaded={onSourceLoaded}\r\n            />\r\n        </div>}\r\n\r\n        <FrameTrain onSTFrameChange={typeAbility => postPendulumInputGroupRef.current?.setValue({ typeAbility })} />\r\n\r\n        <StyledNameSetIdInputContainer className=\"name-style-id-input\">\r\n            <NameSetInputGroup ref={nameSetIdInputGroupRef}\r\n                onTakePicker={setPickerTarget}\r\n            />\r\n            <TextStylePicker key={stylePickerResetCount} ref={stylePickerRef}\r\n                frameInfo={FrameInfoMap[frame as keyof typeof FrameInfoMap]}\r\n                defaultType={nameStyleType}\r\n                defaultValue={nameStyle}\r\n                showExtraDecorativeOption={showExtraDecorativeOption}\r\n                onChange={changeNameStyle}\r\n            />\r\n            <CardIconInputGroup\r\n                isLink={isLink}\r\n                isMonster={isMonster}\r\n                showCreativeOption={showCreativeOption}\r\n            />\r\n        </StyledNameSetIdInputContainer>\r\n        <div className=\"main-info\">\r\n            <div className=\"main-info-first\">\r\n                <RadioTrain\r\n                    className=\"fill-input-train attribute-input\"\r\n                    value={attribute}\r\n                    onChange={changeAttribute}\r\n                    optionList={attributeList}\r\n                >\r\n                    <span>Attribute</span>\r\n                </RadioTrain>\r\n\r\n                {(isPendulum || frame !== 'link' || showCreativeOption)\r\n                    && <PendulumInputGroup ref={pendulumInputGroupRef}\r\n                        showCreativeOption={showCreativeOption}\r\n                        showExtraDecorativeOption={showExtraDecorativeOption}\r\n                        onTakePicker={setPickerTarget}\r\n                    />}\r\n\r\n                <PostPendulumInputGroup ref={postPendulumInputGroupRef} onTakePicker={setPickerTarget} />\r\n\r\n                <div>\r\n                    <div className=\"card-effect-letter-helper\">\r\n                        <StandaloneLabel className=\"standalone-label\">\r\n                            Effect\r\n                        </StandaloneLabel>\r\n                        <CharPicker\r\n                            targetId={pickerTarget.id}\r\n                            onPick={pickerTarget.setValue}\r\n                        />\r\n                    </div>\r\n                    <EffectInputGroup ref={effectInputGroupRef} onTakePicker={setPickerTarget} />\r\n                </div>\r\n\r\n                <FooterInputGroup ref={footerInputGroupRef}\r\n                    isMonster={isMonster}\r\n                    showCreativeOption={showCreativeOption}\r\n                    onTakePicker={setPickerTarget}\r\n                />\r\n            </div>\r\n            <div className=\"main-info-second\">\r\n                <ImageInputGroup ref={imageInputGroupRef}\r\n                    receivingCanvas={artworkCanvas}\r\n                    isLink={isLink}\r\n                    showExtraDecorativeOption={showExtraDecorativeOption}\r\n                    onSourceLoaded={onSourceLoaded}\r\n                    onTainted={onTainted}\r\n                    onCropChange={onCropChange}\r\n                />\r\n            </div>\r\n        </div>\r\n    </div>;\r\n});","import { Button, notification, Tooltip } from 'antd';\r\nimport { forwardRef, useCallback, useImperativeHandle, useRef, useState } from 'react';\r\nimport { MasterSeriesCanvas } from 'src/model';\r\nimport { useCardExport, useMasterSeriDrawer, useSetting } from 'src/service';\r\n\r\nexport type DownloadButtonRef = {\r\n    download: () => void,\r\n}\r\nexport type DownloadButton = {\r\n    isTainted: boolean,\r\n    isInitializing: boolean,\r\n    imageChangeCount: number,\r\n    canvasMap: MasterSeriesCanvas,\r\n    onDownloadError: () => void,\r\n};\r\nexport const DownloadButton = forwardRef<DownloadButtonRef, DownloadButton>(({\r\n    isTainted,\r\n    isInitializing,\r\n    imageChangeCount,\r\n    canvasMap,\r\n    onDownloadError,\r\n}, ref) => {\r\n    const allowHotkey = useSetting(state => state.setting.allowHotkey);\r\n    const { onExport } = useMasterSeriDrawer(\r\n        true,\r\n        canvasMap,\r\n        {\r\n            imageChangeCount,\r\n            isInitializing,\r\n        },\r\n    );\r\n    const {\r\n        drawCanvasRef,\r\n    } = canvasMap;\r\n    const exportRef = useRef({\r\n        currentPipeline: Promise.resolve(),\r\n        pipelineRunning: false,\r\n    });\r\n    const [isDownloading, setDownloading] = useState(false);\r\n    const onDownloadComplete = useCallback(() => {\r\n        setDownloading(false);\r\n    }, []);\r\n    const { onSave } = useCardExport({\r\n        isTainted,\r\n        isInitializing,\r\n        drawCanvasRef,\r\n        exportRef,\r\n        onExport,\r\n        onDownloadError,\r\n        onDownloadComplete,\r\n    });\r\n\r\n    const download = () => {\r\n        if (isTainted) {\r\n            notification.error({\r\n                message: 'Your card is tainted, you must save manually',\r\n                description: 'Right click the card → Choose \"Save image as...\"',\r\n            });\r\n            return;\r\n        }\r\n        setDownloading(true);\r\n        onSave();\r\n        return;\r\n    };\r\n    useImperativeHandle(ref, () => ({\r\n        download,\r\n    }));\r\n\r\n    if (isTainted) return null;\r\n    return <div className=\"save-button-container\">\r\n        <div id=\"save-button-waiting\" />\r\n        <Tooltip overlay={allowHotkey ? <>Ctrl-S / ⌘-S</> : null}>\r\n            <Button className=\"save-button\" loading={isDownloading} id=\"save-button-ready\" onClick={download}>\r\n                Download\r\n            </Button>\r\n        </Tooltip>\r\n    </div>;\r\n});","import { useCallback, useEffect, useRef } from 'react';\r\nimport { compressCardData, insertUrlParam, normalizedCardName } from 'src/util';\r\nimport { useCard } from './use-card';\r\nimport { CardOpacity } from 'src/model';\r\n\r\nexport type UseCardExport = {\r\n    isTainted: boolean,\r\n    isInitializing: boolean,\r\n    drawCanvasRef: React.RefObject<HTMLCanvasElement>,\r\n    exportRef: React.MutableRefObject<{\r\n        currentPipeline: Promise<void>;\r\n        pipelineRunning: boolean;\r\n    }>,\r\n    onExport: (exportProps: {\r\n        isPendulum: boolean,\r\n        opacity: Partial<CardOpacity>,\r\n        isRelevant: () => boolean,\r\n    }) => Promise<void>,\r\n    onDownloadError: () => void,\r\n    onDownloadComplete: () => void,\r\n};\r\nexport const useCardExport = ({\r\n    isTainted,\r\n    isInitializing,\r\n    drawCanvasRef,\r\n    exportRef,\r\n    onExport,\r\n    onDownloadError,\r\n    onDownloadComplete,\r\n}: UseCardExport) => {\r\n    const {\r\n        card: currentCard,\r\n    } = useCard();\r\n    const {\r\n        opacity,\r\n        name,\r\n        isPendulum,\r\n    } = currentCard;\r\n    const pendingSave = useRef(false);\r\n\r\n    const download = useCallback(() => {\r\n        const canvasRef = drawCanvasRef.current;\r\n        if (canvasRef && !isTainted) try {\r\n            const normalizedName = normalizedCardName(name);\r\n            var link = document.createElement('a');\r\n            link.download = normalizedName\r\n                ? `${normalizedName}.png`\r\n                : 'card.png';\r\n            link.href = canvasRef.toDataURL('image/png');\r\n            link.click();\r\n        } catch (e) {\r\n            onDownloadError();\r\n        }\r\n        document.querySelector('#export-canvas-guard')?.classList.remove('guard-on');\r\n        onDownloadComplete();\r\n    }, [drawCanvasRef, isTainted, name, onDownloadComplete, onDownloadError]);\r\n    const onSave = () => {\r\n        document.querySelector('#export-canvas-guard')?.classList.add('guard-on');\r\n        /** Prevent split-second download. By using hotkey user is able to perform extremely fast save process before the pipeline start running, thus getting the previous card data instead of the most recent one. */\r\n        setTimeout(() => {\r\n            if (exportRef.current.pipelineRunning === false) {\r\n                download();\r\n            } else pendingSave.current = true;\r\n        }, 200);\r\n    };\r\n\r\n    useEffect(() => {\r\n        let relevant = true;\r\n        setTimeout(() => {\r\n            const normalizedName = normalizedCardName(name);\r\n\r\n            if (relevant) {\r\n                document.title = normalizedName\r\n                    ? `${normalizedName} - Yu-Gi-Oh Carder`\r\n                    : 'Yu-Gi-Oh Carder';\r\n            }\r\n        }, 500);\r\n\r\n        return () => {\r\n            relevant = false;\r\n        };\r\n    }, [name]);\r\n\r\n    useEffect(() => {\r\n        let relevant = true;\r\n        let confirmReload = (ev: Event) => {\r\n            ev.preventDefault();\r\n            return 'Leave right now may make you lose unsaved progress, proceed?';\r\n        };\r\n        if (isInitializing === false) {\r\n            localStorage.setItem('card-data', JSON.stringify(currentCard));\r\n            localStorage.setItem('card-version', process.env.REACT_APP_VERSION ?? 'unknown');\r\n\r\n            /**\r\n             * Run export pipeline:\r\n             * - Immediately mark the pipeline as running, then run wait for the current pipeline (1).\r\n             * - If the (1) pipeline is no longer relevant, end effect.\r\n             * - Otherwise (the current pipeline is the newest), start export pipeline, this export pipeline is now the current pipeline (2).\r\n             * - If the (2) pipeline is no longer relevant, end effect.\r\n             * - Otherwise finish the pipeline and write result, also mark the pipeline as no longer running.\r\n             */\r\n            (async () => {\r\n                const canvasRef = drawCanvasRef.current;\r\n                if (canvasRef) {\r\n                    window.addEventListener('beforeunload', confirmReload);\r\n                    document.getElementById('export-canvas')?.classList.remove('js-export-available');\r\n                    document.getElementById('export-canvas-guard')?.setAttribute('style', '');\r\n                    document.getElementById('save-button-waiting')?.setAttribute('style', 'display: block');\r\n\r\n                    exportRef.current.pipelineRunning = true;\r\n                    /** Artifical delay, turn on to test export timing */\r\n                    // await new Promise(resolve => setTimeout(() => resolve(true), 3000));\r\n                    await exportRef.current.currentPipeline;\r\n\r\n                    if (relevant) {\r\n                        exportRef.current.currentPipeline = onExport({ isPendulum, opacity, isRelevant: () => relevant });\r\n\r\n                        await exportRef.current.currentPipeline;\r\n                        if (relevant) {\r\n                            const condensedCard = compressCardData(currentCard);\r\n                            if (typeof condensedCard === 'string') insertUrlParam('data', condensedCard);\r\n\r\n                            document.getElementById('export-canvas')?.classList.add('js-export-available');\r\n                            document.getElementById('export-canvas-guard')?.setAttribute('style', 'display: none');\r\n                            document.getElementById('save-button-waiting')?.setAttribute('style', 'display: none');\r\n                            window.removeEventListener('beforeunload', confirmReload);\r\n                            exportRef.current.pipelineRunning = false;\r\n\r\n                            if (pendingSave.current) {\r\n                                pendingSave.current = false;\r\n                                download();\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            })();\r\n        }\r\n\r\n        return () => {\r\n            window.removeEventListener('beforeunload', confirmReload);\r\n            relevant = false;\r\n        };\r\n    });\r\n\r\n    return {\r\n        onSave,\r\n    };\r\n};","import styled from 'styled-components';\r\n\r\nexport const StyledDataButtonPanelContainer = styled.div`\r\n    display: flex;\r\n    column-gap: var(--spacing);\r\n    border-radius: var(--br-lg);\r\n    font-size: var(--fs-4xl);\r\n    line-height: 1.5;\r\n    margin: auto;\r\n    max-width: var(--card-width);\r\n    min-height: 59px;\r\n    outline: none !important;\r\n    padding: var(--spacing);\r\n    padding-right: 0;\r\n    text-align: center;\r\n    text-shadow: 0 1px 2px black;\r\n    .anticon {\r\n        cursor: pointer;\r\n    }\r\n    button {\r\n        color: white;\r\n        border-radius: var(--br-lg);\r\n        outline: none !important;\r\n        cursor: pointer;\r\n    }\r\n    .save-button {\r\n        flex: 1;\r\n        font-size: var(--fs-xl);\r\n        border: var(--bw) solid var(--sub-secondary);\r\n        font-weight: 500;\r\n        box-shadow: var(--bs-button);\r\n        height: 39px; // Alignment\r\n        line-height: 1;\r\n        &:focus, &:active {\r\n            color: white;\r\n        }\r\n    }\r\n    #save-button-waiting {\r\n        cursor: wait;\r\n        position: absolute;\r\n        width: 100%;\r\n        height: 100%;\r\n        top: 0;\r\n        left: 0;\r\n        z-index: 1;\r\n    }\r\n    #save-button-ready {\r\n        cursor: pointer;\r\n        &:hover {\r\n            background-color: var(--sub-info);\r\n            box-shadow: none;\r\n        }\r\n    }\r\n    .save-button-container {\r\n        display: flex;\r\n        flex: 1;\r\n        font-size: var(--fs);\r\n        line-height: 1.35;\r\n        position: relative;\r\n    }\r\n    .imexport {\r\n        flex: 0 0 200px;\r\n        display: grid;\r\n        grid-template-columns: 1fr 1fr;\r\n        column-gap: var(--spacing);\r\n        button {\r\n            font-size: var(--fs);\r\n            background-color: var(--main-tertiary);\r\n            border: var(--bw) solid var(--sub-tertiary);\r\n            box-shadow: var(--bs-button);\r\n            &:hover {\r\n                background-color: var(--sub-tertiary);\r\n                box-shadow: none;\r\n            }\r\n        }\r\n    }\r\n`;\r\n\r\nexport const StyledCardCanvasGroupContainer = styled.div`\r\n    width: var(--card-width);\r\n    height: var(--card-height);\r\n    margin-bottom: var(--spacing);\r\n    transform: translateX(var(--translate-ratio)) translateY(var(--translate-ratio)) scale(var(--resize-ratio))\r\n        translateZ(0);\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    canvas {\r\n        position: absolute;\r\n        left: 0;\r\n        z-index: 1;\r\n        pointer-events: none;\r\n    }\r\n    &:hover {\r\n        .reset-button,\r\n        .lightbox-button {\r\n            display: block;\r\n        }\r\n        #export-canvas.js-export-available {\r\n            display: inline-block !important;\r\n            cursor: default;\r\n        }\r\n        #export-canvas-guard {\r\n            display: flex;\r\n            cursor: wait;\r\n            transition: all 2s;\r\n        }\r\n    }\r\n    #export-canvas {\r\n        display: none;\r\n        z-index: 100;\r\n        pointer-events: all;\r\n    }\r\n    #export-canvas-guard {\r\n        position: absolute;\r\n        left: 0;\r\n        display: none;\r\n        align-items: center;\r\n        justify-content: center;\r\n        z-index: 101;\r\n        // background-color: #ffffff08;\r\n        width: var(--card-width);\r\n        height: var(--card-height);\r\n        .anticon {\r\n            font-size: var(--fs-4xl);\r\n        }\r\n        .canvas-guard-alert {\r\n            position: absolute;\r\n            top: 0;\r\n            right: 0;\r\n            color: white;\r\n            padding: var(--spacing-xs) var(--spacing);\r\n            border-radius: 0 0 0 var(--br-lg);\r\n            background-color: var(--main-active);\r\n            box-shadow:\r\n                0 3px 6px rgba(0, 0, 0, 0.16),\r\n                0 3px 6px rgba(0, 0, 0, 0.23);\r\n        }\r\n        &.guard-on {\r\n            display: flex !important;\r\n        }\r\n    }\r\n    .crop-canvas {\r\n        position: relative;\r\n        width: 416px;\r\n        height: 416px;\r\n        z-index: 0;\r\n        visibility: hidden;\r\n    }\r\n`;\r\n\r\nexport const StyledAppLoading = styled.div`\r\n\tposition: fixed;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\tbackground-image: linear-gradient(45deg, #333, #333);\r\n\tz-index: 4000;\r\n\tcolor: white;\r\n\ttext-shadow:\r\n\t\t0 1px #333,\r\n\t\t0 2px #111;\r\n\tfont-size: var(--fs-3xl);\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n`;\r\n\r\nexport const StyledByMe = styled.div`\r\n\tposition: fixed;\r\n\tright: var(--spacing);\r\n\tbottom: 0;\r\n\tfont-size: var(--fs-xs);\r\n\topacity: 0.5;\r\n\tpadding: var(--spacing-px) var(--spacing-xs);\r\n\tcolor: var(--color-dim);\r\n    img {\r\n        height: 10px;\r\n        margin-left: 1px;\r\n    }\r\n`;\r\n\r\nexport const ErrorAlert = styled.span`\r\n    color: var(--main-danger);\r\n`;\r\n\r\nexport const OverlayButton = styled.div`\r\n    --overlay-size: 51px;\r\n    position: absolute;\r\n    z-index: 101;\r\n    background: var(--main-primary);\r\n    border-color: var(--main-active);\r\n    color: var(--color-heavy);\r\n    padding: var(--spacing);\r\n    line-height: 1;\r\n    font-size: var(--fs-3xl);\r\n    text-align: center;\r\n    width: var(--overlay-size);\r\n    height: var(--overlay-size);\r\n    border-radius: var(--br-lg);\r\n    cursor: pointer;\r\n    box-shadow: var(--bs-1);\r\n    display: none;\r\n    &:hover {\r\n        background: var(--sub-primary);\r\n    }\r\n`;\r\n\r\nexport const LightboxButton = styled(OverlayButton)`\r\n    top: var(--spacing-xs);\r\n    right: var(--spacing-xs);\r\n`;\r\n\r\nexport const ResetButton = styled(OverlayButton)`\r\n    top: var(--spacing-xs);\r\n    right: calc(var(--overlay-size) + 2 * var(--spacing-xs));\r\n`;","import { useCallback, useEffect, useMemo, useRef, useState } from 'react';\r\nimport 'antd/dist/antd.css';\r\nimport './app.scss';\r\nimport './style/index.scss';\r\nimport './responsive.scss';\r\nimport './reduce-color-motion.scss';\r\nimport {\r\n    CanvasConst,\r\n    getDefaultCard,\r\n} from './model';\r\nimport {\r\n    compressCardData,\r\n    decodeCardWithCompatibility,\r\n    isMobileDevice,\r\n} from './util';\r\nimport { CardInputPanel, CardInputPanelRef, DownloadButton, DownloadButtonRef } from './page';\r\nimport WebFont from 'webfontloader';\r\nimport { changeCardFormat, retrieveSavedCard, useCard, useOCGFont, useSetting } from './service';\r\nimport { Modal, notification, Tooltip } from 'antd';\r\nimport { TaintedCanvasWarning } from './component';\r\nimport { clearCanvas } from './draw';\r\nimport { ZoomInOutlined, ClearOutlined } from '@ant-design/icons';\r\nimport {\r\n    ErrorAlert,\r\n    LightboxButton,\r\n    ResetButton,\r\n    StyledAppLoading,\r\n    StyledByMe,\r\n    StyledCardCanvasGroupContainer,\r\n    StyledDataButtonPanelContainer,\r\n} from './app.styled';\r\nimport { configure, HotKeys } from 'react-hotkeys';\r\nimport { useShallow } from 'zustand/react/shallow';\r\n\r\n/** React hotkey setup */\r\nconfigure({\r\n    ignoreTags: [],\r\n});\r\nconst AppGlobalHotkeyMap = {\r\n    EXPORT: ['ctrl+d', 'command+d'],\r\n    IMPORT: ['ctrl+e', 'command+e'],\r\n    VIEW: ['ctrl+b', 'command+b'],\r\n    DOWNLOAD: ['ctrl+s', 'command+s'],\r\n};\r\n\r\nconst { height: CanvasHeight, width: CanvasWidth } = CanvasConst;\r\nfunction App() {\r\n    const {\r\n        allowHotkey,\r\n        softMode,\r\n    } = useSetting(useShallow(({ setting: { allowHotkey, reduceMotionColor } }) => ({\r\n        softMode: reduceMotionColor,\r\n        allowHotkey,\r\n    })));\r\n    const [isInitializing, setInitializing] = useState(true);\r\n    const [error, setError] = useState('');\r\n    const [sourceType, setSourceType] = useState<'internal' | 'external'>('external');\r\n    const [canvasKey, setCanvasKey] = useState(0);\r\n    const [lightboxVisible, setLightboxVisible] = useState(false);\r\n\r\n    const cardInputRef = useRef<CardInputPanelRef>(null);\r\n    const artworkCanvasRef = useRef<HTMLCanvasElement>(null);\r\n    const backgroundCanvasRef = useRef<HTMLCanvasElement>(null);\r\n    const drawCanvasRef = useRef<HTMLCanvasElement>(null);\r\n    const frameCanvasRef = useRef<HTMLCanvasElement>(null);\r\n    const cardIconCanvasRef = useRef<HTMLCanvasElement>(null);\r\n    const pendulumScaleCanvasRef = useRef<HTMLCanvasElement>(null);\r\n    const pendulumEffectCanvasRef = useRef<HTMLCanvasElement>(null);\r\n    const typeCanvasRef = useRef<HTMLCanvasElement>(null);\r\n    const effectCanvasRef = useRef<HTMLCanvasElement>(null);\r\n    const nameCanvasRef = useRef<HTMLCanvasElement>(null);\r\n    const statCanvasRef = useRef<HTMLCanvasElement>(null);\r\n    const setIdCanvasRef = useRef<HTMLCanvasElement>(null);\r\n    const passwordCanvasRef = useRef<HTMLCanvasElement>(null);\r\n    const creatorCanvasRef = useRef<HTMLCanvasElement>(null);\r\n    const stickerCanvasRef = useRef<HTMLCanvasElement>(null);\r\n    const finishCanvasRef = useRef<HTMLCanvasElement>(null);\r\n    const lightboxCanvasRef = useRef<HTMLCanvasElement>(null);\r\n    const [canvasMap] = useState({\r\n        artworkCanvasRef,\r\n        backgroundCanvasRef,\r\n        drawCanvasRef,\r\n        frameCanvasRef,\r\n        cardIconCanvasRef,\r\n        pendulumScaleCanvasRef,\r\n        pendulumEffectCanvasRef,\r\n        typeCanvasRef,\r\n        effectCanvasRef,\r\n        nameCanvasRef,\r\n        statCanvasRef,\r\n        setIdCanvasRef,\r\n        passwordCanvasRef,\r\n        creatorCanvasRef,\r\n        stickerCanvasRef,\r\n        finishCanvasRef,\r\n        lightboxCanvasRef,\r\n    });\r\n\r\n    const downloadButtonRef = useRef<DownloadButtonRef>(null);\r\n\r\n    const [imageChangeCount, setImageChangeCount] = useState(0);\r\n\r\n    useEffect(() => {\r\n        const ctx = drawCanvasRef.current?.getContext('2d');\r\n        const setCard = useCard.getState().setCard;\r\n        if (ctx) {\r\n            ctx.setTransform(1, 0, 0, 1, 0, 0);\r\n            ctx.imageSmoothingQuality = 'high';\r\n            clearCanvas(ctx);\r\n        }\r\n\r\n        WebFont.load({\r\n            custom: {\r\n                families: [\r\n                    'Matrix-Bold',\r\n                    'MatrixBoldSmallCaps',\r\n                    'MatrixBook',\r\n                    'MatrixRegularSmallCaps',\r\n                    'Yugioh Rush Duel Numbers V4',\r\n                    'YuGiOhITCStoneSerifBSc',\r\n                    'matrix',\r\n                    'palatino-linotype-bold',\r\n                    'stone-serif-bold',\r\n                    'stone-serif-regular',\r\n                ],\r\n                urls: ['asset/font.css'],\r\n            },\r\n            active: () => {\r\n                setCard(retrieveSavedCard());\r\n                setInitializing(false);\r\n            },\r\n            fontinactive(familyName, fvd) {\r\n                console.error('TCG fontinactive', familyName, fvd);\r\n                notification.error({\r\n                    message: `${familyName} font could not be loaded, this will impact your card quality`\r\n                });\r\n            },\r\n            inactive: () => {\r\n                setError('Font could not be loaded');\r\n                setInitializing(false);\r\n            },\r\n        });\r\n    }, []);\r\n\r\n    const {\r\n        styleContent: ocgStyleFile,\r\n    } = useOCGFont({\r\n        onBeforeLoad: () => {\r\n            setInitializing(true);\r\n            const ctx = drawCanvasRef.current?.getContext('2d');\r\n            if (ctx) {\r\n                ctx.setTransform(1, 0, 0, 1, 0, 0);\r\n                ctx.imageSmoothingQuality = 'high';\r\n                clearCanvas(ctx);\r\n            }\r\n        },\r\n        onActive: () => {\r\n            console.info('OCG Data Loaded');\r\n\r\n            setInitializing(false);\r\n        },\r\n        onInactive: () => {\r\n            setError('Data for OCG cards could not be loaded');\r\n            setInitializing(false);\r\n        },\r\n        onFontInactive: (familyName, fvd) => {\r\n            console.error('OCG fontinactive', familyName, fvd);\r\n            notification.error({\r\n                message: `${familyName} font could not be loaded, this will impact your card quality`\r\n            });\r\n        }\r\n    });\r\n\r\n    const [isTainted, setTainted] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const documentClassList = document.body.classList;\r\n\r\n        if (softMode) documentClassList.add('reduced-color-motion');\r\n        else documentClassList.remove('reduced-color-motion');\r\n    }, [softMode]);\r\n\r\n    const importData = useCallback((event?: { preventDefault: () => void }) => {\r\n        if (!allowHotkey) return;\r\n\r\n        event?.preventDefault();\r\n        const cardData = window.prompt('Paste your card data here');\r\n        const setCard = useCard.getState().setCard;\r\n\r\n        if (cardData) {\r\n            const decodedCard = decodeCardWithCompatibility(cardData);\r\n            setCard(decodedCard);\r\n            setImageChangeCount(cnt => cnt + 1);\r\n            cardInputRef.current?.forceCardData(decodedCard);\r\n            /** Allow navigate input panel right away */\r\n            document.querySelector<HTMLElement>('.radio-train-input-group')?.focus();\r\n        }\r\n    }, [allowHotkey]);\r\n\r\n    const exportData = useCallback((event?: { preventDefault: () => void }) => {\r\n        if (!allowHotkey) return;\r\n\r\n        event?.preventDefault();\r\n        if (sourceType === 'internal') window.alert('Cannot export card data if you use offline image');\r\n        const exportableCard = useCard.getState().card;\r\n\r\n        window.prompt(\r\n            'Save card data for later use',\r\n            `${compressCardData(exportableCard)}`,\r\n        );\r\n    }, [allowHotkey, sourceType]);\r\n\r\n    const downloadFromHotkey = useCallback((event?: { preventDefault: () => void }) => {\r\n        if (!allowHotkey) return;\r\n\r\n        event?.preventDefault();\r\n        downloadButtonRef.current?.download();\r\n    }, [allowHotkey]);\r\n\r\n    const hotkeyHandlerMap = useMemo(() => {\r\n        return {\r\n            IMPORT: importData,\r\n            EXPORT: exportData,\r\n            VIEW: () => setLightboxVisible(true),\r\n            DOWNLOAD: downloadFromHotkey,\r\n        };\r\n    }, [downloadFromHotkey, exportData, importData]);\r\n\r\n    const alertDownloadError = useCallback(() => {\r\n        setTainted(true);\r\n        alert('Could not save card, please manually save it by right click the card → Choose \"Save image as...\"');\r\n    }, []);\r\n\r\n    const rerenderAllImage = useCallback(() => {\r\n        setCanvasKey(cnt => cnt + 1);\r\n        setImageChangeCount(cnt => cnt + 1);\r\n        setTainted(false);\r\n    }, []);\r\n\r\n    const rerenderCardImage: NonNullable<CardInputPanel['onCropChange']> = useCallback((_, sourceType) => {\r\n        setImageChangeCount(cnt => cnt + 1);\r\n        setSourceType(sourceType);\r\n    }, []);\r\n\r\n    const markTaintedImage = useCallback(() => {\r\n        setImageChangeCount(cnt => cnt + 1);\r\n        setTainted(true);\r\n    }, []);\r\n\r\n    return (\r\n        <HotKeys keyMap={AppGlobalHotkeyMap} handlers={hotkeyHandlerMap}>\r\n            <div id=\"app\"\r\n                /** Prevent accidentally replace the page when dragging image into card art input. */\r\n                onDrop={() => { }}\r\n                style={{\r\n                    backgroundImage: `url(\"${process.env.PUBLIC_URL}/asset/image/texture/debut-dark.png\"), linear-gradient(180deg, #00000022, #00000044)`,\r\n                    height: isMobileDevice() ? '-webkit-fill-available' : '100vh',\r\n                    ...({\r\n                        '--card-height': `${CanvasConst.height}px`,\r\n                        '--card-width': `${CanvasConst.width}px`,\r\n                    }),\r\n                }}\r\n            >\r\n                {ocgStyleFile && <link rel=\"stylesheet\" type=\"text/css\" href={ocgStyleFile} />}\r\n                <div\r\n                    className={'app-container'}\r\n                    style={{\r\n                        backgroundImage: `url(\"${process.env.PUBLIC_URL}/asset/image/texture/dark-denim-3.png\")`,\r\n                    }}\r\n                >\r\n                    {isInitializing && <StyledAppLoading className=\"app-loading\">\r\n                        {error.length > 0\r\n                            ? <ErrorAlert>\r\n                                {error}\r\n                            </ErrorAlert>\r\n                            : 'Loading fonts and scripts...'}\r\n                    </StyledAppLoading>}\r\n                    {/* <div className=\"card-filter-panel\"></div> */}\r\n                    <div className={`card-preview-panel ${isTainted ? 'export-tainted' : 'export-normal'}`}>\r\n                        <StyledDataButtonPanelContainer className=\"data-button-panel\">\r\n                            <div className=\"imexport\">\r\n                                <Tooltip overlay={allowHotkey ? <>Ctrl-D / ⌘-D</> : null}>\r\n                                    <button onClick={exportData}>Export Data</button>\r\n                                </Tooltip>\r\n                                <Tooltip overlay={allowHotkey ? <>Ctrl-E / ⌘-E</> : null}>\r\n                                    <button onClick={importData}>Import Data</button>\r\n                                </Tooltip>\r\n                            </div>\r\n                            <DownloadButton ref={downloadButtonRef}\r\n                                canvasMap={canvasMap}\r\n                                imageChangeCount={imageChangeCount}\r\n                                isTainted={isTainted}\r\n                                isInitializing={isInitializing}\r\n                                onDownloadError={alertDownloadError}\r\n                            />\r\n                            {isTainted && <div id=\"save-button-tainted\" className=\"save-button-container\">\r\n                                <span>Manual save by right click the card<br />→ \"Save image as...\" {TaintedCanvasWarning}</span>\r\n                            </div>}\r\n                        </StyledDataButtonPanelContainer>\r\n                        <div className=\"card-canvas-container\">\r\n                            <StyledCardCanvasGroupContainer className=\"card-canvas-group\">\r\n                                <Tooltip title=\"Reset\">\r\n                                    <ResetButton className=\"reset-button\" onClick={() => {\r\n                                        const consent = window.confirm(\r\n                                            'This will reset your card information back to default, make sure you export the current data first!',\r\n                                        );\r\n\r\n                                        if (consent) {\r\n                                            const { setCard, card } = useCard.getState();\r\n                                            const defaultCard = getDefaultCard();\r\n                                            const contextualDefaultCardData = card.format === 'tcg'\r\n                                                ? defaultCard\r\n                                                : changeCardFormat(defaultCard, 'ocg');\r\n\r\n                                            setCard(contextualDefaultCardData);\r\n                                            setImageChangeCount(cnt => cnt + 1);\r\n                                            cardInputRef.current?.forceCardData(contextualDefaultCardData);\r\n                                        }\r\n                                    }}>\r\n                                        <ClearOutlined />\r\n                                    </ResetButton>\r\n                                </Tooltip>\r\n                                <Tooltip title={<>\r\n                                    Original size\r\n                                    {allowHotkey ? <><br />Ctrl-B / ⌘-B</> : null}\r\n                                </>}>\r\n                                    <LightboxButton className=\"lightbox-button\" onClick={() => setLightboxVisible(cur => !cur)}>\r\n                                        <ZoomInOutlined />\r\n                                    </LightboxButton>\r\n                                </Tooltip>\r\n                                <canvas id=\"export-canvas\" key={canvasKey + 0.1} ref={drawCanvasRef} width={CanvasWidth} height={CanvasHeight} />\r\n                                {/** Overlay guarding seems very janky, cursor should suffix for now */}\r\n                                <div id=\"export-canvas-guard\" onContextMenu={e => e.preventDefault()}>\r\n                                    {/* <div className=\"canvas-guard-alert\">Generating...</div> */}\r\n                                </div>\r\n                                <canvas id=\"frameCanvas\" key={canvasKey} ref={frameCanvasRef} width={CanvasWidth} height={CanvasHeight} />\r\n                                <canvas id=\"nameCanvas\" ref={nameCanvasRef} width={CanvasWidth} height={148} />\r\n                                <canvas id=\"cardIconCanvas\" ref={cardIconCanvasRef} width={CanvasWidth} height={222} />\r\n                                <canvas id=\"pendulumScaleCanvas\" ref={pendulumScaleCanvasRef} width={CanvasWidth} height={889} />\r\n                                <canvas id=\"pendulumEffectCanvas\" ref={pendulumEffectCanvasRef} width={CanvasWidth} height={889} />\r\n                                <canvas id=\"typeCanvas\" ref={typeCanvasRef} width={CanvasWidth} height={1037} />\r\n                                <canvas id=\"effectCanvas\" ref={effectCanvasRef} width={CanvasWidth} height={1111} />\r\n                                <canvas id=\"statCanvas\" ref={statCanvasRef} width={CanvasWidth} height={CanvasHeight} />\r\n                                <canvas id=\"setIdCanvas\" ref={setIdCanvasRef} width={CanvasWidth} height={CanvasHeight} />\r\n                                <canvas id=\"passwordCanvas\" ref={passwordCanvasRef} width={CanvasWidth} height={CanvasHeight} />\r\n                                <canvas id=\"creatorCanvas\" ref={creatorCanvasRef} width={CanvasWidth} height={CanvasHeight} />\r\n                                <canvas id=\"stickerCanvas\" ref={stickerCanvasRef} width={CanvasWidth} height={CanvasHeight} />\r\n                                <canvas id=\"finishCanvas\" ref={finishCanvasRef} width={CanvasWidth} height={CanvasHeight} />\r\n                                <canvas className=\"crop-canvas\" ref={artworkCanvasRef} />\r\n                                <canvas className=\"crop-canvas\" ref={backgroundCanvasRef} />\r\n                            </StyledCardCanvasGroupContainer>\r\n                        </div>\r\n                    </div>\r\n                    {isInitializing === false && <CardInputPanel\r\n                        ref={cardInputRef}\r\n                        artworkCanvas={artworkCanvasRef.current}\r\n                        backgroundCanvas={backgroundCanvasRef.current}\r\n                        onSourceLoaded={rerenderAllImage}\r\n                        onCropChange={rerenderCardImage}\r\n                        onTainted={markTaintedImage}\r\n                    />}\r\n                </div>\r\n                {/** Pixel perfect for card image */}\r\n                <Modal\r\n                    width=\"843px\"\r\n                    wrapClassName=\"card-lightbox-overlay\"\r\n                    visible={lightboxVisible}\r\n                    forceRender={true}\r\n                    onCancel={() => setLightboxVisible(false)}\r\n                    footer={null}\r\n                >\r\n                    <canvas key={canvasKey + 0.1}\r\n                        id=\"lightbox-canvas\"\r\n                        ref={lightboxCanvasRef}\r\n                        width={CanvasWidth}\r\n                        height={CanvasHeight}\r\n                    />\r\n                </Modal>\r\n                <StyledByMe className=\"by-me\">\r\n                    Made by Lauqerm <img src=\"https://i.imgur.com/Ix5cq8k.png\" alt=\"avatar\" />\r\n                </StyledByMe>\r\n            </div>\r\n        </HotKeys>\r\n    );\r\n}\r\n\r\nexport default App;\r\n","import { useEffect, useRef, useState } from 'react';\r\nimport WebFont from 'webfontloader';\r\nimport { useCard } from './use-card';\r\nimport { useShallow } from 'zustand/react/shallow';\r\n\r\nexport type UseOCGFont = {\r\n    onBeforeLoad: () => void,\r\n    onActive: () => void,\r\n    onInactive: () => void,\r\n    onFontInactive: (familyName: string, fvd: string) => void,\r\n}\r\nexport const useOCGFont = ({\r\n    onActive,\r\n    onBeforeLoad,\r\n    onFontInactive,\r\n    onInactive,\r\n}: UseOCGFont) => {\r\n    const {\r\n        font,\r\n        format,\r\n    } = useCard(useShallow(state => ({\r\n        format: state.card.format,\r\n        font: state.card.nameStyle.font,\r\n    })));\r\n    const [styleContent, setStyleContent] = useState('');\r\n\r\n    const ocgReady = useRef(false);\r\n    const loadAttempt = useRef(0);\r\n    useEffect(() => {\r\n        if (\r\n            (format === 'ocg' || font === 'OCG')\r\n            && ocgReady.current === false\r\n            && loadAttempt.current <= 3\r\n        ) {\r\n            loadAttempt.current += 1;\r\n            setStyleContent(`${process.env.PUBLIC_URL}/asset/ocg-font.css`);\r\n            onBeforeLoad();\r\n\r\n            WebFont.load({\r\n                custom: {\r\n                    families: [\r\n                        'DFHSGothic-W3-WIN-RKSJ-H',\r\n                        'DFKakuTaiHiStd-W4',\r\n                        'FOT-Rodin Pro M',\r\n                        'Yu-Gi-Oh! DF Leisho 3',\r\n                    ],\r\n                    urls: ['asset/ocg-font.css'],\r\n                },\r\n                active: () => {\r\n                    ocgReady.current = true;\r\n                    onActive();\r\n                },\r\n                inactive: () => {\r\n                    ocgReady.current = true;\r\n                    onInactive();\r\n                },\r\n                fontinactive: onFontInactive,\r\n            });\r\n        }\r\n    }, [format, font, onActive, onBeforeLoad, onFontInactive, onInactive]);\r\n\r\n    return {\r\n        styleContent,\r\n    };\r\n};","const reportWebVitals = onPerfEntry => {\n    if (onPerfEntry && onPerfEntry instanceof Function) {\n        import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n            getCLS(onPerfEntry);\n            getFID(onPerfEntry);\n            getFCP(onPerfEntry);\n            getLCP(onPerfEntry);\n            getTTFB(onPerfEntry);\n        });\n    }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './app';\r\nimport reportWebVitals from './reportWebVitals';\r\n\r\nReactDOM.render(\r\n    <React.StrictMode>\r\n        <App />\r\n    </React.StrictMode>,\r\n    document.getElementById('root'),\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}